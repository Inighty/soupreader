# 02 — UI 布局排版与交互规范（迁移级别）

> 本规范用于把“页面结构、信息层级、间距、热区、状态页”对齐到 Legado 的语义体验。  
> 具体 Flutter 组件允许差异（必须使用 Cupertino 体系），但用户可见语义必须同义。

## 通用规范（适用于所有页面）

### 1) 状态页一致性
- 加载态：不跳变布局；避免突然出现/消失导致列表抖动
- 空态：给出明确原因与下一步动作（如“未添加书源/未搜索到结果”）
- 错误态：显示“可读的错误摘要” + “重试”入口；同时记录关键日志节点

### 2) 热区与手势
- 列表项点击：主动作（进入详情/进入阅读/打开二级页）
- 列表项长按：二级动作（编辑/删除/置顶/导出等）
- iOS 侧滑返回：所有二级页面必须可侧滑返回（使用 Cupertino 路由）

### 3) 文案与提示
- 迁移期差异/blocked：必须提示“原因 + 替代方案 + 回补计划引用（见 03_blocked_log.md）”

## 页面规范

### A. 主界面（Tab）
参考 Legado：`app/src/main/java/io/legado/app/ui/main/MainActivity.kt`

- Tab 项：书架/发现/我的（RSS 本轮隐藏）
- 重按（双击）窗口：300ms
  - 书架：回到顶部
  - 发现：折叠/回到顶部（EInk 模式为瞬间回顶，非 EInk 可平滑）

**验收点**
- Tab 数变化时（隐藏发现/RSS）：当前 Tab 迁移策略合理，不出现空白页或越界

### B. 发现页（Explore）
参考 Legado：`.../ExploreFragment.kt`

**布局层级**
1. 顶部：搜索框（query hint 对齐“找书/查找”语义）
2. 右上：分组入口（用 iOS ActionSheet 代替 Android 子菜单）
3. 主体：发现列表（可滚动）
4. 空态：当列表为空且搜索框非空/空时，分别提示不同原因（需对齐 legacy 行为）

**交互**
- 输入过滤：即时刷新
- `group:`：仅当以 `group:` 开头才进入分组过滤分支
- 列表项操作：打开/编辑源/置顶/删除/搜索

### C. 书架页（Bookshelf）
参考 Legado：`BookshelfFragment1.kt` + `BookshelfFragment2.kt`

**布局层级**
- 顶部：分组（style1：横向分组条/分段控件；style2：待对齐确认）
- 主体：书籍列表（列表/网格两种）
- 书籍卡片信息：封面、书名、作者、最近阅读时间、未读数/养肥数（根据设置开关）

**交互**
- 点击书籍：进入阅读器
- 长按书籍：弹出操作菜单（删除/置顶/缓存/导出/编辑等，按矩阵逐项对齐）
- 分组长按：进入分组编辑（style1 明确；style2 待读取确认）

### D. 搜索页（Search）
参考 Legado：`ui/book/search/**`

**布局层级**
- 顶部：搜索输入与搜索范围提示（组/源）
- 主体：聚合结果列表（来源分段/合并展示按 SoupReader 既定设计，但语义需同义）
- 底部：分页加载与“继续加载”提示

**交互**
- 精准搜索：开关语义对齐 legado
- 加入书架：入口一致，加入后状态正确回显

### E. 书源管理（Source）
参考 Legado：`ui/book/source/manage/**`、`edit/**`、`debug/**`

**布局层级**
- 列表页：分组/排序/过滤 + 列表 + 空态
- 编辑页：基础/规则/JSON/调试 四 Tab（或等价信息架构）

**交互**
- 导入：支持 URL/JSON/剪贴板/文件
- 调试：给出明确错误信息（规则解析失败、网络失败、登录失效等）

### F. 阅读器（Reader）
参考 Legado：`ReadMenu.kt`、`TextActionMenu.kt`、`SearchMenu.kt`、`ReadBookActivity.kt`

**布局层级**
- 正文阅读区域（翻页/滚动等模式）
- 点击唤起菜单：顶部栏 + 底部栏
- 亮度调节：自动/手动 + 侧边栏位置切换
- 进度条：page/chapter 两种行为（chapter 跳转需确认）

**交互**
- 顶部书名点击：进入详情页
- 文本选择菜单：复制/分享/浏览器或搜索/系统处理文本（朗读相关入口隐藏）
- 阅读内搜索：结果跳转与退出

