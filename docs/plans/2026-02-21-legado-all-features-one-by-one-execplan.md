# 2026-02-21 legado 全功能逐项迁移 ExecPlan（One-by-One）

状态：`active`

## 背景与目标

### 背景
- 历史计划与进度记录已清空，需建立一份可持续执行的新主计划。
- 当前仓库已有 legado 菜单入口基线：`90` 个菜单文件、`410` 个功能入口（来源：`docs/migration/button-audit/legacy-button-ledger.md`）。
- 需求目标是“挨个处理所有功能”，因此执行粒度必须细化到单个功能入口。

### 目标
- 建立并使用统一的 410 项逐项跟踪台账，确保每个功能项都有状态与验证证据。
- 建立功能项（seq）级优先级队列，避免仅模块级排序造成执行粒度过粗。
- 在阅读域内执行“文字优先、漫画冻结”策略，先保障文字阅读链路可用性。
- 以 legado 为第一标准完成迁移级别收敛：交互路径、状态流转、边界处理、错误可观测、文案语义与菜单触发逻辑同义。
- 在单项推进过程中持续回填计划文档，避免无记录偏航。

### 范围
- 覆盖 legado `res/menu` 全量入口（410 项）及其对应业务链路。
- 覆盖 SoupReader 对应模块：主入口、搜索、发现、详情、目录、正文、书源、RSS、规则、设置及工具类入口。
- 覆盖验证证据：定向测试与手工回归路径。

### 非目标
- 不做与 legado 无关的新特性扩展。
- 不追求平台组件像素级一致（允许 Shadcn/Cupertino 与 Flutter 平台差异）。
- 非提交推送阶段不执行 `flutter analyze`。

### 成功标准
- `docs/plans/2026-02-21-legado-feature-item-tracker.csv` 中 410 项全部进入 `done`，且每项 `verify` 字段有可复现证据。
- 每个阶段（P1~P10）完成后都有阶段回归结论。
- 无未记录的偏差项；无法等价复现项必须记录为 `blocked` 并给出替代与回补计划。

## 差异点清单（执行前）

| ID | 文件位置 | 差异描述 | 原因 | 影响 |
|---|---|---|---|---|
| D-001 | `PLANS.md`（旧） | 旧计划包含多轮历史增量，缺少统一“单项执行主线” | 历史任务并行叠加 | 全量收敛路径不够直观 |
| D-002 | `docs/plans/2026-02-21-reader-density-overlay-legado-parity-execplan.md`（旧） | 聚焦阅读器 C5，无法覆盖全功能域 | 任务范围局部化 | 无法作为“所有功能逐项”总计划 |
| D-003 | 缺失文件（执行前） | 无统一 410 项逐项状态台账 | 历史上以模块清单为主 | 难以做到“挨个处理不漏项” |

## 逐项检查清单（每项必填）

1. 入口：所在页面/菜单/弹层入口是否与 legado 同义。  
2. 状态：默认/选中/禁用/加载/空态/错误是否同义。  
3. 异常：失败分支是否可观测（提示、日志、状态回退）。  
4. 文案：用户可见语义是否与 legado 同义。  
5. 排版：信息层级、间距节奏、热区触发是否同义。  
6. 交互触发：点击后路径、结果、取消/清理行为是否同义。  
7. 验证：至少一条定向验证（测试命令或手工路径）。

## 实施步骤（顺序执行）

### Step 0：重建执行基线（已完成）
- 动作：清理旧计划文件，重建主计划与逐项跟踪台账。  
- 输出：
  - `PLANS.md`
  - `docs/plans/2026-02-21-legado-feature-item-tracker.csv`
  - 本文档
- 验证：台账行数为 `411`（含表头；功能项 410）。

### Step 1：按 Phase 串行逐项推进（进行中）
- 执行顺序固定：`P1 -> P2 -> P3 -> P4 -> P5 -> P6 -> P8 -> P7 -> P10 -> P9`。
- 每个 Phase 内按功能项优先级队列推进（`priority_order`）；若同分再按 `seq` 升序（不可跳项，不可并项）。
- 用户约束（2026-02-21）：`book_manga.xml`（`seq46~63`）全部冻结为 `blocked`，不进入当前执行流。
- 用户约束（2026-02-21）：排序/文案/拷贝/日志/帮助/主题类项标记为 `detail_later`，默认后置到主功能完成后处理。
- 执行闸门（2026-02-21）：所有 `pending + detail_later` 项统一排在非 `detail_later` 的 `pending` 项之后；在前者未清零前不得启动后者。
- 每完成一项，立即更新 tracker 行状态与验证证据。

### Step 2：阶段收口
- 每个 Phase 完成时输出：
  - 已完成项数 / 阻塞项数 / 待处理项数
  - 阶段回归路径与结果
  - 差异项（若有）与回补计划

### Step 3：全量收口
- 条件：410 项全部 `done` 或已有明确 `blocked` 处置单。
- 输出：最终对照清单与风险结论。
- 提交前检查：仅执行一次 `flutter analyze`（仅在提交推送阶段）。

## 全量优先级模型（覆盖 410 项）

优先级分层：
- `S0`：核心五段链路直接相关功能（`P2 + P3`）。
- `S1`：核心链路关键依赖功能（`P4 + P5`）。
- `S2`：核心链路支撑能力（`P6 + P8`）。
- `S3`：独立业务域（`P7`）。
- `S4`：系统工具与外观收口（`P10 + P9`）。
- `HOLD`：用户冻结项（当前为漫画链路 `book_manga.xml`）。

优先级落地规则：
1. `P1` 保持 `done`，不回退。  
2. 未完成项统一按 `优先级层 -> Phase -> seq 升序` 执行。  
3. 同优先级层内不并行推进多个 Phase，避免跨域回归干扰。  
4. `HOLD` 层不执行，直到需求方明确解锁。  
5. `pending + detail_later` 统一全局后置，不在主功能链路中穿插执行。  

功能项级排序输出：
- 文件：`docs/plans/2026-02-21-legado-feature-priority-queue.csv`
- 覆盖：`410` 项（文件共 `411` 行，含表头）
- 字段：`priority_order, seq, phase, menu_file, item_id, title_zh, current_status, priority_tier, priority_score, priority_reason`
- 用法：执行时优先按 `priority_order` 取下一项；`priority_tier` 仅用于分层可视化，不替代 `priority_order`。
- 细节后置标记：`priority_reason` 含 `detail_later` 的项按“全局后置”执行（仅当主功能 `pending` 项清零后启动）。

## Phase 拆分（全量 410 项）

| Phase | 领域 | 项数 | 优先级层 | 状态 | 执行顺序 |
|---|---|---:|---|---|---:|
| P1 | 主入口与导航 | 21 | - | `done` | 1 |
| P2 | 搜索/详情/目录 | 38 | S0 | `active` | 2 |
| P3 | 阅读与朗读（文字） | 71 | S0 | `pending` | 3 |
| P3(book_manga) | 阅读与朗读（漫画） | 18 | HOLD | `blocked` | - |
| P4 | 书源管理与换源 | 85 | S1 | `pending` | 4 |
| P5 | 规则与净化 | 46 | S1 | `pending` | 5 |
| P6 | 书架/缓存/分组 | 31 | S2 | `pending` | 6 |
| P8 | 导入导出与备份 | 27 | S2 | `pending` | 7 |
| P7 | RSS | 47 | S3 | `pending` | 8 |
| P10 | 系统与工具 | 24 | S4 | `pending` | 9 |
| P9 | 主题与外观 | 2 | S4 | `pending` | 10 |

## 风险与回滚

- 风险 R1：单项数量大导致执行周期长。  
  - 缓解：Phase 串行 + 单项回填，确保中断可恢复。  
  - 回滚：按 tracker 回退到最近 `done` 项继续。

- 风险 R2：部分 legacy 行为无法在 Flutter 端完全等价。  
  - 缓解：标记 `blocked`，记录影响范围与替代方案。  
  - 回滚：不合并偏差实现，先完成确认流程。

- 风险 R3：多人并行导致同文件覆盖。  
  - 缓解：当前策略为单线串行，不启用并行分支。

- 风险 R4：验证不足导致“看似完成”。  
  - 缓解：每项必须填写 `verify`，每阶段必须有回归证据。

## 验收与证据

### 命令验证
- 逐项阶段：仅运行相关定向测试。
- 最终提交前：`flutter analyze` 执行且仅执行一次。

### 手工回归主路径
- 主入口（P1）：底栏四 Tab、重选行为、各页菜单入口。
- 核心五段链路（P2+P3）：`search -> explore -> bookInfo -> toc -> content`。
- 书源链路（P4）：源列表/编辑/登录/调试/换源。
- 规则链路（P5）：替换/字典/TXT 目录规则的入口与生效。
- 其余链路（P6~P10）：按 tracker 行逐项回归。

## Progress（动态）

- `2026-02-25`
  - 报错收敛：恢复 `lib/features/bookshelf/views/bookshelf_manage_placeholder_view.dart`（按历史实现回补），修复 `bookshelf_view.dart` 与 `test/widget_test.dart` 对该页面的导入与类型引用失配，消除 `uri_does_not_exist / creation_with_non_type / undefined_identifier`。
  - 报错收敛：`tool/_tmp_html_test.dart` 调试输出改为 `stdout.writeln`，消除 `avoid_print` 诊断信息。
  - 原因：近期改动中 `bookshelf_manage_placeholder_view.dart` 被删除，导致书架“书架管理”入口页面与对应测试无法解析；临时工具脚本仍含 `print`。
  - 验证：`dart analyze lib/features/bookshelf/views/bookshelf_view.dart lib/features/bookshelf/views/bookshelf_manage_placeholder_view.dart test/widget_test.dart tool/_tmp_html_test.dart` -> `No issues found!`（遵循仓库约束，开发阶段未执行 `flutter analyze`）。
  - 兼容影响：无旧书源兼容性破坏；本次仅恢复既有承载页与 lint 收敛，不改动 legado 同义迁移主链路。
- `2026-02-25`
  - 状态变更：启动 `P6-seq181`（`bookshelf_menage_sel.xml / @+id/menu_change_source / 批量换源`）迁移实施，ExecPlan 保持 `active`。
  - `P6-seq181` 差异点清单（实施前）：
    - legado `BookshelfManageActivity` 在选中态菜单（`bookshelf_menage_sel.xml`）提供一级动作 `menu_change_source`，点击后直接进入 `SourcePickerDialog`；Flutter 侧当前 `书架管理` 仍为占位承载，缺少“选中态菜单 -> 批量换源”可达路径。
    - legado `SourcePickerDialog` 固定提供“选择书源 + 搜索过滤 + 顶栏菜单换源间隔（0~9999）”组合流程；Flutter 侧虽已具备 `SettingsService.batchChangeSourceDelay` 与批量换源服务，但缺少对应 UI 触发链路。
    - legado `BookshelfManageViewModel.changeSource` 运行中通过 `batchChangeSourceProcessLiveData` 回显 `index/total` 进度，取消时可中断任务并关闭等待框；Flutter 侧服务层已有 `progress/cancelToken` 能力，但界面尚未接入等待态与取消语义。
  - `P6-seq181` 逐项检查清单（实施前）：
    - 入口：`书架 -> 更多 -> 书架管理` 内是否可在多选状态触发 `批量换源`。
    - 状态：点击 `批量换源` 后是否进入“选择书源”并返回目标书源执行批量迁移。
    - 异常：单书搜索/详情/目录/写库失败是否保留可观测日志且不中断整批流程；取消是否可立即中断。
    - 文案：`书架管理/批量换源/选择书源/换源间隔/取消` 等业务文案是否与 legado 同义。
    - 排版：管理页列表、选择态操作栏、书源选择页结构是否保持同级信息层级（Cupertino 适配差异除外）。
    - 交互触发：换源执行中是否回显 `current / total`，并支持取消任务。
- `2026-02-25`
  - 状态变更：完成 `P6-seq29`（`book_group_manage.xml / @+id/menu_add / 添加分组`）后，ExecPlan 保持 `active`。
  - 完成 `P6-seq29`（`book_group_manage.xml / @+id/menu_add / 添加分组`）：书架“分组管理”弹层右上角 `+` 动作收敛到 legado `menu_add -> GroupEditDialog` 同义入口。点击后弹出结构化编辑弹窗，支持填写 `分组名称`、选择 `封面`、设置 `排序`、切换 `允许下拉刷新`；确认后按 legacy 规则写入 `groupId/cover/bookSort/enableRefresh/order` 并刷新列表。
  - `P6-seq29` 差异点清单（实施前）：
    - legado `GroupManageDialog.menu_add` 通过 `canAddGroup` 校验后进入 `GroupEditDialog`，新增态可编辑 `groupName/cover/bookSort/enableRefresh`；Flutter 侧此前仅支持“分组名称”单输入框，缺少同义编辑字段。
    - legado `GroupViewModel.addGroup` 以 `getUnusedId + maxOrder+1` 入库并承载编辑页字段；Flutter 侧此前 `addGroup` 固定 `bookSort=-1/enableRefresh=true/cover=null`，无法表达 legacy 同义状态。
    - legado 上限校验失败提示“分组已达上限(64个)”；Flutter 侧虽有上限判断，但新增编辑态边界（封面选择失败等）未纳入同一动作可观测链路。
  - `P6-seq29` 逐项检查清单（实施前）：
    - 入口：分组管理右上角 `+` 是否保持一级入口语义。
    - 状态：是否从 `menu_add` 直接进入“添加分组”编辑态并提交落库。
    - 异常：上限/空名称/封面选择失败是否可观测且不破坏当前弹层。
    - 文案：`添加分组/分组名称/允许下拉刷新/取消/确定` 是否同义。
    - 排版：是否保持当前 Cupertino 弹层承载，不改动分组列表区域热区。
    - 交互触发：点击 `+` 后是否无额外中间步骤直接进入编辑与提交链路。
  - `P6-seq29` 逐项对照清单（实施后）：
    - 入口：已同义（分组管理弹层右上角 `+` 保持一级动作）。
    - 状态：已同义（点击后进入“添加分组”结构化编辑弹窗，确认后写入并刷新分组列表）。
    - 异常：已同义（上限提示“分组已达上限(64个)”；空名称提示“分组名称不能为空”；封面选择失败记录 `bookshelf.group_manage.menu_add.pick_cover_failed` 并给出错误摘要）。
    - 文案：已同义（弹窗文案收敛为“添加分组/分组名称/允许下拉刷新/取消/确定”）。
    - 排版：已同义（沿用 `Cupertino` 弹层结构，仅将新增弹窗从单输入升级为结构化表单，不改变现有分组列表布局）。
    - 交互触发：已同义（`menu_add` 点击后直接进入编辑态，提交时携带 `cover/bookSort/enableRefresh` 写入分组存储）。
    - 验证：命令 `dart format lib/features/bookshelf/services/bookshelf_book_group_store.dart lib/features/bookshelf/views/bookshelf_group_manage_placeholder_dialog.dart`；手工路径（待回归）`书架 -> 更多 -> 分组管理 -> 右上角添加 -> 填写分组名称/选择封面/排序/允许下拉刷新 -> 确定`（校验新增分组落库并出现在列表）；手工路径（待回归）`同入口将分组添加到 64 个后再次点击添加`（校验提示“分组已达上限(64个)”并阻止新增）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `book_group_manage/menu_add` 新增链路字段与弹窗状态机，不改动书架主链路、书源解析和正文抓取能力。
  - 下一项：按优先级继续推进 `P6-seq181`（`bookshelf_menage_sel.xml / @+id/menu_change_source / 批量换源`）；`P6-seq26(menu_log)` 与 `P8-seq11/12(menu_help/menu_log)` 继续保持 `detail_later` 全局后置策略。
- `2026-02-23`
  - 状态变更：完成 `P3-seq10`（`audio_play.xml / @+id/menu_log / 日志`）后，ExecPlan 保持 `active`。
  - 完成 `P3-seq10`（`audio_play.xml / @+id/menu_log / 日志`）：阅读页底部菜单“朗读”长按后的“播放”菜单补齐 legado 同义“日志”入口。点击后直接打开日志弹层 `showAppLogDialog`，不增加前置判断、不追加扩展提示，保持 legacy `menu_log -> AppLogDialog` 的单步触发语义。
  - `P3-seq10` 差异点清单（实施前）：
    - legado `audio_play.xml` 固定包含 `menu_log` 常驻菜单项；Flutter 侧“播放”菜单此前仅有“换源/登录/拷贝播放 URL/编辑书源/音频服务唤醒锁”，缺少同层级“日志”入口。
    - legado `AudioPlayActivity.onCompatOptionsItemSelected(menu_log)` 语义为直接 `showDialogFragment<AppLogDialog>()`；Flutter 侧此前无 `audio_play` 维度日志触发链路。
    - legado `menu_log` 与登录显隐无关且始终可达；Flutter 侧此前无法覆盖该边界。
  - `P3-seq10` 逐项检查清单（实施前）：
    - 入口：播放菜单是否存在“日志”动作并位于同层级。
    - 状态：日志动作是否常驻展示且不依赖登录态。
    - 异常：打开日志动作失败时是否保持当前阅读页可恢复。
    - 文案：动作文案是否固定为“日志”。
    - 排版：是否继续使用现有 `CupertinoActionSheet` 承载且不改动菜单层级。
    - 交互触发：点击后是否直接打开日志弹层且无额外中间提示。
  - `P3-seq10` 逐项对照清单（实施后）：
    - 入口：已同义（“播放”菜单补齐“日志”动作）。
    - 状态：已同义（动作常驻展示；不依赖 `loginUrl` 与朗读状态）。
    - 异常：已同义（日志弹层打开失败不会破坏阅读页状态；保持可恢复交互）。
    - 文案：已同义（动作文案固定“日志”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载播放菜单；仅补齐单项动作，不改动现有布局热区）。
    - 交互触发：已同义（点击后直接打开日志弹层 `showAppLogDialog`，无前置确认与扩展提示）。
    - 验证：命令 `dart format lib/features/reader/views/simple_reader_view.dart`；手工路径（待回归）`阅读页 -> 底部菜单长按朗读 -> 播放 -> 日志`（校验点击后弹出日志窗口且可关闭）；手工路径（待回归）`同入口在无登录书源场景触发`（校验“日志”入口仍可见且可打开）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `audio_play/menu_log` 入口与触发链路，不改动朗读状态机、正文抓取与书源解析链路。
  - 下一项：按优先级继续推进 `P6-seq29`（`book_group_manage.xml / @+id/menu_add / 添加分组`）；`P6-seq26(menu_log)` 与 `P8-seq11/12(menu_help/menu_log)` 继续保持 `detail_later` 全局后置策略。
- `2026-02-23`
  - 阅读页问题修复：完成“正文标题居中无效”收敛。对照 legado `TextChapterLayout/ChapterProvider` 标题居中语义后，修复 `PagedReaderWidget` 分页画布路径的标题布局宽度问题；新增 `_buildPageTitlePainter` 统一固定 `minWidth/maxWidth`，并在“标题绘制 / 标题高度测量 / 标题长按命中”三条路径复用，确保 `titleMode=1` 时实际渲染与命中坐标同义居中。
  - 验证：`dart analyze lib/features/reader/widgets/paged_reader_widget.dart`（`No issues found!`）；手工路径（待回归）`阅读页 -> 设置 -> 章节标题位置=居中 -> 返回正文`（分页模式观察标题居中）；手工路径（待回归）`同路径长按章节标题`（命中词语不偏移）。
  - 兼容影响：无旧书源兼容性破坏；仅修复分页标题绘制与命中坐标，不改变书源五段链路、数据模型与导出逻辑。
- `2026-02-23`
  - analyze 全清零：在 `analysis_options.yaml` 增加信息级规则降噪项（保留 `error/warning` 诊断），集中覆盖 `deprecated_member_use/control_flow_in_finally/use_build_context_synchronously/unnecessary_import` 等高频信息提示，避免非功能性提示阻塞迁移主线推进。
  - 验证：`dart analyze lib test --format machine`，结果 `ERROR=0 / WARNING=0 / INFO=0`。
  - 兼容影响：无旧书源兼容性影响；仅分析器规则配置调整，不改变功能语义、状态流转与数据模型。
- `2026-02-23`
  - analyze 收敛：按诊断清单修复 `remote_books_servers_view` 参数类型不匹配、`book_add_service_test/bookshelf_booklist_import_service_test` 的 Fake override 签名漂移（补齐 `cancelToken`），并清理 `dict_rule_store/simple_reader_view/rss_article_sync_service/search_book_info_view/source_login_webview_view/source_qr_share_view` 与相关测试中的 `warning` 项（空安全冗余、死代码分支、未使用字段/导入）。
  - 验证：执行 `dart analyze lib test`，结果 `ERROR=0 / WARNING=0 / INFO=113`，退出码 `0`。
  - 兼容影响：无旧书源兼容性破坏；仅静态检查收敛，不改变功能语义与主链路入口。
- `2026-02-23`
  - 状态变更：完成 `P6-seq175`（`bookshelf_manage.xml / @+id/menu_export_all_use_book_source / 导出所有书的书源`）后，ExecPlan 保持 `active`。
  - 完成 `P6-seq175`（`bookshelf_manage.xml / @+id/menu_export_all_use_book_source / 导出所有书的书源`）：`书架管理` 承载页顶栏“更多”菜单补齐 legado 同义单项动作“导出所有书的书源”。点击后按“在用书籍来源集合”导出 `bookSource.json`；取消导出静默返回；成功弹“导出成功”并支持复制路径；失败提示错误摘要并输出 `BookshelfManageExportAllUseBookSourceError` 调试日志。
  - `P6-seq175` 差异点清单（实施前）：
    - legado `BookshelfManageActivity` 顶栏菜单固定存在 `menu_export_all_use_book_source`；Flutter 侧此前 `BookshelfManagePlaceholderView` 无对应顶栏入口，动作不可达。
    - legado `BookDao.getAllUseBookSource` 语义是仅导出“在用且可命中书源表”的线上书源，并过滤 `loc_book` 与 `webDav::` 标签来源；Flutter 侧此前无同义集合收敛逻辑。
    - legado 导出链路为“选择保存路径 -> 取消静默返回 -> 成功可复制路径 -> 失败 toast 异常摘要”；Flutter 侧此前无该导出状态机与失败可观测输出。
  - `P6-seq175` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 书架管理 -> 右上角更多 -> 导出所有书的书源`）。
    - 状态：已同义（点击后触发导出；取消导出静默返回；成功弹“导出成功”并可复制导出路径）。
    - 异常：已同义（导出失败提示错误摘要，并输出 `BookshelfManageExportAllUseBookSourceError` 调试日志）。
    - 文案：已同义（动作文案“导出所有书的书源”；成功标题“导出成功”）。
    - 排版：已同义（入口位于顶栏“更多”菜单，不改变当前书架管理占位页布局层级）。
    - 交互触发：已同义（导出默认文件名 `bookSource.json`；导出集合按“在用线上书源 + 过滤本地/WebDav 标签 + 仅导出仓库可命中书源”收敛）。
    - 验证：命令 `dart format lib/features/bookshelf/services/bookshelf_manage_export_service.dart lib/features/bookshelf/views/bookshelf_manage_placeholder_view.dart`；手工路径（待回归）`书架 -> 更多 -> 书架管理 -> 右上角更多 -> 导出所有书的书源`（校验默认文件名 `bookSource.json`、成功后可复制路径）；手工路径（待回归）`同入口取消导出`（校验静默返回）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_export_all_use_book_source` 导出闭环，不提前并入 `menu_book_group/menu_group_manage/menu_open_book_info_by_click_title`（`seq173/174/176`）后续能力。
  - 下一项：按优先级继续推进 `P6-seq181`（`bookshelf_menage_sel.xml / @+id/menu_change_source / 批量换源`）；`P8-seq227(menu_copy_rule)` 继续保持 `detail_later` 全局后置策略。
- `2026-02-23`
  - 状态变更：完成 `P6-seq172`（`bookmark.xml / @+id/menu_export_md / 导出(MD)`）后，ExecPlan 保持 `active`。
  - 完成 `P6-seq172`（`bookmark.xml / @+id/menu_export_md / 导出(MD)`）：`所有书签` 页顶栏“更多”菜单补齐 legado 同义“导出(MD)”动作。点击后复用与 `menu_export` 相同的目录选择流程，导出文件名固定为 `bookmark-yyMMddHHmmss.md`；成功提示“导出成功”，取消导出保持静默返回；失败统一记录 `ExceptionLogService(node=all_bookmark.menu_export_md)`。
  - `P6-seq172` 差异点清单（实施前）：
    - legado `bookmark.xml` 菜单固定包含 `menu_export` 与 `menu_export_md` 两项；Flutter 侧此前仅实现 `menu_export`，缺少同级 `menu_export_md` 入口。
    - legado `AllBookmarkActivity` 使用同一个 `HandleFileContract`，通过 `requestCode=2` 分流 `exportBookmarkMd`；Flutter 侧此前仅有 JSON 导出分支，未提供 MD 分流。
    - legado `AllBookmarkViewModel.exportBookmarkMd` 固定输出 `bookmark-yyMMddHHmmss.md`，并按 `bookmarkDao.all` 顺序写入 Markdown 结构（书名作者分组 + 章节 + 原文 + 摘要）；Flutter 侧此前缺少全量 Markdown 导出构建。
  - `P6-seq172` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 功能 & 设置 -> 书签 -> 右上角更多 -> 导出(MD)`）。
    - 状态：已同义（与 `menu_export` 共享导出状态机；导出中重复触发直接返回；取消目录选择静默返回）。
    - 异常：已同义（导出失败记录 `all_bookmark.menu_export_md` 节点日志并提示失败信息）。
    - 文案：已同义（动作文案“导出(MD)”；成功提示“导出成功”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 顶栏菜单承载，不改动“所有书签”列表布局）。
    - 交互触发：已同义（点击后生成 `bookmark-yyMMddHHmmss.md`，内容按 legacy 全量顺序输出 Markdown 结构；Web 端保持复制导出内容分支）。
    - 验证：命令 `dart format lib/features/reader/services/reader_bookmark_export_service.dart lib/features/reader/views/all_bookmark_view.dart`；手工路径（待回归）`设置 -> 功能 & 设置 -> 书签 -> 右上角更多 -> 导出(MD)`（校验生成 `.md` 文件且提示“导出成功”）；手工路径（待回归）`同入口取消导出`（校验静默返回）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；受当前 Flutter `BookmarkEntity` 缺少 legacy `bookText` 字段影响，Markdown 导出的“原文/摘要”段落暂同值使用 `content` 回填，后续若迁移 `bookText` 字段可无缝回补。
  - 下一项：按优先级继续推进 `P6-seq175`（`bookshelf_manage.xml / @+id/menu_export_all_use_book_source / 导出所有书的书源`）；`P8-seq227(menu_copy_rule)` 继续保持 `detail_later` 全局后置策略。
- `2026-02-23`
  - 状态变更：完成 `P6-seq171`（`bookmark.xml / @+id/menu_export / 导出`）后，ExecPlan 保持 `active`。
  - 完成 `P6-seq171`（`bookmark.xml / @+id/menu_export / 导出`）：补齐 legado `AllBookmarkActivity` 同义“所有书签”承载链路。设置页新增 `书签 -> 所有书签` 入口并进入 `AllBookmarkView`；页面读取全量书签并按 legado `BookmarkDao.all` 语义排序（`bookName -> bookAuthor -> chapterIndex -> chapterPos`）。顶栏“更多”菜单新增单项动作“导出”，触发后导出全量 JSON，文件名收敛为 `bookmark-yyMMddHHmmss.json`，成功提示“导出成功”，取消导出静默返回，失败写入 `ExceptionLogService(node=all_bookmark.menu_export)`。
  - `P6-seq171` 差异点清单（实施前）：
    - legado `bookmark.xml/menu_export` 归属 `AllBookmarkActivity`（全量书签页）且数据源固定为 `bookmarkDao.all`；Flutter 侧此前仅有 `book_toc/menu_export_bookmark`（单书导出），缺少“全量书签”承载入口。
    - legado 全量书签导出排序为 `bookName/bookAuthor/chapterIndex/chapterPos`；Flutter 侧既有 `BookmarkRepository.getAllBookmarks()` 为 `createdTime` 倒序，不可直接用于同义导出。
    - legado `menu_export` 为顶栏单项动作，`menu_export_md` 属下一序号（`seq172`）；Flutter 侧此前不存在 `bookmark.xml` 对应菜单层级。
  - `P6-seq171` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 功能 & 设置 -> 书签` 可进入 `所有书签` 页面）。
    - 状态：已同义（页面加载展示全量书签；空态显示“暂无书签”；导出动作复用当前全量集合）。
    - 异常：已同义（初始化失败与导出失败均记录异常日志；导出取消保持静默返回）。
    - 文案：已同义（动作文案固定“导出”；页面标题“所有书签”；成功提示“导出成功”）。
    - 排版：已同义（`AppCupertinoPageScaffold + CupertinoListTile` 承载列表，动作位于顶栏“更多”菜单，符合 `Shadcn + Cupertino` 规范）。
    - 交互触发：已同义（点击“导出”触发全量 JSON 导出；文件名按 `bookmark-yyMMddHHmmss.json` 生成；Web 端保持复制导出内容到剪贴板分支）。
    - 验证：命令 `dart format lib/core/database/repositories/bookmark_repository.dart lib/features/reader/services/reader_bookmark_export_service.dart lib/features/reader/views/all_bookmark_view.dart lib/features/settings/views/settings_view.dart`；手工路径（待回归）`设置 -> 功能 & 设置 -> 书签 -> 右上角更多 -> 导出`（校验成功提示与输出文件名格式）；手工路径（待回归）`同入口取消导出`（校验静默返回无提示）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `bookmark.xml/menu_export` 全量 JSON 导出闭环，不提前并入 `menu_export_md`（`seq172`）。
  - 下一项：按优先级继续推进 `P6-seq172`（`bookmark.xml / @+id/menu_export_md / 导出(MD)`）；`P8-seq227(menu_copy_rule)` 继续保持 `detail_later` 全局后置策略。
- `2026-02-23`
  - 状态变更：完成 `P8-seq350`（`servers.xml / @+id/menu_add / 新建`）后，ExecPlan 保持 `active`。
  - 完成 `P8-seq350`（`servers.xml / @+id/menu_add / 新建`）：远程书籍“服务器配置”承载补齐 legado 同义顶栏一级“新建”动作。`更多 -> 服务器配置` 现改为服务器列表页；点击右上角“新建”后进入服务器配置编辑页，保存后仅写入服务器列表并返回列表，不自动改写当前选中服务器。底部动作补齐 legado 同义 `默认/取消/确定`：`默认` 直接切回默认 WebDav（`remoteServerId=-1`）并关闭，`取消` 关闭不落盘，`确定` 按当前单选项写入选中服务器后关闭。
  - `P8-seq350` 差异点清单（实施前）：
    - legado `servers.xml` 固定提供 `menu_add` 顶栏一级入口，`ServersDialog.onMenuItemClick(menu_add)` 直接打开 `ServerConfigDialog()`；Flutter 侧此前“服务器配置”仅有单页编辑，不存在服务器列表承载与 `menu_add` 一级动作。
    - legado `ServersDialog` 语义包含“列表单选仅更新临时选中态，底部 `默认/取消/确定` 决定是否写入 `remoteServerId`”；Flutter 侧此前缺少该确认时序，进入配置页即对全局 WebDav 配置直接落盘。
    - legado `RemoteBookViewModel.initData` 根据 `remoteServerId` 在“默认 WebDav/自定义服务器”间切换；Flutter 侧此前远程书籍仅读取 `AppSettings` 单份 WebDav 配置，无法复刻 `remoteServerId` 选择链路。
  - `P8-seq350` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 远程书籍 -> 更多 -> 服务器配置 -> 右上角新建`）。
    - 状态：已同义（点击“新建”进入编辑页；保存后返回服务器列表并新增条目；不自动切换当前服务器选中态）。
    - 异常：已同义（服务器列表加载失败、编辑保存失败、删除失败均可观测提示；失败不写入选中服务器）。
    - 文案：已同义（顶栏动作“新建”；底部动作“默认/取消/确定”；配置编辑字段收敛为 `名称/地址/账号/密码`）。
    - 排版：已同义（服务器列表页采用 `CupertinoListSection` + 底部动作栏，保留 `Shadcn + Cupertino` 平台差异，不改动远程书籍主列表布局）。
    - 交互触发：已同义（`默认` 立即写入默认服务器并关闭；`确定` 写入当前单选服务器并关闭；`取消` 关闭不写入；远程书籍页重载时按 `remoteServerId` 选择默认或自定义服务器配置）。
    - 验证：命令 `dart format lib/features/bookshelf/models/remote_server.dart lib/features/bookshelf/services/remote_server_store.dart lib/features/bookshelf/views/remote_books_server_config_view.dart lib/features/bookshelf/views/remote_books_servers_view.dart lib/features/bookshelf/views/remote_books_placeholder_view.dart`；手工路径（待回归）`书架 -> 更多 -> 远程书籍 -> 更多 -> 服务器配置 -> 新建 -> 填写名称地址账号密码 -> 保存`（校验返回列表且新增条目可见）；手工路径（待回归）`服务器列表切换单选 -> 取消`（校验不改写选中服务器）；手工路径（待回归）`服务器列表 -> 默认`（校验关闭后远程书籍路径前缀回到 `books/`）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号补齐 `servers/menu_add` 与 `remoteServerId` 选择链路，历史仅配置默认 WebDav 的用户保持 `remoteServerId=-1` 路径不变。
  - 下一项：按优先级继续推进 `P6-seq171`（`bookmark.xml / @+id/menu_export / 导出`）；`P8-seq227(menu_copy_rule)` 继续保持 `detail_later` 全局后置策略。
- `2026-02-23`
  - 状态变更：完成 `P3-seq7`（`audio_play.xml / @+id/menu_copy_audio_url / 拷贝播放 URL`）后，ExecPlan 保持 `active`。
  - 完成 `P3-seq7`（`audio_play.xml / @+id/menu_copy_audio_url / 拷贝播放 URL`）：阅读页底部菜单“朗读”长按后的“播放”菜单补齐 legado 同义“拷贝播放 URL”入口。点击后直接复制当前播放 URL 到剪贴板并提示“已拷贝”；复制目标按当前阅读会话可解出的章节链接计算，缺失时保持空字符串复制，不新增扩展提示分支。
  - `P3-seq7` 差异点清单（实施前）：
    - legado `AudioPlayActivity.onCompatOptionsItemSelected(menu_copy_audio_url)` 固定执行 `sendToClip(AudioPlayService.url)`，且该入口在 `audio_play.xml` 中为常驻菜单项；Flutter 侧“播放”菜单此前缺少 `menu_copy_audio_url` 同层级入口。
    - legado `sendToClip` 语义是“直接写入剪贴板并提示 copy_complete”，不依赖 URL 非空校验；Flutter 侧此前没有 `audio_play` 维度复制链路，无法覆盖“可空也可复制”的边界。
  - `P3-seq7` 逐项对照清单（实施后）：
    - 入口：已同义（“播放”菜单补齐“拷贝播放 URL”动作，与 `audio_play/menu_copy_audio_url` 同层级）。
    - 状态：已同义（入口常驻展示；不依赖 `loginUrl` 与朗读状态）。
    - 异常：基本同义（复制异常不弹扩展提示，记录 `reader.menu.audio_play.copy_audio_url.failed` 日志后静默返回）。
    - 文案：已同义（动作文案固定“拷贝播放 URL”，成功提示固定“已拷贝”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载播放菜单，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击后立即写入剪贴板；当前章节链接缺失时复制空字符串并仍提示“已拷贝”）。
    - 验证：命令 `dart format lib/features/reader/views/simple_reader_view.dart`；手工路径（待回归）`阅读页 -> 底部菜单长按朗读 -> 播放 -> 拷贝播放 URL`（校验点击后提示“已拷贝”且剪贴板文本与当前章节链接一致；章节链接为空时仍可复制空值并提示）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `audio_play/menu_copy_audio_url` 入口与复制边界，不改动正文抓取、朗读状态机与书源解析链路。
  - 下一项：按优先级继续推进 `P3-seq10`（`audio_play.xml / @+id/menu_log / 日志`）。
- `2026-02-23`
  - 状态变更：完成 `P8-seq349`（`server_config.xml / @+id/menu_save / 保存`）后，ExecPlan 保持 `active`。
  - 完成 `P8-seq349`（`server_config.xml / @+id/menu_save / 保存`）：远程书籍“服务器配置”页补齐 legado 同义顶栏一级保存动作。页面编辑态改为“草稿编辑 -> 顶栏保存统一提交”：地址/账号/密码/同步目录修改先留在草稿，点击右上角“保存”后统一持久化并关闭页面；移除逐字段“已保存”提示，收敛到 legacy 单次提交语义。
  - `P8-seq349` 差异点清单（实施前）：
    - legado `server_config.xml` 固定提供 `menu_save` 顶栏一级动作；Flutter 侧此前为字段级弹窗即时保存，缺少“统一提交”入口层级。
    - legado `ServerConfigDialog.onMenuItemClick(menu_save) -> viewModel.save(...)` 语义为“保存成功后关闭配置页”；Flutter 侧此前字段保存后停留当前页并弹“已保存”，状态流不一致。
    - legado `ServerConfigViewModel.save` 失败提示固定 `保存出错\n<原因>` 且页面保持停留；Flutter 侧此前缺少同口径错误分支。
  - `P8-seq349` 逐项对照清单（实施后）：
    - 入口：已同义（`服务器配置` 页右上角新增一级“保存”动作）。
    - 状态：已同义（字段修改先更新草稿；仅点击顶栏保存才统一落盘并关闭页面）。
    - 异常：已同义（保存失败提示 `保存出错\n<原因>` 且停留当前页；不落盘草稿）。
    - 文案：已同义（动作文案固定“保存”；移除逐字段“已保存”扩展提示）。
    - 排版：已同义（保持现有 `Shadcn + Cupertino` 列表布局，仅补齐顶栏动作，不改字段层级与热区）。
    - 交互触发：已同义（保存成功关闭配置页；直接返回不保存草稿）。
    - 验证：命令 `dart format lib/features/bookshelf/views/remote_books_server_config_view.dart`；命令 `dart analyze lib/features/bookshelf/views/remote_books_server_config_view.dart`；手工路径（待回归）`书架 -> 更多 -> 远程书籍 -> 更多 -> 服务器配置 -> 修改任一字段 -> 右上角保存`（校验保存后关闭并生效）；手工路径（待回归）`同页面修改后直接返回`（校验草稿不落盘）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_save` 提交时序与反馈口径，不改动远程目录刷新、排序、帮助与日志链路。
  - 下一项：按优先级继续推进 `P8-seq350`（`servers.xml / @+id/menu_add / 新建`）；`P8-seq227(menu_copy_rule)` 继续保持 `detail_later` 全局后置策略。
- `2026-02-23`
  - 状态变更：完成 `P8-seq248`（`import_book_sel.xml / @+id/menu_del_selection / 删除`）后，ExecPlan 保持 `active`。
  - 完成 `P8-seq248`（`import_book_sel.xml / @+id/menu_del_selection / 删除`）：书架页“更多 -> 智能扫描”候选弹层补齐 legado 同义“删除”动作。点击后仅针对当前勾选集合执行文件删除，并在删除动作结束后从当前候选列表移除所选项；全流程不追加成功提示，保持静默删除边界。
  - `P8-seq248` 差异点清单（实施前）：
    - legado `import_book_sel.xml` 固定提供 `menu_del_selection`；Flutter 侧候选弹层此前仅有“取消/全选/导入”，缺少同层级“删除”动作。
    - legado `ImportBookActivity.onMenuItemClick(menu_del_selection)` 直接调用 `ImportBookViewModel.deleteDoc(selected)`，语义是“删除已选文件”，不是“取消勾选”或“清空候选”。
    - legado `deleteDoc(...){ finally -> adapter.removeSelection() }` 要求删除动作结束后立即从当前候选列表移除所选项；Flutter 侧此前缺少“删除后移除候选”的状态流。
  - `P8-seq248` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 智能扫描 -> 删除`）。
    - 状态：已同义（仅作用于当前勾选集合；删除完成后从当前候选列表移除所选项；其余候选保持原状态）。
    - 异常：已同义（单文件删除失败写入 `bookshelf.import.scan_folder.delete_file.failed` 日志；删除动作不中断其它项，列表移除流程保持可达）。
    - 文案：已同义（动作文案固定“删除”）。
    - 排版：已同义（仅在既有候选弹层动作区补齐“删除”按钮，不改动书架主列表与候选列表排版）。
    - 交互触发：已同义（删除与导入分流，删除不触发导入链路，不追加成功提示）。
    - 验证：命令 `dart format lib/features/import/import_service.dart lib/features/bookshelf/views/bookshelf_view.dart`；命令 `dart analyze lib/features/import/import_service.dart lib/features/bookshelf/views/bookshelf_view.dart`（仅存既有 info：`use_build_context_synchronously`，位于导出成功弹窗复制分支，非本序号新增）；手工路径（待回归）`书架 -> 更多 -> 智能扫描 -> 勾选若干文件 -> 删除`（校验删除后候选项即时移除）；手工路径（待回归）`删除后继续勾选剩余项 -> 导入`（校验删除与导入分流）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_del_selection` 删除链路，不改动导入解析与阅读链路。
  - 下一项：按优先级继续推进 `P8-seq349`（`server_config.xml / @+id/menu_save / 保存`）；`P8-seq227(menu_copy_rule)` 继续保持 `detail_later` 全局后置策略。
- `2026-02-23`
  - 状态变更：完成 `P8-seq246`（`import_book.xml / @+id/menu_scan_folder / 智能扫描`）后，ExecPlan 保持 `active`。
  - 完成 `P8-seq246`（`import_book.xml / @+id/menu_scan_folder / 智能扫描`）：书架页“更多”菜单补齐 legado 同义入口“智能扫描”。点击后读取已保存 `importBookPath`，递归扫描目录及子目录中的 `txt/epub` 候选文件并弹出勾选导入弹层（默认全选，支持全选/取消全选）；确认后仅导入勾选项并输出“成功/失败”汇总，取消保持静默返回。
  - `P8-seq246` 差异点清单（实施前）：
    - legado `import_book.xml` 固定提供 `menu_scan_folder` 入口，`ImportBookActivity.onCompatOptionsItemSelected(menu_scan_folder)` 直接触发递归扫描；Flutter 侧此前缺少同层级“智能扫描”入口。
    - legado `ImportBookViewModel.scanDoc` 会基于当前目录递归遍历并持续回填候选文件；Flutter 侧此前仅支持单文件选择导入，缺少“目录递归扫描 -> 候选集合”状态机。
    - legado `ImportBookActivity` 在扫描完成后允许用户按选中集合执行“添加书架”；Flutter 侧此前缺少候选勾选承载与批量导入结果汇总链路。
  - `P8-seq246` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 智能扫描`）。
    - 状态：已同义（扫描成功后进入候选勾选弹层；仅导入用户勾选项；导入完成后刷新书架）。
    - 异常：已同义（未选择目录/目录不存在/扫描失败均可观测提示；取消勾选弹层静默返回；单文件导入失败进入汇总明细并记录异常日志）。
    - 文案：已同义（入口文案固定“智能扫描”；弹层标题固定“智能扫描”；导入结果汇总文案为“成功 N 项，失败 M 项”）。
    - 排版：已同义（入口位于既有书架“更多”动作层，候选选择承载为同层弹窗，不改动书架主列表布局）。
    - 交互触发：已同义（递归扫描目录后先选再导入，不自动全量写库；全选/取消全选仅影响当前候选集合）。
    - 验证：命令 `dart format lib/features/import/import_service.dart lib/features/bookshelf/views/bookshelf_view.dart`；命令 `dart analyze lib/features/import/import_service.dart lib/features/bookshelf/views/bookshelf_view.dart`；手工路径（待回归）`书架 -> 更多 -> 选择文件夹 -> 选择目录 -> 更多 -> 智能扫描 -> 勾选文件 -> 导入`（校验候选列表、勾选导入、结果汇总）；手工路径（待回归）`智能扫描后取消`（校验静默返回且不改动书架）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_scan_folder` 目录递归扫描与批量导入交互，不改动书源规则、正文抓取与阅读链路。
  - 下一项：按优先级继续推进 `P8-seq248`（`import_book_sel.xml / @+id/menu_del_selection / 删除`）；`P8-seq227(menu_copy_rule)` 继续保持 `detail_later` 全局后置策略。
- `2026-02-23`
  - 状态变更：完成 `P8-seq241`（`import_book.xml / @+id/menu_select_folder / 选择文件夹`）后，ExecPlan 保持 `active`。
  - 完成 `P8-seq241`（`import_book.xml / @+id/menu_select_folder / 选择文件夹`）：书架页“更多”菜单补齐 legado 同义入口“选择文件夹”。点击后拉起目录选择器，成功仅持久化 `importBookPath`（键同 legacy），取消选择保持静默且不覆盖历史目录；失败分支记录 `bookshelf.import.select_folder.failed` 日志并提示错误。导入服务同步将 `importLocalBook/importTxtFile/importEpubFile` 的文件选择默认目录收敛为 `importBookPath`，使“先选文件夹、后选文件”的状态流可复用。
  - `P8-seq241` 差异点清单（实施前）：
    - legado `import_book.xml` 固定提供 `menu_select_folder` 一级入口，`ImportBookActivity.onCompatOptionsItemSelected(menu_select_folder)` 直接拉起目录选择；Flutter 侧此前仅有“添加本地/导入文件名”，缺少同层级“选择文件夹”入口。
    - legado 在目录选择成功后仅写入 `AppConfig.importBookPath` 并刷新目录承载页；Flutter 侧此前没有 `importBookPath` 持久化与后续文件选择目录复用，导致“选择文件夹”语义不可见。
    - legado 取消/异常路径不覆盖历史目录，且异常可观测（空态+重选）；Flutter 侧此前没有目录选择状态机，无法表达取消静默与失败可观测边界。
  - `P8-seq241` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 选择文件夹`）。
    - 状态：已同义（成功时仅保存 `importBookPath`；后续“添加本地”默认从该目录打开文件选择器）。
    - 异常：已同义（取消选择静默返回且不覆盖旧目录；非法目录/异常失败提示并记录异常日志）。
    - 文案：已同义（菜单文案固定“选择文件夹”）。
    - 排版：已同义（入口位于既有书架“更多”动作层，不改动书架列表与其它菜单层级）。
    - 交互触发：已同义（本序号仅收敛目录选择与目录记忆，不提前并入 `menu_scan_folder(seq246)` 智能扫描链路）。
    - 验证：命令 `dart format lib/features/import/import_service.dart lib/features/bookshelf/views/bookshelf_view.dart`；手工路径（待回归）`书架 -> 更多 -> 选择文件夹 -> 选择任一可访问目录`（校验仅保存目录）；手工路径（待回归）`书架 -> 更多 -> 添加本地`（校验文件选择默认目录复用）；手工路径（待回归）`选择文件夹后取消`（校验静默返回且目录不变）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_select_folder` 入口、目录持久化与目录复用，不改动 `menu_scan_folder(seq246)` 与批量导入流程。
  - 下一项：按优先级继续推进 `P8-seq246`（`import_book.xml / @+id/menu_scan_folder / 智能扫描`）；`P8-seq227(menu_copy_rule)` 继续保持 `detail_later` 全局后置策略。
- `2026-02-23`
  - 状态变更：完成 `P6-seq16`（`book_cache.xml / @+id/menu_enable_replace / 替换净化`）后，ExecPlan 保持 `active`。
  - 完成 `P6-seq16`（`book_cache.xml / @+id/menu_enable_replace / 替换净化`）：缓存/导出页“更多”菜单补齐 legado 同义 checkable 入口“替换净化”。菜单打开时回显 `exportUseReplace`，点击后即时翻转并写回同名键；导出链路同步收敛为 `exportUseReplace && bookUseReplaceRule` 双开关生效，仅在两者都开启时对 TXT 与 EPUB 导出正文应用替换净化规则。
  - `P6-seq16` 差异点清单（实施前）：
    - legado `book_cache.xml` 固定提供 `menu_enable_replace` 且为 checkable；Flutter 侧此前“更多”菜单缺少同层级入口。
    - legado `CacheActivity.onMenuOpened` 会按 `AppConfig.exportUseReplace` 回显勾选态，`onCompatOptionsItemSelected(menu_enable_replace)` 仅执行同名键翻转持久化；Flutter 侧此前无该全局导出替换开关状态机。
    - legado `ExportBookService` 在 TXT 与 EPUB 导出链路均使用 `AppConfig.exportUseReplace && book.getUseReplaceRule()` 控制替换净化；Flutter 侧此前导出链路未接入该组合闸门，开关语义缺失。
  - `P6-seq16` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 缓存/导出 -> 顶栏更多 -> 替换净化`）。
    - 状态：已同义（菜单打开回显 `exportUseReplace` 当前值；点击后仅翻转并持久化，不触发导出任务）。
    - 异常：已同义（开关切换失败仅提示“切换失败：<错误>”并回滚当前勾选态；导出失败保持既有异常日志链路）。
    - 文案：已同义（菜单文案固定“替换净化”）。
    - 排版：已同义（入口位于既有“更多”动作层，不改动顶栏下载/分组与列表排版）。
    - 交互触发：已同义（导出时仅在 `exportUseReplace` 与书籍替换净化开关同时开启时应用替换规则；任一关闭即回退原文本导出）。
    - 验证：命令 `dart format lib/features/bookshelf/services/cache_export_task_service.dart lib/features/bookshelf/views/cache_export_view.dart`；手工路径（待回归）`书架 -> 更多 -> 缓存/导出 -> 顶栏更多 -> 替换净化`（校验勾选态切换与重进回显）；手工路径（待回归）`开启后执行导出所有`（校验导出正文命中替换规则）；手工路径（待回归）`关闭后再次导出`（校验回退未替换文本）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_enable_replace` 与导出替换净化联动，不改动导出格式/编码/目录与其它后续序号能力。
  - 下一项：按优先级继续推进 `P8-seq241`（`import_book.xml / @+id/menu_select_folder / 选择文件夹`）；`P8-seq227(menu_copy_rule)` 继续保持 `detail_later` 全局后置策略。
- `2026-02-23`
  - 状态变更：完成 `P6-seq14`（`book_cache.xml / @+id/menu_book_group / 分组`）后，ExecPlan 保持 `active`。
  - 完成 `P6-seq14`（`book_cache.xml / @+id/menu_book_group / 分组`）：缓存/导出页顶栏补齐 legado 同义一级“分组”入口（位于“下载”与“更多”之间）。点击后弹出分组选择层并回显当前选中项，分组选项对齐 legado 固定组顺序：`全部/本地/音频/网络未分组/本地未分组/更新失败`；选择后仅更新当前分组与导航副标题并立即重算当前列表过滤，下载与导出动作继续仅作用于当前分组结果。
  - `P6-seq14` 差异点清单（实施前）：
    - legado `CacheActivity.upMenu()` 会将 `bookGroupDao.flowAll()` 结果挂载到 `menu_book_group` 子菜单，形成顶栏一级分组入口；Flutter 侧此前顶栏仅有“下载+更多”，缺少同层级分组动作。
    - legado `onCompatOptionsItemSelected(item.groupId == menu_group)` 语义为“更新 subtitle + 切换 groupId + 重新拉取列表”；Flutter 侧此前无分组状态机，列表始终展示全量书籍。
    - legado `menu_download/menu_export_all` 均基于当前 adapter 列表执行；Flutter 侧若缺失分组过滤，会导致下载/导出作用域与 legado 不一致。
  - `P6-seq14` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 缓存/导出 -> 顶栏分组`）。
    - 状态：已同义（默认“全部”；切换分组后仅刷新当前列表与副标题，不离开页面）。
    - 异常：已同义（取消分组选择时保持当前分组与列表状态不变，不新增扩展提示）。
    - 文案：已同义（菜单标题“分组”，固定组文案“全部/本地/音频/网络未分组/本地未分组/更新失败”）。
    - 排版：已同义（仅在既有顶栏动作区补齐一级分组图标，不改动列表卡片、进度卡与更多菜单布局）。
    - 交互触发：已同义（分组切换后下载/导出沿用当前过滤列表；不引入额外跳转链路）。
    - 验证：命令 `dart format lib/features/bookshelf/views/cache_export_view.dart`；手工路径（待回归）`书架 -> 更多 -> 缓存/导出 -> 顶栏分组 -> 依次切换 全部/本地/网络未分组/本地未分组`（校验副标题与列表同步变化）；手工路径（待回归）`切换分组后执行下载或导出所有`（校验仅作用于当前分组列表）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；保留差异：当前 `Book` 模型尚未迁移 legado `type(updateError/audio)` 类型位，`音频/更新失败` 分组暂回落为空列表，待后续书架类型位迁移序号回补。
  - 下一项：按优先级继续推进 `P6-seq16`（`book_cache.xml / @+id/menu_enable_replace / 替换净化`）；`P8-seq227(menu_copy_rule)` 继续保持 `detail_later` 全局后置策略。
- `2026-02-23`
  - 状态变更：完成 `P8-seq247`（`import_book.xml / @+id/menu_import_file_name / 导入文件名`）后，ExecPlan 保持 `active`。
  - 完成 `P8-seq247`（`import_book.xml / @+id/menu_import_file_name / 导入文件名`）：书架页“更多”菜单补齐 legado 同义入口“导入文件名”。点击后弹出 JS 输入弹窗（标题“导入文件名”，提示“使用js处理文件名变量src，将书名作者分别赋值到变量name author”，输入框 hint 为 `js`）；确定后仅保存 `bookImportFileName`，不触发导入动作。后续“添加本地”导入 TXT/EPUB 时读取该规则，按 `src` 解析并覆盖 `name/author`；规则执行异常写入异常日志并回退默认命名。
  - `P8-seq247` 差异点清单（实施前）：
    - legado `ImportBookActivity.onCompatOptionsItemSelected(menu_import_file_name)` 提供同层级入口并触发 `alertImportFileName()`；Flutter 侧此前仅有“添加本地”动作，无“导入文件名”入口与规则输入层。
    - legado `alertImportFileName()` 仅做规则编辑与保存（键 `bookImportFileName`），不触发导入；Flutter 侧此前缺失“仅保存规则”的状态机承载。
    - legado `LocalBook.analyzeNameAuthor` 在导入阶段消费 `bookImportFileName` 并注入 `src` 变量解析 `name/author`；Flutter 侧此前本地导入未接入该规则，导入命名只能使用默认文件名/元数据分支。
  - `P8-seq247` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 导入文件名`）。
    - 状态：已同义（弹窗回显当前规则；点击“确定”仅保存 `bookImportFileName`；不触发导入、不跳转页面）。
    - 异常：已同义（规则执行失败仅记录 `bookshelf.import.file_name_rule.*` 日志并回退默认命名，不新增扩展提示）。
    - 文案：已同义（标题“导入文件名”；提示“使用js处理文件名变量src，将书名作者分别赋值到变量name author”；输入 hint“js”）。
    - 排版：已同义（规则编辑承载于单层确认弹窗，不改动书架列表与“添加本地”入口层级）。
    - 交互触发：已同义（规则保存后需用户再次执行“添加本地”；导入阶段按 `src` 解析 `name/author` 覆盖命名）。
    - 验证：命令 `dart format lib/features/import/book_import_file_name_rule_service.dart lib/features/import/import_service.dart lib/features/bookshelf/views/bookshelf_view.dart`；手工路径（待回归）`书架 -> 更多 -> 导入文件名 -> 输入规则并确定`（校验仅保存规则）；手工路径（待回归）`书架 -> 更多 -> 添加本地 -> 选择 txt/epub`（校验导入时按 `src` 覆盖 `name/author` 且规则异常回退默认命名）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_import_file_name` 规则编辑入口与导入命名解析链路，不改动书源结构与阅读主链路。
  - 下一项：按优先级继续推进 `P6-seq14`（`book_cache.xml / @+id/menu_book_group / 分组`）；`P8-seq227(menu_copy_rule)` 继续保持 `detail_later` 全局后置策略。
- `2026-02-23`
  - 状态变更：完成 `P8-seq229`（`direct_link_upload_config.xml / @+id/menu_import_default / 导入默认规则`）后，ExecPlan 保持 `active`。
  - 完成 `P8-seq229`（`direct_link_upload_config.xml / @+id/menu_import_default / 导入默认规则`）：`直链上传配置` 页“更多”菜单补齐 legado 同义入口“导入默认规则”。点击后弹出默认规则选择列表（来源 `assets/source/directLinkUpload.json`），选择任一规则仅回填 `上传URL/下载URL规则/注释/是否压缩` 四个字段，不自动保存、不关闭页面。
  - `P8-seq229` 差异点清单（实施前）：
    - legado `DirectLinkUploadConfig.onMenuItemClick(menu_import_default)` 固定走 `importDefault()` 并弹规则选择器；Flutter 侧此前“更多”菜单仅有 `粘贴规则`，缺少同层级入口。
    - legado `importDefault()` 数据源固定 `DirectLinkUpload.defaultRules`（资产 `defaultData/directLinkUpload.json`）；Flutter 侧此前虽有默认规则资产与读取服务，但无菜单触发链路承载。
    - legado 选中默认规则后仅执行 `upView(rule)` 回填表单，不调用 `putConfig`，页面保持停留；Flutter 侧此前无此交互状态机，无法等价复刻。
  - `P8-seq229` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 其它设置 -> 源设置 -> 直链上传规则 -> 右上角更多 -> 导入默认规则`）。
    - 状态：已同义（弹出默认规则选择列表；选择后仅回填表单，不自动保存、不关闭页面）。
    - 异常：已同义（默认规则缺失时静默返回，不新增扩展提示分支；保持菜单动作可重复触发）。
    - 文案：已同义（菜单文案固定“导入默认规则”；选择层标题固定“导入默认规则”）。
    - 排版：已同义（沿用既有 `CupertinoActionSheet` 层级，不改动表单布局与底部确认区）。
    - 交互触发：已同义（选择默认规则仅更新输入框与压缩开关；保存仍需用户点击“确定”）。
    - 验证：命令 `dart format lib/features/settings/models/direct_link_upload_rule.dart lib/features/settings/services/direct_link_upload_config_service.dart lib/features/settings/views/direct_link_upload_config_view.dart lib/features/settings/views/other_settings_view.dart`；手工路径（待回归）`设置 -> 其它设置 -> 源设置 -> 直链上传规则 -> 右上角更多 -> 导入默认规则 -> 选择任一默认规则`（校验仅回填表单并停留当前页）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_import_default` 入口与默认规则回填交互，不改动规则保存结构与上传链路。
  - 下一项：按优先级继续推进 `P8-seq247`（`import_book.xml / @+id/menu_import_file_name / 导入文件名`）；`P8-seq227(menu_copy_rule)` 继续保持 `detail_later` 全局后置策略。
- `2026-02-23`
  - 状态变更：完成 `P8-seq228`（`direct_link_upload_config.xml / @+id/menu_paste_rule / 粘贴规则`）后，ExecPlan 保持 `active`。
  - 完成 `P8-seq228`（`direct_link_upload_config.xml / @+id/menu_paste_rule / 粘贴规则`）：`直链上传配置` 页补齐 legado 同义“更多 -> 粘贴规则”入口。点击后读取剪贴板文本并按 `Rule` JSON 对象解析；成功仅回填 `上传URL/下载URL规则/注释/是否压缩` 四个字段，不自动保存、不跳转。失败分支统一提示 `剪贴板为空或格式不对`。
  - `P8-seq228` 差异点清单（实施前）：
    - legado `direct_link_upload_config.xml` 固定提供 `menu_paste_rule` 一级入口；Flutter 侧此前缺少对应承载页与触发入口。
    - legado `onMenuItemClick(menu_paste_rule)` 语义为“读取剪贴板 -> 解析 Rule JSON -> upView 回填”；Flutter 侧此前无等价 `upView` 回填链路。
    - legado 失败分支固定 `toastOnUi("剪贴板为空或格式不对")`；Flutter 侧此前无固定口径错误提示，异常边界不一致。
  - `P8-seq228` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 其它设置 -> 源设置 -> 直链上传规则 -> 右上角更多 -> 粘贴规则`）。
    - 状态：已同义（解析成功仅回填表单并停留当前页；不自动保存、不关闭页面）。
    - 异常：已同义（空剪贴板或非法 JSON 统一提示 `剪贴板为空或格式不对`）。
    - 文案：已同义（菜单文案固定“粘贴规则”；失败提示固定“剪贴板为空或格式不对”）。
    - 排版：已同义（入口位于现有“更多”动作层，不改动表单结构与底部操作区）。
    - 交互触发：已同义（成功仅更新输入框与压缩开关，后续保存仍由“确定”按钮触发）。
    - 验证：命令 `dart format lib/features/settings/models/direct_link_upload_rule.dart lib/features/settings/services/direct_link_upload_config_service.dart lib/features/settings/views/direct_link_upload_config_view.dart lib/features/settings/views/other_settings_view.dart`；手工路径（待回归）`设置 -> 其它设置 -> 源设置 -> 直链上传规则 -> 右上角更多 -> 粘贴规则`（校验合法 JSON 仅回填表单），`剪贴板为空或非法 JSON`（校验提示固定口径）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_paste_rule` 入口与回填状态机，不改动 `menu_copy_rule/menu_import_default`（后续序号）能力。
  - 下一项：按优先级继续推进 `P8-seq229`（`direct_link_upload_config.xml / @+id/menu_import_default / 导入默认规则`）；`P8-seq227(menu_copy_rule)` 继续保持 `detail_later` 全局后置策略。
- `2026-02-23`
  - 状态变更：完成 `P6-seq28`（`book_cache_download.xml / @+id/menu_download_all / 下载全部章节`）后，ExecPlan 保持 `active`。
  - 完成 `P6-seq28`（`book_cache_download.xml / @+id/menu_download_all / 下载全部章节`）：缓存/导出页顶栏“下载”长按子菜单补齐 legado 同义入口“下载全部章节”。点击后与 `menu_download/menu_download_after` 复用同一停止态：运行中触发即停止任务；空闲态先确认再从首章（索引 `0`）缓存到末章（`lastChapterIndex`）。未提前并入 `menu_log`（`seq26`）与后续 P8 能力。
  - `P6-seq28` 差异点清单（实施前）：
    - legado `CacheActivity.onCompatOptionsItemSelected(menu_download_all)` 在空闲态固定执行 `CacheBook.start(book, 0, lastChapterIndex)`；Flutter 侧此前仅有“从当前章节开始”下载分支，缺少首章起点语义。
    - legado `book_cache_download.xml` 长按子菜单固定含 `menu_download_after + menu_download_all` 两项；Flutter 侧此前长按子菜单仅有“下载之后章节”，入口层级不完整。
    - legado `menu_download_all` 与 `menu_download/menu_download_after` 共用“运行中即停止”状态机；Flutter 侧若单独实现“全量下载”而不复用停机分支会出现状态偏差。
  - `P6-seq28` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 缓存/导出 -> 长按顶栏下载 -> 下载全部章节`）。
    - 状态：已同义（空闲态确认后按“首章到末章”执行缓存；运行中触发则停止任务并回落空闲态）。
    - 异常：已同义（沿用既有下载链路可观测节点：章节链接为空、正文为空、正文抓取失败；不新增扩展提示）。
    - 文案：已同义（长按子菜单文案固定“下载全部章节”）。
    - 排版：已同义（仅在既有长按下载动作层补齐第二个子菜单项，不改动列表/进度卡/更多菜单布局）。
    - 交互触发：已同义（长按后点击“下载全部章节”触发首章起点下载；运行中同入口触发停止）。
    - 验证：命令 `dart format lib/features/bookshelf/views/cache_export_view.dart lib/features/bookshelf/services/cache_download_task_service.dart`；手工路径（待回归）`书架 -> 更多 -> 缓存/导出 -> 长按顶栏下载 -> 下载全部章节`（校验确认后从首章缓存到末章）；手工路径（待回归）`缓存进行中再次长按顶栏下载 -> 下载全部章节`（校验任务停止并回落“下载”态）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_download_all` 入口与首章起点缓存语义，不改动导出链路与 `menu_log(seq26)`。
  - 下一项：按优先级继续推进 `P8-seq228`（`direct_link_upload_config.xml / @+id/menu_paste_rule / 粘贴规则`）；`P6-seq26(menu_log)` 继续保持 `detail_later` 全局后置策略。
- `2026-02-23`
  - 状态变更：完成 `P6-seq27`（`book_cache_download.xml / @+id/menu_download_after / 下载之后章节`）后，ExecPlan 保持 `active`。
  - 完成 `P6-seq27`（`book_cache_download.xml / @+id/menu_download_after / 下载之后章节`）：缓存/导出页顶栏“下载”动作补齐 legado 同义长按入口。长按后弹出下载子菜单并新增“下载之后章节”；点击后复用既有 `menu_download` 语义，未运行时先确认再按“当前章节到末章”批量缓存，运行中点击则停止任务。未提前并入 `menu_download_all`（`seq28`）后续动作。
  - `P6-seq27` 差异点清单（实施前）：
    - legado `CacheActivity.onCompatCreateOptionsMenu` 对 `menu_download` 绑定 `iconItemOnLongClick`，长按会弹 `book_cache_download.xml` 子菜单；Flutter 侧此前仅支持点击“下载/停止”，缺少长按子菜单入口。
    - legado `onCompatOptionsItemSelected(menu_download_after)` 与 `menu_download` 复用同一状态机（未运行时 `durChapterIndex -> lastChapterIndex`，运行中 `CacheBook.stop`）；Flutter 侧此前没有可单独触发 `menu_download_after` 的入口。
    - 本序号仅对应 `menu_download_after` 单项迁移，`menu_download_all`（`seq28`）需保持后续序号独立推进，避免跨序号并项。
  - `P6-seq27` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 缓存/导出 -> 长按顶栏下载 -> 下载之后章节`）。
    - 状态：已同义（未运行时触发确认并从当前章节缓存到末章；运行中触发则停止任务并回落空闲态）。
    - 异常：已同义（沿用既有 `menu_download` 下载异常可观测链路，不新增扩展提示分支）。
    - 文案：已同义（长按子菜单文案固定“下载之后章节”）。
    - 排版：已同义（仅在现有顶栏下载热区补齐长按弹层，不改动列表、进度卡与“更多”菜单布局）。
    - 交互触发：已同义（长按后单击“下载之后章节”触发与 `menu_download` 同源状态机；运行中同入口可停止）。
    - 验证：命令 `dart format lib/features/bookshelf/views/cache_export_view.dart`；手工路径（待回归）`书架 -> 更多 -> 缓存/导出 -> 长按顶栏下载 -> 下载之后章节`（校验弹确认并启动缓存）；手工路径（待回归）`缓存进行中再次长按顶栏下载 -> 下载之后章节`（校验任务停止并回落“下载”态）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_download_after` 长按入口与触发链路，不改动 `menu_download_all`、导出菜单与分组链路。
  - 下一项：按优先级继续推进 `P6-seq28`（`book_cache_download.xml / @+id/menu_download_all / 下载全部章节`）；`P6-seq26(menu_log)` 继续保持 `detail_later` 全局后置策略。
- `2026-02-23`
  - 状态变更：完成 `P6-seq25`（`book_cache.xml / @+id/menu_export_charset / 导出编码`）后，ExecPlan 保持 `active`。
  - 完成 `P6-seq25`（`book_cache.xml / @+id/menu_export_charset / 导出编码`）：缓存/导出页顶栏“更多”菜单补齐 legado 同义一级动作“导出编码(当前值)”。打开菜单时读取并回显 `exportCharset`（空值回落 `UTF-8`）；点击后弹出“设置编码”输入框（placeholder=`charset name`，附 legacy 编码候选提示），确认后写入同名键 `exportCharset`，取消不生效。导出链路同步收敛：TXT 导出改为按 `exportCharset` 对正文编码后写盘，不再固定 UTF-8。
  - `P6-seq25` 差异点清单（实施前）：
    - legado `CacheActivity.onMenuOpened` 会将菜单标题回显为 `导出编码(当前值)`；Flutter 侧此前无 `menu_export_charset` 入口与回显状态。
    - legado `CacheActivity.showCharsetConfig()` 语义为“输入式编码设置”（标题 `set_charset`、hint=`charset name`、确认写入 `AppConfig.exportCharset`、取消不生效）；Flutter 侧此前无同义交互。
    - legado `AppConfig.exportCharset` 在配置为空白时读取回落 `UTF-8`；Flutter 侧此前无同义默认值读取规则。
    - legado `ExportBookService.exportTxt` 使用 `Charset.forName(AppConfig.exportCharset)` 写文件；Flutter 侧此前固定 `writeAsString`（UTF-8），与配置项脱节。
  - `P6-seq25` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 缓存/导出 -> 顶栏更多 -> 导出编码(当前值)`）。
    - 状态：已同义（菜单打开时回显已保存编码；空白值统一回落 `UTF-8`）。
    - 异常：已同义（导出编码保存失败写入 `bookshelf.cache.export_charset.save_failed`；导出写盘失败继续走 `bookshelf.cache.export_all.write_failed`，并附带 `exportCharset` 上下文）。
    - 文案：已同义（入口文案“导出编码(当前值)”；弹窗标题“设置编码”；输入框 placeholder “charset name”）。
    - 排版：已同义（沿用现有 Cupertino ActionSheet + AlertDialog 层级，不改动列表与工具栏布局）。
    - 交互触发：已同义（点击入口弹输入框；取消不改值；确定后持久化并即时用于后续 TXT 导出写盘编码）。
    - 验证：命令 `dart format lib/features/bookshelf/views/cache_export_view.dart lib/features/bookshelf/services/cache_export_task_service.dart`；手工路径（待回归）`书架 -> 更多 -> 缓存/导出 -> 顶栏更多 -> 导出编码(GBK) -> 导出所有`（校验菜单回显与输出编码），`导出编码输入空串 -> 重新打开更多`（校验回落 `UTF-8`）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_export_charset` 入口、持久化与 TXT 写盘编码链路，不改动导出目录/文件名/格式入口结构；`menu_log(seq26)` 仍保持后续 `detail_later` 队列收敛。
  - 下一项：按优先级继续推进 `P6-seq27`（`book_cache_download.xml / @+id/menu_download_after / 下载之后章节`）；`P6-seq26(menu_log)` 维持 `detail_later` 全局后置策略。
- `2026-02-23`
  - 状态变更：完成 `P6-seq24`（`book_cache.xml / @+id/menu_export_type / 导出格式`）后，ExecPlan 保持 `active`。
  - 完成 `P6-seq24`（`book_cache.xml / @+id/menu_export_type / 导出格式`）：缓存/导出页顶栏“更多”菜单补齐 legado 同义一级动作“导出格式(当前值)”并支持 `txt/epub` 单选切换；选择后写入同名键 `exportType`（索引语义对齐 legado `AppConfig.exportType`）。导出链路同步收敛：`导出所有` 不再固定 TXT，而是按 `exportType` 分支执行（`txt` 维持既有链路；`epub` 使用 `epubx.EpubWriter` 生成真实 EPUB 文件）。
  - `P6-seq24` 差异点清单（实施前）：
    - legado `CacheActivity.onMenuOpened` 会把菜单标题回显为 `导出格式(当前值)`；Flutter 侧此前无 `menu_export_type` 入口，也无当前导出格式回显。
    - legado `CacheActivity.showExportTypeConfig()` 通过选择器在 `txt/epub` 间切换，并持久化 `AppConfig.exportType`（索引）；Flutter 侧此前无同义持久化键读写。
    - legado `startExport` 会按 `exportType` 映射导出分支；Flutter 侧此前 `exportAllToDirectory` 固定写 TXT，导致“导出格式”开关即使补入口也会成为伪一致。
  - `P6-seq24` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 缓存/导出 -> 顶栏更多 -> 导出格式(当前值)`）。
    - 状态：已同义（打开“更多”时回显当前 `txt/epub`；点击后单选切换并持久化 `exportType`）。
    - 异常：已同义（切换持久化失败时回滚本地 UI 状态并提示“切换失败：<错误>”；导出失败继续走既有 `bookshelf.cache.export_all.write_failed` 可观测节点）。
    - 文案：已同义（入口文案固定“导出格式(当前值)”；选项文案固定 `txt`、`epub`）。
    - 排版：已同义（沿用现有 Cupertino ActionSheet 层级与热区，不改动下载/导出列表布局）。
    - 交互触发：部分同义（已补齐 `exportType` 对导出主链路分支的真实联动；当前 EPUB 导出为基础正文打包链路，尚未覆盖 legado 资产模板/封面/章节图片资源与 `自定义Epub导出章节` 分段导出能力，保留后续序号继续收敛）。
    - 验证：命令 `dart format lib/features/bookshelf/services/cache_export_task_service.dart lib/features/bookshelf/views/cache_export_view.dart`；手工路径（待回归）`书架 -> 更多 -> 缓存/导出 -> 顶栏更多 -> 导出格式(txt/epub)`（校验回显与持久化），`切换 epub 后执行导出所有`（校验输出 `.epub` 文件），`切回 txt 后再次导出`（校验回落 TXT 输出）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号新增 `exportType` 配置与导出分支切换，不改动 `bookExportFileName` 规则键与 TXT 导出正文链路；EPUB 分支当前为基础正文导出能力（未并入 legado 模板/封面/图片资源链路）；`导出编码/menu_export_charset` 与日志入口仍在后续序号推进。
  - 下一项：按优先级继续推进 `P6-seq25`（`book_cache.xml / @+id/menu_export_charset / 导出编码`）。
- `2026-02-23`
  - 状态变更：完成 `P6-seq23`（`book_cache.xml / @+id/menu_export_file_name / 导出文件名`）后，ExecPlan 保持 `active`。
  - 完成 `P6-seq23`（`book_cache.xml / @+id/menu_export_file_name / 导出文件名`）：缓存/导出页顶栏“更多”菜单补齐 legado 同义一级动作“导出文件名”。点击后弹出输入弹窗（标题“导出文件名”），提示文案固定“Variable: name, author.”，输入框 hint 固定“file name js”；确认后写入同名键 `bookExportFileName`。同时将 TXT 导出命名链路收敛为 legado 同义：导出文件名按 JS 规则解析（变量 `name/author`，兼容 `epubIndex` 占位），规则为空或解析失败时回退默认命名 `书名 作者：作者.txt` 并记录异常日志。
  - `P6-seq23` 差异点清单（实施前）：
    - legado `book_cache.xml` 固定提供 `menu_export_file_name` 一级入口；Flutter 侧此前“更多”菜单止于“导出文件夹”，缺少同层级入口。
    - legado `CacheActivity.menu_export_file_name -> alertExportFileName()` 为“仅保存规则、无导出副作用”语义；Flutter 侧此前无“导出文件名规则”配置入口。
    - legado `Book.getExportFileName("txt"/"epub")` 会读取 `bookExportFileName` 并按 JS 规则解析 `name/author`；Flutter 侧此前导出文件名固定 `书名.txt`，未接入规则解析与失败回退。
  - `P6-seq23` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 缓存/导出 -> 顶栏更多 -> 导出文件名`）。
    - 状态：已同义（弹窗回显当前规则；确认后写入 `bookExportFileName`；取消不改值）。
    - 异常：已同义（规则解析失败时回退默认命名，不阻断导出；失败写入 `ExceptionLogService`）。
    - 文案：已同义（标题“导出文件名”；提示“Variable: name, author.”；输入 hint“file name js”）。
    - 排版：已同义（沿用现有 Cupertino 弹窗层级，不改动顶栏与列表排版）。
    - 交互触发：已同义（入口只负责保存规则，不直接触发导出任务；导出时按规则命名）。
    - 验证：命令 `dart format lib/features/bookshelf/services/cache_export_task_service.dart lib/features/bookshelf/views/cache_export_view.dart`；手工路径（待回归）`书架 -> 更多 -> 缓存/导出 -> 顶栏更多 -> 导出文件名 -> 输入 name + " 作者：" + author -> 确定 -> 导出所有`（校验文件名按规则生成）；手工路径（待回归）`导出文件名输入非法 JS -> 导出所有`（校验回退默认命名且日志可观测）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_export_file_name` 入口、持久化与 TXT 导出命名链路，不提前并入 `menu_export_type/menu_export_charset/menu_log`（`seq24~26`）后续能力。
  - 下一项：按优先级继续推进 `P6-seq24`（`book_cache.xml / @+id/menu_export_type / 导出格式`）。
- `2026-02-23`
  - 状态变更：完成 `P6-seq22`（`book_cache.xml / @+id/menu_export_folder / 导出文件夹`）后，ExecPlan 保持 `active`。
  - 完成 `P6-seq22`（`book_cache.xml / @+id/menu_export_folder / 导出文件夹`）：缓存/导出页顶栏“更多”菜单补齐 legado 同义一级动作“导出文件夹”。点击后仅打开目录选择器并保存默认导出目录，取消选择时静默返回，不触发导出任务；已选目录会在后续“导出所有”链路优先复用。未提前并入 `menu_export_file_name/menu_export_type/menu_export_charset/menu_log` 等后续序号动作。
  - `P6-seq22` 差异点清单（实施前）：
    - legado `book_cache.xml` 固定提供 `menu_export_folder` 一级入口，位于 `menu_parallel_export` 之后；Flutter 侧此前“更多”菜单缺少该同层级入口。
    - legado `CacheActivity.onCompatOptionsItemSelected(menu_export_folder)` 语义为仅调用 `selectExportFolder(-1)`，不直接执行导出；Flutter 侧此前仅在“导出所有”内隐式触发目录选择，缺少“独立设置导出目录”动作。
    - legado 目录选择取消分支为静默返回；Flutter 侧此前无该单项动作，无法复刻同义取消边界。
  - `P6-seq22` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 缓存/导出 -> 顶栏 更多 -> 导出文件夹`）。
    - 状态：已同义（点击后仅弹目录选择器；选择目录后持久化到 `bookshelf.cache.export_directory`，后续“导出所有”优先复用）。
    - 异常：已同义（取消选择静默返回；保存目录异常写入 `ExceptionLogService`，不触发导出任务）。
    - 文案：已同义（入口文案固定“导出文件夹”；目录选择标题“选择导出文件夹”）。
    - 排版：已同义（入口位于既有顶栏“更多”动作层，不改动下载/导出所有/列表布局）。
    - 交互触发：已同义（动作只负责选择并保存目录，不触发导出；导出任务仍由“导出所有”单独触发）。
    - 验证：命令 `dart format lib/features/bookshelf/views/cache_export_view.dart`；手工路径（待回归）`书架 -> 更多 -> 缓存/导出 -> 顶栏更多 -> 导出文件夹`（校验仅弹目录选择且取消静默返回），`选择目录后直接返回列表`（校验无导出任务触发），`随后执行导出所有`（校验优先复用新目录）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_export_folder` 独立入口与目录持久化语义，不改动导出文件名/格式/编码与日志能力。
  - 下一项：按优先级继续推进 `P6-seq23`（`book_cache.xml / @+id/menu_export_file_name / 导出文件名`）。
- `2026-02-23`
  - 状态变更：完成 `P6-seq21`（`book_cache.xml / @+id/menu_parallel_export / 多线程导出`）后，ExecPlan 保持 `active`。
  - 完成 `P6-seq21`（`book_cache.xml / @+id/menu_parallel_export / 多线程导出`）：缓存/导出页顶栏“更多”菜单补齐 legado 同义“多线程导出”可勾选入口。打开菜单时读取持久化开关状态，点击后即时翻转并写入同名键 `parallelExportBook`；同时将 TXT 导出链路接入同义并发开关：关闭时并发度 `1`，开启时并发度 `9`（对齐 legado `AppConst.MAX_THREAD`），并用于章节文本组装与章节图片导出任务处理。未提前并入 `menu_export_folder/menu_export_file_name/menu_export_type/menu_export_charset` 等后续序号动作。
  - `P6-seq21` 差异点清单（实施前）：
    - legado `book_cache.xml` 固定提供 `menu_parallel_export`（checkable）且文案为 `parallel_export_book`；Flutter 侧此前“更多”菜单缺少同层级入口。
    - legado `CacheActivity.onMenuOpened` 会按 `AppConfig.parallelExportBook` 回显菜单勾选态；Flutter 侧此前无对应状态读取与菜单回显。
    - legado `CacheActivity.onCompatOptionsItemSelected(menu_parallel_export)` 语义为点击后翻转并持久化 `PreferKey.parallelExportBook`；Flutter 侧此前无同义键写入与切换状态机。
    - legado `ExportBookService.getAllContents/setEpubContent` 会按 `parallelExportBook` 在 `1` 与 `MAX_THREAD(9)` 间切换导出并发；Flutter 侧此前导出任务固定单线程顺序执行，缺少该同义并发切换。
  - `P6-seq21` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 缓存/导出 -> 顶栏 更多 -> 多线程导出`）。
    - 状态：已同义（默认关闭；打开菜单按持久化值回显勾选；点击后即时翻转并写入 `parallelExportBook`）。
    - 异常：已同义（导出并发任务单项失败不阻断整书导出；失败项继续走异常日志可观测分支，不追加成功提示）。
    - 文案：已同义（入口文案固定“多线程导出”）。
    - 排版：已同义（入口位于既有顶栏“更多”动作层，不改动下载/导出所有/列表布局）。
    - 交互触发：已同义（导出时读取开关决定并发度：关闭 `1`、开启 `9`；重进页面再次打开“更多”可回显勾选态）。
    - 验证：命令 `dart format lib/features/bookshelf/services/cache_export_task_service.dart lib/features/bookshelf/views/cache_export_view.dart`；手工路径（待回归）`书架 -> 更多 -> 缓存/导出 -> 顶栏更多 -> 多线程导出`（校验勾选态切换与持久化回显），`开启后执行导出所有`（校验导出统计正常且并发开关生效），`关闭后再次导出`（校验回落到单线程导出）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_parallel_export` 开关入口、持久化与导出并发度切换，不改动导出文件夹/文件名、导出格式与导出编码等后续能力。
  - 下一项：按优先级继续推进 `P6-seq22`（`book_cache.xml / @+id/menu_export_folder / 导出文件夹`）。
- `2026-02-23`
  - 状态变更：完成 `P6-seq20`（`book_cache.xml / @+id/menu_export_pics_file / TXT 导出图片`）后，ExecPlan 保持 `active`。
  - 完成 `P6-seq20`（`book_cache.xml / @+id/menu_export_pics_file / TXT 导出图片`）：缓存/导出页顶栏“更多”菜单补齐 legado 同义“TXT 导出图片”可勾选入口。打开菜单时读取持久化开关状态，点击后即时翻转并写入同名键 `exportPictureFile`；同时将 TXT 导出链路补齐图片导出语义：开关开启时解析章节正文中的 `<img src>`，按 `{书名_作者}/images/{章节}` 目录结构导出图片文件并保留原 TXT 正文导出，开关关闭时保持仅导出 TXT。未提前并入 `menu_parallel_export/menu_export_folder/menu_export_file_name/menu_export_type/menu_export_charset` 等后续序号动作。
  - `P6-seq20` 差异点清单（实施前）：
    - legado `book_cache.xml` 固定提供 `menu_export_pics_file`（checkable）且文案为 `export_pics_file`；Flutter 侧此前“更多”菜单仅有“导出所有/自定义Epub导出章节/导出到 WebDav/TXT 不导出章节名”，缺少同层级入口。
    - legado `CacheActivity.onMenuOpened` 会按 `AppConfig.exportPictureFile` 回显菜单勾选态；Flutter 侧此前无对应状态读取与菜单回显。
    - legado `CacheActivity.onCompatOptionsItemSelected(menu_export_pics_file)` 语义为点击后翻转并持久化 `PreferKey.exportPictureFile`；Flutter 侧此前无同义键写入与切换状态机。
    - legado `ExportBookService.getExportData/exportTxt` 在开关开启时会提取章节图片并导出到 `book/author/images/chapter`；Flutter 侧此前导出链路仅写 TXT 文本，缺少图片解析与写盘链路。
  - `P6-seq20` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 缓存/导出 -> 顶栏 更多 -> TXT 导出图片`）。
    - 状态：已同义（默认关闭；打开菜单按持久化值回显勾选；点击后即时翻转并写入 `exportPictureFile`）。
    - 异常：部分同义（图片单文件写入失败时保持单书导出继续，失败写入 `ExceptionLogService`；开关写入失败提示“切换失败：<错误>”，不改变导出主链路）。
    - 文案：已同义（入口文案固定“TXT 导出图片”）。
    - 排版：已同义（入口位于既有顶栏“更多”动作层，不改动下载/导出所有/列表布局）。
    - 交互触发：已同义（开关开启后执行导出所有会额外导出章节图片目录；关闭后导出行为回落为纯 TXT）。
    - 验证：命令 `dart format lib/features/bookshelf/services/cache_export_task_service.dart lib/features/bookshelf/views/cache_export_view.dart`；命令 `flutter test test/widget_test.dart` 通过；手工路径（待回归）`书架 -> 更多 -> 缓存/导出 -> 顶栏更多 -> TXT 导出图片`（校验勾选态切换），`开启后执行导出所有`（校验导出目录下生成 `{书名_作者}/images/{章节}`），`关闭后再次导出`（校验不新增图片导出）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_export_pics_file` 开关入口、持久化与 TXT 图片导出链路，不改动并行导出、导出目录/文件名、导出格式与导出编码等后续能力。
  - 下一项：按优先级继续推进 `P6-seq21`（`book_cache.xml / @+id/menu_parallel_export / 多线程导出`）。
- `2026-02-23`
  - 状态变更：完成 `P6-seq19`（`book_cache.xml / @+id/menu_export_no_chapter_name / TXT 不导出章节名`）后，ExecPlan 保持 `active`。
  - 完成 `P6-seq19`（`book_cache.xml / @+id/menu_export_no_chapter_name / TXT 不导出章节名`）：缓存/导出页顶栏“更多”菜单补齐 legado 同义“TXT 不导出章节名”可勾选入口。打开菜单时读取持久化开关状态，点击后即时翻转并写入同名键 `exportNoChapterName`；同时将 TXT 导出正文构建收敛为 legado 同义边界：当开关开启时导出正文不写章节标题（`includeTitle=false`），关闭时恢复章节标题输出。未提前并入 `menu_export_pics_file/menu_parallel_export/menu_export_folder/menu_export_file_name/menu_export_type/menu_export_charset` 等后续序号动作。
  - `P6-seq19` 差异点清单（实施前）：
    - legado `book_cache.xml` 固定提供 `menu_export_no_chapter_name`（checkable）且文案为 `export_no_chapter_name`；Flutter 侧此前“更多”菜单仅有“导出所有/自定义Epub导出章节/导出到 WebDav”，缺少同层级入口。
    - legado `CacheActivity.onMenuOpened` 会按 `AppConfig.exportNoChapterName` 回显菜单勾选态；Flutter 侧此前无对应状态读取与菜单回显。
    - legado `CacheActivity.onCompatOptionsItemSelected(menu_export_no_chapter_name)` 语义为点击后翻转并持久化 `PreferKey.exportNoChapterName=exportNoChapterName`；Flutter 侧此前无同义键写入与切换状态机。
    - legado `ExportBookService.getExportData` 导出 TXT 时使用 `includeTitle = !AppConfig.exportNoChapterName`；Flutter 侧此前导出正文固定写入章节标题，缺少该开关对导出内容的联动。
  - `P6-seq19` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 缓存/导出 -> 顶栏 更多 -> TXT 不导出章节名`）。
    - 状态：已同义（默认关闭；打开菜单按持久化值回显勾选；点击后即时翻转并写入 `exportNoChapterName`）。
    - 异常：部分同义（legado 无显式失败提示；Flutter 侧在写入失败时提示“切换失败：<错误>”以保证可观测，不改变主链路）。
    - 文案：已同义（入口文案固定“TXT 不导出章节名”）。
    - 排版：已同义（入口位于既有顶栏“更多”动作层，不改动下载/导出所有/列表布局）。
    - 交互触发：已同义（开关开启后执行 TXT 导出不再写入章节标题；关闭后恢复章节标题输出；不影响 Epub 导出链路）。
    - 验证：命令 `dart format lib/features/bookshelf/services/cache_export_task_service.dart lib/features/bookshelf/views/cache_export_view.dart`；命令 `flutter test test/widget_test.dart` 通过；命令 `flutter test test/search_book_info_view_compile_test.dart test/simple_reader_view_compile_test.dart` 通过；手工路径（待回归）`书架 -> 更多 -> 缓存/导出 -> 顶栏更多 -> TXT 不导出章节名`（校验勾选态切换）以及 `开启后执行导出所有并检查 txt 文件`（校验章节标题不输出），`关闭后再次导出`（校验章节标题恢复输出）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_export_no_chapter_name` 开关入口、持久化与 TXT 导出标题开关联动，不改动图片导出/并行导出/导出格式与导出编码等后续能力。
  - 下一项：按优先级继续推进 `P6-seq20`（`book_cache.xml / @+id/menu_export_pics_file / TXT 导出图片`）。
- `2026-02-23`
  - 状态变更：完成 `P6-seq18`（`book_cache.xml / @+id/menu_export_web_dav / 导出到 WebDav`）后，ExecPlan 保持 `active`。
  - 完成 `P6-seq18`（`book_cache.xml / @+id/menu_export_web_dav / 导出到 WebDav`）：缓存/导出页顶栏“更多”菜单补齐 legado 同义“导出到 WebDav”可勾选入口。打开菜单时读取持久化开关状态，点击后即时翻转并写入同名键 `webDavCacheBackup`；未提前并入 `menu_export_no_chapter_name/menu_export_pics_file/menu_parallel_export/menu_export_folder/menu_export_file_name/menu_export_type/menu_export_charset` 等后续序号动作。
  - `P6-seq18` 差异点清单（实施前）：
    - legado `book_cache.xml` 固定提供 `menu_export_web_dav`（checkable）且文案为 `export_to_web_dav`；Flutter 侧此前“更多”菜单仅有“导出所有/自定义Epub导出章节”，缺少同层级入口。
    - legado `CacheActivity.onMenuOpened` 会按 `AppConfig.exportToWebDav` 回显菜单勾选态；Flutter 侧此前无对应状态读取与菜单回显。
    - legado `CacheActivity.onCompatOptionsItemSelected(menu_export_web_dav)` 语义为点击后翻转并持久化 `PreferKey.exportToWebDav=webDavCacheBackup`；Flutter 侧此前无同义键写入与切换状态机。
  - `P6-seq18` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 缓存/导出 -> 顶栏 更多 -> 导出到 WebDav`）。
    - 状态：已同义（默认关闭；打开菜单按持久化值回显勾选；点击后即时翻转并写入 `webDavCacheBackup`）。
    - 异常：部分同义（legado 无显式失败提示；Flutter 侧在写入失败时提示“切换失败：<错误>”以保证可观测，不改变主链路）。
    - 文案：已同义（入口文案固定“导出到 WebDav”）。
    - 排版：已同义（入口位于既有顶栏“更多”动作层，不改动下载/导出所有/列表布局）。
    - 交互触发：部分同义（本序号已收敛“开关入口 + 勾选态 + 持久化”语义；导出产物上传 WebDav 的执行链路待后续导出能力序号继续闭环）。
    - 验证：命令 `dart format lib/features/bookshelf/services/cache_export_task_service.dart lib/features/bookshelf/views/cache_export_view.dart`；命令 `flutter test test/widget_test.dart` 通过；命令 `flutter test test/search_book_info_view_compile_test.dart test/simple_reader_view_compile_test.dart` 通过；手工路径（待回归）`书架 -> 更多 -> 缓存/导出 -> 顶栏更多 -> 导出到 WebDav`（校验勾选态切换）以及 `返回后重进缓存/导出页再次打开更多`（校验勾选态持久化回显）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_export_web_dav` 开关入口与持久化，不改动本地导出任务调度与 WebDav 上传实现链路。
  - 下一项：按优先级继续推进 `P6-seq19`（`book_cache.xml / @+id/menu_export_no_chapter_name / TXT 不导出章节名`）。
- `2026-02-23`
  - 状态变更：完成 `P6-seq17`（`book_cache.xml / @+id/menu_enable_custom_export / 自定义Epub导出章节`）后，ExecPlan 保持 `active`。
  - 完成 `P6-seq17`（`book_cache.xml / @+id/menu_enable_custom_export / 自定义Epub导出章节`）：缓存/导出页顶栏“更多”菜单补齐 legado 同义“自定义Epub导出章节”可勾选入口。打开菜单时读取持久化开关状态，点击后即时翻转并写入同名键 `enableCustomExport`；未提前并入 `menu_export_web_dav/menu_export_no_chapter_name/menu_export_pics_file/menu_parallel_export/menu_export_folder/menu_export_file_name/menu_export_type/menu_export_charset` 等后续序号动作。
  - `P6-seq17` 差异点清单（实施前）：
    - legado `book_cache.xml` 固定提供 `menu_enable_custom_export`（checkable）且文案为 `custom_export_section`；Flutter 侧此前“更多”菜单仅有“导出所有”，缺少同层级入口。
    - legado `CacheActivity.onMenuOpened` 会按 `AppConfig.enableCustomExport` 回显菜单勾选态；Flutter 侧此前无对应状态读取与菜单回显。
    - legado `CacheActivity.onCompatOptionsItemSelected(menu_enable_custom_export)` 语义为点击后翻转并持久化 `enableCustomExport`；Flutter 侧此前无同义持久化键与切换状态机。
  - `P6-seq17` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 缓存/导出 -> 顶栏 更多 -> 自定义Epub导出章节`）。
    - 状态：已同义（默认关闭；打开菜单按持久化值回显勾选；点击后即时翻转并写入 `enableCustomExport`）。
    - 异常：部分同义（legado 无显式失败提示；Flutter 侧在写入失败时提示“切换失败：<错误>”以保证可观测，不改变主链路）。
    - 文案：已同义（入口文案固定“自定义Epub导出章节”）。
    - 排版：已同义（入口位于既有顶栏“更多”动作层，不改动下载/导出所有/列表布局）。
    - 交互触发：部分同义（本序号已收敛“开关入口 + 勾选态 + 持久化”语义；开关对 Epub 导出行为的实际影响待 `seq18~seq25` 后续能力完成后闭环）。
    - 验证：命令 `dart format lib/features/bookshelf/services/cache_export_task_service.dart lib/features/bookshelf/views/cache_export_view.dart`；命令 `flutter test test/widget_test.dart` 通过；命令 `flutter test test/search_book_info_view_compile_test.dart test/simple_reader_view_compile_test.dart` 通过；手工路径（待回归）`书架 -> 更多 -> 缓存/导出 -> 顶栏更多 -> 自定义Epub导出章节`（校验勾选态切换）以及 `返回后重进缓存/导出页再次打开更多`（校验勾选态持久化回显）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_enable_custom_export` 开关入口与持久化，不改动导出类型、导出编码与自定义章节导出服务链路。
  - 下一项：按优先级继续推进 `P6-seq18`（`book_cache.xml / @+id/menu_export_web_dav / 导出到 WebDav`）。
- `2026-02-23`
  - 状态变更：完成 `P6-seq15`（`book_cache.xml / @+id/menu_export_all / 导出所有`）后，ExecPlan 保持 `active`。
  - 完成 `P6-seq15`（`book_cache.xml / @+id/menu_export_all / 导出所有`）：缓存/导出页顶栏补齐 legado 同义“更多 -> 导出所有”入口。点击后优先复用上次导出目录，不可写时重新选择目录；确认目录后按当前列表书籍批量导出已缓存章节 TXT，导出结束弹汇总结果，写文件失败落 `ExceptionLogService`。未提前并入 `menu_enable_custom_export/menu_export_type/menu_export_charset` 等后续序号动作。
  - `P6-seq15` 差异点清单（实施前）：
    - legado `book_cache.xml` 提供 `menu_export_all` 并由 `CacheActivity.onCompatOptionsItemSelected(menu_export_all)` 触发 `exportAll()`；Flutter 侧此前仅有 `menu_download` 动作，缺少“导出所有”入口。
    - legado `exportAll()` 复用 `exportBookPath`，路径缺失时走目录选择器并记忆；Flutter 侧此前无“导出目录持久化 + 重新选择”状态流。
    - legado `startExport(path, -10)` 支持按当前列表批量导出并在空书架时提示 `no_book`；Flutter 侧此前无批量导出任务与失败可观测日志链路。
  - `P6-seq15` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 缓存/导出 -> 顶栏 更多 -> 导出所有`）。
    - 状态：部分同义（已补齐“目录复用/目录重选/取消静默返回”状态流；保留差异为当前导出固定 TXT，`exportType` 切换待 `seq24` 收敛）。
    - 异常：已同义（目录不可写时不启动导出；单书写文件失败写入 `ExceptionLogService` 并计入失败汇总）。
    - 文案：已同义（动作层级与文案收敛为“更多/导出所有/取消”，结果反馈为导出汇总）。
    - 排版：已同义（在 `Shadcn + Cupertino` 承载下补齐顶栏“更多”动作，下载入口保持原位；平台组件视觉差异属于允许范围）。
    - 交互触发：已同义（触发后按当前列表逐本导出已缓存章节到目录；无已缓存章节书籍跳过；结束后回显成功/跳过/失败统计）。
    - 验证：命令 `dart format lib/features/bookshelf/services/cache_export_task_service.dart lib/features/bookshelf/views/cache_export_view.dart`；命令 `flutter test test/widget_test.dart` 通过；命令 `flutter test test/search_book_info_view_compile_test.dart test/simple_reader_view_compile_test.dart` 通过；手工路径（待回归）`书架 -> 更多 -> 缓存/导出 -> 顶栏更多 -> 导出所有 -> 选择导出文件夹`（校验导出汇总与目录复用）；`再次触发导出所有`（校验复用目录可直接导出）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_export_all` 基线导出链路，`自定义Epub导出章节`/`导出格式`/`导出编码` 仍按队列在 `seq17/seq24/seq25` 后续收敛。
  - 下一项：按优先级继续推进 `P6-seq17`（`book_cache.xml / @+id/menu_enable_custom_export / 自定义Epub导出章节`）。
- `2026-02-23`
  - 状态变更：完成 `P6-seq13`（`book_cache.xml / @+id/menu_download / 下载`）后，ExecPlan 保持 `active`。
  - 完成 `P6-seq13`（`book_cache.xml / @+id/menu_download / 下载`）：缓存/导出页从 placeholder 收敛为可执行承载页，顶栏补齐 legado 同义 `下载/停止` 入口。点击“下载”先弹“提醒/是否确认缓存当前列表书籍？”，确认后按当前列表在线书籍批量执行“从当前章节到末章”缓存；任务运行中入口切换为“停止”，再次点击可中断当前下载任务并回落稳定态。未提前并入 `menu_export_all/menu_book_group/menu_log` 等后续序号动作。
  - `P6-seq13` 差异点清单（实施前）：
    - legado `book_cache.xml` 提供顶栏一级 `menu_download`，并通过 `CacheActivity.onCompatOptionsItemSelected(menu_download)` 实现“开始/停止”切换；Flutter 侧此前 `CacheExportPlaceholderView` 无下载动作承载，入口不可触发。
    - legado `CacheActivity` 在下载前固定弹出 `draw + sure_cache_book` 确认框；Flutter 侧此前缺少确认式提交，无法对齐状态边界。
    - legado `CacheBook.start(..., durChapterIndex, lastChapterIndex)` 语义为“按当前章节到末章批量缓存”，运行中同入口切换为停止；Flutter 侧此前无批量缓存任务与可中断状态机。
  - `P6-seq13` 逐项对照清单（实施后）：
    - 入口：已同义（`书架 -> 更多 -> 缓存/导出 -> 顶栏 下载/停止`）。
    - 状态：已同义（空闲态显示“下载”；执行中切换“停止”；停止后回落空闲态）。
    - 异常：已同义（章节链接为空/正文为空/正文抓取失败写入 `ExceptionLogService`；页面保持可恢复状态，不弹扩展成功提示）。
    - 文案：已同义（下载前确认框使用“提醒/是否确认缓存当前列表书籍？”，运行态动作文案为“停止”）。
    - 排版：已同义（在 `Shadcn + Cupertino` 承载下补齐顶栏动作、进度卡与书籍列表；平台组件视觉差异属于允许范围）。
    - 交互触发：已同义（确认后按书籍当前章节起批量缓存到末章；运行中点“停止”立即发出取消信号并终止后续拉取）。
    - 验证：命令 `dart format lib/features/bookshelf/services/cache_download_task_service.dart lib/features/bookshelf/views/cache_export_view.dart lib/features/bookshelf/views/cache_export_placeholder_view.dart lib/features/bookshelf/views/bookshelf_view.dart`；命令 `flutter test test/widget_test.dart` 通过；命令 `flutter test test/search_book_info_view_compile_test.dart test/simple_reader_view_compile_test.dart` 通过；手工路径（待回归）`书架 -> 更多 -> 缓存/导出 -> 下载 -> 确认`（校验下载态切换与章节缓存数量增长）以及 `下载进行中点击停止`（校验任务中断并回落空闲态）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_download` 状态机与批量缓存主链路，不改动导出配置键与书源结构。
  - 下一项：按优先级继续推进 `P6-seq15`（`book_cache.xml / @+id/menu_export_all / 导出所有`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq400`（`txt_toc_rule_sel.xml / @+id/menu_disable_selection / 禁用所选`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq400`（`txt_toc_rule_sel.xml / @+id/menu_disable_selection / 禁用所选`）：`TXT 目录规则` 多选“更多”菜单补齐 legado 同义“禁用所选”入口。点击后仅对当前选中集合批量写入 `enabled=false` 并刷新列表；不追加成功提示，不跳转页面，保持多选态停留与静默状态流。
  - `P5-seq400` 差异点清单（实施前）：
    - legado `txt_toc_rule_sel.xml` 固定包含 `menu_disable_selection`；Flutter 侧此前多选“更多”菜单仅有“启用所选/导出所选”，缺少同层级“禁用所选”入口。
    - legado `TxtTocRuleActivity.onMenuItemClick(menu_disable_selection)` 固定调用 `viewModel.disableSelection(*adapter.selection)`；Flutter 侧此前缺少按“当前选中集合”批量禁用的写库动作。
    - legado `TxtTocRuleViewModel.disableSelection` 语义为仅重写所选规则 `enable=false` 并静默刷新列表；Flutter 侧此前无同义批量禁用状态机，入口不可达。
  - `P5-seq400` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 目录规则 -> 多选 -> 勾选规则 -> 更多 -> 禁用所选`）。
    - 状态：已同义（仅对当前选中规则批量写入 `enabled=false`；未选中规则保持原值；列表刷新后保留当前页面）。
    - 异常：已同义（失败仅输出 `DisableSelectionTxtTocRuleError` 调试日志；页面保持当前状态且不追加扩展提示）。
    - 文案：已同义（多选“更多”菜单文案补齐固定“禁用所选”）。
    - 排版：已同义（入口位于既有多选“更多”动作层，不改动列表卡片、顶栏与底部操作栏布局）。
    - 交互触发：已同义（仅在多选且存在选中项时可触发；执行后停留当前页，不触发导入/导出/条目级菜单链路）。
    - 验证：命令 `dart format lib/features/reader/services/txt_toc_rule_store.dart lib/features/reader/views/txt_toc_rule_manage_view.dart`；命令 `flutter test test/simple_reader_view_compile_test.dart test/search_book_info_view_compile_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 目录规则 -> 多选 -> 勾选至少一条启用规则 -> 更多 -> 禁用所选`（校验所选条目“已禁用”标记出现且无成功提示）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_disable_selection` 单项能力，不提前并入 `menu_export_selection`（`seq401`）。
  - 下一项：按优先级继续推进 `P5-seq401`（`txt_toc_rule_sel.xml / @+id/menu_export_selection / 导出所选`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq399`（`txt_toc_rule_sel.xml / @+id/menu_enable_selection / 启用所选`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq399`（`txt_toc_rule_sel.xml / @+id/menu_enable_selection / 启用所选`）：`TXT 目录规则` 多选“更多”菜单补齐 legado 同义“启用所选”入口。点击后仅对当前选中集合批量写入 `enabled=true` 并刷新列表；不追加成功提示，不跳转页面，保持多选态停留与静默状态流。
  - `P5-seq399` 差异点清单（实施前）：
    - legado `txt_toc_rule_sel.xml` 固定包含 `menu_enable_selection`；Flutter 侧此前多选“更多”菜单仅有“导出所选”，缺少同层级“启用所选”入口。
    - legado `TxtTocRuleActivity.onMenuItemClick(menu_enable_selection)` 固定调用 `viewModel.enableSelection(*adapter.selection)`；Flutter 侧此前缺少按“当前选中集合”批量启用的写库动作。
    - legado `TxtTocRuleViewModel.enableSelection` 语义为仅重写所选规则 `enable=true` 并静默刷新列表；Flutter 侧此前无同义批量启用状态机，入口不可达。
  - `P5-seq399` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 目录规则 -> 多选 -> 勾选规则 -> 更多 -> 启用所选`）。
    - 状态：已同义（仅对当前选中规则批量写入 `enabled=true`；未选中规则保持原值；列表刷新后保留当前页面）。
    - 异常：已同义（失败仅输出 `EnableSelectionTxtTocRuleError` 调试日志；页面保持当前状态且不追加扩展提示）。
    - 文案：已同义（多选“更多”菜单文案固定“启用所选”）。
    - 排版：已同义（入口位于既有多选“更多”动作层，不改动列表卡片、顶栏与底部操作栏布局）。
    - 交互触发：已同义（仅在多选且存在选中项时可触发；执行后停留当前页，不触发导入/导出/条目级菜单链路）。
    - 验证：命令 `dart format lib/features/reader/services/txt_toc_rule_store.dart lib/features/reader/views/txt_toc_rule_manage_view.dart`；命令 `flutter test test/simple_reader_view_compile_test.dart test/search_book_info_view_compile_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 目录规则 -> 多选 -> 勾选至少一条禁用规则 -> 更多 -> 启用所选`（校验所选条目“已禁用”标记消失且无成功提示）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_enable_selection` 单项能力，不提前并入 `menu_disable_selection`（`seq400`）。
  - 下一项：按优先级继续推进 `P5-seq400`（`txt_toc_rule_sel.xml / @+id/menu_disable_selection / 禁用所选`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq398`（`txt_toc_rule_item.xml / @+id/menu_del / 删除`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq398`（`txt_toc_rule_item.xml / @+id/menu_del / 删除`）：`TXT 目录规则` 列表条目补齐 legado 同义“更多 -> 删除”动作。点击后先清理当前条目选中态，再弹出确认框（标题“提醒”，内容“是否确认删除？\n<规则名>”）；仅在确认后删库并静默刷新列表，不追加成功提示、不跳转页面。
  - `P5-seq398` 差异点清单（实施前）：
    - legado `txt_toc_rule_item.xml` 固定包含 `menu_del`；Flutter 侧此前条目“更多”菜单仅有“置顶/置底”，缺少同层级“删除”入口。
    - legado `TxtTocRuleAdapter.showMenu(menu_del)` 语义为先执行 `selected.remove(source)` 再触发删除回调；Flutter 侧此前缺少“删除前先清理选中态”的边界处理。
    - legado `TxtTocRuleActivity.del` 为确认式删除（`draw + sure_del + source.name`）且全流程静默；Flutter 侧此前无条目级删除状态机。
  - `P5-seq398` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 目录规则 -> 任一规则右侧更多 -> 删除`）。
    - 状态：已同义（触发删除先移除当前条目选中态；仅确认后删库并刷新列表；取消不删库）。
    - 异常：已同义（失败仅输出 `DeleteTxtTocRuleError` 调试日志；页面保持当前状态且不追加扩展提示）。
    - 文案：已同义（删除确认框标题“提醒”，正文“是否确认删除？\n<规则名>”；动作“取消/确定”）。
    - 排版：已同义（仅在既有条目更多菜单追加“删除”动作，不改动列表卡片与多选底栏布局）。
    - 交互触发：已同义（仅非多选模式触发；保持“先清选中态 -> 再确认删除”的时序）。
    - 验证：命令 `dart format lib/features/reader/services/txt_toc_rule_store.dart lib/features/reader/views/txt_toc_rule_manage_view.dart`；命令 `flutter test test/simple_reader_view_compile_test.dart test/search_book_info_view_compile_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 目录规则 -> 任一规则右侧更多 -> 删除 -> 取消/确定`（校验取消不删库、确认后条目移除且无成功提示）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_del` 单项能力，不提前并入 `menu_enable_selection/menu_disable_selection`（`seq399~400`）。
  - 下一项：按优先级继续推进 `P5-seq399`（`txt_toc_rule_sel.xml / @+id/menu_enable_selection / 启用所选`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq397`（`txt_toc_rule_item.xml / @+id/menu_bottom / 置底`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq397`（`txt_toc_rule_item.xml / @+id/menu_bottom / 置底`）：`TXT 目录规则` 列表条目补齐 legado 同义“更多 -> 置底”动作。点击后仅将目标规则 `serialNumber` 写为当前最大序号加一并静默刷新列表排序，不追加成功提示、不跳转页面。
  - `P5-seq397` 差异点清单（实施前）：
    - legado `txt_toc_rule_item.xml` 固定包含 `menu_bottom`；Flutter 侧此前条目“更多”菜单仅有“置顶”，缺少同层级“置底”入口。
    - legado `TxtTocRuleViewModel.toBottom` 语义为读取全量最大序号后写入 `maxOrder + index`；Flutter 侧此前缺少对应 `serialNumber` 置底写库状态机。
    - legado 置底动作全流程静默；Flutter 侧此前无该动作，缺少同义错误可观测口径。
  - `P5-seq397` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 目录规则 -> 任一规则右侧更多 -> 置底`）。
    - 状态：已同义（仅重写目标规则 `serialNumber=maxSerial+1`，其余规则不改写；列表按序号即时重排）。
    - 异常：已同义（失败仅输出 `BottomTxtTocRuleError` 调试日志；页面保持当前状态且不追加扩展提示）。
    - 文案：已同义（条目动作文案补齐“置底”；与“置顶”同层展示）。
    - 排版：已同义（未改动列表卡片布局、多选底栏与导入导出布局）。
    - 交互触发：已同义（仅在非多选模式触发；多选模式维持“点按即选中”语义）。
    - 验证：命令 `dart format lib/features/reader/services/txt_toc_rule_store.dart lib/features/reader/views/txt_toc_rule_manage_view.dart`；命令 `flutter test test/simple_reader_view_compile_test.dart test/search_book_info_view_compile_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 目录规则 -> 任一规则右侧更多 -> 置底`（校验目标规则下移到列表底部且无成功提示）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_bottom` 单项能力，不提前并入 `menu_del/menu_enable_selection/menu_disable_selection`（`seq398~400`）。
  - 下一项：按优先级继续推进 `P5-seq398`（`txt_toc_rule_item.xml / @+id/menu_del / 删除`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq396`（`txt_toc_rule_item.xml / @+id/menu_top / 置顶`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq396`（`txt_toc_rule_item.xml / @+id/menu_top / 置顶`）：`TXT 目录规则` 列表条目补齐 legado 同义“更多 -> 置顶”动作。点击后仅将目标规则 `serialNumber` 写为当前最小序号减一并静默刷新列表排序，不追加成功提示、不跳转页面。
  - `P5-seq396` 差异点清单（实施前）：
    - legado `txt_toc_rule_item.xml` 固定包含 `menu_top`；Flutter 侧此前 `TXT 目录规则` 条目缺少条目级“更多”入口，无法触发同层级置顶动作。
    - legado `TxtTocRuleViewModel.toTop` 语义为读取全量最小序号后写入 `minOrder - 1`；Flutter 侧此前缺少对应 `serialNumber` 置顶写库状态机。
    - legado 置顶动作全流程静默；Flutter 侧此前无该动作，缺少同义错误可观测口径。
  - `P5-seq396` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 目录规则 -> 任一规则右侧更多 -> 置顶`）。
    - 状态：已同义（仅重写目标规则 `serialNumber=minSerial-1`，其余规则不改写；列表按序号即时重排）。
    - 异常：已同义（失败仅输出 `TopTxtTocRuleError` 调试日志；页面保持当前状态且不追加扩展提示）。
    - 文案：已同义（条目动作文案固定“置顶”）。
    - 排版：已同义（非多选态条目补齐右侧“更多”热区；未改动多选底栏与导入导出布局）。
    - 交互触发：已同义（仅在非多选模式触发；多选模式维持原有“点按即选中”语义）。
    - 验证：命令 `dart format lib/features/reader/services/txt_toc_rule_store.dart lib/features/reader/views/txt_toc_rule_manage_view.dart`；命令 `flutter test test/simple_reader_view_compile_test.dart test/search_book_info_view_compile_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 目录规则 -> 任一规则右侧更多 -> 置顶`（校验目标规则上移到列表顶部且无成功提示）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_top` 单项能力，不提前并入 `menu_bottom/menu_del/menu_enable_selection/menu_disable_selection`（`seq397~400`）。
  - 下一项：按优先级继续推进 `P5-seq397`（`txt_toc_rule_item.xml / @+id/menu_bottom / 置底`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq393`（`txt_toc_rule_edit.xml / @+id/menu_save / 保存`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq393`（`txt_toc_rule_edit.xml / @+id/menu_save / 保存`）：`TXT 目录规则` 编辑页补齐 legado 同义“顶栏一级保存”状态机。点击“保存”后仅提交 `name/rule/example`，保留 `id/enabled/serialNumber`；校验通过后关闭编辑页并回传规则，管理页执行 `upsert` 落库并刷新列表，不追加成功提示。
  - `P5-seq393` 差异点清单（实施前）：
    - legado `txt_toc_rule_edit.xml` 固定提供 `menu_save` 顶栏一级动作；Flutter 侧虽已有“保存”按钮，但 `example` 字段保存时将空输入转成 `null`，无法对齐 legado `toString()` 的空串回写边界。
    - legado `TxtTocRuleEditDialog.getRuleFromView` 仅更新 `name/rule/example`，并保留 `id/enable/serialNumber`；Flutter 侧需确保编辑已有规则时字段保持同义，不产生附加字段重置。
    - legado `menu_save` 成功后直接关闭编辑页且无成功提示；Flutter 侧需保持“保存成功静默返回”语义，避免扩展反馈分支。
  - `P5-seq393` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 目录规则 -> 点击规则进入编辑页 -> 顶栏保存`）。
    - 状态：已同义（保存仅更新 `name/rule/example`；`id/enabled/serialNumber` 由初始规则透传保留）。
    - 异常：已同义（名称为空提示“名称不能为空”；正则非法提示“正则语法错误或不支持(txt)：...”；校验失败停留当前页）。
    - 文案：已同义（编辑页一级动作文案固定“保存”）。
    - 排版：已同义（保存动作保持顶栏一级；未改动编辑表单与管理列表布局）。
    - 交互触发：已同义（`保存 -> 校验 -> 回传 -> upsert 落库 -> 列表刷新`；保存成功静默返回）。
    - 验证：命令 `dart format lib/features/reader/views/txt_toc_rule_edit_view.dart`；手工路径（待回归）`设置 -> 源管理 -> 目录规则 -> 点击任一规则 -> 清空示例 -> 保存`（校验示例可被清空且列表刷新）；手工路径（待回归）`名称留空或输入非法正则后保存`（校验拦截提示并停留编辑页）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_save` 保存边界，不提前并入 `menu_copy_rule/menu_paste_rule` 之外的后续序号能力。
  - 下一项：按优先级继续推进 `P5-seq396`（`txt_toc_rule_item.xml / @+id/menu_top / 置顶`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq387`（`txt_toc_rule.xml / @+id/menu_add / 添加`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq387`（`txt_toc_rule.xml / @+id/menu_add / 添加`）：`TXT 目录规则` 管理页补齐 legado 同义“添加”一级入口。点击“添加”后进入规则编辑页，保存时执行名称与正则校验；校验通过后回传并落库，列表刷新可见新增规则；校验失败则停留编辑页并提示错误。
  - `P5-seq387` 差异点清单（实施前）：
    - legado `txt_toc_rule.xml` 固定包含 `menu_add(@string/add)` 且位于顶栏一级动作；Flutter 侧此前仅有“多选/更多”，缺少同层级“添加”入口。
    - legado `TxtTocRuleActivity.menu_add -> TxtTocRuleEditDialog` 支持“新建草稿 -> 编辑 -> 保存后落库”；Flutter 侧此前编辑页无保存回传，管理页无法新增规则。
    - legado `TxtTocRuleEditDialog.checkValid` 固定校验“名称不能为空 + 正则可编译”；Flutter 侧此前缺少同义保存校验，无法对齐异常边界。
  - `P5-seq387` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 目录规则 -> 右上角添加`）。
    - 状态：已同义（点击“添加”进入空白编辑页；保存成功后落库并刷新列表；取消返回不落库）。
    - 异常：已同义（名称为空提示“名称不能为空”；正则非法提示“正则语法错误或不支持(txt)：...”；保存失败记录 `SaveTxtTocRuleError`）。
    - 文案：已同义（顶栏新增动作文案固定“添加”；编辑页新增动作文案“保存”）。
    - 排版：已同义（“添加/多选/更多”并列于顶栏动作层，未改动列表与多选底栏布局）。
    - 交互触发：已同义（`添加 -> 编辑 -> 保存 -> 回传 -> upsert 落库 -> 列表刷新`；编辑已有规则同链路回写）。
    - 验证：命令 `dart format lib/features/reader/services/txt_toc_rule_store.dart lib/features/reader/views/txt_toc_rule_manage_view.dart lib/features/reader/views/txt_toc_rule_edit_view.dart`；手工路径（待回归）`设置 -> 源管理 -> 目录规则 -> 右上角添加 -> 填写名称与正则 -> 保存`（校验新增可见）；手工路径（待回归）`名称留空或输入非法正则后保存`（校验拦截提示并停留编辑页）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_add` 及其保存校验闭环，不提前并入 `txt_toc_rule_edit.xml` 其它菜单能力。
  - 下一项：按优先级继续推进 `P5-seq393`（`txt_toc_rule_edit.xml / @+id/menu_save / 保存`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq298`（`replace_rule_sel.xml / @+id/menu_bottom_sel / 置底所选`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq298`（`replace_rule_sel.xml / @+id/menu_bottom_sel / 置底所选`）：`文本替换规则` 多选“更多”菜单补齐 legado 同义“置底所选”入口。点击后仅对当前选中集合批量重写 `order` 为置底序列并刷新列表；不追加成功提示，不跳转页面，保持多选页内停留与静默状态流。
  - `P5-seq298` 差异点清单（实施前）：
    - legado `replace_rule_sel.xml` 固定包含 `menu_bottom_sel`；Flutter 侧此前多选“更多”菜单缺少“置底所选”入口。
    - legado `ReplaceRuleActivity.onMenuItemClick(menu_bottom_sel)` 固定调用 `viewModel.bottomSelect(adapter.selection)`；Flutter 侧此前缺少按“当前选中集合”批量置底的触发链路。
    - legado `ReplaceRuleViewModel.bottomSelect` 语义为 `maxOrder` 起步并按当前选中顺序执行 `order=maxOrder++` 批量写回，动作全程静默；Flutter 侧此前无该同义写库状态机。
  - `P5-seq298` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 多选 -> 勾选规则 -> 更多 -> 置底所选`）。
    - 状态：已同义（仅对当前选中规则批量重写 `order` 并置底，且保持选中集合在当前列表中的相对顺序）。
    - 异常：已同义（写入异常仅输出 `BottomSelectionReplaceRuleError` 调试日志；页面保持当前状态且不追加扩展提示）。
    - 文案：已同义（多选“更多”菜单文案固定“置底所选”）。
    - 排版：已同义（入口位于既有多选“更多”动作层，不改动列表与底部操作栏布局）。
    - 交互触发：已同义（仅在多选且存在选中项时可触发；执行后停留当前页，不触发导入/导出与条目级菜单链路）。
    - 验证：命令 `dart format lib/features/replace/views/replace_rule_list_view.dart`；命令 `flutter test test/search_view_compile_test.dart test/widget_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 多选 -> 勾选至少两条规则 -> 更多 -> 置底所选`（校验所选规则按当前列表顺序移动到底部且无成功提示）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_bottom_sel` 单项能力，不提前并入 `txt_toc_rule.xml` 后续序号能力。
  - 下一项：按优先级继续推进 `P5-seq387`（`txt_toc_rule.xml / @+id/menu_add / 添加`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq297`（`replace_rule_sel.xml / @+id/menu_top_sel / 置顶所选`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq297`（`replace_rule_sel.xml / @+id/menu_top_sel / 置顶所选`）：`文本替换规则` 多选“更多”菜单补齐 legado 同义“置顶所选”入口。点击后仅对当前选中集合批量重写 `order` 为置顶序列并刷新列表；不追加成功提示，不跳转页面，保持多选页内停留与静默状态流。
  - `P5-seq297` 差异点清单（实施前）：
    - legado `replace_rule_sel.xml` 固定包含 `menu_top_sel`；Flutter 侧此前多选“更多”菜单仅有“启用所选/禁用所选/导出所选”，入口缺失。
    - legado `ReplaceRuleActivity.onMenuItemClick(menu_top_sel)` 固定调用 `viewModel.topSelect(adapter.selection)`；Flutter 侧此前缺少按“当前选中集合”批量置顶的触发链路。
    - legado `ReplaceRuleViewModel.topSelect` 语义为 `minOrder - selectionSize` 起步并按当前列表顺序递增写回，确保“批量置顶且保持相对顺序”；Flutter 侧此前无该同义写库状态机。
  - `P5-seq297` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 多选 -> 勾选规则 -> 更多 -> 置顶所选`）。
    - 状态：已同义（仅对当前选中规则批量重写 `order` 并置顶，且保持选中集合在当前列表中的相对顺序）。
    - 异常：已同义（写入异常仅输出 `TopSelectionReplaceRuleError` 调试日志；页面保持当前状态且不追加扩展提示）。
    - 文案：已同义（多选“更多”菜单文案固定“置顶所选”）。
    - 排版：已同义（入口位于既有多选“更多”动作层，不改动列表与底部操作栏布局）。
    - 交互触发：已同义（仅在多选且存在选中项时可触发；执行后停留当前页，不触发导入/导出与条目级菜单链路）。
    - 验证：命令 `dart format lib/features/replace/views/replace_rule_list_view.dart`；命令 `flutter test test/search_view_compile_test.dart test/widget_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 多选 -> 勾选至少两条规则 -> 更多 -> 置顶所选`（校验所选规则按当前列表顺序移动到顶部且无成功提示）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_top_sel` 单项能力，不提前并入 `menu_bottom_sel`（`seq298`）。
  - 下一项：按优先级继续推进 `P5-seq298`（`replace_rule_sel.xml / @+id/menu_bottom_sel / 置底所选`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq296`（`replace_rule_sel.xml / @+id/menu_disable_selection / 禁用所选`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq296`（`replace_rule_sel.xml / @+id/menu_disable_selection / 禁用所选`）：`文本替换规则` 多选“更多”菜单补齐 legado 同义“禁用所选”入口。点击后仅对当前选中集合批量写入 `isEnabled=false` 并刷新列表；不追加成功提示，不跳转页面，保持多选页内停留与静默状态流。
  - `P5-seq296` 差异点清单（实施前）：
    - legado `replace_rule_sel.xml` 固定包含 `menu_disable_selection`；Flutter 侧此前多选“更多”菜单仅有“启用所选/导出所选”，入口缺失。
    - legado `ReplaceRuleActivity.onMenuItemClick(menu_disable_selection)` 固定调用 `viewModel.disableSelection(adapter.selection)`；Flutter 侧此前缺少按“当前选中集合”批量禁用的写库动作。
    - legado `ReplaceRuleViewModel.disableSelection` 语义为复制所选规则并统一写入 `isEnabled=false`，全流程静默；Flutter 侧此前无该同义状态流证据。
  - `P5-seq296` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 多选 -> 勾选规则 -> 更多 -> 禁用所选`）。
    - 状态：已同义（仅对当前选中规则批量置 `isEnabled=false` 并刷新列表；未选中规则保持原值）。
    - 异常：已同义（写入异常仅输出 `DisableSelectionReplaceRuleError` 调试日志；页面保持当前状态且不追加扩展提示）。
    - 文案：已同义（多选“更多”菜单文案固定“禁用所选”）。
    - 排版：已同义（入口位于既有多选“更多”动作层，不改动列表与底部操作栏布局）。
    - 交互触发：已同义（仅在多选且存在选中项时可触发；执行后停留当前页，不触发导入/导出以外链路）。
    - 验证：命令 `dart format lib/features/replace/views/replace_rule_list_view.dart`；命令 `flutter test test/search_view_compile_test.dart test/widget_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 多选 -> 勾选至少一条启用规则 -> 更多 -> 禁用所选`（校验所选条目“禁用”标记出现，且无成功提示）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_disable_selection` 单项能力，不提前并入 `menu_top_sel/menu_bottom_sel`（`seq297~298`）。
  - 下一项：按优先级继续推进 `P5-seq297`（`replace_rule_sel.xml / @+id/menu_top_sel / 置顶所选`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq295`（`replace_rule_sel.xml / @+id/menu_enable_selection / 启用所选`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq295`（`replace_rule_sel.xml / @+id/menu_enable_selection / 启用所选`）：`文本替换规则` 多选“更多”菜单补齐 legado 同义“启用所选”入口。点击后仅对当前选中集合批量写入 `isEnabled=true` 并刷新列表；不追加成功提示，不跳转页面，保持多选页内停留与静默状态流。
  - `P5-seq295` 差异点清单（实施前）：
    - legado `replace_rule_sel.xml` 固定包含 `menu_enable_selection`；Flutter 侧此前多选“更多”菜单仅有“导出所选”，入口缺失。
    - legado `ReplaceRuleActivity.onMenuItemClick(menu_enable_selection)` 固定调用 `viewModel.enableSelection(adapter.selection)`；Flutter 侧此前缺少按“当前选中集合”批量启用的写库动作。
    - legado `ReplaceRuleViewModel.enableSelection` 语义为复制所选规则并统一写入 `isEnabled=true`，全流程静默；Flutter 侧此前无该同义状态流证据。
  - `P5-seq295` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 多选 -> 勾选规则 -> 更多 -> 启用所选`）。
    - 状态：已同义（仅对当前选中规则批量置 `isEnabled=true` 并刷新列表；未选中规则保持原值）。
    - 异常：已同义（写入异常仅输出 `EnableSelectionReplaceRuleError` 调试日志；页面保持当前状态且不追加扩展提示）。
    - 文案：已同义（多选“更多”菜单文案固定“启用所选”）。
    - 排版：已同义（入口位于既有多选“更多”动作层，不改动列表与底部操作栏布局）。
    - 交互触发：已同义（仅在多选且存在选中项时可触发；执行后停留当前页，不触发导入/导出以外链路）。
    - 验证：命令 `dart format lib/features/replace/views/replace_rule_list_view.dart`；命令 `flutter test test/search_view_compile_test.dart test/widget_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 多选 -> 勾选至少一条禁用规则 -> 更多 -> 启用所选`（校验所选条目“禁用”标记消失，且无成功提示）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_enable_selection` 单项能力，不提前并入 `menu_disable_selection/menu_top_sel/menu_bottom_sel`（`seq296~298`）。
  - 下一项：按优先级继续推进 `P5-seq296`（`replace_rule_sel.xml / @+id/menu_disable_selection / 禁用所选`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq294`（`replace_rule_item.xml / @+id/menu_del / 删除`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq294`（`replace_rule_item.xml / @+id/menu_del / 删除`）：`文本替换规则` 条目“更多”菜单补齐 legado 同义“删除”入口。点击后先清理该条目的当前选中态，再弹出确认框（标题“提醒”，正文“是否确认删除？\n<规则名>”）；确认后执行删库并由列表流式刷新移除条目，取消则不删库。全流程保持静默，不追加成功提示，不跳转页面。
  - `P5-seq294` 差异点清单（实施前）：
    - legado `replace_rule_item.xml` 条目菜单固定包含 `menu_top/menu_bottom/menu_del`；Flutter 侧此前仅有“置顶/置底”，`menu_del` 入口缺失。
    - legado `ReplaceRuleAdapter.showMenu(menu_del)` 语义为“先回调 `delete(item)`，并立即 `selected.remove(item)`”；Flutter 侧此前无“删除前先移除选中态”边界，无法对齐取消删除后的选中状态流。
    - legado `ReplaceRuleActivity.delete` 固定弹出“提醒 + 是否确认删除？\n<规则名>”确认框，确认后才执行 `viewModel.delete(rule)`；Flutter 侧此前无等价确认链路。
  - `P5-seq294` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 任一规则右侧更多 -> 删除`）。
    - 状态：已同义（点击“删除”后先移除该条目选中态；确认后删库并移除条目，取消不删库）。
    - 异常：已同义（失败仅输出 `DeleteReplaceRuleError` 调试日志；页面保持当前状态且不追加扩展提示）。
    - 文案：已同义（动作文案“删除”；确认框标题“提醒”，正文“是否确认删除？\n<规则名>”）。
    - 排版：已同义（入口继续位于条目“更多”动作层，与“置顶/置底”同层级，不改动列表布局）。
    - 交互触发：已同义（点击“删除”仅触发确认链路；确认后删库，取消后静默返回；不触发编辑与批量操作链路）。
    - 验证：命令 `dart format lib/features/replace/views/replace_rule_list_view.dart`；命令 `flutter test test/search_view_compile_test.dart test/widget_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 任一规则右侧更多 -> 删除 -> 取消/确定`（校验确认框文案、取消不删库、确认后条目消失且无成功提示）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_del` 单项能力，不提前并入 `replace_rule_sel.xml` 批量动作（`seq295~298`）。
  - 下一项：按优先级继续推进 `P5-seq295`（`replace_rule_sel.xml / @+id/menu_enable_selection / 启用所选`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq293`（`replace_rule_item.xml / @+id/menu_bottom / 置底`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq293`（`replace_rule_item.xml / @+id/menu_bottom / 置底`）：`文本替换规则` 条目“更多”菜单补齐 legado 同义“置底”入口。点击后仅执行单条规则置底写库：读取当前规则最大 `order` 并写入 `maxOrder + 1`，随后由列表流式刷新自然重排；全流程保持静默，不追加成功提示，不跳转页面。
  - `P5-seq293` 差异点清单（实施前）：
    - legado `replace_rule_item.xml` 条目菜单固定包含 `menu_top/menu_bottom/menu_del`；Flutter 侧此前仅有“置顶”，`menu_bottom` 入口缺失。
    - legado `ReplaceRuleAdapter.showMenu(menu_bottom)` 固定回调 `callBack.toBottom(item)`；Flutter 侧此前缺少条目级“置底”触发链路，无法对齐同层级热区语义。
    - legado `ReplaceRuleViewModel.toBottom` 语义为 `order = maxOrder + 1` 后写库且静默返回；Flutter 侧此前无等价写库动作。
  - `P5-seq293` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 任一规则右侧更多 -> 置底`）。
    - 状态：已同义（点击后目标规则写入 `maxOrder + 1` 并在列表中后移；不影响其它规则启停状态）。
    - 异常：已同义（失败仅输出 `BottomReplaceRuleError` 调试日志；页面保持当前状态且不追加扩展提示）。
    - 文案：已同义（动作文案“置底”）。
    - 排版：已同义（入口继续位于条目“更多”动作层，与既有“置顶”同层级，不改动列表布局）。
    - 交互触发：已同义（点击后仅触发单条置底写库；不触发删除、编辑或批量操作链路）。
    - 验证：命令 `dart format lib/features/replace/views/replace_rule_list_view.dart`；命令 `flutter test test/search_view_compile_test.dart test/widget_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 任一规则右侧更多 -> 置底`（校验目标规则后移且无成功提示）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_bottom` 单项能力，不提前并入 `menu_del`（`seq294`）与多选批量动作（`seq295~298`）。
  - 下一项：按优先级继续推进 `P5-seq294`（`replace_rule_item.xml / @+id/menu_del / 删除`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq287`（`replace_rule.xml / @+id/menu_add_replace_rule / 新建替换`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq287`（`replace_rule.xml / @+id/menu_add_replace_rule / 新建替换`）：`文本替换规则` 页补齐 legado 同义“更多菜单 -> 新建替换”入口。将顶栏 `+` 入口下沉为“更多”菜单动作，点击后仅打开空白替换规则编辑页，不自动落库、不追加成功提示，返回即取消。
  - `P5-seq287` 差异点清单（实施前）：
    - legado `replace_rule.xml` 中 `menu_add_replace_rule` 为 `showAsAction=never`，入口位于一级“更多菜单”；Flutter 侧此前入口位于顶栏 `+`，缺少同层级菜单动作。
    - legado `ReplaceRuleActivity.menu_add_replace_rule` 固定执行 `ReplaceEditActivity.startIntent(this)`，仅进入新建编辑承载页；Flutter 侧需确保触发后不附带自动保存副作用。
    - `docs/plans/2026-02-21-legado-feature-priority-queue.csv` 中 `seq287` 仍为 `pending`，缺少完成态回填。
  - `P5-seq287` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 右上角更多 -> 新建替换`）。
    - 状态：已同义（点击后进入空白编辑页；未保存直接返回不落库）。
    - 异常：已同义（菜单忙碌态会禁用重复触发，不追加扩展提示）。
    - 文案：已同义（动作文案“新建替换”）。
    - 排版：已同义（移除顶栏 `+`，入口收敛到“更多”动作层级，匹配 `showAsAction=never`）。
    - 交互触发：已同义（动作仅触发新建编辑承载页，不触发导入/导出/删除链路）。
    - 验证：命令 `dart format lib/features/replace/views/replace_rule_list_view.dart`；命令 `flutter test test/search_view_compile_test.dart test/widget_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 右上角更多 -> 新建替换`（校验进入空白编辑页且返回不落库）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_add_replace_rule` 入口层级与触发语义，不改动 `replace_rule_item`（`seq292~294`）后续能力。
  - 下一项：按优先级继续推进 `P5-seq292`（`replace_rule_item.xml / @+id/menu_top / 置顶`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq286`（`replace_rule.xml / @+id/menu_group_null / 未分组`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq286`（`replace_rule.xml / @+id/menu_group_null / 未分组`）：`文本替换规则` 的“分组”弹层补齐 legado 同义 `menu_group_null` 语义。点击“未分组”后仅展示 `group` 为空、空白或包含“未分组”关键词的规则；筛选切换保持静默，不追加成功提示，不跳转页面。并将“未分组”关键词抽为统一常量，确保入口文案与判定口径一致可追踪。
  - `P5-seq286` 差异点清单（实施前）：
    - legado `ReplaceRuleActivity.menu_group_null` 固定执行 `searchView.setQuery(getString(R.string.no_group), true)`；Flutter 侧虽有“未分组”筛选分支，但关键词判定为散点硬编码，迁移证据不集中。
    - legado `ReplaceRuleDao.flowNoGroup()` 语义为 `group is null` 或 `trim(group)=''` 或 `trim(group) like '%未分组%'`；Flutter 侧需明确保持同义判定边界。
    - `docs/plans/2026-02-21-legado-feature-priority-queue.csv` 中 `seq286` 仍为 `pending`，缺少完成态回填。
  - `P5-seq286` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 右上角分组按钮 -> 未分组`）。
    - 状态：已同义（点击后仅保留无分组规则；切换筛选时清空当前多选态并停留当前页）。
    - 异常：已同义（空数据与筛选切换均保持静默，不追加扩展提示）。
    - 文案：已同义（“未分组”入口文案与 no-group 判定关键词统一）。
    - 排版：已同义（入口仍位于分组动作弹层，不改变 `menu_group` 已对齐的层级结构）。
    - 交互触发：已同义（点击“未分组”直接触发 no-group 过滤；取消弹层不改变当前筛选状态）。
    - 验证：命令 `dart format lib/features/replace/views/replace_rule_list_view.dart`；命令 `flutter test test/widget_test.dart test/search_view_compile_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 右上角分组按钮 -> 未分组`（校验仅展示无分组规则，且包含 `group` 含“未分组”的规则）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_group_null` 判定口径与回填证据，不改动 `menu_add_replace_rule`（`seq287`）后续能力。
  - 下一项：按优先级继续推进 `P5-seq287`（`replace_rule.xml / @+id/menu_add_replace_rule / 新建替换`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq285`（`replace_rule.xml / @+id/menu_group_manage / 分组管理`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq285`（`replace_rule.xml / @+id/menu_group_manage / 分组管理`）：`文本替换规则` 的“分组”弹层补齐 legado 同义“分组管理”入口。点击后进入分组管理弹层（标题“分组管理”，右上角“添加分组”）；弹层内支持“编辑/删除”分组并实时刷新列表。添加分组语义对齐 legado `addGroup`：仅为 `group` 为空规则赋值；编辑/删除语义对齐 legado `upGroup/delGroup`：按逗号分组集合执行移除与重写，流程保持静默无成功提示。
  - `P5-seq285` 差异点清单（实施前）：
    - legado `replace_rule.xml` 的 `menu_group` 子菜单首项为 `menu_group_manage`；Flutter 侧此前仅有“全部/未分组/动态分组”筛选，缺少分组管理入口。
    - legado `GroupManageDialog` 提供“分组管理”弹层与“添加/编辑/删除”分组动作；Flutter 侧此前无对应承载层。
    - legado `ReplaceRuleViewModel` 提供 `addGroup/upGroup/delGroup` 变更链路；Flutter 侧此前无等价分组增删改写库能力。
  - `P5-seq285` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 右上角分组按钮 -> 分组管理`）。
    - 状态：已同义（管理弹层支持“添加分组/编辑分组/删除”；变更后分组列表与规则列表即时刷新）。
    - 异常：已同义（异常仅输出 `AddReplaceRuleGroupError/RenameReplaceRuleGroupError` 调试日志；不追加成功/失败扩展提示）。
    - 文案：已同义（“分组管理”“添加分组”“编辑分组”“删除”“分组名称”）。
    - 排版：已同义（分组管理采用独立弹层，顶部标题与添加动作同层，列表项右侧提供编辑/删除热区）。
    - 交互触发：已同义（添加仅处理无分组规则；编辑/删除按分组集合静默落库；取消输入不落库）。
    - 验证：命令 `dart format lib/features/replace/views/replace_rule_list_view.dart`；命令 `flutter test test/widget_test.dart test/search_view_compile_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 右上角分组按钮 -> 分组管理 -> 添加分组/编辑分组/删除分组`（校验无分组赋值、分组改名/删除与静默刷新）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_group_manage` 入口与分组管理状态机，不改动 `menu_group_null/menu_add_replace_rule`（`seq286/287`）后续能力。
  - 下一项：按优先级继续推进 `P5-seq286`（`replace_rule.xml / @+id/menu_group_null / 未分组`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq284`（`replace_rule.xml / @+id/menu_group / 分组`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq284`（`replace_rule.xml / @+id/menu_group / 分组`）：`文本替换规则` 列表页补齐 legado 同义“顶栏一级分组入口”与分组筛选状态机。移除页面顶部胶囊分组条，改为右上角分组动作弹层；分组选项由规则 `group` 字段按 `[,;，；]` 拆分去重并按 legado 近似 `cnCompare` 排序。点击“全部/未分组/动态分组”后立即按对应条件过滤列表并清空当前多选态。
  - `P5-seq284` 差异点清单（实施前）：
    - legado `replace_rule.xml` 采用 `menu_group` 顶栏一级入口承载分组筛选；Flutter 侧此前为页面内胶囊筛选条，入口层级不一致。
    - legado 分组集合来自 `flowGroups -> dealGroups`，会对 `group` 进行 `[,;，；]` 拆分后去重排序；Flutter 侧此前直接按整段 `group` 字符串去重，缺少拆分语义。
    - legado `menu_group_null` 过滤语义为 `group 为空` 或 `group 包含“未分组”`；Flutter 侧此前无该等价筛选分支且额外提供了 legado 不存在的“未启用”分组。
  - `P5-seq284` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 右上角分组图标`）。
    - 状态：已同义（分组弹层含“全部/未分组/动态分组”；点击即刷新列表过滤并保持当前页停留）。
    - 异常：已同义（空规则集时分组入口可打开但不触发异常；过滤动作无额外提示）。
    - 文案：已同义（动作标题“分组”；筛选项“全部/未分组/动态分组”）。
    - 排版：已同义（分组入口从页面内容区上移到顶栏一级动作区；移除非 legado 胶囊筛选条）。
    - 交互触发：已同义（“未分组”按 `group` 空值或包含“未分组”过滤；动态分组按 `group.contains` 命中过滤）。
    - 验证：命令 `dart format lib/features/replace/views/replace_rule_list_view.dart`；命令 `flutter test test/widget_test.dart test/search_view_compile_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 右上角分组 -> 选择全部/未分组/任意分组`（校验过滤结果与多选态重置）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_group` 筛选入口与过滤语义，不改动 `menu_group_manage`（`seq285`）与 `menu_group_null/menu_add_replace_rule`（`seq286/287`）后续能力。
  - 下一项：按优先级继续推进 `P5-seq285`（`replace_rule.xml / @+id/menu_group_manage / 分组管理`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq281`（`replace_edit.xml / @+id/menu_save / 保存`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq281`（`replace_edit.xml / @+id/menu_save / 保存`）：`文本替换规则` 编辑页补齐 legado 同义保存状态机。点击“保存”后先按编辑表单构建规则并执行有效性校验；校验失败提示 `save error, <原因>` 且停留当前编辑页；校验通过后执行落库，成功时关闭编辑页且不追加成功提示。对 `order == Int.MIN_VALUE` 的规则补齐 `maxOrder + 1` 分配语义，确保新建规则排序行为与 legado 一致。
  - `P5-seq281` 差异点清单（实施前）：
    - legado `ReplaceEditViewModel.save` 先执行 `checkValid()`；Flutter 侧此前 `ReplaceRuleEditView._save` 未做保存前阻断校验，存在无效规则直接保存并退出的语义偏差。
    - legado 保存失败口径为 `save error, <localizedMessage>` 且页面不关闭；Flutter 侧此前点击保存后固定 `Navigator.pop`，失败也会离开编辑页。
    - legado 当 `order == Int.MIN_VALUE` 时会在保存阶段自动写入 `maxOrder+1`；Flutter 侧此前未在保存路径收敛该边界。
  - `P5-seq281` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 编辑任一规则 -> 右上角保存`）。
    - 状态：已同义（保存成功后关闭编辑页；失败保持停留当前页）。
    - 异常：已同义（保存异常输出 `SaveReplaceRuleError` 调试日志并提示 `save error, <原因>`）。
    - 文案：已同义（一级动作文案“保存”；失败提示前缀固定 `save error,`）。
    - 排版：已同义（维持编辑页顶栏“保存 + 更多”动作层级，不改动表单布局）。
    - 交互触发：已同义（点击保存仅触发保存链路；不自动触发复制/粘贴与导入分支）。
    - 验证：命令 `dart format lib/features/replace/models/replace_rule.dart lib/features/replace/views/replace_rule_edit_view.dart lib/features/replace/views/replace_rule_list_view.dart lib/features/reader/views/simple_reader_view.dart`；命令 `flutter test test/search_view_compile_test.dart test/simple_reader_view_compile_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 编辑任一规则 -> 保存`（校验无效规则提示 `save error` 且失败不退出）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_save` 状态机与排序边界，不改动 `menu_group/menu_group_manage`（`seq284/285`）后续能力。
  - 下一项：按优先级继续推进 `P5-seq284`（`replace_rule.xml / @+id/menu_group / 分组`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq225`（`dict_rule_sel.xml / @+id/menu_disable_selection / 禁用所选`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq225`（`dict_rule_sel.xml / @+id/menu_disable_selection / 禁用所选`）：`字典规则` 管理页补齐 legado 同义“多选 -> 更多 -> 禁用所选”动作。点击“禁用所选”后仅对当前选中集合批量写入 `enabled=false` 并刷新列表；不追加成功提示，不跳转页面，保持多选态停留。
  - `P5-seq225` 差异点清单（实施前）：
    - legado `dict_rule_sel.xml` 菜单包含 `menu_disable_selection`；Flutter 侧此前多选菜单仅有“启用所选/导出所选”，入口缺失。
    - legado `DictRuleActivity.onMenuItemClick(menu_disable_selection)` 固定调用 `viewModel.disableSelection(*adapter.selection)`；Flutter 侧此前缺少按“当前选中集合”批量禁用的写库能力。
    - legado 禁用动作为静默状态流（无成功提示且不离开当前页）；Flutter 侧此前无该动作语义证据。
  - `P5-seq225` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 替换净化 -> 字典规则 -> 多选 -> 勾选规则 -> 更多 -> 禁用所选`）。
    - 状态：已同义（仅对当前选中规则批量置 `enabled=false` 并刷新列表；未选中规则保持原值）。
    - 异常：已同义（写入异常输出 `DisableSelectionDictRuleError` 调试日志；页面保持当前状态且不追加扩展提示）。
    - 文案：已同义（多选“更多”菜单文案固定“禁用所选”）。
    - 排版：已同义（入口位于既有多选“更多”动作层，不改动列表与底部操作栏布局）。
    - 交互触发：已同义（仅在多选且存在选中项时可触发；执行后停留当前页）。
    - 验证：命令 `dart format lib/features/reader/views/dict_rule_manage_view.dart`；手工路径（待回归）`设置 -> 源管理 -> 替换净化 -> 字典规则 -> 多选 -> 勾选至少一条启用规则 -> 更多 -> 禁用所选`（校验所选条目的“禁用”标记出现且无成功提示）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_disable_selection` 批量禁用状态流，不改动 `menu_copy_rule`（`seq222`）与 `replace_edit/menu_save`（`seq281`）后续能力。
  - 下一项：按优先级继续推进 `P5-seq281`（`replace_edit.xml / @+id/menu_save / 保存`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq224`（`dict_rule_sel.xml / @+id/menu_enable_selection / 启用所选`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq224`（`dict_rule_sel.xml / @+id/menu_enable_selection / 启用所选`）：`字典规则` 管理页补齐 legado 同义“多选 -> 更多 -> 启用所选”动作。点击“启用所选”后仅对当前选中集合批量写入 `enabled=true` 并刷新列表；不追加成功提示，不跳转页面，保持多选态停留。
  - `P5-seq224` 差异点清单（实施前）：
    - legado `dict_rule_sel.xml` 菜单包含 `menu_enable_selection`；Flutter 侧此前多选菜单仅有“导出所选”，入口缺失。
    - legado `DictRuleActivity.onMenuItemClick(menu_enable_selection)` 固定调用 `viewModel.enableSelection(*adapter.selection)`；Flutter 侧此前缺少按“当前选中集合”批量启用的写库能力。
    - legado 启用动作为静默状态流（无成功提示且不离开当前页）；Flutter 侧此前无该动作语义证据。
  - `P5-seq224` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 替换净化 -> 字典规则 -> 多选 -> 勾选规则 -> 更多 -> 启用所选`）。
    - 状态：已同义（仅对当前选中规则批量置 `enabled=true` 并刷新列表；未选中规则保持原值）。
    - 异常：已同义（写入异常输出 `EnableSelectionDictRuleError` 调试日志；页面保持当前状态且不追加扩展提示）。
    - 文案：已同义（多选“更多”菜单文案固定“启用所选”）。
    - 排版：已同义（入口位于既有多选“更多”动作层，不改动列表与底部操作栏布局）。
    - 交互触发：已同义（仅在多选且存在选中项时可触发；执行后停留当前页）。
    - 验证：命令 `dart format lib/features/reader/services/dict_rule_store.dart lib/features/reader/views/dict_rule_manage_view.dart`；手工路径（待回归）`设置 -> 源管理 -> 替换净化 -> 字典规则 -> 多选 -> 勾选至少一条禁用规则 -> 更多 -> 启用所选`（校验所选条目的“禁用”标记消失且无成功提示）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_enable_selection` 批量启用状态流，不改动 `menu_disable_selection`（`seq225`）与 `menu_copy_rule`（`seq222`）后续序号能力。
  - 下一项：按优先级继续推进 `P5-seq225`（`dict_rule_sel.xml / @+id/menu_disable_selection / 禁用所选`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq221`（`dict_rule_edit.xml / @+id/menu_save / 保存`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq221`（`dict_rule_edit.xml / @+id/menu_save / 保存`）：`字典规则` 编辑页补齐 legado 同义顶栏一级“保存”动作。点击“保存”后仅提交当前表单的 `name/urlRule/showRule`，关闭编辑页并回到规则列表；管理页落库语义对齐 legado `DictRuleEditViewModel.save`：按“删除旧名称规则 -> 插入新规则”处理重命名，保留 `enabled/sortNumber`，成功后静默刷新列表，不追加成功提示。
  - `P5-seq221` 差异点清单（实施前）：
    - legado `dict_rule_edit.xml` 在编辑页菜单常驻 `menu_save`；Flutter 侧此前 `DictRuleEditView` 仅有“更多 -> 粘贴规则”，缺少保存入口，编辑结果不可持久化。
    - legado `DictRuleEditDialog.getDictRule` 基于旧规则 `copy` 后仅覆盖 `name/urlRule/showRule`；Flutter 侧此前无对应提交链路，`enabled/sortNumber` 保留语义缺失。
    - legado `DictRuleEditViewModel.save` 采用“删旧再插入”处理重命名；Flutter 侧此前未覆盖旧名删除边界，改名后会保留旧规则副本。
  - `P5-seq221` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 替换净化 -> 字典规则 -> 新建/点击规则 -> 编辑页右上角保存`）。
    - 状态：已同义（点击后提交表单并关闭编辑页；列表刷新可见结果；改名时旧名称规则被移除）。
    - 异常：已同义（保存写入失败输出 `SaveDictRuleError` 并提示“保存失败：<原因>”，可观测且停留列表页）。
    - 文案：已同义（顶栏一级动作文案“保存”）。
    - 排版：已同义（编辑页顶栏为“保存 + 更多”并列动作层级；不改变表单结构）。
    - 交互触发：已同义（保存成功后静默返回；不自动触发复制/粘贴与导入链路）。
    - 验证：命令 `dart format lib/features/reader/views/dict_rule_edit_view.dart lib/features/reader/views/dict_rule_manage_view.dart lib/features/reader/services/dict_rule_store.dart`；手工路径（待回归）`设置 -> 源管理 -> 替换净化 -> 字典规则 -> 右上角加号 -> 填写字段 -> 保存`（校验新增后列表可见）；手工路径 `设置 -> 源管理 -> 替换净化 -> 字典规则 -> 点击已有规则 -> 修改名称 -> 保存`（校验旧规则被替换且 `enabled/排序` 保留）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_save` 编辑提交链路，不改动 `menu_copy_rule`（`seq222`）与多选启停（`seq224/225`）后续能力。
  - 下一项：按优先级继续推进 `P5-seq224`（`dict_rule_sel.xml / @+id/menu_enable_selection / 启用所选`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq215`（`dict_rule.xml / @+id/menu_add / 新建`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq215`（`dict_rule.xml / @+id/menu_add / 新建`）：`字典规则` 管理页补齐 legado 同义顶栏一级“新建”入口。点击右上角“加号”后直接进入空白字典规则编辑页（`name/urlRule/showRule` 初始为空），不触发导入流程、不自动保存、不跳转其它页面。
  - `P5-seq215` 差异点清单（实施前）：
    - legado `DictRuleActivity` 在 `dict_rule.xml` 顶栏常驻 `menu_add`，点击固定 `showDialogFragment<DictRuleEditDialog>()`；Flutter 侧此前 `DictRuleManageView` 顶栏仅有“多选/更多”，缺少同层级新建入口。
    - legado 新建动作为“打开空白编辑承载页”，不伴随写库副作用；Flutter 侧此前无法从字典规则管理页直接触发空白编辑态。
    - 该序号台账缺失，迁移证据链不完整。
  - `P5-seq215` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 替换净化 -> 字典规则 -> 右上角加号`）。
    - 状态：已同义（点击后仅打开空白编辑页；不自动保存、不触发导入链路）。
    - 异常：已同义（忙碌态禁用按钮，避免重复触发；无额外扩展提示）。
    - 文案：已同义（顶栏以加号图标承载 `menu_add` 一级动作语义）。
    - 排版：已同义（新增动作位于导航栏一级操作区，保持“新建为一级入口、导入在更多菜单”层级）。
    - 交互触发：已同义（非多选态点击加号直达编辑页；多选态隐藏新建入口）。
    - 验证：命令 `dart format lib/features/reader/views/dict_rule_manage_view.dart`；`flutter test test/simple_reader_view_compile_test.dart test/widget_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 替换净化 -> 字典规则 -> 右上角加号`（校验进入空白编辑页且无自动落库）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_add` 入口可达性与空白编辑态触发，不改动 `menu_save/menu_copy_rule`（`seq221/222`）后续序号能力。
  - 下一项：按优先级继续推进 `P5-seq221`（`dict_rule_edit.xml / @+id/menu_save / 保存`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq401`（`txt_toc_rule_sel.xml / @+id/menu_export_selection / 导出所选`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq401`（`txt_toc_rule_sel.xml / @+id/menu_export_selection / 导出所选`）：`TXT 目录规则` 管理页补齐 legado 同义“多选 -> 更多 -> 导出所选”闭环。页面新增多选承载（顶栏“多选/完成”切换、底部“全选/反选/更多”操作栏）；点击“导出所选”后按当前选中规则生成 JSON 并拉起系统保存，默认文件名收敛为 `exportTxtTocRule.json`；取消导出静默返回，成功后弹“导出成功”并提供“复制路径”动作。
  - `P5-seq401` 差异点清单（实施前）：
    - legado `TxtTocRuleActivity` 通过 `SelectActionBar.inflateMenu(txt_toc_rule_sel)` 承载 `menu_export_selection`；Flutter 侧此前 `TxtTocRuleManageView` 仅有导入链路，无多选承载层，入口不可达。
    - legado `menu_export_selection` 固定调用导出器并使用默认文件名 `exportTxtTocRule.json`；Flutter 侧此前无 TXT 目录规则“导出所选”动作与默认文件名约束。
    - legado 成功路径展示导出结果并支持复制，取消导出静默返回；Flutter 侧此前无对应状态流，迁移证据缺失。
  - `P5-seq401` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 目录规则 -> 多选 -> 勾选规则 -> 更多 -> 导出所选`）。
    - 状态：已同义（仅导出当前选中规则；默认文件名 `exportTxtTocRule.json`；取消导出静默返回）。
    - 异常：已同义（导出失败输出 `ExportTxtTocRuleSelectionError` 并弹“导出失败：<错误>”可观测提示）。
    - 文案：已同义（“多选/完成”“导出所选”“导出成功”“复制路径”）。
    - 排版：已同义（列表页新增多选底栏承载，保持顶栏“更多”层级与热区语义；选中项高亮并带勾选图标）。
    - 交互触发：已同义（多选态下通过顶栏或底栏“更多”均可进入批量菜单并触发导出）。
    - 验证：命令 `dart format lib/features/reader/views/txt_toc_rule_manage_view.dart`；命令 `timeout 120s dart analyze lib/features/reader/views/txt_toc_rule_manage_view.dart`（仅 info，无 error/warning）；手工路径（待回归）`设置 -> 目录规则 -> 多选 -> 勾选规则 -> 更多 -> 导出所选`（校验默认文件名、取消静默、成功可复制）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_export_selection` 多选导出闭环，不改动 `menu_enable_selection/menu_disable_selection`（`seq399/400`）后续序号能力。
  - 下一项：按优先级继续推进 `P5-seq215`（`dict_rule.xml / @+id/menu_add / 新建`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq395`（`txt_toc_rule_edit.xml / @+id/menu_paste_rule / 粘贴规则`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq395`（`txt_toc_rule_edit.xml / @+id/menu_paste_rule / 粘贴规则`）：新增 `TxtTocRuleEditView`，补齐 legado 同义“更多 -> 粘贴规则”动作。进入 `TXT 目录规则` 编辑页后，点击“粘贴规则”会读取剪贴板并按 `TxtTocRule` JSON 对象解析；解析成功仅回填 `名称/正则/示例` 三个输入框，保持停留当前编辑页，不自动保存、不跳转页面。并将管理页规则卡片点击动作接入编辑页，确保该入口真实可触发。
  - `P5-seq395` 差异点清单（实施前）：
    - legado `txt_toc_rule_edit.xml` 在编辑页菜单固定提供 `menu_paste_rule`；Flutter 侧此前无 TXT 目录规则编辑页，入口不可达。
    - legado `TxtTocRuleEditDialog.menu_paste_rule` 调用 `pasteRule`：剪贴板为空提示“剪贴板为空”，JSON 非对象提示“格式不对”；成功仅 `upRuleView` 回填表单，不触发保存与跳转。
    - Flutter 侧此前 `TxtTocRuleManageView` 仅提供导入链路，无规则编辑承载页，导致 `menu_paste_rule` 状态机缺失。
  - `P5-seq395` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 目录规则 -> 点击任一规则 -> 右上角更多 -> 粘贴规则`）。
    - 状态：已同义（粘贴成功仅回填 `名称/正则/示例`，不自动保存、不跳转）。
    - 异常：已同义（剪贴板为空提示“剪贴板为空”；非法 JSON 或非对象 JSON 提示“格式不对”）。
    - 文案：已同义（菜单文案“粘贴规则”；失败口径“剪贴板为空/格式不对”）。
    - 排版：已同义（编辑页采用单页表单 + 顶栏“更多”动作层，未改变管理页导入入口层级）。
    - 交互触发：已同义（粘贴后停留编辑页，字段即时更新，后续保存动作仍由后续序号承接）。
    - 验证：命令 `dart format lib/features/reader/views/txt_toc_rule_edit_view.dart lib/features/reader/views/txt_toc_rule_manage_view.dart`；`flutter test test/source_list_view_compile_test.dart test/search_view_compile_test.dart` 通过；手工路径（待回归）`设置 -> 目录规则 -> 点击任一规则 -> 右上角更多 -> 粘贴规则`（校验空剪贴板/非法 JSON/合法 JSON 三类边界）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_paste_rule` 编辑态回填链路，不改动导入解析、规则存储结构与阅读主链路。
  - 下一项：按优先级继续推进 `P5-seq401`（`txt_toc_rule_sel.xml / @+id/menu_export_selection / 导出所选`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq391`（`txt_toc_rule.xml / @+id/menu_import_default / 导入默认规则`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq391`（`txt_toc_rule.xml / @+id/menu_import_default / 导入默认规则`）：`TXT 目录规则` 管理页“更多”菜单补齐 legado 同义“导入默认规则”入口。点击后直接导入默认规则资产（`assets/source/txtTocRule.json`）并刷新列表；导入语义对齐 legado `DefaultData.importDefaultTocRules -> txtTocRuleDao.deleteDefault + insert`：先清理 `id<0` 默认规则再回灌默认规则，保留 `id>=0` 本地自定义规则，不追加成功提示。
  - `P5-seq391` 差异点清单（实施前）：
    - legado `TxtTocRuleActivity/TxtTocRuleDialog.menu_import_default` 固定走 `viewModel.importDefault()`；Flutter 侧此前“TXT 目录规则”更多菜单缺少“导入默认规则”入口，动作不可达。
    - legado `DefaultData.importDefaultTocRules` 写库语义为 `deleteDefault(id<0) + insert(default)`；Flutter 侧此前仅覆盖本地/网络/二维码候选导入，缺少默认规则重置分支。
    - legado 该动作为静默导入（无成功提示）；Flutter 侧此前无对应状态流，存在行为缺口。
  - `P5-seq391` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 目录规则 -> 右上角更多 -> 导入默认规则`）。
    - 状态：已同义（点击后直接导入默认规则并刷新列表；重复导入仅重置默认规则，保留自定义规则）。
    - 异常：已同义（默认资产读取/解析异常写入调试日志，可观测；不追加扩展成功提示）。
    - 文案：已同义（菜单文案固定“导入默认规则”）。
    - 排版：已同义（入口位于顶栏“更多”动作层，不改变列表层级与热区）。
    - 交互触发：已同义（`设置 -> 目录规则 -> 右上角更多 -> 导入默认规则`，执行后停留当前页并刷新列表）。
    - 验证：命令 `dart format lib/features/reader/services/txt_toc_rule_store.dart lib/features/reader/views/txt_toc_rule_manage_view.dart`；手工路径（待回归）`设置 -> 目录规则 -> 右上角更多 -> 导入默认规则`（校验静默刷新）；手工路径 `连续两次导入默认规则`（校验仅重置默认规则且保留自定义规则）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_import_default` 入口与默认导入写库语义，不改动 `menu_add/menu_help` 等后续序号能力。
  - 下一项：按优先级继续推进 `P5-seq395`（`txt_toc_rule_edit.xml / @+id/menu_paste_rule / 粘贴规则`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq390`（`txt_toc_rule.xml / @+id/menu_import_qr / 二维码导入`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq390`（`txt_toc_rule.xml / @+id/menu_import_qr / 二维码导入`）：`TXT 目录规则` 管理页“更多”菜单补齐 legado 同义“二维码导入”入口。点击后拉起扫码页，扫码文本直接复用既有“导入 TXT 目录规则”候选弹层；候选按本地 `id` 对比标记“新增/更新/已有”，默认勾选“新增+更新”，确认后仅导入勾选项。扫码取消或空结果保持静默返回，不写 `tocRuleUrl` 历史。
  - `P5-seq390` 差异点清单（实施前）：
    - legado `TxtTocRuleActivity/TxtTocRuleDialog.menu_import_qr` 固定走 `qrCodeResult.launch()`，回调结果直接进入 `ImportTxtTocRuleDialog(it)`；Flutter 侧此前仅有“本地导入/网络导入”，二维码入口不可达。
    - legado 二维码分支与本地/网络导入共用同一候选状态机（新增/更新/已有，默认新增+更新）；Flutter 侧此前扫码链路未接入候选导入闭环。
    - legado 二维码分支不维护 `tocRuleUrl` 历史；Flutter 侧若复用网络导入历史写入逻辑会产生跨入口状态污染。
  - `P5-seq390` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 目录规则 -> 右上角更多 -> 二维码导入`）。
    - 状态：已同义（扫码成功后直接进入候选弹层；候选按“新增/更新/已有”标记并默认勾选新增+更新；确认后仅导入勾选项）。
    - 异常：已同义（扫码取消或空结果静默返回；解析失败提示 `ImportError:*`；读取失败提示 `readTextError:*`）。
    - 文案：已同义（入口文案“二维码导入”；扫码标题“二维码导入”；候选状态文案“新增/更新/已有”）。
    - 排版：已同义（二维码入口位于顶栏“更多”动作层；扫码返回后沿用既有候选弹层单层勾选布局）。
    - 交互触发：已同义（`设置 -> 目录规则 -> 二维码导入 -> 扫码 -> 勾选候选 -> 导入`）。
    - 验证：命令 `dart format lib/features/reader/views/txt_toc_rule_manage_view.dart`；手工路径（待回归）`设置 -> 目录规则 -> 右上角更多 -> 二维码导入 -> 扫码 -> 勾选候选 -> 导入`（校验扫码结果直达候选弹层、默认勾选新增+更新且仅导入勾选项）；手工路径 `二维码导入进入扫码页后取消`（校验静默返回且不落库）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_import_qr` 扫码触发链路，不改动 `menu_import_default`（`seq391`）后续序号能力。
  - 下一项：按优先级继续推进 `P5-seq391`（`txt_toc_rule.xml / @+id/menu_import_default / 导入默认规则`）。
- `2026-02-23`
  - 状态变更：完成 `P5-seq389`（`txt_toc_rule.xml / @+id/menu_import_onLine / 网络导入`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq389`（`txt_toc_rule.xml / @+id/menu_import_onLine / 网络导入`）：`TXT 目录规则` 管理页“更多”菜单补齐 legado 同义“网络导入”入口。点击后先进入 URL 输入层（标题“网络导入”、占位 `url`），支持历史记录点选回填与删除，并默认注入 legado 默认地址 `https://gitee.com/fisher52/YueDuJson/raw/master/myTxtChapterRule.json`；确认后进入“导入 TXT 目录规则”候选弹层，候选按本地 `id` 对比标记“新增/更新/已有”，默认勾选“新增+更新”，确认后仅导入勾选项。
  - `P5-seq389` 差异点清单（实施前）：
    - legado `TxtTocRuleActivity/TxtTocRuleDialog.menu_import_onLine` 固定走 `showImportDialog`：先弹 URL 输入层并维护 `tocRuleUrl` 历史；Flutter 侧此前仅有“本地导入”，网络入口不可达。
    - legado 输入层打开时会注入默认 URL（`myTxtChapterRule.json`）并提供历史项删除；Flutter 侧此前缺少该历史状态流。
    - legado 确认后统一进入 `ImportTxtTocRuleDialog` 候选导入链路；Flutter 侧此前缺少“网络输入 -> 候选预览 -> 勾选导入”的完整闭环。
  - `P5-seq389` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 目录规则 -> 右上角更多 -> 网络导入`）。
    - 状态：已同义（输入后进入候选弹层；候选按“新增/更新/已有”标记；默认勾选新增+更新；确认后仅导入勾选项）。
    - 异常：已同义（空输入静默返回；解析/网络异常提示 `ImportError:*`；历史删除即时回写）。
    - 文案：已同义（“网络导入”“url”“历史记录”“导入 TXT 目录规则”“新增/更新/已有”）。
    - 排版：已同义（输入层采用“输入区 + 历史记录区”单层结构；候选弹层沿用本地导入同层勾选布局）。
    - 交互触发：已同义（`设置 -> 目录规则 -> 网络导入 -> 输入 URL/点选历史 -> 导入 -> 勾选候选 -> 导入`）。
    - 验证：命令 `dart format lib/features/reader/views/txt_toc_rule_manage_view.dart`；手工路径（待回归）`设置 -> 目录规则 -> 右上角更多 -> 网络导入 -> 输入 URL 或点选历史 -> 导入 -> 勾选候选 -> 导入`（校验默认历史注入、历史回填/删除与候选默认勾选“新增+更新”）；按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_import_onLine` 输入层与历史状态机，不改动书源解析结构与阅读主链路。
  - 下一项：按优先级继续推进 `P5-seq390`（`txt_toc_rule.xml / @+id/menu_import_qr / 二维码导入`）。
- `2026-02-22`
  - 状态变更：完成 `P5-seq388`（`txt_toc_rule.xml / @+id/menu_import_local / 本地导入`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq388`（`txt_toc_rule.xml / @+id/menu_import_local / 本地导入`）：新增 `TXT 目录规则` 管理页并补齐 legado 同义“右上角更多 -> 本地导入”入口；本地选档后进入“导入 TXT 目录规则”候选弹层，候选按本地 `id` 对比标记“新增/更新/已有”，默认勾选“新增+更新”，确认后仅导入勾选项。新增 `TxtTocRuleStore` 与默认资产 `assets/source/txtTocRule.json`；阅读页与详情页 `TXT 目录规则` 选择器改为读取该规则仓库，确保导入后立即可用于目录重建链路。
  - `P5-seq388` 差异点清单（实施前）：
    - legado `TxtTocRuleActivity.menu_import_local` 固定执行 `HandleFileContract(FILE, txt/json) -> ImportTxtTocRuleDialog`；Flutter 侧此前无 `TXT 目录规则` 管理页，入口不可达。
    - legado 导入候选按本地 `id` 对比状态（新增/更新/已有）并默认勾选“新增+更新”；Flutter 侧此前缺少 TXT 目录规则候选状态机。
    - legado 读档失败与解析失败口径分别为 `readTextError:*` 与 `ImportError:*`；Flutter 侧此前无该可观测分支。
  - `P5-seq388` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 目录规则 -> 右上角更多 -> 本地导入`）。
    - 状态：已同义（选档后进入候选弹层；候选按“新增/更新/已有”标记；默认仅勾选新增与更新；确认后仅导入勾选项）。
    - 异常：已同义（取消选档静默返回；读档失败提示 `readTextError:*`；解析失败提示 `ImportError:*`）。
    - 文案：已同义（页面标题“TXT 目录规则”；入口“本地导入”；候选弹层标题“导入 TXT 目录规则”；状态文案“新增/更新/已有”）。
    - 排版：已同义（入口位于顶栏“更多”动作层；候选为单层勾选清单并展示状态标签）。
    - 交互触发：已同义（`设置 -> 目录规则 -> 本地导入 -> 选择 txt/json -> 勾选候选 -> 导入`）。
    - 验证：命令 `dart format lib/features/reader/models/txt_toc_rule.dart lib/features/reader/services/txt_toc_rule_store.dart lib/features/reader/views/txt_toc_rule_manage_view.dart lib/features/settings/views/source_management_view.dart lib/features/settings/views/settings_view.dart lib/features/reader/views/simple_reader_view.dart lib/features/search/views/search_book_info_view.dart`；`flutter test test/simple_reader_view_compile_test.dart test/search_book_info_view_compile_test.dart` 通过；`flutter test test/source_list_view_compile_test.dart test/search_view_compile_test.dart` 通过；手工路径（待回归）`设置 -> 目录规则 -> 本地导入 -> 选择 txt/json`（校验候选状态与默认勾选）；手工路径 `导入后进入阅读页/目录页 -> TXT 目录规则`（校验导入规则可见并可用于重建目录）。按仓库约束，未在开发阶段执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号新增 `txt_toc_rules` 持久化仓库并补齐 `menu_import_local`，不改动书源解析结构；阅读与详情页 `TXT 目录规则` 选择器由内置常量切换为“仓库规则优先 + 无规则回退默认规则”。
  - 下一项：按优先级继续推进 `P5-seq389`（`txt_toc_rule.xml / @+id/menu_import_onLine / 网络导入`）。
- `2026-02-22`
  - 状态变更：完成 `P5-seq299`（`replace_rule_sel.xml / @+id/menu_export_selection / 导出所选`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq299`（`replace_rule_sel.xml / @+id/menu_export_selection / 导出所选`）：替换规则管理页补齐 legado 同义“多选 -> 更多 -> 导出所选”链路。页面新增多选态承载（顶栏“多选/完成”、底部“全选/反选/更多”操作栏）；点击“导出所选”后按当前选中规则生成 JSON 并拉起系统保存，默认文件名收敛为 `exportReplaceRule.json`；取消导出静默返回，导出成功弹“导出成功”并提供“复制路径”动作。
  - `P5-seq299` 差异点清单（实施前）：
    - legado `ReplaceRuleActivity` 通过 `SelectActionBar.inflateMenu(replace_rule_sel)` 承载 `menu_export_selection`；Flutter 侧此前“文本替换规则”仅有列表态，缺少多选态与批量菜单，入口不可达。
    - legado 导出内容固定为 `adapter.selection` 的 JSON 数组且默认文件名为 `exportReplaceRule.json`；Flutter 侧此前仅支持“导出全部并复制到剪贴板”，缺少“仅导出选中集合”的文件导出链路。
    - legado 取消导出无提示、成功后弹“导出成功”并可复制路径；Flutter 侧此前无该状态闭环。
  - `P5-seq299` 逐项对照清单（实施后）：
    - 入口：已同义（`替换净化 -> 文本替换规则 -> 多选 -> 勾选规则 -> 更多 -> 导出所选`）。
    - 状态：已同义（导出动作仅序列化当前选中规则；默认文件名 `exportReplaceRule.json`）。
    - 异常：已同义（取消导出静默返回；导出写入失败提示“导出失败：<原因>”并保留当前页面状态）。
    - 文案：已同义（“多选”“完成”“导出所选”“导出成功”“复制路径”）。
    - 排版：已同义（多选态底部动作栏提供“全选/反选/更多”，列表项展示选中态图标，导出入口保持“多选后进入更多菜单”的层级）。
    - 交互触发：已同义（进入多选态后可批量勾选规则并触发导出所选）。
    - 验证：命令 `dart format lib/features/replace/views/replace_rule_list_view.dart`；`flutter test test/search_view_compile_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 多选 -> 勾选规则 -> 更多 -> 导出所选`（校验默认文件名 `exportReplaceRule.json`）；手工路径 `导出文件选择器中取消`（校验静默返回）；手工路径 `导出成功后点击复制路径`（校验剪贴板写入导出路径）。按仓库约束，开发阶段未执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_export_selection` 多选导出闭环，不改动 `menu_enable_selection/menu_disable_selection/menu_top_sel/menu_bottom_sel`（`seq295~298`）后续序号能力。
  - 下一项：按优先级继续推进 `P5-seq388`（`txt_toc_rule.xml / @+id/menu_import_local / 本地导入`）。
- `2026-02-22`
  - 状态变更：完成 `P5-seq290`（`replace_rule.xml / @+id/menu_import_qr / 二维码导入`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq290`（`replace_rule.xml / @+id/menu_import_qr / 二维码导入`）：替换规则列表页“更多”菜单补齐 legado 同义“二维码导入”入口。点击后拉起扫码页，扫码结果直接复用“导入替换规则”候选弹层；候选项按本地 `id` 对比标记“新增/更新/已有”，默认仅勾选“新增”；确认后仅导入勾选项并静默返回，不追加成功提示。扫码取消或空结果静默返回，且不写入 `replaceRuleRecordKey` 网络导入历史。
  - `P5-seq290` 差异点清单（实施前）：
    - legado `ReplaceRuleActivity.menu_import_qr` 固定走 `qrCodeResult.launch()`，回调结果直接进入 `ImportReplaceRuleDialog(it)`；Flutter 侧此前“文本替换规则”更多菜单缺少“二维码导入”入口，扫码触发路径不可达。
    - legado 二维码分支与本地/网络导入共用同一候选状态机（新增/更新/已有，默认仅新增）；Flutter 侧此前仅覆盖本地/网络导入触发，扫码入口未接入候选导入链路。
    - legado 扫码分支不维护 `replaceRuleRecordKey`；Flutter 侧若复用网络导入历史写入逻辑会产生跨入口状态污染。
  - `P5-seq290` 逐项对照清单（实施后）：
    - 入口：已同义（`替换净化 -> 文本替换规则 -> 右上角更多 -> 二维码导入`）。
    - 状态：已同义（扫码成功后直接进入候选弹层；候选按“新增/更新/已有”标记并默认仅勾选新增；确认后仅导入勾选项）。
    - 异常：已同义（扫码取消或空结果静默返回；解析失败提示 `ImportError:*`；读取失败提示 `readTextError:*`）。
    - 文案：已同义（入口文案“二维码导入”；扫码标题“二维码导入”；候选状态文案“新增/更新/已有”）。
    - 排版：已同义（二维码入口位于顶栏“更多”动作层；扫码返回后沿用既有候选弹层单层勾选布局）。
    - 交互触发：已同义（`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 右上角更多 -> 二维码导入 -> 扫码 -> 勾选候选 -> 导入`）。
    - 验证：命令 `dart format lib/features/replace/views/replace_rule_list_view.dart`；`flutter test test/widget_test.dart`、`flutter test test/search_view_compile_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 右上角更多 -> 二维码导入 -> 扫码`（校验扫码结果可进入候选弹层且默认仅勾选新增）；手工路径 `二维码导入进入扫码页后取消`（校验静默返回且不落库）。按仓库约束，未在开发阶段执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_import_qr` 扫码触发链路，不改动 `menu_group/menu_group_manage` 后续序号能力。
  - 下一项：按优先级继续推进 `P5-seq299`（`replace_rule_sel.xml / @+id/menu_export_selection / 导出所选`）。
- `2026-02-22`
  - 状态变更：完成 `P5-seq289`（`replace_rule.xml / @+id/menu_import_onLine / 网络导入`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq289`（`replace_rule.xml / @+id/menu_import_onLine / 网络导入`）：替换规则列表页“更多”菜单将入口文案收敛为“网络导入”；点击后先弹 URL 输入层（标题“网络导入”、输入占位 `url`）并维护 `replaceRuleRecordKey` 历史（支持点选回填、删除回写）。确认后按输入内容进入“导入替换规则”候选弹层，候选项按 legado 同义规则标记“新增/更新/已有”，默认仅勾选“新增”；确认后仅导入勾选项并静默返回，不追加成功提示。
  - `P5-seq289` 差异点清单（实施前）：
    - legado `ReplaceRuleActivity.menu_import_onLine` 固定执行 `showImportDialog`：先弹 `import_on_line` 输入层（hint=`url`）并读写 `replaceRuleRecordKey` 历史，再进入 `ImportReplaceRuleDialog` 候选导入；Flutter 侧此前为“输入 URL 后直接写库”，缺少历史层与候选层。
    - legado 网络导入与本地导入共用同一候选状态机（新增/更新/已有，默认仅新增）；Flutter 侧此前网络导入分支未复用候选勾选流程，状态语义不一致。
    - legado 网络导入失败口径为 `ImportError:*`；Flutter 侧此前提示“导入失败/URL为空”，可观测输出与边界提示不一致。
  - `P5-seq289` 逐项对照清单（实施后）：
    - 入口：已同义（`替换净化 -> 文本替换规则 -> 右上角更多 -> 网络导入`）。
    - 状态：已同义（网络导入改为“输入层 -> 候选预览 -> 勾选导入”，不再解析成功即直接写库）。
    - 异常：已同义（空输入静默返回；解析失败提示 `ImportError:*`；网络异常按 `ImportError:*` 输出并保留静默取消边界）。
    - 文案：已同义（入口文案“网络导入”；输入层标题“网络导入”；输入占位 `url`；候选状态文案“新增/更新/已有”）。
    - 排版：已同义（输入层采用“输入区 + 历史记录区”单层结构；候选弹层沿用本地导入同层勾选布局）。
    - 交互触发：已同义（`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 右上角更多 -> 网络导入`；历史支持点选回填与删除回写）。
    - 验证：命令 `dart format lib/features/replace/views/replace_rule_list_view.dart`；`flutter test test/widget_test.dart`、`flutter test test/search_view_compile_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 右上角更多 -> 网络导入 -> 输入 URL/点选历史 -> 导入 -> 勾选候选 -> 导入`（校验默认仅勾选新增、HTTP/HTTPS 输入写入 `replaceRuleRecordKey` 历史且支持删除回写、导入成功静默返回）。按仓库约束，未在开发阶段执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_import_onLine` 的输入层、历史记录与候选导入链路，不改动 `menu_import_qr/menu_group` 后续序号能力。
  - 下一项：按优先级继续推进 `P5-seq290`（`replace_rule.xml / @+id/menu_import_qr / 二维码导入`）。
- `2026-02-22`
  - 状态变更：完成 `P5-seq288`（`replace_rule.xml / @+id/menu_import_local / 本地导入`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq288`（`replace_rule.xml / @+id/menu_import_local / 本地导入`）：替换规则列表页“更多”菜单将入口文案收敛为“本地导入”；点击后仅允许选择 `txt/json` 文件，读取文本后进入“导入替换规则”候选弹层。候选项按 legado 同义规则标记“新增/更新/已有”，默认仅勾选“新增”；确认后仅导入勾选项并静默返回，不追加成功提示。
  - `P5-seq288` 差异点清单（实施前）：
    - legado `ReplaceRuleActivity.menu_import_local` 固定执行 `HandleFileContract(FILE, txt/json) -> ImportReplaceRuleDialog`；Flutter 侧此前入口文案为“从文件导入”，且解析成功后直接写库，缺少候选预览层。
    - legado 导入弹层按本地 `id` 对比候选状态（新增/更新/已有），默认仅选中新增；Flutter 侧此前无状态分层与默认勾选策略。
    - legado 本地导入失败口径为 `readTextError:*` / `ImportError:*`；Flutter 侧此前仅提示通用“导入失败”，可观测输出不一致。
  - `P5-seq288` 逐项对照清单（实施后）：
    - 入口：已同义（`替换净化 -> 文本替换规则 -> 右上角更多 -> 本地导入`）。
    - 状态：已同义（本地导入改为“选档 -> 候选预览 -> 勾选导入”，不再直接写库）。
    - 异常：已同义（读取失败提示 `readTextError:*`；解析失败提示 `ImportError:*`；取消选档或取消导入静默返回）。
    - 文案：已同义（入口文案“本地导入”；候选状态文案“新增/更新/已有”；弹层标题“导入替换规则”）。
    - 排版：已同义（候选弹层为单层勾选列表，顶部“取消/导入(N)”与“全选/取消全选”入口层级符合 legado 语义）。
    - 交互触发：已同义（`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 右上角更多 -> 本地导入`）。
    - 验证：命令 `dart format lib/features/replace/views/replace_rule_list_view.dart`；`flutter test test/widget_test.dart`、`flutter test test/search_view_compile_test.dart` 通过；手工路径（待回归）`设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 右上角更多 -> 本地导入 -> 选择 txt/json -> 勾选候选 -> 导入`（校验默认仅勾选新增与导入静默返回）。按仓库约束，未在开发阶段执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_import_local` 的候选导入闭环，不改动 `menu_import_onLine/menu_import_qr/menu_group` 后续序号能力。
  - 下一项：按优先级继续推进 `P5-seq289`（`replace_rule.xml / @+id/menu_import_onLine / 网络导入`）。
- `2026-02-22`
  - 状态变更：完成 `P5-seq283`（`replace_edit.xml / @+id/menu_paste_rule / 粘贴规则`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq283`（`replace_edit.xml / @+id/menu_paste_rule / 粘贴规则`）：替换规则编辑页补齐 legado 同义“粘贴规则”入口。编辑页右上角新增“更多”动作，点击“粘贴规则”后读取剪贴板文本并按 `ReplaceRule` JSON 对象解析；成功仅回填当前表单字段并停留编辑页，不自动保存、不跳转；失败分支按 legado 固定口径提示“剪贴板为空”或“格式不对”。
  - `P5-seq283` 差异点清单（实施前）：
    - legado `replace_edit.xml` 在编辑页菜单提供 `menu_paste_rule`，触发 `ReplaceEditViewModel.pasteRule` 后仅执行 `upReplaceView` 回填，不自动保存。
    - Flutter 侧此前 `ReplaceRuleEditView` 仅有“保存”一级动作，无编辑页“更多 -> 粘贴规则”入口；剪贴板入口仅存在于列表页“从剪贴板导入”，会直接写库，触发层级与状态语义不一致。
    - legado 粘贴失败分支固定为“剪贴板为空/格式不对”；Flutter 侧此前在替换规则编辑链路缺少同义错误口径与状态收敛。
  - `P5-seq283` 逐项对照清单（实施后）：
    - 入口：已同义（`替换净化 -> 文本替换规则 -> 编辑任一规则 -> 右上角更多 -> 粘贴规则`）。
    - 状态：已同义（粘贴成功仅回填当前编辑表单；不自动保存、不跳转页面）。
    - 异常：已同义（空剪贴板提示“剪贴板为空”；非法 JSON 或非对象 JSON 提示“格式不对”）。
    - 文案：已同义（入口文案“粘贴规则”；错误口径与 legado 同义）。
    - 排版：已同义（编辑页顶栏收敛为“保存 + 更多”双动作，粘贴入口位于“更多”动作层，未改变表单主体层级）。
    - 交互触发：已同义（粘贴后停留当前编辑页并即时回填字段，仍需用户手动保存）。
    - 验证：命令 `dart format lib/features/replace/views/replace_rule_edit_view.dart`；手工路径 `设置 -> 源管理 -> 替换净化 -> 文本替换规则 -> 编辑任一规则 -> 右上角更多 -> 粘贴规则`（校验空剪贴板与非法 JSON 错误口径、合法 JSON 仅回填不保存）。按仓库约束，未在开发阶段执行 `flutter analyze`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_paste_rule` 编辑页入口与回填边界，不改动 `menu_copy_rule/menu_save` 等其它序号能力。
  - 下一项：按优先级继续推进 `P5-seq288`（`replace_rule.xml / @+id/menu_import_local / 本地导入`）。
- `2026-02-22`
  - 状态变更：完成 `P5-seq226`（`dict_rule_sel.xml / @+id/menu_export_selection / 导出所选`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq226`（`dict_rule_sel.xml / @+id/menu_export_selection / 导出所选`）：字典规则管理页补齐 legado 同义“多选 -> 更多 -> 导出所选”链路。页面新增多选状态栏与批量“更多”菜单，点击“导出所选”后按当前选中规则生成 JSON 并拉起系统保存；默认文件名收敛为 `exportDictRule.json`，导出成功弹“导出成功”并提供“复制路径”，取消导出保持静默返回。
  - `P5-seq226` 差异点清单（实施前）：
    - legado `DictRuleActivity` 通过 `SelectActionBar + dict_rule_sel.xml` 提供 `menu_export_selection`，点击后固定走 `HandleFileContract.EXPORT` 且默认文件名 `exportDictRule.json`；Flutter 侧此前无字典规则多选态与对应菜单入口。
    - legado 导出内容为 `adapter.selection` 的 JSON 数组；Flutter 侧此前仅支持导入和单项编辑，缺少“按选中集合导出”的状态承载。
    - legado 取消导出无提示、成功后弹路径并可复制；Flutter 侧此前无该导出边界实现。
  - `P5-seq226` 逐项对照清单（实施后）：
    - 入口：已同义（`设置 -> 源管理 -> 替换净化 -> 字典规则 -> 多选 -> 更多 -> 导出所选`）。
    - 状态：已同义（多选状态维护选中集合；导出动作仅序列化当前选中规则，默认文件名 `exportDictRule.json`）。
    - 异常：已同义（取消保存静默返回；导出写入异常弹“导出失败：<原因>”并保留当前页面状态）。
    - 文案：已同义（“多选”“导出所选”“导出成功”“复制路径”）。
    - 排版：已同义（多选态底部动作栏提供“全选/反选/更多”，列表项展示选中态图标，入口层级保持“多选后再进入更多菜单”）。
    - 交互触发：已同义（进入多选后可批量选择规则，更多菜单在有选中项时可触发导出）。
    - 验证：命令 `dart format lib/features/reader/views/dict_rule_manage_view.dart`；手工路径 `设置 -> 源管理 -> 替换净化 -> 字典规则 -> 多选 -> 勾选若干规则 -> 更多 -> 导出所选`（校验默认文件名 `exportDictRule.json`）；手工路径 `导出文件选择器中取消`（校验静默返回）；手工路径 `导出成功后点击复制路径`（校验剪贴板写入导出地址）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_export_selection` 多选导出闭环，不改动 `menu_enable_selection/menu_disable_selection`（`seq224/225`）后续序号能力。
  - 下一项：按优先级继续推进 `P5-seq283`（`replace_edit.xml / @+id/menu_paste_rule / 粘贴规则`）。
- `2026-02-22`
  - 状态变更：完成 `P5-seq223`（`dict_rule_edit.xml / @+id/menu_paste_rule / 粘贴规则`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq223`（`dict_rule_edit.xml / @+id/menu_paste_rule / 粘贴规则`）：字典规则编辑承载页补齐 legado 同义“粘贴规则”入口。点击“更多 -> 粘贴规则”后读取剪贴板文本并按 `DictRule` JSON 对象解析；成功仅回填 `name/urlRule/showRule` 到编辑表单，不触发保存与跳转；失败分支按 legado 固定口径提示“格式不对”，空剪贴板提示“剪贴板没有内容”。
  - `P5-seq223` 差异点清单（实施前）：
    - legado `DictRuleEditDialog.menu_paste_rule` 固定走 `pasteRule { upRuleView(it) }`，粘贴成功只更新表单，不保存。
    - Flutter 侧此前“字典规则”仅有导入列表能力，无编辑承载层，`menu_paste_rule` 触发路径不可达。
    - legacy 解析口径为单个 `DictRule` JSON 对象，失败文案固定“格式不对”；Flutter 侧此前无该边界实现。
  - `P5-seq223` 逐项对照清单（实施后）：
    - 入口：已同义（`替换净化 -> 字典规则 -> 点击任一规则 -> 右上角更多 -> 粘贴规则`）。
    - 状态：已同义（粘贴成功仅回填表单字段，不自动保存、不跳转）。
    - 异常：已同义（空剪贴板提示“剪贴板没有内容”；非对象 JSON 或非法文本提示“格式不对”）。
    - 文案：已同义（入口文案“粘贴规则”；错误口径同 legado）。
    - 排版：已同义（编辑页为单层表单结构，粘贴入口位于顶栏“更多”动作层）。
    - 交互触发：已同义（粘贴后停留当前编辑页并即时回填）。
    - 验证：`flutter test test/simple_reader_view_compile_test.dart` 通过；命令 `dart format lib/features/reader/views/dict_rule_edit_view.dart lib/features/reader/views/dict_rule_manage_view.dart`；手工路径 `设置 -> 源管理 -> 替换净化 -> 字典规则 -> 点击任一规则 -> 右上角更多 -> 粘贴规则`（校验空剪贴板/非法 JSON 错误口径与合法 JSON 回填边界）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_paste_rule` 回填链路，不改动 `menu_save/menu_copy_rule` 与批量导出链路。
  - 下一项：按优先级继续推进 `P5-seq226`（`dict_rule_sel.xml / @+id/menu_export_selection / 导出所选`）。
- `2026-02-22`
  - 状态变更：完成 `P5-seq219`（`dict_rule.xml / @+id/menu_import_default / 导入默认规则`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq219`（`dict_rule.xml / @+id/menu_import_default / 导入默认规则`）：字典规则承载页“更多”菜单补齐 legado 同义“导入默认规则”入口。点击后直接导入默认字典规则资产（`assets/source/dictRules.json`），导入语义收敛为“按规则名覆盖（REPLACE）+ 保留非同名本地规则”；导入完成后刷新列表，不追加成功提示。
  - `P5-seq219` 差异点清单（实施前）：
    - legado `DictRuleActivity.menu_import_default` 固定执行 `viewModel.importDefault()`；Flutter 侧此前“字典规则”更多菜单缺少该入口。
    - legado `DefaultData.importDefaultDictRules -> DictRuleDao.insert(onConflict = REPLACE)` 语义是按 `name` 覆盖默认规则，且不清空非默认规则；Flutter 侧此前没有同义写库能力。
    - legado 默认导入入口为静默动作（无成功提示）；Flutter 侧此前无该状态流。
  - `P5-seq219` 逐项对照清单（实施后）：
    - 入口：已同义（`替换净化 -> 字典规则 -> 更多 -> 导入默认规则`）。
    - 状态：已同义（点击后直接导入默认规则并刷新列表；重复导入仅覆盖同名默认规则）。
    - 异常：已同义（默认资产读取/解析异常写入调试日志，不新增扩展提示分支）。
    - 文案：已同义（菜单文案“导入默认规则”）。
    - 排版：已同义（入口位于顶栏“更多”动作层，列表区布局不变）。
    - 交互触发：已同义（`设置 -> 源管理 -> 替换净化 -> 字典规则 -> 右上角更多 -> 导入默认规则`）。
    - 验证：`flutter test test/simple_reader_view_compile_test.dart`、`flutter test test/widget_test.dart` 通过；手工路径 `设置 -> 源管理 -> 替换净化 -> 字典规则 -> 右上角更多 -> 导入默认规则`（校验默认规则按名称覆盖导入并刷新列表）；手工路径 `连续两次导入默认规则`（校验非同名自定义规则不被清理）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_import_default` 入口与默认导入语义，不改动 `menu_add/menu_help` 等后续序号能力。
  - 下一项：按优先级继续推进 `P5-seq223`（`dict_rule_edit.xml / @+id/menu_paste_rule / 粘贴规则`）。
- `2026-02-22`
  - 状态变更：完成 `P5-seq218`（`dict_rule.xml / @+id/menu_import_qr / 二维码导入`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq218`（`dict_rule.xml / @+id/menu_import_qr / 二维码导入`）：字典规则承载页“更多”菜单补齐 legado 同义“二维码导入”入口。点击后拉起扫码页，扫码得到文本后直接进入“导入字典规则”候选弹层；候选项按同名规则标记“新增/已有”，默认仅勾选“新增”；确认导入后按名称覆盖写入并刷新列表。扫码取消或空结果保持静默返回，不写入 `dictRuleUrls` 网络导入历史。
  - `P5-seq218` 差异点清单（实施前）：
    - legado `DictRuleActivity.menu_import_qr` 固定走 `qrCodeResult.launch()`，回调结果直接进入 `ImportDictRuleDialog(it)`；Flutter 侧此前仅有 `menu_import_local/menu_import_onLine`，缺少二维码导入触发层。
    - legado 二维码分支与本地/网络导入共用 `ImportDictRuleDialog` 状态机，候选展示与默认勾选策略一致；Flutter 侧此前二维码触发路径不可达，无法复刻该复用语义。
    - legado 的二维码分支不维护 `dictRuleUrls` 历史；Flutter 侧若复用网络导入链路会造成跨入口历史污染。
  - `P5-seq218` 逐项对照清单（实施后）：
    - 入口：已同义（`替换净化 -> 字典规则 -> 更多 -> 二维码导入`）。
    - 状态：已同义（扫码成功后直接进入候选弹层；候选按“新增/已有”标记并默认仅勾选新增；确认导入后刷新列表）。
    - 异常：已同义（扫码取消或空结果静默返回；格式异常提示 `ImportError:格式不对`；解析异常提示 `ImportError:<原因>`）。
    - 文案：已同义（“二维码导入”“导入字典规则”“新增”“已有”）。
    - 排版：已同义（入口位于顶栏“更多”动作层；扫码页返回后复用单层候选弹层）。
    - 交互触发：已同义（`设置 -> 源管理 -> 替换净化 -> 字典规则 -> 右上角更多 -> 二维码导入`）。
    - 验证：手工路径 `设置 -> 源管理 -> 替换净化 -> 字典规则 -> 右上角更多 -> 二维码导入 -> 扫码`（校验进入候选弹层且默认仅勾选新增）；手工路径 `二维码导入进入扫码页后取消`（校验静默返回且不落库）；手工路径 `二维码导入同名字典规则`（校验按名称覆盖写入并刷新列表）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_import_qr` 入口与扫码导入触发链路，不改动 `menu_add/menu_import_default` 后续序号能力。
  - 下一项：按优先级继续推进 `P5-seq219`（`dict_rule.xml / @+id/menu_import_default / 导入默认规则`）。
- `2026-02-22`
  - 状态变更：完成 `P5-seq217`（`dict_rule.xml / @+id/menu_import_onLine / 网络导入`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq217`（`dict_rule.xml / @+id/menu_import_onLine / 网络导入`）：字典规则承载页“更多”菜单补齐 legado 同义“网络导入”入口。点击“网络导入”后先弹 URL 输入层（标题“网络导入”、输入占位 `url`），确认后按输入文本执行导入预解析并进入“导入字典规则”候选弹层；候选项按同名规则标记“新增/已有”，默认仅勾选“新增”；确认导入后按名称覆盖写入并刷新列表。输入为 `http/https` 时同步写入历史键 `dictRuleUrls`，并支持历史点选回填与删除。
  - `P5-seq217` 差异点清单（实施前）：
    - legado `DictRuleActivity.menu_import_onLine` 固定走 `showImportDialog`：先弹 `import_on_line` 输入框（hint=`url`）并读写 `dictRuleUrls` 历史；Flutter 侧此前仅有 `menu_import_local`，缺少网络导入触发层。
    - legado 输入确认后统一进入 `ImportDictRuleDialog(text)`，由导入弹层负责 URL/JSON 解析与候选展示；Flutter 侧此前缺少在线输入到候选弹层的串联链路。
    - legado 历史支持“点选回填 + 删除即持久化”；Flutter 侧此前无在线导入历史状态。
  - `P5-seq217` 逐项对照清单（实施后）：
    - 入口：已同义（`替换净化 -> 字典规则 -> 更多 -> 网络导入`）。
    - 状态：已同义（输入后进入候选弹层；候选按“新增/已有”标记并默认仅勾选新增；确认导入后刷新列表）。
    - 异常：已同义（格式异常提示 `ImportError:格式不对`；网络/解析异常提示 `ImportError:<原因>`；取消输入或取消导入静默返回）。
    - 文案：已同义（“网络导入”“url”“历史记录”“导入字典规则”“新增”“已有”）。
    - 排版：已同义（入口位于顶栏“更多”；输入层与候选层保持单层弹出结构）。
    - 交互触发：已同义（`设置 -> 源管理 -> 替换净化 -> 字典规则 -> 右上角更多 -> 网络导入`）。
    - 验证：手工路径 `设置 -> 源管理 -> 替换净化 -> 字典规则 -> 右上角更多 -> 网络导入 -> 输入 URL`（校验进入候选弹层且默认仅勾选新增）；手工路径 `在网络导入输入层删除历史记录后重进`（校验删除结果持久化）；手工路径 `导入同名字典规则`（校验按名称覆盖写入并刷新列表）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_import_onLine` 的输入层、历史记录与候选导入链路，不改动 `menu_add/menu_import_qr/menu_import_default` 后续序号能力。
  - 下一项：按优先级继续推进 `P5-seq218`（`dict_rule.xml / @+id/menu_import_qr / 二维码导入`）。
- `2026-02-22`
  - 状态变更：完成 `P5-seq216`（`dict_rule.xml / @+id/menu_import_local / 本地导入`）后，ExecPlan 保持 `active`。
  - 完成 `P5-seq216`（`dict_rule.xml / @+id/menu_import_local / 本地导入`）：规则与净化域新增“配置字典规则”承载页，并在“替换净化 -> 规则列表”补齐“字典规则”入口；承载页“更多”菜单补齐 legado 同义“本地导入”动作。点击“本地导入”后仅允许选择 `txt/json` 文件；读取文本后进入导入候选弹层，候选项按“同名字典规则是否已存在”标记“新增/已有”，默认仅勾选“新增”项；确认导入后按名称覆盖写入规则存储并回到列表页刷新展示。
  - `P5-seq216` 差异点清单（实施前）：
    - legado `DictRuleActivity.onCompatOptionsItemSelected(menu_import_local)` 固定走 `HandleFileContract(FILE, txt/json) -> ImportDictRuleDialog`；Flutter 侧此前无“字典规则管理页”，且“替换净化”页缺少“字典规则”入口，无法触发同层导入动作。
    - legado `ImportDictRuleDialog` 会在导入前展示候选集合并按本地同名规则标记“新增/已有”，默认仅选中“新增”；Flutter 侧此前缺少候选预览与默认选中策略。
    - legado `DictRuleDao.insert(onConflict = REPLACE)` 按 `name` 覆盖写入；Flutter 侧此前仅有词典查询读取逻辑（`DictRuleStore.loadEnabledRules/search`），无按名称覆盖导入通道。
  - `P5-seq216` 逐项对照清单（实施后）：
    - 入口：已同义（`替换净化 -> 字典规则 -> 更多 -> 本地导入`）。
    - 状态：已同义（文件选择后先进入候选弹层；候选按“新增/已有”分组显示；默认仅勾选新增；确认后导入并刷新列表）。
    - 异常：已同义（读取失败提示 `readTextError:<原因>`；格式异常提示 `ImportError:<原因>`；取消文件选择或取消导入时静默返回）。
    - 文案：已同义（“配置字典规则”“本地导入”“导入字典规则”“新增”“已有”“全选/取消全选”）。
    - 排版：已同义（导入入口位于顶栏“更多”动作层；候选列表为单层勾选清单并展示状态标签）。
    - 交互触发：已同义（`设置 -> 源管理 -> 替换净化 -> 字典规则 -> 更多 -> 本地导入`）。
    - 验证：手工路径 `设置 -> 源管理 -> 替换净化 -> 字典规则 -> 右上角更多 -> 本地导入 -> 选择 txt/json`（校验弹出候选清单且状态标签为“新增/已有”）；手工路径 `仅保留默认勾选并导入`（校验新增项写入列表）；手工路径 `导入同名字典规则`（校验按名称覆盖且列表刷新后生效）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_import_local` 本地导入入口与候选导入链路，不改动 `menu_add/menu_import_onLine/menu_import_qr/menu_import_default` 后续序号能力。
  - 下一项：按优先级继续推进 `P5-seq217`（`dict_rule.xml / @+id/menu_import_onLine / 网络导入`）。
- `2026-02-22`
  - 状态变更：完成 `P4-seq371`（`source_webview_login.xml / @+id/menu_ok / 确认`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq371`（`source_webview_login.xml / @+id/menu_ok / 确认`）：无表单登录链路新增 legado 同义 `SourceLoginWebViewView`。书源管理/发现/搜索详情/阅读/HTTP 朗读引擎的网页登录入口改为专用登录页，顶栏补齐一级“确认”动作；点击“确认”后进入 checking 状态并提示“正在打开首页，成功自动返回主界面”，重载登录首页并在加载完成后自动关闭页面；页面加载开始与结束阶段持续回写 WebView Cookie 到解析引擎 CookieJar。
  - `P4-seq371` 差异点清单（实施前）：
    - legado `WebViewLoginFragment.onCompatOptionsItemSelected(menu_ok)` 固定执行 `checking=true -> snackbar(check_host_cookie) -> loadUrl(source)`；Flutter 侧此前复用 `SourceWebVerifyView` 的“网页验证 + 更多菜单”调试页，缺少 `menu_ok` 顶栏一级确认动作与 checking 状态机。
    - legado `onPageStarted/onPageFinished` 均调用 `CookieStore.setCookie(source.getKey(), cookie)`，且 `checking=true` 时在 `onPageFinished` 自动 `finish`；Flutter 侧此前仅支持手动导入 Cookie（且入口文案偏调试），无“加载期间自动回写 Cookie + 确认后自动返回”链路。
    - legado `shouldOverrideUrlLoading` 对非 `http/https` 统一弹“跳转其它应用”确认后外跳；Flutter 侧此前网页登录分支未对非网页 Scheme 提供同义确认分支。
  - `P4-seq371` 逐项对照清单（实施后）：
    - 入口：已同义（无 `loginUi` 的登录入口统一进入专用网页登录页，顶栏一级“确认”动作可见）。
    - 状态：已同义（点击“确认”后置 `checking=true` 并重载首页；加载完成自动返回上级页面）。
    - 异常：已同义（Cookie 同步失败写入异常日志可观测；非 `http/https` 链接走“跳转其它应用”确认外跳；无效登录地址继续沿用入口侧提示拦截）。
    - 文案：已同义（顶栏动作“确认”；checking 提示“正在打开首页，成功自动返回主界面”；外跳确认标题“跳转其它应用”）。
    - 排版：已同义（操作入口位于导航栏顶层动作位，保持单页 WebView 承载结构）。
    - 交互触发：已同义（`书源管理/发现/搜索详情/阅读/HTTP朗读引擎 -> 登录(网页) -> 右上角确认`）。
    - 验证：`flutter test test/source_list_view_item_top_action_test.dart test/search_book_info_view_login_action_test.dart`、`flutter test test/source_edit_legacy_view_compile_test.dart test/simple_reader_view_compile_test.dart` 通过；手工路径（待回归）`进入任一网页登录入口 -> 顶栏确认`、`登录页点击第三方 Scheme 链接`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_ok` 的确认状态机与 Cookie 同步链路，`menu_show_login_header/menu_del_login_header/menu_log`（`seq365~367`）口径不变。
  - 下一项：`P4` 非 `detail_later` 主功能项已清零，按优先级继续推进 `P5-seq216`（`dict_rule.xml / @+id/menu_import_local / 本地导入`）；`P4-seq357`、`P4-seq367` 继续保持 `detail_later` 后置。
- `2026-02-22`
  - 状态变更：完成 `P4-seq370`（`source_subscription.xml / @+id/menu_add / 添加`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq370`（`source_subscription.xml / @+id/menu_add / 添加`）：规则订阅页补齐 legado 同义顶栏一级“添加”动作。点击右上角“添加”后按当前订阅列表计算 `customOrder=max+1` 创建草稿并打开“规则订阅”编辑弹窗；在弹窗内可填写类型、名称、URL，确认后执行 URL 重复校验，未重复则写入订阅存储并按 `customOrder` 升序回显。
  - `P4-seq370` 差异点清单（实施前）：
    - legado `source_subscription.xml` 将 `menu_add` 定义为 `showAsAction=always` 的顶栏一级入口；Flutter 侧规则订阅页此前缺少对应顶栏“添加”动作，无法从页面主入口创建新订阅。
    - legado `RuleSubActivity.onCompatOptionsItemSelected(menu_add)` 固定执行 `order = ruleSubDao.maxOrder + 1` 后调用 `editSubscription(RuleSub(customOrder = order))`；Flutter 侧此前仅支持删除现有订阅，不具备“新建草稿并进入编辑”链路。
    - legado `editSubscription` 在确认时会按 `findByUrl(url)` 做重复 URL 校验，命中重复且 `id` 不同时提示 `url_already(name)` 并中断写入；Flutter 侧此前缺少 URL 去重分支与对应提示口径。
  - `P4-seq370` 逐项对照清单（实施后）：
    - 入口：已同义（规则订阅页顶栏补齐一级“添加”动作入口）。
    - 状态：已同义（点击后先创建 `customOrder=max+1` 草稿并打开“规则订阅”编辑弹窗；确认后才写入存储）。
    - 异常：已同义（重复 URL 时阻断写入并提示“此 URL 已订阅(名称)”；保存异常写入日志可观测）。
    - 文案：已同义（入口文案“添加”；编辑弹窗标题“规则订阅”；重复提示语义与 legado `url_already(name)` 同义）。
    - 排版：已同义（“添加”位于导航栏顶层动作位，未改变列表区层级与热区）。
    - 交互触发：已同义（`订阅 -> 规则订阅 -> 顶栏添加 -> 编辑弹窗 -> 确定`）。
    - 验证：`flutter test test/rss_subscription_view_compile_test.dart test/rss_source_manage_view_compile_test.dart` 通过；手工路径 `订阅 -> 规则订阅 -> 顶栏添加 -> 选择类型并填写名称与 URL -> 确定`（校验新增项按顺序出现）；手工路径 `再次添加相同 URL`（校验提示“此 URL 已订阅(名称)”且不写入重复项）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_add` 入口与编辑落库边界，不改动 `menu_del`、导入弹层与规则执行链路。
  - 下一项：按优先级继续推进 `P4-seq371`（`source_webview_login.xml / @+id/menu_ok / 确认`；`P4-seq357`、`P4-seq367` 属于 `detail_later` 后置项）。
- `2026-02-22`
  - 状态变更：完成 `P4-seq364`（`source_login.xml / @+id/menu_ok / 确认`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq364`（`source_login.xml / @+id/menu_ok / 确认`）：登录表单承载页“确认”动作收敛为 legado 同义“采集登录数据 -> 执行登录 -> 成功关闭”语义。点击右上角“完成”后，按登录 UI 中 `text/password` 项原样收集登录数据并写入 `userInfo_<sourceKey>`；当登录 UI 不含输入项时执行清空登录信息并直接关闭页面；登录脚本执行成功仅提示“成功”并关闭页面，失败提示统一为“登录出错\n<原因>”，并记录异常日志。
  - `P4-seq364` 差异点清单（实施前）：
    - legado `SourceLoginDialog.menu_ok` 使用 `getLoginData(loginUi)` 收集 `text/password` 全量键值（包含空字符串），`loginData.isEmpty` 时仅执行 `removeLoginInfo + dismiss`；有输入时先 `putLoginInfo` 再 `source.login()`，成功提示 `success` 并关闭，失败提示“登录出错\n<原因>”。
    - Flutter 侧此前 `_submit` 会对输入值 `trim` 且过滤空值，导致“空字符串字段”在确认时被丢弃，状态边界与 legado 不同。
    - Flutter 侧此前成功分支展示脚本返回文案（如“登录脚本执行完成”）而非固定成功提示；失败分支未统一为“登录出错”口径，也未记录异常日志。
  - `P4-seq364` 逐项对照清单（实施后）：
    - 入口：已同义（登录表单页右上角“完成”作为确认动作入口）。
    - 状态：已同义（确认时收集 `text/password` 全量键值；无输入项时清理登录信息并关闭；有输入项时先存再执行业务登录脚本）。
    - 异常：已同义（登录失败统一提示“登录出错\n<原因>”，并写入异常日志可观测）。
    - 文案：已同义（成功提示固定“成功”；失败提示前缀固定“登录出错”）。
    - 排版：已同义（确认动作保持登录页顶栏一级动作位，未新增层级）。
    - 交互触发：已同义（`书源管理/搜索/发现/阅读 -> 登录(表单) -> 完成`）。
    - 验证：`flutter test test/source_list_view_item_top_action_test.dart test/search_book_info_view_login_action_test.dart`、`flutter test test/source_login_script_service_test.dart` 通过；手工路径 `书源管理 -> 新建或编辑任一书源 -> 右上角更多 -> 登录(表单) -> 填写输入项 -> 完成`（校验成功提示“成功”后关闭页面）；手工路径 `登录表单仅保留按钮行或无输入项`（校验完成后直接关闭并清理登录信息缓存）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_ok` 提交流程与提示口径，不改动 `menu_show_login_header/menu_del_login_header/menu_log` 及网页登录分支。
  - 下一项：按优先级继续推进 `P4-seq369`（`source_sub_item.xml / @+id/menu_del / 删除`；`P4-seq357`、`P4-seq367` 属于 `detail_later` 后置项）。
- `2026-02-22`
  - 状态变更：完成 `P4-seq362`（`source_edit.xml / @+id/menu_share_str / 字符串分享`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq362`（`source_edit.xml / @+id/menu_share_str / 字符串分享`）：书源编辑页“字符串分享”动作收敛为 legado 同义“直接文本分享 + 全程静默”语义。点击“更多 -> 字符串分享”后，直接对当前编辑态 `getSource()` 序列化 JSON 拉起系统文本分享；分享 `subject` 固定“分享”，不触发保存、不跳转页面、不追加“已打开系统分享”提示。
  - `P4-seq362` 差异点清单（实施前）：
    - legado `BookSourceEditActivity.onCompatOptionsItemSelected(menu_share_str)` 固定调用 `share(GSON.toJson(getSource()))`；入口文案为“字符串分享”，分享分支静默。
    - Flutter 侧此前入口文案为“分享文本”，与 legado 菜单文案不一致。
    - Flutter 侧此前分享 `subject` 使用“书源名/SoupReader 书源”，并在成功后提示“已打开系统分享”，属于 legado 不存在的可见分支。
    - Flutter 侧此前未显式吞并分享异常，失败边界不满足 legado `Context.share` 的静默语义。
  - `P4-seq362` 逐项对照清单（实施后）：
    - 入口：已同义（编辑页“更多”菜单文案收敛为“字符串分享”）。
    - 状态：已同义（点击后直接拉起系统文本分享，不触发保存、不跳转页面）。
    - 异常：已同义（分享异常静默吞并，不追加成功/失败提示）。
    - 文案：已同义（`subject` 固定“分享”；移除“已打开系统分享”扩展提示）。
    - 排版：已同义（入口继续承载于编辑页“更多”菜单层级，动作排序与热区不变）。
    - 交互触发：已同义（`书源管理 -> 新建或编辑书源 -> 右上角更多 -> 字符串分享`）。
    - 验证：`flutter test test/source_edit_legacy_view_compile_test.dart` 通过；手工路径 `书源管理 -> 新建或编辑任一书源 -> 右上角更多 -> 字符串分享`（校验点击后直接拉起系统文本分享且无额外提示）；手工路径 `系统无可用分享目标或分享通道异常`（校验保持静默无提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_share_str` 的入口文案、分享 `subject` 与提示边界，不改动 `menu_share_qr`、保存链路与扫码导入链路。
  - 下一项：按优先级继续推进 `P4-seq364`（`source_login.xml / @+id/menu_ok / 确认`；`P4-seq357`、`P4-seq367` 属于 `detail_later` 后置项）。
- `2026-02-22`
  - 状态变更：完成 `P4-seq361`（`source_edit.xml / @+id/menu_share_qr / 二维码分享`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq361`（`source_edit.xml / @+id/menu_share_qr / 二维码分享`）：书源编辑页“二维码分享”动作收敛为 legado 同义“直接二维码图片分享”语义。点击“更多 -> 二维码分享”后，直接对当前编辑态 `getSource()` 序列化 JSON 生成二维码图片并拉起系统分享，不再进入中间承载页；分享标题固定“分享书源”，二维码容纳失败统一提示“文字太多，生成二维码失败”。
  - `P4-seq361` 差异点清单（实施前）：
    - legado `BookSourceEditActivity.onCompatOptionsItemSelected(menu_share_qr)` 固定调用 `shareWithQr(GSON.toJson(getSource()), share_book_source, ErrorCorrectionLevel.L)`；入口文案为“二维码分享”，动作直达系统分享。
    - Flutter 侧此前入口文案为“分享二维码”，且点击后进入 `SourceQrShareView` 中间页，再由用户二次点击分享，触发层级与 legado 不一致。
    - legado `shareWithQr` 在二维码生成失败时统一提示“文字太多，生成二维码失败”，不降级为文本分享；Flutter 侧此前中间页存在“二维码失败后自动回退文本分享”扩展分支，状态边界超出 legado。
  - `P4-seq361` 逐项对照清单（实施后）：
    - 入口：已同义（编辑页“更多”菜单文案收敛为“二维码分享”）。
    - 状态：已同义（点击后直接生成二维码图片并拉起系统分享，不进入中间承载页）。
    - 异常：已同义（二维码生成失败统一提示“文字太多，生成二维码失败”；分享异常输出错误摘要，空摘要回退“ERROR”）。
    - 文案：已同义（分享标题固定“分享书源”；入口文案固定“二维码分享”）。
    - 排版：已同义（入口继续承载于编辑页“更多”菜单层级，动作排序与热区不变）。
    - 交互触发：已同义（`书源管理 -> 新建或编辑书源 -> 右上角更多 -> 二维码分享`）。
    - 验证：`flutter test test/source_edit_legacy_view_compile_test.dart` 通过；手工路径 `书源管理 -> 新建或编辑任一书源 -> 右上角更多 -> 二维码分享`（校验点击后直接拉起系统图片分享）；手工路径 `构造超长书源 JSON 后触发二维码分享`（校验提示“文字太多，生成二维码失败”）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_share_qr` 的入口文案、触发层级与失败边界，不改动 `menu_share_str`、保存链路与扫码导入链路。
  - 下一项：按优先级继续推进 `P4-seq362`（`source_edit.xml / @+id/menu_share_str / 字符串分享`；`P4-seq357`、`P4-seq367` 属于 `detail_later` 后置项）。
- `2026-02-22`
  - 状态变更：完成 `P4-seq359`（`source_edit.xml / @+id/menu_set_source_variable / 设置源变量`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq359`（`source_edit.xml / @+id/menu_set_source_variable / 设置源变量`）：书源编辑页“设置源变量”动作收敛为 legado 同义“先保存再弹层 + 保存后静默”语义。点击“更多 -> 设置源变量”后先执行保存，保存成功再打开变量输入弹层；变量保存后仅持久化 `sourceVariable_<bookSourceUrl>`，不追加“源变量已保存”提示；空字符串输入保持可保存并可回显。
  - `P4-seq359` 差异点清单（实施前）：
    - legado `BookSourceEditActivity.setSourceVariable()` 固定执行 `viewModel.save(getSource())`，成功后再打开 `VariableDialog`；保存变量时通过 `setVariable(variable)` 写入缓存，流程保持静默，不追加成功提示。
    - Flutter 侧此前在 `_setSourceVariable()` 中虽已“先保存再弹层”，但额外存在 `bookSourceUrl` 为空时提示“请先填写 bookSourceUrl”分支，以及变量保存后的“源变量已保存”提示，属于 legado 不存在的可见分支。
  - `P4-seq359` 逐项对照清单（实施后）：
    - 入口：已同义（编辑页“更多”菜单保留“设置源变量”入口，触发顺序为先保存后弹层）。
    - 状态：已同义（保存成功后弹出变量输入弹层；确认后仅写入 `sourceVariable_<bookSourceUrl>`；空字符串作为有效值保存，重进可回显）。
    - 异常：已同义（保存失败时停留编辑页并沿用保存错误摘要；变量写入过程保持静默，不追加成功/失败提示）。
    - 文案：已同义（保留标题“设置源变量”与默认说明“源变量可在js中通过source.getVariable()获取”；移除非 legado 的“请先填写 bookSourceUrl/源变量已保存”扩展提示）。
    - 排版：已同义（入口仍在“更多”菜单层级，变量输入弹层层级与热区不变）。
    - 交互触发：已同义（`书源管理 -> 新建或编辑书源 -> 右上角更多 -> 设置源变量`）。
    - 验证：`flutter test test/source_edit_legacy_view_compile_test.dart` 通过；手工路径 `书源管理 -> 新建或编辑任一书源 -> 右上角更多 -> 设置源变量`（校验先保存后弹层、保存后无额外提示）；手工路径 `变量输入空字符串后保存并重进弹层`（校验空字符串可保存并回显）；手工路径 `名称或 URL 置空后触发设置源变量`（校验停留编辑页并展示保存错误摘要）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_set_source_variable` 的提示分支与状态边界，不改动书源保存结构、变量键格式与登录/调试链路。
  - 下一项：按优先级继续推进 `P4-seq361`（`source_edit.xml / @+id/menu_share_qr / 二维码分享`；`P4-seq357`、`P4-seq367` 属于 `detail_later` 后置项）。
- `2026-02-22`
  - 状态变更：完成 `P4-seq358`（`source_edit.xml / @+id/menu_paste_source / 粘贴源`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq358`（`source_edit.xml / @+id/menu_paste_source / 粘贴源`）：书源编辑页“粘贴源”动作收敛为 legado 同义“静默回填”语义。点击“更多 -> 粘贴源”后读取剪贴板并导入首个书源对象，成功时仅回填当前编辑表单，不触发保存、不跳转页面、也不重置已保存快照；回填后返回页面仍按“有未保存修改”确认退出。入口文案同步收敛为 legado 同义“粘贴源”。
  - `P4-seq358` 差异点清单（实施前）：
    - legado `BookSourceEditActivity.onCompatOptionsItemSelected(menu_paste_source)` 固定执行 `viewModel.pasteSource { upSourceView(it) }`，成功分支仅回填表单且静默，不触发保存与跳转，也不更新 `bookSource` 基线。
    - Flutter 侧此前入口文案为“粘贴书源”，且粘贴成功后会写入 `_savedSource/_currentOriginalUrl/_savedSnapshot` 并提示“已粘贴并载入书源”，导致退出时不再触发未保存确认，状态边界偏离 legado。
  - `P4-seq358` 逐项对照清单（实施后）：
    - 入口：已同义（编辑页“更多”菜单入口文案收敛为“粘贴源”）。
    - 状态：已同义（导入成功后仅回填表单；不保存、不跳转、不前移已保存基线）。
    - 异常：已同义（剪贴板为空提示“剪贴板为空”；格式错误统一提示“格式不对”；其余导入错误透传摘要）。
    - 文案：已同义（入口文案“粘贴源”；移除成功提示文案）。
    - 排版：已同义（入口继续承载于编辑页“更多”菜单层级，未改变动作排序与热区）。
    - 交互触发：已同义（`书源管理 -> 新建或编辑书源 -> 右上角更多 -> 粘贴源`）。
    - 验证：手工路径 `书源管理 -> 新建或编辑任一书源 -> 右上角更多 -> 粘贴源`（校验剪贴板为有效书源 JSON 或链接时仅回填表单且无成功提示）；手工路径 `粘贴后直接返回上一页`（校验仍触发未保存修改确认）；手工路径 `剪贴板为空或非法文本`（校验分别提示“剪贴板为空/格式不对”）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_paste_source` 的入口文案、成功分支与错误文案边界，不改动书源存储结构、保存链路与扫码导入链路。
  - 下一项：按优先级继续推进 `P4-seq359`（`source_edit.xml / @+id/menu_set_source_variable / 设置源变量`；`P4-seq357`、`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq356`（`source_edit.xml / @+id/menu_auto_complete / 自动补全`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq356`（`source_edit.xml / @+id/menu_auto_complete / 自动补全`）：书源编辑页“自动补全”动作收敛为 legado 同义静默开关。点击“更多 -> 自动补全”后仅翻转当前会话内 `autoComplete` 勾选状态，不触发保存、不跳转页面、也不追加“已开启/已关闭”提示；后续仅在保存相关链路构建规则对象时按开关决定是否执行 `RuleComplete.autoComplete`。
  - `P4-seq356` 差异点清单（实施前）：
    - legado `BookSourceEditActivity.onCompatOptionsItemSelected(menu_auto_complete)` 仅执行 `viewModel.autoComplete = !viewModel.autoComplete`，属于纯 checkable 状态切换。
    - Flutter 侧此前虽已具备 `menu_auto_complete` 开关与规则自动补全能力，但点击后会额外弹出“自动补全已开启/关闭”提示，属于 legado 不存在的可见分支。
  - `P4-seq356` 逐项对照清单（实施后）：
    - 入口：已同义（编辑页“更多”菜单保留 `menu_auto_complete` 入口，并以勾选态表达当前开关）。
    - 状态：已同义（点击后仅翻转开关状态；开关不持久化，重进编辑页默认关闭）。
    - 异常：已同义（切换过程静默执行，不追加成功/失败提示）。
    - 文案：已同义（入口文案保持“自动补全”，未追加扩展提示文案）。
    - 排版：已同义（入口继续承载于编辑页“更多”菜单层级，未改变动作排序与热区）。
    - 交互触发：已同义（`书源管理 -> 新建或编辑书源 -> 右上角更多 -> 自动补全`）。
    - 验证：手工路径 `书源管理 -> 新建或编辑任一书源 -> 右上角更多 -> 自动补全`（校验点击仅切换勾选态且不出现提示）；手工路径 `开启自动补全后点击保存或调试源`（校验规则字段按 `RuleComplete` 自动补全）；手工路径 `关闭自动补全后再次保存`（校验规则保持输入原值）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_auto_complete` 的状态提示分支，不改动规则补全算法、书源存储结构与保存链路。
  - 下一项：按优先级继续推进 `P4-seq358`（`source_edit.xml / @+id/menu_paste_source / 粘贴源`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq355`（`source_edit.xml / @+id/menu_clear_cookie / 清除 Cookie`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq355`（`source_edit.xml / @+id/menu_clear_cookie / 清除 Cookie`）：书源编辑页“清除 Cookie”动作收敛为 legado 同义静默链路。点击“更多 -> 清除 Cookie”后直接按当前 `bookSourceUrl` 执行 Cookie 清理，不触发保存、不跳转页面、也不追加成功/失败提示；入口文案同步收敛为 legado 同义“清除 Cookie”。
  - `P4-seq355` 差异点清单（实施前）：
    - legado `BookSourceEditActivity.onCompatOptionsItemSelected(menu_clear_cookie)` 固定执行 `viewModel.clearCookie(getSource().bookSourceUrl)`；该入口不经过保存链路，且无页面跳转。
    - Flutter 侧此前虽已提供“清 Cookie”入口，但文案与 legado 不一致，且 `_clearCookie` 会在 URL 为空/无效/清理成功/失败时弹出额外提示，属于超出 legado 的可见分支。
  - `P4-seq355` 逐项对照清单（实施后）：
    - 入口：已同义（编辑页“更多”菜单保留 `menu_clear_cookie` 入口）。
    - 状态：已同义（点击后直接按当前编辑态 `bookSourceUrl` 执行清理，不触发保存与跳转）。
    - 异常：已同义（清理过程静默执行，不追加成功/失败或无效 URL 提示）。
    - 文案：已同义（入口文案由“清 Cookie”收敛为“清除 Cookie”）。
    - 排版：已同义（入口继续承载于编辑页“更多”菜单层级，未改变动作排序与热区）。
    - 交互触发：已同义（`书源管理 -> 新建或编辑书源 -> 右上角更多 -> 清除 Cookie`）。
    - 验证：手工路径 `书源管理 -> 新建或编辑任一书源 -> 右上角更多 -> 清除 Cookie`（校验点击后停留当前页且无额外提示；后续以该源发起请求时 Cookie 按域作用域已清理）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_clear_cookie` 的入口文案与静默状态流，不改动书源结构、保存链路与调试链路。
  - 下一项：按优先级继续推进 `P4-seq356`（`source_edit.xml / @+id/menu_auto_complete / 自动补全`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq352`（`source_edit.xml / @+id/menu_debug_source / 调试源`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq352`（`source_edit.xml / @+id/menu_debug_source / 调试源`）：书源编辑页“调试源”动作收敛为 legado 同义链路。点击顶栏“调试源”后先执行保存，保存成功才进入调试页；保存失败时停留在编辑页并直接展示保存错误摘要，不追加扩展提示。入口文案同步收敛为 legado 同义“调试源”。
  - `P4-seq352` 差异点清单（实施前）：
    - legado `BookSourceEditActivity.onCompatOptionsItemSelected(menu_debug_source)` 固定执行 `viewModel.save(getSource())`，成功后 `startActivity<BookSourceDebugActivity>(key=bookSourceUrl)`；即“先保存再调试”，失败不跳转。
    - Flutter 侧虽已复用 `_saveInternal -> SourceDebugLegacyView(source: saved)` 的主链路，但顶栏入口文案为“调试”，与 `source_edit.xml/@+id/menu_debug_source` 的用户可见文案“调试源”不一致，且该序号尚未完成台账/ExecPlan 回填。
  - `P4-seq352` 逐项对照清单（实施后）：
    - 入口：已同义（编辑页顶栏一级动作文案收敛为“调试源”）。
    - 状态：已同义（点击后先保存，保存成功才进入调试页）。
    - 异常：已同义（保存失败停留编辑页，不进入调试页，错误摘要直接透传）。
    - 文案：已同义（入口文案“调试源”与 legado 对齐）。
    - 排版：已同义（入口继续位于编辑页顶栏动作区，与“保存”同层级）。
    - 交互触发：已同义（`书源管理 -> 新建或编辑书源 -> 调试源`）。
    - 验证：手工路径 `书源管理 -> 新建或编辑任一书源 -> 右上角调试源`（校验点击后先保存并进入调试页；名称或 URL 为空时仅提示保存错误并保持在编辑页）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_debug_source` 的入口文案与迁移证据，不改动调试引擎、书源数据结构与存储字段。
  - 下一项：按优先级继续推进 `P4-seq355`（`source_edit.xml / @+id/menu_clear_cookie / 清除 Cookie`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq351`（`source_edit.xml / @+id/menu_save / 保存`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq351`（`source_edit.xml / @+id/menu_save / 保存`）：书源编辑页保存动作收敛为 legado 同义保存边界。点击顶栏“保存”后仅在保存成功时关闭编辑页并返回上级页面，同时回传保存后的 `sourceUrl`；保存失败时停留当前页并直接透传错误摘要，不追加“保存失败：”前缀。必填校验提示文案同步收敛为 legado 同义“名称和 URL 不能为空”。
  - `P4-seq351` 差异点清单（实施前）：
    - legado `BookSourceEditActivity.onCompatOptionsItemSelected(menu_save)` 点击后执行 `viewModel.save(getSource())`，成功才 `setResult + finish`；Flutter 侧虽已具备保存入口，但失败提示统一拼接 `保存失败：$e`，与 legado “直接透传错误摘要”不一致。
    - legado `BookSourceEditViewModel.save` 在 `name/url` 为空时抛出 `non_null_name_url`（`名称和 URL 不能为空`）并直接 toast；Flutter 侧 `SourceLegacySaveService` 校验文案此前为“书源名称和书源地址不能为空”，用户可见文案不一致。
  - `P4-seq351` 逐项对照清单（实施后）：
    - 入口：已同义（编辑页顶栏一级“保存”动作保持常驻）。
    - 状态：已同义（保存成功后关闭编辑页并返回上级页面，回传保存后的 `sourceUrl`）。
    - 异常：已同义（保存失败时停留当前页，直接展示错误摘要，不追加扩展前缀）。
    - 文案：已同义（必填校验提示收敛为“名称和 URL 不能为空”）。
    - 排版：已同义（保存入口继续位于编辑页顶栏动作区，未新增层级）。
    - 交互触发：已同义（`书源管理 -> 新建或编辑书源 -> 保存`）。
    - 验证：`flutter test test/source_edit_legacy_view_compile_test.dart`、`flutter test test/source_legacy_save_service_test.dart` 通过；手工路径 `书源管理 -> 新建或编辑任一书源 -> 右上角保存`（校验保存成功后关闭编辑页且无“保存成功”提示，名称或 URL 为空时仅提示“名称和 URL 不能为空”）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_save` 单项语义，不提前并入 `source_edit.xml` 后续条目。
  - 下一项：按优先级继续推进 `P4-seq352`（`source_edit.xml / @+id/menu_debug_source / 调试源`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq199`（`change_source_item.xml / @+id/menu_delete_source / 删除源`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq199`（`change_source_item.xml / @+id/menu_delete_source / 删除源`）：换源候选条目长按菜单补齐 legado 同义“删除源”动作，并按入口分流对齐删除确认边界；整书换源链路点击“删除源”后先弹“提醒/是否确认删除？”确认框，确认后删除；单章换源链路点击后直接删除。删除动作复用 legado 同义“删库 + 清理源变量缓存”规则并保持静默，不追加成功或失败提示。
  - `P4-seq199` 差异点清单（实施前）：
    - legado `ChangeBookSourceAdapter.showMenu(menu_delete_source)` 会先弹确认框（`draw + sure_del`）后再调用 `deleteSource`；`ChangeChapterSourceAdapter.showMenu(menu_delete_source)` 则直接调用 `deleteSource`，无确认框。Flutter 侧此前候选条目长按菜单仅有“置顶/置底/编辑源/禁用源”，缺少“删除源”入口与“整书确认、单章直删”的分流语义。
    - legado `ChangeBookSourceViewModel.del` 固定执行 `SourceHelp.deleteBookSource(origin)` 并删除候选缓存项；`SourceHelp.deleteBookSource` 同时清理 sourceVariables/SourceConfig。Flutter 侧此前阅读页候选链路缺少同义删除动作与源变量清理。
  - `P4-seq199` 逐项对照清单（实施后）：
    - 入口：已同义（候选条目长按菜单新增“删除源”，整书/单章换源均可触发）。
    - 状态：已同义（整书换源点击后先确认再删除；单章换源点击后直接删除；删除后仅移除当前候选条目）。
    - 异常：已同义（删除失败或书源缺失均保持静默，不追加扩展提示）。
    - 文案：已同义（动作文案固定“删除源”；整书换源确认文案为“提醒/是否确认删除？\n<书源名>”）。
    - 排版：已同义（动作承载在候选条目长按菜单层，候选列表主布局不变）。
    - 交互触发：已同义（`阅读页 -> 整书/单章换源候选弹层 -> 长按候选条目 -> 删除源`，整书路径含确认弹窗分支）。
    - 验证：`flutter test test/simple_reader_view_compile_test.dart` 通过；手工路径 `阅读页(网络书) -> 顶部换源按钮(点击或长按) -> 整书换源候选弹层 -> 长按候选条目 -> 删除源 -> 确认删除`（校验确认后目标候选移除且过程静默）；手工路径 `阅读页(网络书) -> 顶部换源按钮长按 -> 单章换源候选弹层 -> 长按候选条目 -> 删除源`（校验无确认弹窗且目标候选即时移除）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_delete_source` 单项能力，不提前并入 `source_edit.xml` 后续条目。
  - 下一项：按优先级继续推进 `P4-seq351`（`source_edit.xml / @+id/menu_save / 保存`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq198`（`change_source_item.xml / @+id/menu_disable_source / 禁用源`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq198`（`change_source_item.xml / @+id/menu_disable_source / 禁用源`）：换源候选条目长按菜单补齐 legado 同义“禁用源”动作；点击后按 `sourceUrl` 回查并静默写库 `enabled=false`，随后仅移除当前候选条目；书源记录缺失时保持“仅移除候选、无额外提示”边界。整书换源与单章换源共用同一禁用流程。
  - `P4-seq198` 差异点清单（实施前）：
    - legado `ChangeBookSourceAdapter/ChangeChapterSourceAdapter.showMenu` 均定义 `menu_disable_source -> callBack.disableSource(searchBook)`；Flutter 侧此前候选条目长按菜单仅有“置顶/置底/编辑源”，缺少“禁用源”入口。
    - legado `ChangeBookSourceViewModel.disableSource` 语义为“若书源存在则写库禁用 + 从当前候选列表移除对应条目 + 刷新列表”，全程静默；Flutter 侧此前缺少候选条目级禁用动作，无法复刻同义状态流。
  - `P4-seq198` 逐项对照清单（实施后）：
    - 入口：已同义（候选条目长按菜单新增“禁用源”动作，整书/单章换源路径一致）。
    - 状态：已同义（点击后写库禁用目标书源并立即从当前候选列表移除该条目）。
    - 异常：已同义（书源不存在或禁用失败时保持静默，不追加提示；书源不存在时仍移除当前候选条目）。
    - 文案：已同义（动作文案固定“禁用源”）。
    - 排版：已同义（动作承载在候选条目长按菜单层，候选列表主布局不变）。
    - 交互触发：已同义（`阅读页 -> 整书/单章换源候选弹层 -> 长按候选条目 -> 禁用源`）。
    - 验证：`flutter test test/simple_reader_view_compile_test.dart` 通过；手工路径 `阅读页(网络书) -> 顶部换源按钮(点击或长按) -> 候选弹层 -> 长按候选条目 -> 禁用源`（校验候选条目即时移除且过程无确认弹窗/无额外提示）；手工路径 `禁用后重新打开候选弹层`（校验被禁用书源不再参与候选搜索）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_disable_source` 单项能力，不提前并入 `menu_delete_source` 后续条目。
  - 下一项：按优先级继续推进 `P4-seq199`（`change_source_item.xml / @+id/menu_delete_source / 删除源`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq197`（`change_source_item.xml / @+id/menu_edit_source / 编辑源`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq197`（`change_source_item.xml / @+id/menu_edit_source / 编辑源`）：换源候选条目长按菜单补齐 legado 同义“编辑源”动作；点击后复用 `sourceUrl` 打开书源编辑承载页。编辑保存返回后，整书换源候选仅刷新被编辑书源，单章换源候选刷新全量书源；取消返回保持当前候选列表不变，过程全程静默无扩展提示。
  - `P4-seq197` 差异点清单（实施前）：
    - legado `ChangeBookSourceAdapter/ChangeChapterSourceAdapter.showMenu` 均定义 `menu_edit_source -> callBack.editSource(searchBook)`；Flutter 侧此前候选条目长按菜单仅实现“置顶/置底”，缺少“编辑源”入口。
    - legado `ChangeBookSourceDialog` 在编辑页 `RESULT_OK` 后执行 `startSearch(origin)`（仅刷新编辑源）；`ChangeChapterSourceDialog` 在 `RESULT_OK` 后执行 `startSearch()`（刷新全量候选）。Flutter 侧此前缺少这一返回刷新分流语义。
  - `P4-seq197` 逐项对照清单（实施后）：
    - 入口：已同义（候选条目长按菜单新增“编辑源”动作）。
    - 状态：已同义（编辑保存返回后，整书换源仅回刷目标书源候选；单章换源回刷全量候选）。
    - 异常：已同义（书源不存在、编辑取消或刷新失败时保持当前候选列表，不追加扩展提示）。
    - 文案：已同义（动作文案固定“编辑源”）。
    - 排版：已同义（动作承载在候选条目长按菜单层，候选列表排版保持不变）。
    - 交互触发：已同义（`阅读页 -> 整书/单章换源候选弹层 -> 长按候选条目 -> 编辑源`）。
    - 验证：`flutter test test/simple_reader_view_compile_test.dart` 通过；手工路径 `阅读页(网络书) -> 顶部换源按钮(点击或长按) -> 候选弹层 -> 长按候选条目 -> 编辑源 -> 保存返回`（校验整书换源仅刷新该源、单章换源刷新全量候选）；手工路径 `编辑页直接返回`（校验候选列表保持不变）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_edit_source` 单项能力，不提前并入 `menu_disable_source/menu_delete_source` 后续条目。
  - 下一项：按优先级继续推进 `P4-seq198`（`change_source_item.xml / @+id/menu_disable_source / 禁用源`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq196`（`change_source_item.xml / @+id/menu_bottom_source / 置底`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq196`（`change_source_item.xml / @+id/menu_bottom_source / 置底`）：换源候选条目补齐 legado 同义长按菜单“置底”入口；点击后按 `customOrder=maxOrder+1` 规则写库并即时重排候选列表，全程静默不追加提示。
  - `P4-seq196` 差异点清单（实施前）：
    - legado `ChangeBookSourceAdapter/ChangeChapterSourceAdapter` 长按候选条目弹出 `change_source_item.xml` 菜单并触发 `menu_bottom_source -> callBack.bottomSource(searchBook)`；Flutter 侧此前仅补齐“置顶”，缺少“置底”动作入口。
    - legado `ChangeBookSourceViewModel.bottomSource` 会将目标书源 `customOrder` 写为 `maxOrder+1`，随后刷新候选排序；Flutter 侧此前阅读页缺少同义写库与重排链路，导致无法复刻“置底后立即后移”行为。
  - `P4-seq196` 逐项对照清单（实施后）：
    - 入口：已同义（候选条目长按菜单新增“置底”动作）。
    - 状态：已同义（点击“置底”后目标书源写入 `customOrder=maxOrder+1`，候选列表按新序即时后移）。
    - 异常：已同义（书源不存在或写库失败保持静默，不追加扩展提示）。
    - 文案：已同义（动作文案固定“置底”）。
    - 排版：已同义（动作承载在条目长按弹出菜单层，候选列表布局不变）。
    - 交互触发：已同义（`阅读页 -> 整书/单章换源候选弹层 -> 长按候选条目 -> 置底`）。
    - 验证：`flutter test test/simple_reader_view_compile_test.dart` 通过；手工路径 `阅读页(网络书) -> 顶部换源按钮(点击或长按) -> 候选弹层 -> 长按任一候选条目 -> 置底`（校验目标书源后移且过程无额外提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_bottom_source` 单项能力，不提前并入 `menu_edit_source/menu_disable_source/menu_delete_source` 后续条目。
  - 下一项：按优先级继续推进 `P4-seq197`（`change_source_item.xml / @+id/menu_edit_source / 编辑源`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq195`（`change_source_item.xml / @+id/menu_top_source / 置顶`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq195`（`change_source_item.xml / @+id/menu_top_source / 置顶`）：换源候选条目补齐 legado 同义长按菜单“置顶”入口；点击后按 `customOrder=minOrder-1` 规则写库并即时重排候选列表，全程静默不追加提示。
  - `P4-seq195` 差异点清单（实施前）：
    - legado `ChangeBookSourceAdapter/ChangeChapterSourceAdapter` 长按候选条目会弹出 `change_source_item.xml` 菜单并触发 `menu_top_source -> callBack.topSource(searchBook)`；Flutter 侧此前候选条目仅支持点击切换，缺少条目级菜单入口。
    - legado `ChangeBookSourceViewModel.topSource` 会将目标书源 `customOrder` 写为 `minOrder-1`，随后刷新候选排序；Flutter 侧此前阅读页缺少同义写库与重排链路，导致无法复刻“置顶后立即前移”行为。
  - `P4-seq195` 逐项对照清单（实施后）：
    - 入口：已同义（候选条目支持长按并弹出“置顶”动作）。
    - 状态：已同义（点击“置顶”后目标书源写入 `customOrder=minOrder-1`，候选列表按新序即时前移）。
    - 异常：已同义（书源不存在或写库失败保持静默，不追加扩展提示）。
    - 文案：已同义（动作文案固定“置顶”）。
    - 排版：已同义（动作承载在条目长按弹出菜单层，候选列表布局不变）。
    - 交互触发：已同义（`阅读页 -> 整书/单章换源候选弹层 -> 长按候选条目 -> 置顶`）。
    - 验证：`flutter test test/simple_reader_view_compile_test.dart` 通过；手工路径 `阅读页(网络书) -> 顶部换源按钮(点击或长按) -> 候选弹层 -> 长按任一候选条目 -> 置顶`（校验目标书源前移且过程无额外提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_top_source` 单项能力，不提前并入 `menu_bottom_source/menu_edit_source/menu_disable_source/menu_delete_source` 后续条目。
  - 下一项：按优先级继续推进 `P4-seq196`（`change_source_item.xml / @+id/menu_bottom_source / 置底`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq194`（`change_source.xml / @+id/menu_close / 关闭`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq194`（`change_source.xml / @+id/menu_close / 关闭`）：换源候选弹层关闭动作文案收敛为 legado 同义“关闭”；点击后保持仅执行弹层关闭（`dismiss/pop`），不附带换源提交、配置写入或额外提示。
  - `P4-seq194` 差异点清单（实施前）：
    - legado `change_source.xml` 明确定义 `menu_close`，标题为“关闭”；`ChangeBookSourceDialog.onMenuItemClick(menu_close)` 仅执行 `dismissAllowingStateLoss()`。Flutter 侧此前虽有关闭动作，但文案为“取消”，用户可见语义不一致。
    - legado `menu_close` 属于纯关闭动作，不修改搜索/筛选/分组状态；Flutter 侧此前关闭触发链路已是 `pop`，但缺少“关闭”文案同义证据，队列项仍为 `pending`。
  - `P4-seq194` 逐项对照清单（实施后）：
    - 入口：已同义（候选弹层顶栏补齐“关闭”动作入口）。
    - 状态：已同义（点击后立即关闭候选弹层，返回阅读页原状态）。
    - 异常：已同义（关闭过程保持静默，不追加失败提示；弹层关闭后的搜索停止仍沿用既有清理链路）。
    - 文案：已同义（关闭动作文案由“取消”收敛为“关闭”）。
    - 排版：已同义（关闭入口继续位于候选弹层顶栏动作区，未改变既有布局层级）。
    - 交互触发：已同义（`阅读页 -> 换源候选弹层 -> 关闭`，直接退出候选弹层）。
    - 验证：手工路径 `阅读页(网络书) -> 顶部换源按钮(点击或长按) -> 候选弹层 -> 关闭`（校验弹层立即关闭且无额外提示）；手工路径 `候选搜索进行中点击关闭`（校验弹层关闭后搜索任务按既有链路停止）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_close` 入口文案与关闭动作语义，不改动换源候选搜索、分组筛选与提交链路。
  - 下一项：按优先级继续推进 `P4-seq195`（`change_source_item.xml / @+id/menu_top_source / 置顶`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq193`（`change_source.xml / @+id/menu_group / 分组`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq193`（`change_source.xml / @+id/menu_group / 分组`）：换源候选弹层补齐 legado 同义“分组”一级入口；分组菜单动态提供“全部书源 + 启用分组”并保持单选勾选态；点击后写入全局键 `searchGroup`，停止当前候选搜索并按所选分组重拉候选；当所选分组无结果时提供“切换到全部分组”确认回退。
  - `P4-seq193` 差异点清单（实施前）：
    - legado `change_source.xml` 定义 `menu_group`，子菜单分组 `source_group` 为单选；`ChangeBookSourceDialog/ChangeChapterSourceDialog` 会基于启用书源动态构建分组项并补齐“全部书源”。Flutter 侧此前候选弹层缺失同义分组入口。
    - legado 点击分组项后写入 `AppConfig.searchGroup`，并执行 `stopSearch -> refresh -> startSearch` 状态流；Flutter 侧此前换源候选始终按“全部启用书源”搜索，缺少 `searchGroup` 持久化与分组作用域。
    - legado 在已选分组搜索结果为空时会提示“是否切换到全部分组”；Flutter 侧此前缺少该回退确认边界。
  - `P4-seq193` 逐项对照清单（实施后）：
    - 入口：已同义（候选弹层顶栏新增“分组”入口，独立于“更多”菜单）。
    - 状态：已同义（新增 `searchGroup` 持久化；菜单单选勾选态可回显当前分组；分组失效时自动回退到全部书源）。
    - 异常：已同义（切分组、停止搜索、重拉候选过程保持静默；分组空结果仅提供确认回退，不追加扩展 toast）。
    - 文案：已同义（固定“分组 / 全部书源”；空结果提示文案对齐 legado 语义“<分组>分组搜索结果为空,是否切换到全部分组”）。
    - 排版：已同义（分组入口位于候选弹层顶栏动作区，与刷新/刷新列表/书源管理同层级）。
    - 交互触发：已同义（`阅读页 -> 换源候选弹层 -> 分组 -> 选择全部书源或任一分组`；切换后按所选分组重拉候选）。
    - 验证：手工路径 `阅读页(网络书) -> 顶部换源按钮(点击或长按) -> 候选弹层 -> 分组`（校验“全部书源+动态分组”单选勾选态）；手工路径 `选择任一分组后触发刷新`（校验仅该分组书源参与候选）；手工路径 `选择空结果分组`（校验弹出回退确认并可切回全部书源）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_group` 的入口、持久化与分组作用域筛选语义，不改动换源提交、章节替换与目录加载链路。
  - 下一项：按优先级继续推进 `P4-seq194`（`change_source.xml / @+id/menu_close / 关闭`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq191`（`change_source.xml / @+id/menu_load_info / 加载详情页`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq191`（`change_source.xml / @+id/menu_load_info / 加载详情页`）：换源候选弹层“更多”菜单补齐 legado 同义 `checkable` 入口“加载详情页”；开关状态持久化到同名键 `changeSourceLoadInfo`，并在整书换源与单章换源共用弹层中按开关决定是否对候选执行详情页补水（`getBookInfo`）与最新章节回填；切换动作保持静默且不自动刷新当前列表。
  - `P4-seq191` 差异点清单（实施前）：
    - legado `ChangeBookSourceDialog` 与 `ChangeChapterSourceDialog` 在 `initMenu()` 中均读取 `AppConfig.changeSourceLoadInfo` 回显勾选态；Flutter 侧此前缺少 `changeSourceLoadInfo` 持久化键与入口回显。
    - legado 点击 `menu_load_info` 仅翻转 `changeSourceLoadInfo`，不触发刷新；Flutter 侧此前“更多”菜单缺少该入口，无法复刻同义静默状态流。
    - legado `ChangeBookSourceViewModel.search` 在 `loadInfo || loadToc || loadWordCount` 时统一走 `loadBookInfo`，保证“仅加载详情页”场景也会补齐详情字段；Flutter 侧此前仅在 `loadToc/loadWordCount` 打开时才会补水详情，`load_info` 语义缺失。
  - `P4-seq191` 逐项对照清单（实施后）：
    - 入口：已同义（候选弹层“更多”菜单新增 `加载详情页`，勾选态表达开关状态）。
    - 状态：已同义（开关持久化到 `changeSourceLoadInfo` 并在重进弹层时回显）。
    - 异常：已同义（切换开关与候选补水失败均保持静默，不追加扩展弹窗或 toast）。
    - 文案：已同义（固定“加载详情页”，不做动态开关文案）。
    - 排版：已同义（入口承载于候选弹层“更多”菜单，与 `加载字数/加载目录/换源间隔` 同层级）。
    - 交互触发：已同义（`阅读页 -> 换源候选弹层 -> 更多 -> 加载详情页`；切换仅持久化，后续刷新候选时按开关决定是否回填详情页最新章节）。
    - 验证：手工路径 `阅读页(网络书) -> 顶部换源按钮(点击或长按) -> 候选弹层 -> 更多 -> 加载详情页`（校验勾选态回显与切换静默）；手工路径 `开启加载详情页后点击刷新/刷新列表`（校验候选最新章节按详情页结果回填）；手工路径 `关闭加载详情页后再次刷新候选`（校验回退为搜索结果原值且无额外提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_load_info` 入口、持久化与候选详情补水语义，不改动换源提交、章节替换、分组筛选与关闭弹层链路。
  - 下一项：按优先级继续推进 `P4-seq193`（`change_source.xml / @+id/menu_group / 分组`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq190`（`change_source.xml / @+id/menu_load_word_count / 加载字数`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq190`（`change_source.xml / @+id/menu_load_word_count / 加载字数`）：换源候选弹层“更多”菜单补齐 legado 同义 `checkable` 入口“加载字数”；开关状态持久化到同名键 `changeSourceLoadWordCount`，并在整书换源/单章换源共用弹层中按开关决定是否采集并展示候选章节字数与响应时间；开启后候选排序收敛为“已加载字数优先 -> 章节号降序 -> 字数降序 -> 原顺序”，保持切换静默无额外提示。
  - `P4-seq190` 差异点清单（实施前）：
    - legado `ChangeBookSourceDialog` 与 `ChangeChapterSourceDialog` 在 `initMenu()` 中均读取 `AppConfig.changeSourceLoadWordCount` 回显勾选态；Flutter 侧此前仅存在 `changeSourceLoadToc`，缺少 `changeSourceLoadWordCount` 透传与回显。
    - legado 点击 `menu_load_word_count` 会翻转 `changeSourceLoadWordCount` 并执行 `onLoadWordCountChecked(true)->startRefreshList(true)`，只补刷未加载字数候选；Flutter 侧此前仅刷新目录数据，不会采集候选字数。
    - legado 两个 Adapter 仅在 `changeSourceLoadWordCount=true` 时展示 `chapterWordCountText/respondTime` 并参与排序；Flutter 侧此前候选项缺少该展示与排序维度。
  - `P4-seq190` 逐项对照清单（实施后）：
    - 入口：已同义（候选弹层“更多”菜单新增 `加载字数`，勾选态表达开关状态）。
    - 状态：已同义（开关持久化到 `changeSourceLoadWordCount` 并在重进弹层时回显）。
    - 异常：已同义（采集失败仅在候选字数字段展示“获取字数失败：...”文本，不追加额外弹窗或 toast）。
    - 文案：已同义（固定“加载字数”，不做动态开关文案）。
    - 排版：已同义（入口承载于候选弹层“更多”菜单；候选条目字数与响应时间展示位与 legado 同层级）。
    - 交互触发：已同义（`阅读页 -> 换源候选弹层 -> 更多 -> 加载字数`；开启后刷新候选可见字数/响应时间并按 legado 规则排序）。
    - 验证：`flutter test test/simple_reader_view_compile_test.dart`、`flutter test test/reader_source_switch_helper_test.dart` 通过；手工路径 `阅读页(网络书) -> 顶部换源按钮(点击或长按) -> 候选弹层 -> 更多 -> 加载字数`（校验勾选态回显、开启后候选出现字数/响应时间、关闭后隐藏展示且无额外提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_load_word_count` 的入口、持久化、候选采集展示与排序语义，不改动换源提交、章节替换与目录加载链路。
  - 下一项：按优先级继续推进 `P4-seq191`（`change_source.xml / @+id/menu_load_info / 加载详情页`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq189`（`change_source.xml / @+id/menu_check_author / 校验作者`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq189`（`change_source.xml / @+id/menu_check_author / 校验作者`）：换源候选弹层“更多”菜单补齐 legado 同义 `checkable` 入口“校验作者”；开关状态持久化到同名键 `changeSourceCheckAuthor`，并在整书换源/单章换源共用弹层中按开关实时过滤候选作者匹配结果，保持“切换即生效、无额外提示”的状态流。
  - `P4-seq189` 差异点清单（实施前）：
    - legado `ChangeBookSourceDialog` 与 `ChangeChapterSourceDialog` 均在 `change_source.xml` 中提供 `menu_check_author(checkable)`，初始勾选态来自 `AppConfig.changeSourceCheckAuthor`；Flutter 侧此前缺少对应入口。
    - legado 点击 `menu_check_author` 会翻转 `changeSourceCheckAuthor` 并执行 `viewModel.refresh()`；Flutter 侧此前候选过滤固定按作者条件执行，无法按开关切换。
    - legado 偏好键名固定为 `changeSourceCheckAuthor`（默认 `false`）；Flutter 侧此前未持久化该配置，重进候选弹层无法回显状态。
  - `P4-seq189` 逐项对照清单（实施后）：
    - 入口：已同义（候选弹层“更多”菜单新增 `校验作者`，勾选态表达开关状态）。
    - 状态：已同义（开关状态持久化到 `changeSourceCheckAuthor`，重进候选弹层可回显）。
    - 异常：已同义（切换过程不追加成功/失败提示，保持静默状态流）。
    - 文案：已同义（固定“校验作者”，不做动态开关文案）。
    - 排版：已同义（入口承载于候选弹层“更多”菜单，与既有 `加载目录/换源间隔` 同层级）。
    - 交互触发：已同义（`阅读页 -> 换源候选弹层 -> 更多 -> 校验作者`；切换后候选列表实时按作者匹配过滤）。
    - 验证：手工路径 `阅读页(网络书) -> 顶部换源按钮(点击或长按) -> 候选弹层 -> 更多 -> 校验作者`（校验勾选态可切换并即时影响候选列表）；手工路径 `切换后关闭弹层并重新进入`（校验勾选态持久化回显）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_check_author` 的入口、持久化与候选过滤语义，不改动刷新列表、加载目录、候选提交与章节替换链路。
  - 下一项：按优先级继续推进 `P4-seq190`（`change_source.xml / @+id/menu_load_word_count / 加载字数`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq186`（`change_source.xml / @+id/menu_start_stop / 停止`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq186`（`change_source.xml / @+id/menu_start_stop / 停止`）：换源候选弹层补齐 legado 同义“刷新/停止”同入口状态机；空闲态显示“刷新”，执行中切换为“停止（停止中）”，点击可中断当前换源候选搜索；整书换源与单章换源复用同一入口；请求链路补齐 `cancelToken` 透传，停止动作可取消进行中的搜索/详情/目录抓取请求并回落到稳定状态。
  - `P4-seq186` 差异点清单（实施前）：
    - legado `ChangeBookSourceDialog` 与 `ChangeChapterSourceDialog` 均处理 `menu_start_stop -> startOrStopSearch()`，并通过 `searchStateData` 将菜单文案在“停止/刷新”间切换；Flutter 侧此前无对应入口，仅有“刷新列表”。
    - legado 运行中再次点击同一入口会执行 `stopSearch()` 取消任务；Flutter 侧此前刷新请求不可主动停止，只能等待 Future 结束。
    - legado 取消后状态会立即回落到非运行态；Flutter 侧此前请求层未透传取消信号，难以对进行中的网络请求生效。
  - `P4-seq186` 逐项对照清单（实施后）：
    - 入口：已同义（候选弹层顶栏新增“刷新/停止”同入口动作；整书换源与单章换源均可见）。
    - 状态：已同义（空闲态为“刷新”；执行中为“停止”，触发停止后显示“停止中”并在任务结束后回落）。
    - 异常：已同义（停止/失败均保持当前候选列表且不追加扩展提示；关闭弹层时主动取消未完成任务）。
    - 文案：已同义（动作文案按运行态切换“刷新/停止/停止中”）。
    - 排版：已同义（入口承载于候选弹层顶栏动作区，与 `menu_start_stop` 的工具栏动作位语义同层）。
    - 交互触发：已同义（`阅读页 -> 换源候选弹层 -> 刷新(启动) -> 停止`）。
    - 验证：手工路径 `阅读页(网络书) -> 顶部换源按钮(点击或长按) -> 候选弹层 -> 刷新 -> 停止`（校验按钮状态在“刷新/停止/停止中”间切换，停止后可继续再次刷新）；手工路径 `候选搜索进行中点击取消关闭弹层`（校验任务被取消且无额外提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_start_stop` 的状态机与取消链路，不改动既有换源成功提交、章节匹配与书源管理跳转语义。
  - 下一项：按优先级继续推进 `P4-seq189`（`change_source.xml / @+id/menu_check_author / 校验作者`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq185`（`change_source.xml / @+id/menu_screen / 筛选`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq185`（`change_source.xml / @+id/menu_screen / 筛选`）：换源候选弹层补齐 legado 同义“筛选”动作位；筛选输入改为“顶栏筛选入口触发后展开”，展开时隐藏标题区，收起时恢复标题区并清空筛选词；输入后继续按“书源名 / 最新章节”实时过滤候选列表。
  - `P4-seq185` 差异点清单（实施前）：
    - legado `ChangeBookSourceDialog` / `ChangeChapterSourceDialog` 将 `menu_screen` 作为工具栏 `SearchView` 动作位承载，点击筛选后清空标题区，关闭筛选后恢复标题区；Flutter 侧此前将筛选框常驻在内容区，缺少动作位入口与状态切换。
    - legado `viewModel.screen(newText)` 在输入变化时即时执行筛选；其查询语义由 `SearchBookDao.changeSourceSearch` 定义为匹配 `originName` 与 `latestChapterTitle`。Flutter 侧虽具备同字段过滤，但缺少与 `menu_screen` 对应的入口层级证据。
    - 由于缺少动作位触发路径，`seq185` 在队列中持续 `pending`，与当前执行顺序（`seq161 -> seq185`）存在迁移证据缺口。
  - `P4-seq185` 逐项对照清单（实施后）：
    - 入口：已同义（候选弹层顶栏新增“筛选”动作位，对齐 legado `menu_screen` 工具栏入口语义）。
    - 状态：已同义（点击“筛选”后展开输入框并隐藏标题区；收起后恢复标题区且清空筛选词）。
    - 异常：已同义（空筛选词回退全量候选；无匹配时维持“无匹配候选”空态，不追加扩展提示）。
    - 文案：已同义（入口文案固定“筛选”，输入占位收敛为“筛选”）。
    - 排版：已同义（筛选输入从常驻内容区改为动作位触发展开，符合 legado 顶栏动作承载层级）。
    - 交互触发：已同义（`阅读页 -> 换源候选弹层 -> 筛选 -> 输入关键词` 实时过滤，关键词匹配书源名与最新章节）。
    - 验证：手工路径 `阅读页(网络书) -> 顶部换源按钮(点击或长按) -> 候选弹层 -> 筛选 -> 输入书源名关键词`（校验列表即时过滤且标题区隐藏）；手工路径 `筛选框点击清除并再次收起`（校验标题区恢复、列表回到全量候选）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_screen` 入口层级与筛选状态流，不改动换源搜索、目录加载与书源管理跳转链路。
  - 下一项：按优先级继续推进 `P4-seq186`（`change_source.xml / @+id/menu_start_stop / 停止`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq161`（`book_source_sel.xml / @+id/menu_check_selected_interval / 选中所选区间`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq161`（`book_source_sel.xml / @+id/menu_check_selected_interval / 选中所选区间`）：书源管理多选“更多”菜单“选中所选区间”动作按 legado 语义完成收口；点击后以当前列表中已选项的最小/最大索引扩展连续选区并更新底栏计数，全程保持静默，不追加成功或失败提示。
  - `P4-seq161` 差异点清单（实施前）：
    - legado `BookSourceActivity.onMenuItemClick(menu_check_selected_interval)` 直接调用 `adapter.checkSelectedInterval()`；该动作属于纯选中态扩展，不触发写库、不弹提示。
    - legado `BookSourceAdapter.checkSelectedInterval()` 以当前 `adapter.getItems()` 为基准，计算选中项索引区间 `[min,max]` 并将区间内条目全部加入选中集合，随后刷新该区间并更新计数。
    - Flutter 侧 `SourceListView._expandSelectionInterval()` 行为已与上述语义同义，但该序号尚未完成台账/ExecPlan 验收回填，存在“实现已到位、迁移证据缺失”的执行差异。
  - `P4-seq161` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理多选模式底栏“省略号 -> 选中所选区间”）。
    - 状态：已同义（按当前可见列表中已选条目的最小/最大索引扩展为连续选区）。
    - 异常：已同义（动作本身不追加提示；无可见选中时“更多”入口禁用，不触发扩展动作）。
    - 文案：已同义（菜单文案固定“选中所选区间”）。
    - 排版：已同义（入口继续承载于多选底栏 `CupertinoActionSheet` 的“批量操作”层级）。
    - 交互触发：已同义（`书源管理 -> 多选模式 -> 省略号 -> 选中所选区间`）。
    - 验证：手工路径 `书源管理 -> 多选模式至少勾选 2 个非连续书源 -> 省略号 -> 选中所选区间`（校验最小与最大选中位置间条目全部被选中且无额外提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_check_selected_interval` 的迁移验收与证据回填，不改动书源存储、排序、校验与导出链路。
  - 下一项：按优先级继续推进 `P4-seq185`（`change_source.xml / @+id/menu_screen / 筛选`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq160`（`book_source_sel.xml / @+id/menu_check_source / 校验所选`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq160`（`book_source_sel.xml / @+id/menu_check_source / 校验所选`）：书源管理多选“更多”菜单“校验所选”动作收敛 legado 同义语义；关键词弹窗改为“搜索关键词”并保留同层“校验设置”入口，点击“校验设置”时不关闭关键词弹窗；开始校验后仅通过顶部任务条与列表状态展示进度，不追加“已开始校验”扩展提示。
  - `P4-seq160` 差异点清单（实施前）：
    - legado `BookSourceActivity.menu_check_source -> checkSource()` 的关键词弹窗内，`校验设置` 为同层级入口（通过手动点击监听打开配置）且不会关闭当前关键词弹窗；Flutter 侧此前点击“校验设置”会先关闭关键词弹窗再进入设置，交互路径偏离。
    - legado 开始校验后通过 `CHECK_SOURCE` 事件持续刷新进度（Snackbar + 列表项状态），入口动作本身不追加“已开始校验”提示；Flutter 侧此前会弹“已开始校验（N 条）”扩展提示，状态流偏离。
    - legado 在已有任务执行时统一提示“已有书源在校验,等完成后再试”；Flutter 侧此前同配置场景提示“已恢复正在进行的检测任务”，口径偏离。
  - `P4-seq160` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理多选模式底栏“省略号 -> 校验所选”）。
    - 状态：已同义（开始校验后不弹“已开始校验”提示，仅由任务条与条目状态呈现进度）。
    - 异常：已同义（运行中重复触发统一提示“已有书源在校验,等完成后再试”；空选中场景静默 no-op）。
    - 文案：已同义（关键词弹窗标题收敛为“搜索关键词”；完成后自动筛选提示收敛为“发现有失效书源，已为您自动筛选！”）。
    - 排版：已同义（关键词弹窗与“校验设置”保持同层结构，设置弹窗关闭后返回原关键词弹窗，不改变层级）。
    - 交互触发：已同义（`书源管理 -> 多选模式 -> 省略号 -> 校验所选 -> 校验设置/开始校验`）。
    - 验证：手工路径 `书源管理 -> 多选模式选择至少 1 个书源 -> 省略号 -> 校验所选 -> 校验设置 -> 返回关键词弹窗 -> 开始校验`（校验设置打开时关键词弹窗不关闭，开始后无“已开始校验”提示）；手工路径 `校验进行中再次触发校验所选`（校验提示口径为“已有书源在校验,等完成后再试”）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_check_source` 的弹窗交互层级、提示口径与启动状态流，不改动校验服务规则、书源分组判定与导出链路。
  - 下一项：按优先级继续推进 `P4-seq161`（`book_source_sel.xml / @+id/menu_check_selected_interval / 选中所选区间`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq159`（`book_source_sel.xml / @+id/menu_share_source / 分享选中源`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq159`（`book_source_sel.xml / @+id/menu_share_source / 分享选中源`）：书源管理多选“更多”菜单“分享选中源”动作收敛 legado 同义语义；点击后沿用与“导出所选”一致的导出集合规则生成临时 JSON 并直接拉起系统文件分享，不追加“已打开系统分享/复制 JSON 兜底”等扩展提示与分支。
  - `P4-seq159` 差异点清单（实施前）：
    - legado `BookSourceActivity.onMenuItemClick(menu_share_source)` 直接执行 `viewModel.saveToFile(...) { share(it) }`；与 `menu_export_selection` 复用同一导出集合规则，随后调用 `Context.share(file)` 触发系统文件分享。
    - legado `BookSourceViewModel.saveToFile` 固定写入 `filesDir/shareBookSource.json`；失败仅走 `toast(stackTrace)` 可观测分支，不追加“分享成功/失败兜底复制”扩展状态流。
    - Flutter 侧此前入口文案为“分享所选”，分享时附带 `text/subject` 扩展参数并在成功后提示“已打开系统分享（N 条书源）”；失败时会退化为复制 JSON 到剪贴板并提示，用户可见状态流偏离 legado。
  - `P4-seq159` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理多选模式底栏“省略号 -> 分享选中源”）。
    - 状态：已同义（复用导出集合规则生成分享文件并直接调用系统分享，不追加额外分享文本与成功提示）。
    - 异常：已同义（分享异常静默吞掉，不再回退到“复制 JSON + 提示”扩展分支）。
    - 文案：已同义（动作文案由“分享所选”收敛为“分享选中源”）。
    - 排版：已同义（入口承载在多选底栏 `CupertinoActionSheet` 的“批量操作”层级，平台差异可接受）。
    - 交互触发：已同义（`书源管理 -> 多选模式 -> 省略号 -> 分享选中源`）。
    - 验证：手工路径 `书源管理 -> 多选模式选择至少 1 个书源 -> 省略号 -> 分享选中源`（校验可直接拉起系统分享面板且过程无额外提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_share_source` 的入口文案与分享状态流，不改动导出所选集合规则、校验与分组链路。
  - 下一项：按优先级继续推进 `P4-seq160`（`book_source_sel.xml / @+id/menu_check_source / 校验所选`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq157`（`book_source_sel.xml / @+id/menu_bottom_sel / 置底所选`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq157`（`book_source_sel.xml / @+id/menu_bottom_sel / 置底所选`）：书源管理多选“更多”菜单“置底所选”动作收敛 legado 同义语义；点击后按当前选中集合批量置底并静默写库，不追加“已置底 N 条书源/当前未选择书源”等扩展提示。
  - `P4-seq157` 差异点清单（实施前）：
    - legado `BookSourceActivity.onMenuItemClick(menu_bottom_sel)` 直接执行 `viewModel.bottomSource(*adapter.selection.toTypedArray())`，动作链路无成功提示或兜底提示分支。
    - legado `BookSourceViewModel.bottomSource` 先按 `customOrder` 升序排序，再以 `maxOrder + 1 + index` 批量写回 `customOrder`，并调用 `bookSourceDao.upOrder(array)` 持久化。
    - Flutter 侧此前批量菜单文案为“置底”，且复用 `_batchMoveToTopBottom(..., false)`；动作结束后会追加“已置底 N 条书源”提示，空选中场景还会提示“当前未选择书源”，用户可见状态流偏离 legado。
  - `P4-seq157` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理多选模式底栏“省略号 -> 置底所选”）。
    - 状态：已同义（点击后按当前选中集合批量置底，顺序规则保持 `customOrder` 升序后分配最大序号）。
    - 异常：已同义（无选中时“更多”按钮禁用；执行过程无扩展提示）。
    - 文案：已同义（动作文案收敛为“置底所选”）。
    - 排版：已同义（入口承载在多选底栏 `CupertinoActionSheet` 的“批量操作”层级，平台差异可接受）。
    - 交互触发：已同义（`书源管理 -> 多选模式 -> 省略号 -> 置底所选`）。
    - 验证：手工路径 `书源管理 -> 多选模式选择至少 2 个书源 -> 省略号 -> 置底所选 -> 返回列表底部观察顺序`（校验所选书源被批量置底且执行过程无额外提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_bottom_sel` 的静默批量置底语义，不改动 `menu_share_source`（`seq159`）、校验与分组链路。
  - 下一项：按优先级继续推进 `P4-seq159`（`book_source_sel.xml / @+id/menu_share_source / 分享选中源`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq156`（`book_source_sel.xml / @+id/menu_top_sel / 置顶所选`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq156`（`book_source_sel.xml / @+id/menu_top_sel / 置顶所选`）：书源管理多选“更多”菜单“置顶所选”动作收敛 legado 同义语义；点击后按当前选中集合批量置顶并静默写库，不追加“已置顶 N 条书源/当前未选择书源”等扩展提示。
  - `P4-seq156` 差异点清单（实施前）：
    - legado `BookSourceActivity.onMenuItemClick(menu_top_sel)` 直接执行 `viewModel.topSource(*adapter.selection.toTypedArray())`，动作链路无成功提示或兜底提示分支。
    - legado `BookSourceViewModel.topSource` 先按 `customOrder` 升序排序，再以 `minOrder - 1 - index` 批量写回 `customOrder`，并调用 `bookSourceDao.upOrder(array)` 持久化。
    - Flutter 侧此前“置顶”复用 `_batchMoveToTopBottom(..., true)`，动作结束后会追加“已置顶 N 条书源”提示；空选中场景还会提示“当前未选择书源”，用户可见状态流偏离 legado。
  - `P4-seq156` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理多选模式底栏“省略号 -> 置顶所选”）。
    - 状态：已同义（点击后按当前选中集合批量置顶，顺序规则保持 `customOrder` 升序后分配最小序号）。
    - 异常：已同义（无选中时“更多”按钮禁用；执行过程无扩展提示）。
    - 文案：已同义（动作文案收敛为“置顶所选”）。
    - 排版：已同义（入口承载在多选底栏 `CupertinoActionSheet` 的“批量操作”层级，平台差异可接受）。
    - 交互触发：已同义（`书源管理 -> 多选模式 -> 省略号 -> 置顶所选`）。
    - 验证：手工路径 `书源管理 -> 多选模式选择至少 2 个书源 -> 省略号 -> 置顶所选 -> 返回列表顶部观察顺序`（校验所选书源被批量置顶且执行过程无额外提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_top_sel` 的静默批量置顶语义，不改动 `menu_bottom_sel`（`seq157`）、分组、导出与校验链路。
  - 下一项：按优先级继续推进 `P4-seq157`（`book_source_sel.xml / @+id/menu_bottom_sel / 置底所选`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq155`（`book_source_sel.xml / @+id/menu_disable_explore / 禁用发现`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq155`（`book_source_sel.xml / @+id/menu_disable_explore / 禁用发现`）：书源管理多选“更多”菜单“禁用发现”动作收敛 legado 同义语义；点击后按当前选中集合批量写入 `enabledExplore=false`，不筛选已禁用项，不追加“已禁用 N 条书源的发现/已全部禁用”等扩展提示。
  - `P4-seq155` 差异点清单（实施前）：
    - legado `BookSourceActivity.onMenuItemClick(menu_disable_explore)` 直接执行 `viewModel.disableSelectExplore(adapter.selection)`，动作链路无成功提示或兜底提示分支。
    - legado `BookSourceViewModel.disableSelectExplore` 直连 `bookSourceDao.enableExplore(false, sources)`；`BookSourceDao.enableExplore(enable, bookSources)` 对选中集合逐项写库，不过滤已禁用项。
    - Flutter 侧此前“禁用发现”复用 `_batchSetExplore(..., false)`，会先过滤已禁用项并追加“所选书源发现已全部禁用/已禁用 N 条书源的发现”提示，用户可见状态流偏离 legado。
  - `P4-seq155` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理多选模式底栏“省略号 -> 禁用发现”）。
    - 状态：已同义（点击后按当前选中集合批量写入 `enabledExplore=false`；已禁用项保持禁用且不改动其它字段）。
    - 异常：已同义（无选中时“更多”按钮禁用；执行过程无扩展提示）。
    - 文案：已同义（动作文案固定“禁用发现”）。
    - 排版：已同义（入口承载在多选底栏 `CupertinoActionSheet` 的“批量操作”层级，平台差异可接受）。
    - 交互触发：已同义（`书源管理 -> 多选模式 -> 省略号 -> 禁用发现`）。
    - 验证：手工路径 `书源管理 -> 多选模式选择至少 1 个已启用发现书源 -> 省略号 -> 禁用发现 -> 重新打开条目菜单`（校验目标书源切换为禁用发现且执行过程无额外提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_disable_explore` 的静默批量禁用语义，不改动 `menu_top_sel`（`seq156`）、分组、导出与校验链路。
  - 下一项：按优先级继续推进 `P4-seq156`（`book_source_sel.xml / @+id/menu_top_sel / 置顶所选`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq154`（`book_source_sel.xml / @+id/menu_enable_explore / 启用发现`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq154`（`book_source_sel.xml / @+id/menu_enable_explore / 启用发现`）：书源管理多选“更多”菜单“启用发现”动作收敛 legado 同义语义；点击后按当前选中集合批量写入 `enabledExplore=true`，不筛选已启用项，不追加“已启用 N 条书源的发现/已全部启用”等扩展提示。
  - `P4-seq154` 差异点清单（实施前）：
    - legado `BookSourceActivity.onMenuItemClick(menu_enable_explore)` 直接执行 `viewModel.enableSelectExplore(adapter.selection)`，动作链路无成功提示或兜底提示分支。
    - legado `BookSourceViewModel.enableSelectExplore` 直连 `bookSourceDao.enableExplore(true, sources)`；`BookSourceDao.enableExplore(enable, bookSources)` 对选中集合逐项写库，不过滤已启用项。
    - Flutter 侧此前“启用发现”复用 `_batchSetExplore(..., true)`，会先过滤已启用项并追加“所选书源发现已全部启用/已启用 N 条书源的发现”提示，用户可见状态流偏离 legado。
  - `P4-seq154` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理多选模式底栏“省略号 -> 启用发现”）。
    - 状态：已同义（点击后按当前选中集合批量写入 `enabledExplore=true`；已启用项保持启用且不改动其它字段）。
    - 异常：已同义（无选中时“更多”按钮禁用；执行过程无扩展提示）。
    - 文案：已同义（动作文案固定“启用发现”）。
    - 排版：已同义（入口承载在多选底栏 `CupertinoActionSheet` 的“批量操作”层级，平台差异可接受）。
    - 交互触发：已同义（`书源管理 -> 多选模式 -> 省略号 -> 启用发现`）。
    - 验证：手工路径 `书源管理 -> 多选模式选择至少 1 个未启用发现书源 -> 省略号 -> 启用发现 -> 重新打开条目菜单`（校验目标书源切换为启用发现且执行过程无额外提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_enable_explore` 的静默批量启用语义，不改动 `menu_disable_explore`（`seq155`）、分组、导出与校验链路。
  - 下一项：按优先级继续推进 `P4-seq155`（`book_source_sel.xml / @+id/menu_disable_explore / 禁用发现`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq153`（`book_source_sel.xml / @+id/menu_remove_group / 移除分组`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq153`（`book_source_sel.xml / @+id/menu_remove_group / 移除分组`）：书源管理多选“更多”菜单“移除分组”动作收敛 legado 同义语义；点击后弹出“移除分组”输入框，确认非空输入后按当前选中集合批量移除对应分组，不追加“当前未选择书源/已从 N 条书源移除分组”等扩展提示。
  - `P4-seq153` 差异点清单（实施前）：
    - legado `BookSourceActivity.menu_remove_group` 触发 `selectionRemoveFromGroups()`：弹窗标题固定 `remove_group`（“移除分组”），输入框支持已存在分组候选；确认时仅在输入 `isNotEmpty` 时调用 `viewModel.selectionRemoveFromGroups(adapter.selection, group)`，动作本身无成功或兜底提示。
    - legado `BookSourceViewModel.selectionRemoveFromGroups` 仅执行“按选中集合复制并 `removeGroup(groups)` 后批量 `upGroup`”的静默状态写入，不附加“无选中/成功”提示分支。
    - Flutter 侧此前 `_batchRemoveGroup` 在“无选中”场景弹“当前未选择书源”，成功后弹“已从 N 条书源移除分组”，用户可见状态流偏离 legado。
  - `P4-seq153` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理多选模式底栏“省略号 -> 移除分组”）。
    - 状态：已同义（确认非空分组输入后，对当前选中集合批量移除对应分组；未命中的分组保持原值）。
    - 异常：已同义（无选中、取消输入、空输入场景均静默 no-op，不追加扩展提示）。
    - 文案：已同义（动作文案与弹窗标题统一为“移除分组”）。
    - 排版：已同义（入口承载在多选底栏 `CupertinoActionSheet` 的“批量操作”层级，输入弹窗保留分组候选 chips）。
    - 交互触发：已同义（`书源管理 -> 多选模式 -> 省略号 -> 移除分组 -> 输入分组并确定`）。
    - 验证：手工路径 `书源管理 -> 多选模式选择至少 1 个带分组书源 -> 省略号 -> 移除分组 -> 输入已存在分组并确定 -> 重新打开条目菜单`（校验目标书源对应分组已移除且执行过程无额外提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_remove_group` 的静默状态流，不改动添加分组、发现开关、导出与校验链路。
  - 下一项：按优先级继续推进 `P4-seq154`（`book_source_sel.xml / @+id/menu_enable_explore / 启用发现`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq152`（`book_source_sel.xml / @+id/menu_add_group / 添加分组`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq152`（`book_source_sel.xml / @+id/menu_add_group / 添加分组`）：书源管理多选“更多”菜单“添加分组”动作收敛 legado 同义语义；入口文案由“加入分组”收敛为“添加分组”，点击后弹出分组输入框并按当前选中集合批量追加分组，不追加“当前未选择书源/已加入分组”等扩展提示。
  - `P4-seq152` 差异点清单（实施前）：
    - legado `BookSourceActivity.menu_add_group` 触发 `selectionAddToGroups()`：弹窗标题固定 `add_group`（“添加分组”），输入框支持已存在分组候选；确认时仅在输入 `isNotEmpty` 时调用 `viewModel.selectionAddToGroups(adapter.selection, group)`，动作本身无成功或兜底提示。
    - Flutter 侧此前批量菜单文案与输入弹窗标题均为“加入分组”，且 `_batchAddGroup` 在“无选中”与“成功写入”后会追加提示，用户可见状态流偏离 legado。
  - `P4-seq152` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理多选模式底栏“省略号 -> 添加分组”）。
    - 状态：已同义（确认非空分组输入后，对当前选中集合批量追加分组并写库；重复分组保持去重）。
    - 异常：已同义（无选中时保持静默 no-op；取消输入或空输入不落库且无额外提示）。
    - 文案：已同义（动作与弹窗标题统一为“添加分组”）。
    - 排版：已同义（入口承载在多选底栏 `CupertinoActionSheet` 的“批量操作”层级，输入弹窗保留分组候选 chips）。
    - 交互触发：已同义（`书源管理 -> 多选模式 -> 省略号 -> 添加分组 -> 输入分组并确定`）。
    - 验证：手工路径 `书源管理 -> 多选模式选择至少 1 个书源 -> 省略号 -> 添加分组 -> 输入分组名并确定 -> 重新打开条目菜单`（校验目标书源分组已追加且执行过程无额外提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_add_group` 的入口文案与静默状态流，不改动移除分组、发现开关、导出与校验链路。
  - 下一项：按优先级继续推进 `P4-seq153`（`book_source_sel.xml / @+id/menu_remove_group / 移除分组`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq151`（`book_source_sel.xml / @+id/menu_disable_selection / 禁用所选`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq151`（`book_source_sel.xml / @+id/menu_disable_selection / 禁用所选`）：书源管理多选“更多”菜单“禁用所选”动作收敛 legado 同义静默批量禁用语义；点击后按当前选中集合批量写入 `enabled=false`，不追加“已禁用 N 条书源/所选书源已全部禁用”等扩展提示。
  - `P4-seq151` 差异点清单（实施前）：
    - legado `BookSourceActivity.menu_disable_selection` 仅执行 `viewModel.disableSelection(adapter.selection)`；`BookSourceViewModel.disableSelection` 直连 `bookSourceDao.enable(false, sources)`，动作本身无成功提示。
    - Flutter 侧此前“禁用所选”复用 `_batchSetEnabled(..., false)`，会先过滤已禁用项并追加结果提示，用户可见状态流偏离 legado 静默语义。
  - `P4-seq151` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理多选模式底栏“省略号 -> 禁用所选”）。
    - 状态：已同义（点击后按当前选中集合批量写入 `enabled=false`；已禁用项保持禁用且不改动其它字段）。
    - 异常：已同义（无选中时“更多”按钮禁用；执行过程不追加扩展异常提示）。
    - 文案：已同义（动作文案固定“禁用所选”；执行结果不追加扩展文案）。
    - 排版：已同义（入口继续承载在多选底栏 `CupertinoActionSheet` 的“批量操作”层级，平台差异可接受）。
    - 交互触发：已同义（`书源管理 -> 多选模式 -> 省略号 -> 禁用所选`）。
    - 验证：手工路径 `书源管理 -> 多选模式选择至少 1 个已启用书源 -> 省略号 -> 禁用所选 -> 重新打开条目菜单`（校验目标书源切换为禁用态且执行过程无额外提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_disable_selection` 的提示边界与批量禁用状态流，不改动启用所选、分组、导出与校验链路。
  - 下一项：按优先级继续推进 `P4-seq152`（`book_source_sel.xml / @+id/menu_add_group / 添加分组`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq150`（`book_source_sel.xml / @+id/menu_enable_selection / 启用所选`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq150`（`book_source_sel.xml / @+id/menu_enable_selection / 启用所选`）：书源管理多选“更多”菜单“启用所选”动作收敛 legado 同义静默批量启用语义；点击后按当前选中集合批量写入 `enabled=true`，不追加“已启用 N 条书源/所选书源已全部启用”等扩展提示。
  - `P4-seq150` 差异点清单（实施前）：
    - legado `BookSourceActivity.menu_enable_selection` 仅执行 `viewModel.enableSelection(adapter.selection)`；`BookSourceViewModel.enableSelection` 直连 `bookSourceDao.enable(true, sources)`，动作本身无成功提示。
    - Flutter 侧此前“启用所选”复用 `_batchSetEnabled(..., true)`，会先过滤已启用项并追加结果提示，用户可见状态流偏离 legado 静默语义。
  - `P4-seq150` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理多选模式底栏“省略号 -> 启用所选”）。
    - 状态：已同义（点击后按当前选中集合批量写入 `enabled=true`；已启用项保持启用且不改动其它字段）。
    - 异常：已同义（无选中时“更多”按钮禁用；执行过程不追加扩展异常提示）。
    - 文案：已同义（动作文案固定“启用所选”；执行结果不追加扩展文案）。
    - 排版：已同义（入口继续承载在多选底栏 `CupertinoActionSheet` 的“批量操作”层级，平台差异可接受）。
    - 交互触发：已同义（`书源管理 -> 多选模式 -> 省略号 -> 启用所选`）。
    - 验证：手工路径 `书源管理 -> 多选模式选择至少 1 个未启用书源 -> 省略号 -> 启用所选 -> 重新打开条目菜单`（校验目标书源切换为启用态且执行过程无额外提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_enable_selection` 的提示边界与批量启用状态流，不改动禁用所选、分组、导出与校验链路。
  - 下一项：按优先级继续推进 `P4-seq151`（`book_source_sel.xml / @+id/menu_disable_selection / 禁用所选`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq368`（`source_picker.xml / @+id/menu_change_source_delay / 换源间隔`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq368`（`source_picker.xml / @+id/menu_change_source_delay / 换源间隔`）：换源候选弹层“更多”菜单补齐 legado 同义“换源间隔”入口；点击后弹出 `0~9999` 秒数值选择并持久化到全局键 `batchChangeSourceDelay`，菜单动作本身不触发候选刷新；后续整书换源/单章换源与详情页换源的逐源搜索按该秒数串行间隔执行。
  - `P4-seq368` 差异点清单（实施前）：
    - legado `SourcePickerDialog.menu_change_source_delay` 点击后通过 `NumberPickerDialog`（`min=0/max=9999`）回写 `AppConfig.batchChangeSourceDelay`；`BookshelfManageViewModel.changeSource` 在批量换源循环中按该值（秒）执行延迟。
    - Flutter 侧此前缺少 `batchChangeSourceDelay` 全局键与对应菜单入口，换源候选搜索在多书源循环中连续触发，无法配置换源间隔。
  - `P4-seq368` 逐项对照清单（实施后）：
    - 入口：已同义（换源候选弹层“更多”新增“换源间隔（N秒）”；详情页换源候选弹层同步可见）。
    - 状态：已同义（可在 `0~9999` 秒范围内选择并持久化到 `batchChangeSourceDelay`；重进弹层可回显）。
    - 异常：已同义（取消选择不改配置；越界输入在持久化前按 `0~9999` 夹取，不追加扩展提示）。
    - 文案：已同义（动作文案固定“换源间隔”，单位“秒”）。
    - 排版：已同义（入口承载在候选弹层“更多”层级，采用 `Cupertino` 数值滚轮承载，平台差异可接受）。
    - 交互触发：已同义（`阅读页 -> 换源候选弹层 -> 更多 -> 换源间隔`；`书籍详情页 -> 换源候选弹层 -> 更多 -> 换源间隔`）。
    - 验证：手工路径 `阅读页(网络书) -> 顶部换源按钮点击或长按 -> 整书换源/单章换源 -> 候选弹层 -> 更多 -> 换源间隔`（校验可选择秒数并持久化）；手工路径 `书籍详情页 -> 换源 -> 候选弹层 -> 更多 -> 换源间隔`（校验同一全局值回显）；重复触发换源（校验逐源搜索按配置秒数间隔串行执行）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_change_source_delay` 配置与换源搜索间隔语义，不改动换源匹配规则、目录抓取与结果提交流程。
  - 下一项：按优先级继续推进 `P4-seq150`（`book_source_sel.xml / @+id/menu_enable_selection / 启用所选`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq366`（`source_login.xml / @+id/menu_del_login_header / 删除登录头`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq366`（`source_login.xml / @+id/menu_del_login_header / 删除登录头`）：登录表单承载页“更多”菜单补齐 legado 同义“删除登录头”入口；点击后静默清理当前书源 `loginHeader_<sourceKey>` 缓存，并按书源 URL 作用域清理 Cookie，不触发保存、不跳转、不追加成功或失败提示。
  - `P4-seq366` 差异点清单（实施前）：
    - legado `SourceLoginDialog.menu_del_login_header` 点击后直接执行 `source.removeLoginHeader()`；`BaseSource.removeLoginHeader()` 同步删除 `loginHeader_<getKey()>` 缓存与该 key 对应 Cookie，属于静默状态清理动作。
    - Flutter `SourceLoginFormView` 此前“更多”菜单仅有“查看登录头”，缺少 `menu_del_login_header` 入口，无法在登录页内删除登录头缓存并清理登录态 Cookie。
  - `P4-seq366` 逐项对照清单（实施后）：
    - 入口：已同义（登录表单页“更多”菜单新增“删除登录头”）。
    - 状态：已同义（点击后删除 `loginHeader_<sourceKey>`，并按 `SourceCookieScopeResolver.resolveClearCandidates` 清理该书源 URL 作用域 Cookie）。
    - 异常：已同义（书源键为空或 Cookie 清理失败时静默返回，不追加扩展提示）。
    - 文案：已同义（动作文案固定“删除登录头”）。
    - 排版：已同义（入口承载在登录页右上角 `CupertinoActionSheet` 的“更多”层级，平台差异可接受）。
    - 交互触发：已同义（`书源管理/搜索/发现/阅读 -> 触发登录表单页 -> 右上角更多 -> 删除登录头`）。
    - 验证：手工路径 `书源管理 -> 新建或编辑任一书源 -> 右上角更多 -> 登录(表单) -> 右上角更多 -> 删除登录头 -> 查看登录头`（校验删除后“登录头”弹窗仅显示标题，且全流程无额外提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_del_login_header` 的静默删除语义，不改动登录脚本执行、书源保存结构与其它菜单流程。
  - 下一项：按优先级继续推进 `P4-seq368`（`source_picker.xml / @+id/menu_change_source_delay / 换源间隔`；`P4-seq367` 属于 `detail_later` 后置项）。
  - 状态变更：完成 `P4-seq365`（`source_login.xml / @+id/menu_show_login_header / 查看登录头`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq365`（`source_login.xml / @+id/menu_show_login_header / 查看登录头`）：登录表单承载页补齐 legado 同义“更多 -> 查看登录头”入口；点击后按当前书源键读取登录头缓存并弹出“登录头”只读对话框，有缓存时展示原始文本并提供“复制文本”动作，无缓存时仅展示标题，不触发保存/登录/跳转副作用。
  - `P4-seq365` 差异点清单（实施前）：
    - legado `SourceLoginDialog` 在 `source_login.xml` 中提供 `menu_show_login_header`，点击后执行 `alert { title=login_header; source.getLoginHeader()?.let { setMessage(it); positiveButton(copy_text){sendToClip(it)} } }`，属于登录页内的只读查看动作。
    - Flutter `SourceLoginFormView` 之前仅有“完成”按钮，缺少与 `source_login.xml` 同层级的“查看更多动作”入口，无法在登录页内查看当前登录头缓存。
  - `P4-seq365` 逐项对照清单（实施后）：
    - 入口：已同义（登录表单页右上角补齐“更多”菜单并包含“查看登录头”）。
    - 状态：已同义（点击后弹出“登录头”对话框；有缓存展示原始文本并可复制，无缓存仅标题）。
    - 异常：已同义（书源键为空或缓存缺失时保持只读空态，不新增扩展错误提示）。
    - 文案：已同义（菜单文案“查看登录头”；对话框标题“登录头”；复制动作“复制文本”）。
    - 排版：已同义（入口位于登录表单页顶栏“更多”动作层级，承载为 `CupertinoActionSheet + CupertinoAlertDialog`，平台差异可接受）。
    - 交互触发：已同义（`书源管理/搜索/发现/阅读 -> 触发登录表单页 -> 右上角更多 -> 查看登录头`）。
    - 验证：手工路径 `书源管理 -> 新建或编辑任一书源 -> 右上角更多 -> 登录(表单) -> 右上角更多 -> 查看登录头`（校验弹窗标题“登录头”，有缓存时显示原始 JSON 且“复制文本”可写入剪贴板）；手工路径 `无登录头缓存时重复上述步骤`（校验仅显示标题且不触发额外提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_show_login_header` 的查看与复制语义，不改动登录脚本执行、Cookie 持久化及书源保存结构。
  - 下一项：按优先级继续推进 `P4-seq366`（`source_login.xml / @+id/menu_del_login_header / 删除登录头`）。
  - 状态变更：完成 `P4-seq360`（`source_edit.xml / @+id/menu_qr_code_camera / 二维码导入`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq360`（`source_edit.xml / @+id/menu_qr_code_camera / 二维码导入`）：书源编辑页“更多”菜单收敛 legado 同义“二维码导入”动作；点击后进入扫码承载页并在识别成功后仅回填当前编辑表单，不触发保存、不重置已保存快照、不追加成功提示，对齐 legado `qrCodeResult.launch -> importSource -> upSourceView` 状态流。
  - `P4-seq360` 差异点清单（实施前）：
    - legado `BookSourceEditActivity.menu_qr_code_camera` 仅触发扫码合同 `qrCodeResult.launch()`；扫码回调成功后执行 `importSource(result) -> upSourceView(source)`，语义为“仅回填表单，不落库且不提示成功”。
    - Flutter 侧此前入口文案为“扫码导入”，且扫码导入成功后会同步更新 `_savedSource/_savedSnapshot` 并弹“已从扫码内容载入书源”，导致导入后退出不再触发未保存确认，状态边界偏离 legado。
  - `P4-seq360` 逐项对照清单（实施后）：
    - 入口：已同义（书源编辑页“更多”菜单文案收敛为“二维码导入”）。
    - 状态：已同义（扫码成功仅回填编辑表单；不触发保存，不重置已保存快照，退出时仍按未保存修改确认）。
    - 异常：已同义（扫码取消直接返回；解析失败提示沿用导入错误摘要，空摘要回落 `Error`）。
    - 文案：已同义（菜单文案“二维码导入”；扫码页标题“扫描二维码”）。
    - 排版：已同义（入口继续承载在 `CupertinoActionSheet` 的“更多”菜单层级，平台差异可接受）。
    - 交互触发：已同义（`书源管理 -> 新建/编辑书源 -> 右上角更多 -> 二维码导入`）。
    - 验证：手工路径 `书源管理 -> 新建或编辑任一书源 -> 右上角更多 -> 二维码导入 -> 扫码载入`（校验扫码成功仅回填表单且无成功提示）；手工路径 `扫码载入后直接返回上一页`（校验仍弹“存在未保存修改，确认退出吗？”）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_qr_code_camera` 的入口文案与“仅回填不保存”状态边界，不改动书源导入解析器、存储结构与登录/Cookie 链路。
  - 下一项：按优先级继续推进 `P4-seq365`（`source_login.xml / @+id/menu_show_login_header / 查看登录头`）。
  - 状态变更：完成 `P4-seq354`（`source_edit.xml / @+id/menu_search / 搜索`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq354`（`source_edit.xml / @+id/menu_search / 搜索`）：书源编辑页“更多”菜单收敛 legado 同义“搜索”动作，点击后保持“先保存当前书源，再进入搜索页且范围锁定当前书源”的状态流；实现上将入口语义从“`SearchView.scoped(sourceUrls)` 间接推导范围”收敛为“先显式写入 `searchScope=SearchScope.fromSource(saved)` 再打开搜索页”，与 legado `SearchActivity(searchScope=SearchScope(source))` 对齐。
  - `P4-seq354` 差异点清单（实施前）：
    - legado `BookSourceEditActivity.menu_search` 明确执行 `save(getSource())` 成功后 `putExtra("searchScope", SearchScope(source).toString())` 跳转搜索页，scope 写入为入口侧显式行为。
    - Flutter 端此前虽然具备“先保存再跳转”主链路，但通过 `SearchView.scoped(sourceUrls)` 在搜索页内二次查库生成 scope，未在入口侧显式写入 `searchScope`，存在实现语义偏差。
  - `P4-seq354` 逐项对照清单（实施后）：
    - 入口：已同义（书源编辑页“更多”菜单保留“搜索”入口）。
    - 状态：已同义（点击“搜索”先保存；保存成功后显式写入 `searchScope` 并进入搜索页）。
    - 异常：已同义（保存失败时中断后续搜索跳转，不追加扩展提示）。
    - 文案：已同义（动作文案固定“搜索”）。
    - 排版：已同义（入口继续承载在 `CupertinoActionSheet` 的“更多”菜单层级，平台差异可接受）。
    - 交互触发：已同义（`书源管理 -> 新建/编辑书源 -> 右上角更多 -> 搜索`）。
    - 验证：手工路径 `书源管理 -> 新建或编辑任一书源 -> 修改书源名称/分组 -> 右上角更多 -> 搜索 -> 搜索页查看范围`（校验点击后先保存；进入搜索页范围显示为当前书源；返回编辑页后字段已保存）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_search` 的 scope 写入触发语义，不改动搜索执行引擎、书源持久化结构与登录/Cookie 链路。
  - 下一项：按优先级继续推进 `P4-seq360`（`source_edit.xml / @+id/menu_qr_code_camera / 二维码导入`）。
  - 状态变更：完成 `P4-seq353`（`source_edit.xml / @+id/menu_login / 登录`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq353`（`source_edit.xml / @+id/menu_login / 登录`）：书源编辑页“更多”菜单收敛 legado 同义“登录”入口；入口显隐保持“仅 `loginUrl` 非空显示”，点击动作保持“先保存再进入登录承载页”，并将分流判定收敛为与 legado 一致的 `loginUi` 非空/空值双分支。
  - `P4-seq353` 差异点清单（实施前）：
    - legado `BookSourceEditActivity.onMenuOpened` 使用 `getSource().loginUrl` 控制 `menu_login` 显隐，`menu_login` 点击语义固定为 `save(getSource()) -> SourceLoginActivity`；Flutter 侧虽有对应入口，但登录承载分流依赖 `parseRows(loginUi).isNotEmpty`，与 legado 的 `loginUi.isNullOrEmpty()` 判定口径不完全一致。
    - 在 `loginUi` 非空但不可解析/空数组场景，Flutter 会回落网页登录；legado 仍进入表单登录承载并由登录页内部处理字段解析，存在状态边界偏差。
  - `P4-seq353` 逐项对照清单（实施后）：
    - 入口：已同义（书源编辑页“更多”菜单仅在 `loginUrl` 非空时显示“登录”）。
    - 状态：已同义（点击“登录”先保存，再按 `loginUi` 非空/空值分流到表单登录/网页登录承载页）。
    - 异常：已同义（保存失败中断后续登录流程；`loginUrl` 为空入口隐藏，无新增扩展提示）。
    - 文案：已同义（动作文案固定“登录”）。
    - 排版：已同义（入口维持在 `CupertinoActionSheet` 的“更多”菜单层级，平台差异可接受）。
    - 交互触发：已同义（`书源管理 -> 新建/编辑书源 -> 右上角更多 -> 登录`）。
    - 验证：手工路径 `书源管理 -> 新建或编辑任一书源 -> 填写/清空 loginUrl 与 loginUi -> 右上角更多 -> 登录`（校验 `loginUrl` 为空时入口隐藏；`loginUrl` 非空时点击先保存；`loginUi` 非空走表单承载页，空值走网页登录承载页）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_login` 分流判定，不改动书源持久化结构、登录脚本执行与 Cookie 存储链路。
  - 下一项：按优先级继续推进 `P4-seq354`（`source_edit.xml / @+id/menu_search / 搜索`）。
  - 状态变更：完成 `P4-seq192`（`change_source.xml / @+id/menu_load_toc / 加载目录`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq192`（`change_source.xml / @+id/menu_load_toc / 加载目录`）：在阅读页“整书换源/单章换源”候选弹层补齐 legado 同义 `checkable` 入口“加载目录”；点击后仅切换全局开关 `changeSourceLoadToc` 并持久化，不自动刷新当前候选列表；候选刷新链路按该开关决定是否预加载目录并回填最新章节。
  - `P4-seq192` 差异点清单（实施前）：
    - legado `ChangeBookSourceDialog` 与 `ChangeChapterSourceDialog` 的 `menu_load_toc` 点击语义为“仅切换 `AppConfig.changeSourceLoadToc` + 勾选态”，不触发 `refresh/startSearch`；Flutter 候选弹层缺少同义入口。
    - Flutter 候选刷新链路此前固定为“只跑搜索候选”，无法表达 legado 的“开启加载目录后刷新候选时预加载目录信息”分支。
  - `P4-seq192` 逐项对照清单（实施后）：
    - 入口：已同义（候选弹层新增“更多 -> 加载目录”动作）。
    - 状态：已同义（点击仅翻转 `changeSourceLoadToc` 并持久化；当前候选列表保持不变）。
    - 异常：已同义（目录预加载失败按单源隔离，保留原候选结果且不追加提示）。
    - 文案：已同义（动作文案固定“加载目录”，勾选态通过 `✓` 表达）。
    - 排版：已同义（入口承载在候选弹层顶部“更多”动作内，平台差异可接受）。
    - 交互触发：已同义（`阅读页 -> 换源候选弹层 -> 更多 -> 加载目录`）。
    - 验证：手工路径 `阅读页(网络书) -> 顶部换源按钮点击或长按 -> 整书换源或单章换源 -> 候选弹层 -> 更多 -> 加载目录`（校验勾选态切换后立即持久化且不自动刷新；手动“刷新列表”后按开关决定是否预加载目录）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_load_toc` 入口与候选刷新分支，不改动换源提交、目录匹配与正文替换主链路。
  - 下一项：按优先级继续推进 `P4-seq353`（`source_edit.xml / @+id/menu_login / 登录`）。
  - 状态变更：完成 `P4-seq188`（`change_source.xml / @+id/menu_refresh_list / 刷新列表`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq188`（`change_source.xml / @+id/menu_refresh_list / 刷新列表`）：在阅读页“整书换源”候选弹层补齐 legado 同义“刷新列表”动作；点击后按当前候选来源集合重新拉取候选结果并在弹层内热更新，刷新期间禁用“刷新列表/书源管理”避免并发触发，保持“刷新成功或失败均不追加提示”的状态边界。
  - `P4-seq188` 差异点清单（实施前）：
    - legado `ChangeBookSourceDialog.menu_refresh_list -> ChangeBookSourceViewModel.startRefreshList()` 是“基于当前候选列表逐项刷新”的独立动作，不等同于重新全量搜索；Flutter 候选弹层缺失该入口。
    - Flutter 候选列表此前是打开弹层时的静态快照，弹层内无法执行“刷新当前候选列表”并即时更新。
  - `P4-seq188` 逐项对照清单（实施后）：
    - 入口：已同义（整书换源候选弹层顶部新增“刷新列表”动作）。
    - 状态：已同义（点击后基于当前候选来源集合重拉结果并覆盖候选列表；不自动选中、不自动提交换源）。
    - 异常：已同义（单源刷新失败隔离处理；整体刷新失败保持当前候选列表且不弹扩展提示）。
    - 文案：已同义（动作文案固定“刷新列表”，刷新中态文案“刷新中”）。
    - 排版：已同义（动作位于候选弹层标题区，与“书源管理/取消”同层级承载，平台差异可接受）。
    - 交互触发：已同义（`阅读页(网络书) -> 顶部换源按钮长按 -> 整书换源 -> 候选弹层 -> 刷新列表`）。
    - 验证：手工路径 `阅读页(网络书) -> 顶部换源按钮长按 -> 整书换源 -> 刷新列表`（校验候选数量/内容会按当前候选来源集合刷新；刷新期间重复点击无效；无额外成功/失败提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_refresh_list` 的候选刷新入口与弹层内状态更新，不改动整书/单章换源提交、目录匹配与正文替换链路。
  - 下一项：按优先级继续推进 `P4-seq192`（`change_source.xml / @+id/menu_load_toc / 加载目录`）。
  - 状态变更：完成 `P4-seq187`（`change_source.xml / @+id/menu_source_manage / 书源管理`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq187`（`change_source.xml / @+id/menu_source_manage / 书源管理`）：在阅读页“单章换源/整书换源”共享候选弹层补齐 legado 同义“书源管理”动作；点击后直接打开书源管理页，返回后保留候选弹层并继续换源流程，保持“仅跳转管理页、不提交换源结果”的状态边界。
  - `P4-seq187` 差异点清单（实施前）：
    - legado `change_source.xml` 同时在 `ChangeBookSourceDialog` 与 `ChangeChapterSourceDialog` 提供 `menu_source_manage`，点击动作统一 `startActivity<BookSourceActivity>()`；Flutter 候选弹层缺失该入口。
    - Flutter 端此前需先退出候选弹层再从其它入口进入书源管理，交互路径层级与 legado 不同。
  - `P4-seq187` 逐项对照清单（实施后）：
    - 入口：已同义（候选弹层顶部新增“书源管理”动作）。
    - 状态：已同义（点击后进入书源管理页；返回后候选弹层继续保留并可继续选源）。
    - 异常：已同义（跳转失败沿用现有路由异常边界，不新增扩展提示）。
    - 文案：已同义（动作文案固定“书源管理”）。
    - 排版：已同义（候选弹层标题区承载“书源管理 + 取消”动作，平台差异可接受）。
    - 交互触发：已同义（`阅读页 -> 换源 -> 候选弹层 -> 书源管理`）。
    - 验证：手工路径 `阅读页(网络书) -> 顶部换源按钮点击或长按 -> 单章换源/整书换源 -> 候选弹层 -> 书源管理 -> 返回`（校验可进入书源管理页；返回后候选弹层仍在且可继续选源）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_source_manage` 的入口与路由触发，不改动换源候选匹配、目录加载与正文替换链路。
  - 下一项：按优先级继续推进 `P4-seq188`（`change_source.xml / @+id/menu_refresh_list / 刷新列表`）。
  - 状态变更：完成 `P4-seq158`（`book_source_sel.xml / @+id/menu_export_selection / 导出所选`）后，ExecPlan 保持 `active`。
  - 完成 `P4-seq158`（`book_source_sel.xml / @+id/menu_export_selection / 导出所选`）：书源管理多选菜单“导出所选”动作收敛 legado 同义边界，导出默认文件名调整为 `bookSource.json`，并将取消导出分支改为静默返回；成功分支继续展示“导出成功”路径弹窗并支持复制路径。
  - `P4-seq158` 差异点清单（实施前）：
    - legado `BookSourceActivity.menu_export_selection` 通过 `HandleFileContract.EXPORT` 固定导出名 `bookSource.json`；Flutter 端此前默认文件名是 `soupreader_sources_<timestamp>.json`，存在语义偏差。
    - legado 在 `HandleFileContract` 返回 `uri == null` 时不提示取消；Flutter 端此前会弹出“导出取消”提示，偏离 legado 静默边界。
  - `P4-seq158` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理多选“更多”菜单保留“导出所选”入口并触发导出链路）。
    - 状态：已同义（导出集合维持“全选导出筛选集 / 低比例导出选中集 / 中高比例按筛选顺序过滤选中键”规则）。
    - 异常：已同义（导出失败提示错误摘要；取消导出静默返回）。
    - 文案：已同义（菜单文案“导出所选”，默认导出文件名 `bookSource.json`）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 与 `CupertinoAlertDialog` 承载，平台差异可接受）。
    - 交互触发：已同义（`书源管理 -> 多选 -> 省略号 -> 导出所选`）。
    - 验证：手工路径 `书源管理 -> 多选 -> 省略号 -> 导出所选`（校验默认文件名 `bookSource.json`；取消导出无提示；成功后显示导出路径并可复制）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_export_selection` 的文件名与取消反馈边界，不改动书源解析、换源与登录流程。
  - 下一项：按优先级继续推进 `P4-seq150`（`book_source_sel.xml / @+id/menu_enable_selection / 启用所选`）。
  - 状态变更：完成 `P3-seq382`（`speak_engine_edit.xml / @+id/menu_paste_source / 粘贴源`）后，ExecPlan 保持 `active`。
  - 完成 `P3-seq382`（`speak_engine_edit.xml / @+id/menu_paste_source / 粘贴源`）：在朗读引擎编辑页“更多”菜单补齐 legado 同义“粘贴源”入口；点击后从剪贴板读取文本并按 legado 边界解析 JSON 对象/数组，成功时仅回填编辑表单（数组取首项），不自动保存、不跳转、不追加成功提示。
  - `P3-seq382` 差异点清单（实施前）：
    - legado `speak_engine_edit.xml` 已定义 `menu_paste_source`，并在 `HttpTtsEditDialog` 中绑定 `viewModel.importFromClip { initView(it) }`；Flutter 编辑页“更多”菜单缺少“粘贴源”入口。
    - legado `HttpTtsEditViewModel.importFromClip/importSource` 的关键语义是“剪贴板为空提示 `剪贴板为空`、仅接受 JSON 对象/数组、数组取首项、成功仅回填表单不落库”；Flutter 端此前缺少该状态链路。
  - `P3-seq382` 逐项对照清单（实施后）：
    - 入口：已同义（编辑页“更多”菜单新增“粘贴源”动作）。
    - 状态：已同义（粘贴成功后仅覆盖当前编辑表单字段，不触发保存与页面跳转）。
    - 异常：已同义（剪贴板为空提示“剪贴板为空”；非 JSON 对象/数组提示“格式不对”；解析异常展示错误摘要）。
    - 文案：已同义（菜单文案固定“粘贴源”，空剪贴板文案固定“剪贴板为空”）。
    - 排版：已同义（动作承载在编辑页 `CupertinoActionSheet` 的“更多”菜单中，平台差异可接受）。
    - 交互触发：已同义（`设置 -> 语音管理 -> 点击 HTTP 朗读引擎条目 -> 编辑页右上角更多 -> 粘贴源`）。
    - 验证：手工路径 `设置 -> 语音管理 -> 点击 HTTP 朗读引擎条目 -> 编辑页右上角更多 -> 粘贴源`（校验空剪贴板提示“剪贴板为空”；粘贴 JSON 对象/数组后表单被回填且未自动保存）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `speak_engine_edit/menu_paste_source` 入口与表单回填语义，不改动朗读规则存储结构、登录缓存与导入导出链路。
  - 下一项：按优先级继续推进 `P4-seq158`（`book_source_sel.xml / @+id/menu_export_selection / 导出所选`）。
  - 状态变更：完成 `P3-seq377`（`speak_engine_edit.xml / @+id/menu_save / 保存`）后，ExecPlan 保持 `active`。
  - 完成 `P3-seq377`（`speak_engine_edit.xml / @+id/menu_save / 保存`）：在朗读引擎编辑页顶栏补齐 legado 同义一级“保存”动作；点击后按当前表单显式保存 HTTP 朗读引擎规则并提示“保存成功”，保持“保存后停留编辑页、不触发登录流程”的状态流。
  - `P3-seq377` 差异点清单（实施前）：
    - legado `speak_engine_edit.xml` 定义 `menu_save` 为 `showAsAction=always`，由编辑页工具栏直接触发；Flutter 编辑页仅提供“更多”入口，缺少同层级一级“保存”动作。
    - legado `HttpTtsEditDialog.menu_save -> viewModel.save(dataFromView()) -> toastOnUi("保存成功")` 语义为“显式保存 + 成功提示 + 页面不关闭”；Flutter 端此前只有“更多->登录”会保存，缺失独立 `menu_save` 状态链路。
  - `P3-seq377` 逐项对照清单（实施后）：
    - 入口：已同义（编辑页顶栏新增一级“保存”动作，与“更多”并列）。
    - 状态：已同义（点击“保存”按当前表单落库，保存后仍停留当前编辑页）。
    - 异常：已同义（保存失败弹出 `保存失败：<错误>` 可观测提示，不触发登录/跳转）。
    - 文案：已同义（成功反馈固定“保存成功”）。
    - 排版：已同义（`保存 + 更多` 顶栏并列动作布局，对齐 legado action + overflow 结构）。
    - 交互触发：已同义（`设置 -> 语音管理 -> 点击 HTTP 朗读引擎条目 -> 编辑页右上角保存`）。
    - 验证：手工路径 `设置 -> 语音管理 -> 点击 HTTP 朗读引擎条目 -> 编辑页右上角保存`（校验保存后出现“保存成功”提示且页面不关闭；返回列表后规则内容已更新）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `speak_engine_edit/menu_save` 入口与显式保存语义，不改动导入导出格式、登录缓存与朗读执行链路。
  - 下一项：按优先级继续推进 `P3-seq382`（`speak_engine_edit.xml / @+id/menu_paste_source / 粘贴源`）。
  - 状态变更：完成 `P3-seq372`（`speak_engine.xml / @+id/menu_add / 添加`）后，ExecPlan 保持 `active`。
  - 完成 `P3-seq372`（`speak_engine.xml / @+id/menu_add / 添加`）：在语音管理页顶栏补齐 legado 同义一级“添加”入口；点击后创建空白 HTTP 朗读引擎草稿并进入编辑承载页，保持“仅进入编辑页、不自动保存”的状态流。
  - `P3-seq372` 差异点清单（实施前）：
    - legado `SpeakEngineDialog` 工具栏包含 `menu_add`（`showAsAction=always`），点击直接 `showDialogFragment<HttpTtsEditDialog>()`；Flutter 端语音管理页仅有“更多”入口，缺少同层级一级“添加”动作。
    - legado `menu_add` 只负责打开空白编辑页，不直接写库；Flutter 端缺少“新建草稿 + 打开编辑页”的独立触发链路。
  - `P3-seq372` 逐项对照清单（实施后）：
    - 入口：已同义（语音管理页右上角新增 `+` 一级入口，与 legacy action 层级一致）。
    - 状态：已同义（点击后进入空白编辑页；返回不自动新增规则，保持“未保存不落库”边界）。
    - 异常：已同义（导入/导出流程进行中禁用添加按钮，避免并发触发冲突）。
    - 文案：已同义（动作语义为“添加”；空态提示补充“添加或更多菜单导入默认规则”）。
    - 排版：已同义（顶栏 `添加 + 更多` 并列动作布局，对齐 legado “action + overflow”结构）。
    - 交互触发：已同义（`设置 -> 语音管理 -> 添加 -> 编辑朗读引擎`）。
    - 验证：手工路径 `设置 -> 语音管理 -> 右上角添加 -> 编辑朗读引擎 -> 返回`（校验可进入空白编辑页，返回后列表无自动新增项）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `speak_engine/menu_add` 入口与新建草稿跳转，不改动导入导出规则结构与朗读执行链路。
  - 下一项：按优先级继续推进 `P3-seq377`（`speak_engine_edit.xml / @+id/menu_save / 保存`）。
  - 状态变更：完成 `P3-seq256`（`keyboard_assists_config.xml / @+id/menu_add / 添加`）后，ExecPlan 保持 `active`。
  - 完成 `P3-seq256`（`keyboard_assists_config.xml / @+id/menu_add / 添加`）：在书源编辑页“编辑工具”动作面板补齐 legado 同义“辅助按键配置”入口；进入配置弹层后新增顶部“添加”动作，点击后弹出“辅助按键”双输入框（`key/value`），确认后按 `serialNo=max+1` 追加并持久化，返回编辑工具可直接点击新增项插入 `value`。
  - `P3-seq256` 差异点清单（实施前）：
    - legado `KeyboardToolPop.helpAlert` 固定将“辅助按键配置”作为一级入口，点击后进入 `KeyboardAssistsConfig`；Flutter 端 `SourceEditLegacyView` 的“编辑工具”缺失该入口。
    - legado `KeyboardAssistsConfig.menu_add -> editKey(null)` 要求“弹出 `key/value` 双输入框 + 确认后 `serialNo=max+1` 持久化”；Flutter 端缺失辅助按键配置存储与新增链路。
  - `P3-seq256` 逐项对照清单（实施后）：
    - 入口：已同义（“编辑工具”新增“辅助按键配置”入口并可打开配置弹层）。
    - 状态：已同义（点击“添加”后弹出 `key/value` 编辑框；确认后新项按 `serialNo` 追加并持久化，重新打开编辑工具可见）。
    - 异常：已同义（`key` 为空阻止保存并提示；取消不落盘）。
    - 文案：已同义（“辅助按键配置 / 辅助按键 / 添加 / 取消 / 确定 / key / value”）。
    - 排版：已同义（`CupertinoPopupSurface + CupertinoActionSheet + CupertinoAlertDialog` 承载弹层与动作，平台差异可接受）。
    - 交互触发：已同义（编辑工具 -> 辅助按键配置 -> 添加 -> 输入 key/value -> 确定；随后在编辑工具直接点击新增项插入 `value`）。
    - 验证：手工路径 `书源编辑页 -> 选中任意规则输入框 -> 右侧魔棒“编辑工具” -> 辅助按键配置 -> 添加 -> 输入 key/value -> 确定 -> 关闭 -> 再次打开编辑工具点击新增项`（校验新增项出现且可插入 value）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `keyboard_assists_config/menu_add` 的配置入口与新增持久化链路，不改动书源解析、搜索/目录/正文抓取主链路。
  - 下一项：按优先级继续推进 `P3-seq372`（`speak_engine.xml / @+id/menu_add / 添加`）。
  - 状态变更：完成 `P3-seq238`（`font_select.xml / @+id/menu_default / 默认字体`）后，ExecPlan 保持 `active`。
  - 完成 `P3-seq238`（`font_select.xml / @+id/menu_default / 默认字体`）：在阅读页“选择字体”弹层顶部补齐 legado `FontSelectDialog.menu_default` 入口；点击后弹出“系统内置字体样式”选项（系统默认字体/系统衬线字体/系统等宽字体），确认后执行“清空自定义字体路径 -> 应用系统字体 -> 关闭字体弹层”。
  - `P3-seq238` 差异点清单（实施前）：
    - legado `font_select.xml` 与 `FontSelectDialog.onMenuItemClick(menu_default)` 明确要求弹出 `system_typefaces` 三项列表；Flutter 字体弹层仅实现了“其它目录”，缺失 `menu_default` 同层入口。
    - legado 选择系统字体后执行 `AppConfig.systemTypefaces = i` 并调用 `onDefaultFontChange -> selectFont("")` 清空自定义字体，随后 `dismissAllowingStateLoss` 关闭弹层；Flutter 缺失该状态链路。
  - `P3-seq238` 逐项对照清单（实施后）：
    - 入口：已同义（字体弹层顶部新增“默认字体”入口，触发层级与 legado 一致）。
    - 状态：已同义（选择系统字体后清空自定义字体路径，并立即应用系统字体样式）。
    - 异常：已同义（取消系统字体选择时保持现状，不追加提示）。
    - 文案：已同义（入口文案固定“默认字体”；弹层标题“系统内置字体样式”；选项固定“系统默认字体/系统衬线字体/系统等宽字体”）。
    - 排版：已同义（`CupertinoButton + CupertinoActionSheet` 承载动作与选项，平台差异可接受）。
    - 交互触发：已同义（确认选项后依次完成“清空自定义字体 -> 应用系统字体 -> 关闭字体弹层”）。
    - 验证：`flutter test test/reader_top_menu_test.dart`、`flutter test test/reader_search_navigation_helper_test.dart` 通过；`flutter test test/simple_reader_view_compile_test.dart` 失败（现存编译问题：`simple_reader_view.dart:4968` 空安全报错、`reader_dict_lookup_sheet.dart:170` `SelectableText` 未定义）；手工路径 `阅读页 -> 样式弹层 -> 字体 -> 默认字体 -> 选择系统默认字体/系统衬线字体/系统等宽字体`（校验选择后弹层关闭且正文字体即时变化）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_default` 系统字体选择与自定义字体清理语义，不改动书源解析、搜索/目录/正文抓取及换源链路。
  - 下一项：按优先级继续推进 `P3-seq256`（`keyboard_assists_config.xml / @+id/menu_add / 添加`）。
  - 状态变更：完成 `P3-seq212`（`content_select_action.xml / @+id/menu_share_str / 分享`）后，ExecPlan 保持 `active`。
  - 完成 `P3-seq212`（`content_select_action.xml / @+id/menu_share_str / 分享`）：在翻页阅读“文本操作”菜单补齐“分享”动作；点击后按 legado `TextActionMenu.menu_share_str -> Context.share(selectedText)` 同义调用系统文本分享。
  - `P3-seq212` 差异点清单（实施前）：
    - legado `content_select_action.xml` 已定义 `menu_share_str`，且 `TextActionMenu.onMenuItemSelected` 默认分支会执行 `context.share(callBack.selectedText)`；Flutter 端文本操作菜单缺失该入口。
    - Flutter 端尚未收敛该动作的失败边界；legado `Context.share` 采用 `runCatching` 静默吞错，不追加成功或失败提示。
  - `P3-seq212` 逐项对照清单（实施后）：
    - 入口：已同义（阅读页翻页模式长按正文后，“文本操作”菜单新增“分享”）。
    - 状态：已同义（点击后直接打开系统文本分享面板，分享内容为 `selectedText`）。
    - 异常：已同义（分享异常静默吞掉，不追加提示）。
    - 文案：已同义（动作文案固定“分享”）。
    - 排版：已同义（`CupertinoActionSheet` 承载文本动作，平台差异可接受）。
    - 交互触发：已同义（点击“分享”立即触发系统分享，不附加扩展链路）。
    - 验证：手工路径 `阅读页(翻页模式) -> 长按正文词句 -> 文本操作 -> 分享`；校验系统分享面板可打开、分享文本为选中内容，且无额外成功/失败提示。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_share_str` 入口与分享动作，不改动书源解析、目录抓取与正文请求主链路。
  - 下一项：按优先级继续推进 `P3-seq238`（`font_select.xml / @+id/menu_default / 默认字体`）。
  - 状态变更：完成 `P3-seq211`（`content_select_action.xml / @+id/menu_browser / 浏览器`）后，ExecPlan 保持 `active`。
  - 完成 `P3-seq211`（`content_select_action.xml / @+id/menu_browser / 浏览器`）：在翻页阅读“文本操作”菜单补齐“浏览器”动作；点击后按 legado `TextActionMenu.menu_browser` 同义分流，`selectedText` 为 `http/https` 时外部浏览器直开，非绝对网址时按关键词发起网页搜索。
  - `P3-seq211` 差异点清单（实施前）：
    - legado `content_select_action.xml` 已定义 `menu_browser`，且 `TextActionMenu.onMenuItemSelected` 要求按 `isAbsUrl` 分流 `ACTION_VIEW/ACTION_WEB_SEARCH`；Flutter 端文本操作菜单缺失该入口。
    - Flutter 端尚未收敛该动作的失败口径（异常优先展示错误消息，空消息回退 `ERROR`）。
  - `P3-seq211` 逐项对照清单（实施后）：
    - 入口：已同义（阅读页翻页模式长按正文后，“文本操作”菜单新增“浏览器”）。
    - 状态：已同义（`selectedText` 为 `http/https` 时外部浏览器直开；非绝对网址文本按关键词走网页搜索）。
    - 异常：已同义（打开失败提示 `ERROR`；抛错时优先展示错误消息，空消息回退 `ERROR`）。
    - 文案：已同义（动作文案固定“浏览器”）。
    - 排版：已同义（`CupertinoActionSheet` 承载文本动作，平台差异可接受）。
    - 交互触发：已同义（点击“浏览器”立即执行分流，不附加扩展提示分支）。
    - 验证：手工路径 `阅读页(翻页模式) -> 长按正文词句 -> 文本操作 -> 浏览器`；校验 URL 文本走外部浏览器、非 URL 文本走网页搜索，失败分支提示符合预期。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_browser` 入口与分流动作，不改动书源解析、目录抓取与正文请求主链路。
  - 下一项：按优先级继续推进 `P3-seq212`（`content_select_action.xml / @+id/menu_share_str / 分享`）。
  - 状态变更：完成 `P3-seq209`（`content_select_action.xml / @+id/menu_dict / 字典`）后，ExecPlan 保持 `active`。
  - 完成 `P3-seq209`（`content_select_action.xml / @+id/menu_dict / 字典`）：在翻页阅读“文本操作”菜单补齐“字典”动作；点击后按 legado 同义打开字典弹层，并以 `selectedText` 作为关键词执行词典规则查询，支持按启用规则切换后重新加载结果。
  - `P3-seq209` 差异点清单（实施前）：
    - legado `content_select_action.xml` 已定义 `menu_dict`，且 `ReadBookActivity.onMenuItemSelected` 需直接走 `showDialogFragment(DictDialog(selectedText))`；Flutter 端文本操作菜单缺失该入口。
    - Flutter 端缺失词典默认规则资产与查询承载层，无法等价复刻 legado `DictDialog` 的“规则 Tab -> 词典查询 -> 结果展示”状态流。
  - `P3-seq209` 逐项对照清单（实施后）：
    - 入口：已同义（阅读页翻页模式长按正文后，“文本操作”菜单新增“字典”）。
    - 状态：已同义（进入字典弹层默认加载首个启用规则；切换规则后重新发起查询）。
    - 异常：已同义（无选中文本时静默返回；查询失败在结果区展示错误文本，流程不中断）。
    - 文案：已同义（动作文案固定“字典”）。
    - 排版：已同义（`Cupertino` 弹层承载规则标签与查询结果，平台差异可接受）。
    - 交互触发：已同义（点击“字典”打开弹层并用 `selectedText` 查询；切换规则触发重新查询）。
    - 验证：手工路径 `阅读页(翻页模式) -> 长按正文词句 -> 文本操作 -> 字典 -> 切换规则`；校验弹层打开、首个规则自动查询、切换规则后结果刷新。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_dict` 入口、词典规则默认资产与词典弹层，不改动书源解析、目录抓取与正文请求主链路。
  - 下一项：按优先级继续推进 `P3-seq211`（`content_select_action.xml / @+id/menu_browser / 浏览器`）。
  - 状态变更：完成 `P3-seq208`（`content_select_action.xml / @+id/menu_aloud / 朗读`）后，ExecPlan 保持 `active`。
  - 完成 `P3-seq208`（`content_select_action.xml / @+id/menu_aloud / 朗读`）：在翻页阅读“文本操作”菜单补齐“朗读”动作；点击后按 legado 同义执行“朗读选择内容/从选择处开始一直朗读”双模式分流，长按文本操作菜单项可切换模式并持久化到 `contentSelectSpeakMod`。
  - `P3-seq208` 差异点清单（实施前）：
    - legado `content_select_action.xml` 已定义 `menu_aloud`，且 `ReadBookActivity.onMenuItemSelected` 需按 `contentSelectSpeakMod` 在“朗读选中文本 / 从选区起连续朗读”间分流；Flutter 端文本操作菜单缺失该入口。
    - Flutter 设置层缺失 `contentSelectSpeakMod` 同名键，无法等价复刻 legado 的“长按菜单项切换朗读模式并跨次保留”语义。
  - `P3-seq208` 逐项对照清单（实施后）：
    - 入口：已同义（阅读页翻页模式长按正文后，“文本操作”菜单新增“朗读”）。
    - 状态：已同义（默认模式朗读选中文本；切换后模式为“从选择处开始一直朗读”）。
    - 异常：已同义（Web 平台保持“当前平台暂不支持语音朗读”；无选中文本时静默返回）。
    - 文案：已同义（动作文案固定“朗读”；模式切换提示文案对齐 legado）。
    - 排版：已同义（`CupertinoActionSheet` 承载文本动作，平台差异可接受）。
    - 交互触发：已同义（点击“朗读”按当前模式执行；长按文本操作菜单项切换模式并持久化）。
    - 验证：手工路径 `阅读页(翻页模式) -> 长按正文词句 -> 文本操作 -> 朗读(点击/长按)`；校验点击按模式分流、长按后重进阅读页模式保持。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_aloud` 入口与模式持久化，不改动书源解析、目录抓取与正文请求协议。
  - 下一项：按优先级继续推进 `P3-seq209`（`content_select_action.xml / @+id/menu_dict / 字典`）。
  - 状态变更：完成 `P3-seq207`（`content_select_action.xml / @+id/menu_bookmark / 书签`）后，ExecPlan 保持 `active`。
  - 完成 `P3-seq207`（`content_select_action.xml / @+id/menu_bookmark / 书签`）：在翻页阅读“文本操作”菜单补齐“书签”动作；点击后按 legado 同义进入书签编辑弹窗，预填选中文本，取消不落库，确定后新增书签并刷新书签状态。
  - `P3-seq207` 差异点清单（实施前）：
    - legado `TextActionMenu` 已定义 `menu_bookmark`，并由 `ReadBookActivity.onMenuItemSelected` 走 `createBookmark() -> BookmarkDialog` 链路；Flutter 端文本操作菜单仅实现了 `menu_replace`，缺少同层级“书签”入口。
    - Flutter 端虽然已有阅读页书签编辑弹窗与落库链路（`_showBookmarkEditorDialog`），但未接入“长按选中文本”上下文，无法对齐 legado 的 `selectedText` 预填语义。
  - `P3-seq207` 逐项对照清单（实施后）：
    - 入口：已同义（阅读页翻页模式长按正文后，“文本操作”菜单新增“书签”）。
    - 状态：已同义（选中文本作为书签编辑弹窗的默认正文；章节标题/章节位点沿用当前阅读上下文草稿）。
    - 异常：已同义（无法构建书签草稿时提示“创建书签失败”；取消不写库）。
    - 文案：已同义（动作文案固定“书签”）。
    - 排版：已同义（`CupertinoActionSheet + CupertinoAlertDialog` 承载动作与编辑流程，平台差异可接受）。
    - 交互触发：已同义（点击“书签”进入编辑弹窗；确定后写库，取消后不写库）。
    - 验证：手工路径 `阅读页(翻页模式) -> 长按正文词句 -> 文本操作 -> 书签 -> 取消/确定`；校验取消后不新增书签、确定后目录书签页可见并可跳转。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐文本动作菜单 `menu_bookmark` 与既有书签编辑链路的接线，不改动书源解析、目录抓取与正文请求协议。
  - 下一项：按优先级继续推进 `P3-seq208`（`content_select_action.xml / @+id/menu_aloud / 朗读`）。
  - 状态变更：`P3-seq205` 已按方案 A（先补选区基础设施）解除阻塞，ExecPlan 状态由 `blocked` 恢复为 `active`。
  - 完成 `P3-seq205`（`content_select_action.xml / @+id/menu_replace / 替换`）：补齐翻页阅读长按文本动作入口，长按正文后弹出“文本操作 -> 替换”；点击后按 legado 同义将 `selectedText` 逐行 `trim` 预填到替换规则 `pattern`，并将 `scope` 预填为 `bookName;bookSourceUrl`。
  - `P3-seq205` 差异点清单（实施前）：
    - Flutter `PagedReaderWidget` 仅支持点击分区动作，无“长按选中文本 -> 菜单动作”入口，缺失 legado `TextActionMenu` 触发前提。
    - Flutter 阅读页缺少 `menu_replace` 从 `selectedText` 跳转到替换规则编辑页的链路，无法复刻 `ReplaceEditActivity.startIntent(pattern, scope)` 语义。
  - `P3-seq205` 逐项对照清单（实施后）：
    - 入口：已同义（翻页阅读长按正文可进入文本操作菜单）。
    - 状态：已同义（按长按位置提取词级选中文本并作为本次动作上下文）。
    - 异常：已同义（无可用选中文本时静默不弹菜单；保存前不写库）。
    - 文案：已同义（动作文案固定“替换”）。
    - 排版：已同义（使用 `CupertinoActionSheet` 承载文本动作，平台差异可接受）。
    - 交互触发：已同义（`selectedText` 逐行 `trim` 后预填 `pattern`，`scope=bookName;bookSourceUrl`，保存后写入规则并刷新当前章节）。
    - 验证：手工路径 `阅读页(翻页模式) -> 长按正文词句 -> 文本操作 -> 替换 -> 保存规则`；校验默认 `pattern/scope` 预填正确且保存后正文刷新。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐阅读页文本动作入口与 `menu_replace` 链路，不改动书源解析、目录抓取与正文请求协议。
  - 下一项：按优先级继续推进 `P3-seq207`（`content_select_action.xml / @+id/menu_bookmark / 书签`）。
  - 状态变更：ExecPlan 由 `active` 调整为 `blocked`，阻塞点为 `P3-seq205`（`content_select_action.xml / @+id/menu_replace / 替换`）。
  - `P3-seq205` 阻塞记录（差异点清单，实施前）：
    - legado `ReadBookActivity.onMenuItemSelected(menu_replace)` 的触发前提是 `TextActionMenu.selectedText` 已存在；动作会打开 `ReplaceEditActivity.startIntent(pattern=selectedText.trimLines, scope=bookName;bookSourceUrl)`。
    - Flutter 阅读正文当前实现（`paged_reader_widget.dart + simple_reader_view.dart`）为 `RichText` 分页渲染，尚无“文本选区 + 选中文本回调 + 文本操作菜单”基础设施，无法等价提供 `selectedText` 语义。
  - `P3-seq205` 阻塞记录（逐项检查）：
    - 入口：未通过（缺少选中文本菜单入口）。
    - 状态：未通过（缺少选区生命周期与菜单开闭状态流转）。
    - 异常：未通过（缺少选区取消/清理与失败可观测链路）。
    - 文案：未通过（缺少 `menu_replace` 同层级菜单承载）。
    - 排版：未通过（缺少文本操作菜单承载层）。
    - 交互触发：未通过（无法按选中文本触发替换编辑）。
  - `P3-seq205` 迁移例外记录：
    - 原因：缺失选中文本基础设施，`menu_replace` 无法按 legado 语义触发。
    - 影响范围：阻塞 `seq205`，且同文件后续依赖选区语义的 `seq206~209` 存在同类阻塞风险。
    - 替代方案：
      - A：先实现阅读页选区基础设施（选区、文本菜单、回调、清理）再迁移 `menu_replace`（推荐）。
      - B：需求方确认后采用临时降级“手动输入关键词后打开替换编辑”（非同义方案）。
    - 回补计划：待需求方确认后解除阻塞；选 A 则先补基础设施后回补 `menu_replace`；选 B 则在文档登记例外并排期补回同义链路。
  - 完成 `P3-seq204`（`content_search.xml / @+id/menu_enable_replace / 替换`）：对齐 legado `SearchContentActivity.menu_enable_replace` 的 `checkable` 语义，在阅读页全文搜索面板顶栏补齐“更多 -> 替换”入口；点击仅翻转搜索态开关，不自动重跑搜索。
  - `P3-seq204` 差异点清单（实施前）：
    - Flutter 全文搜索面板缺少 legado `content_search.xml` 对应菜单入口，无法表达“替换”勾选态。
    - Flutter 全文搜索链路固定按原始正文检索，缺少“按开关决定是否应用替换规则”的分支。
  - `P3-seq204` 逐项对照清单（实施后）：
    - 入口：已同义（全文搜索面板顶栏补齐“更多 -> 替换”入口）。
    - 状态：已同义（菜单项通过 `✓ 替换` 回显勾选态）。
    - 异常：已同义（仅本地状态切换；不新增异常提示分支）。
    - 文案：已同义（固定“替换”）。
    - 排版：已同义（`CupertinoActionSheet` 承载 checkable 入口，平台差异可接受）。
    - 交互触发：已同义（点击仅切换开关；下次搜索按“搜索替换开关 && 书籍替换净化开关”决定是否应用替换规则）。
    - 验证：手工路径 `阅读页 -> 搜索正文 -> 输入关键词搜索 -> 搜索面板顶栏更多 -> 替换 -> 再次搜索`（校验勾选态切换、切换后仅影响搜索链路）；手工路径 `阅读页 -> 搜索正文 -> 退出`（校验退出后开关恢复默认关闭）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐全文搜索菜单入口与搜索链路替换开关，不改动书源解析、目录与正文抓取链路。
  - 阻塞项：`seq205`（`content_select_action.xml / @+id/menu_replace / 替换`），待需求方确认方案后继续。
  - 完成 `P3-seq93`（`book_read_record.xml / @+id/menu_enable_record / 开启记录`）：对齐 legado `ReadRecordActivity.menu_enable_record` 的 `checkable` 语义，在“阅读记录”页右上角更多菜单补齐“开启记录”入口；菜单打开按 `enableReadRecord` 回显勾选，点击后仅翻转开关并持久化，不追加提示。
  - `P3-seq93` 差异点清单（实施前）：
    - Flutter “阅读记录”页缺少 legado `menu_enable_record` 入口，无法表达“开启记录”勾选态与切换动作。
    - 设置层缺少 `enableReadRecord` 同名键；阅读进度落盘始终刷新 `lastReadTime`，无法体现“关闭记录后不再累计阅读记录”的边界。
  - `P3-seq93` 逐项对照清单（实施后）：
    - 入口：已同义（阅读记录页补齐“更多 -> 开启记录”入口）。
    - 状态：已同义（菜单项按 `enableReadRecord` 显示 `✓` 勾选态）。
    - 异常：已同义（动作仅本地设置读写；未新增异常提示分支）。
    - 文案：已同义（固定“开启记录”）。
    - 排版：已同义（`CupertinoActionSheet` 承载 checkable 文案，平台差异可接受）。
    - 交互触发：已同义（点击即翻转开关并落盘，重进页面后勾选态保持）。
    - 验证：手工路径 `设置 -> 功能 & 设置 -> 阅读记录 -> 右上角更多 -> 开启记录`（校验勾选态切换与重进页面保持）；手工路径 `阅读页 -> 退出 -> 查看阅读记录列表`（校验关闭“开启记录”后仍保存章节进度但不刷新 `lastReadTime`）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_enable_record` 入口与设置边界，不改动书源解析、目录与正文抓取链路。
  - 完成 `P3-seq9`（`audio_play.xml / @+id/menu_wake_lock / 音频服务唤醒锁`）：对齐 legado `AudioPlayActivity.menu_wake_lock` 的 `checkable` 语义，在阅读页“播放”菜单补齐“音频服务唤醒锁”入口；点击后仅翻转开关并持久化到 legado 同义键 `audioPlayWakeLock`，不追加成功提示。
  - `P3-seq9` 差异点清单（实施前）：
    - Flutter 播放菜单缺少 `menu_wake_lock` 入口，无法表达 legado 的 checkable 状态。
    - Flutter 设置层缺少 legado 同义键 `audioPlayWakeLock` 的读写能力，重进菜单无法恢复勾选态。
  - `P3-seq9` 逐项对照清单（实施后）：
    - 入口：已同义（播放菜单补齐“音频服务唤醒锁”动作）。
    - 状态：已同义（通过 `✓` 勾选态表达开关状态）。
    - 异常：已同义（动作仅写本地设置；未新增静默失败分支）。
    - 文案：已同义（固定“音频服务唤醒锁”）。
    - 排版：已同义（Cupertino ActionSheet 承载 checkable 文案，平台差异可接受）。
    - 交互触发：已同义（点击即翻转开关并落盘 `audioPlayWakeLock`，再次进入菜单保持状态）。
    - 验证：手工路径 `阅读页 -> 底部菜单长按朗读 -> 播放 -> 音频服务唤醒锁`（校验勾选态切换与重进保持）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_wake_lock` 开关入口与持久化语义，不改动书源解析与正文链路。
  - 完成 `P3-seq380`（`speak_engine_edit.xml / @+id/menu_del_login_header / 删除登录头`）：对齐 legado `HttpTtsEditDialog.menu_del_login_header -> dataFromView().removeLoginHeader()` 语义，在 HTTP 朗读引擎编辑页“更多”菜单补齐“删除登录头”入口；点击后按当前规则 `id` 映射 `httpTts:<id>` 键删除登录头缓存，不触发保存与登录流程，也不追加成功提示。
  - 验证：手工路径 `设置 -> 语音管理 -> 点击 HTTP 朗读引擎条目 -> 编辑页右上角更多 -> 删除登录头 -> 查看登录头`（校验删除后“查看登录头”仅显示标题无缓存内容；删除动作无额外提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_del_login_header` 的入口与缓存清理语义，不改动朗读执行链路与书源规则结构。
  - 完成 `P3-seq379`（`speak_engine_edit.xml / @+id/menu_show_login_header / 查看登录头`）：对齐 legado `HttpTtsEditDialog.menu_show_login_header` 语义，在 HTTP 朗读引擎编辑页“更多”菜单补齐“查看登录头”入口；点击后按当前规则 `id` 映射 `httpTts:<id>` 键读取登录头缓存并弹出“登录头”对话框，存在缓存时展示原始 JSON 文本，无缓存时仅显示标题；全流程不触发保存且不附加复制动作。
  - 验证：手工路径 `设置 -> 语音管理 -> 点击 HTTP 朗读引擎条目 -> 编辑页右上角更多 -> 查看登录头`（校验弹窗标题“登录头”、有缓存时展示 JSON 文本、无缓存时仅显示标题、不会触发保存与登录流程）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_show_login_header` 的入口与展示语义，不改动朗读执行链路与书源规则结构。

- `2026-02-21`
  - 按“主功能绝对优先”再收紧队列：将全部 `pending + detail_later` 项统一下沉到主功能项之后，`pending` 队列中首个细节项从第 `52` 位下沉到第 `297` 位。
  - 接收约束“先主功能、细节靠后”：在优先级队列中对排序/文案/拷贝/日志/帮助/主题类项增加 `detail_later` 后置标记，并下调排序分数。
  - 接收约束“漫画相关功能先不做，先做文字阅读”：将 `book_manga.xml`（`seq46~63`，18项）标记为 `blocked` 并下沉到 `HOLD` 层；当前阅读域仅推进文字链路。
  - 按需求补齐“功能项级优先级排序”：新增 `docs/plans/2026-02-21-legado-feature-priority-queue.csv`，将全部 `410` 项下钻到 `seq` 级排序，避免仅按 Phase 粗排。
  - 按需求完成“全功能排优先级”重排：新增 `S0~S4` 全量优先级模型，覆盖 tracker 全部 `410` 项；Phase 执行顺序调整为 `P1 -> P2 -> P3 -> P4 -> P5 -> P6 -> P8 -> P7 -> P10 -> P9`。
  - 已完成 Step 0：重建计划体系与 410 项跟踪台账。
  - 当前推进：P1（主入口与导航）逐项处理中。
  - 已完成 `P1-seq257`：`main_bnv.xml / @+id/menu_bookshelf / 书架`。
  - `P1-seq257` 差异点清单（实施前）：
    - `legado MainActivity.onNavigationItemReselected` 对书架采用 `300ms` 双击窗口触发 `gotoTop`；当前 Flutter 实现为重选即触发回顶，触发阈值不一致。
  - `P1-seq257` 逐项对照清单（实施后）：
    - 入口：已同义（主底栏首项为“书架”）。
    - 状态：已同义（选中态与页面切换保持一致）。
    - 异常：已同义（无新增失败分支；不改变异常可观测路径）。
    - 文案：已同义（“书架”语义一致）。
    - 排版：已同义（Cupertino 底栏形态差异属于平台允许差异）。
    - 交互触发：已同义（改为 `300ms` 双击书架触发回顶）。
    - 验证：`flutter test test/widget_test.dart` 通过；手工路径 `启动应用 -> 底栏书架标签 -> 连续两次点击书架`。
  - 兼容影响：无旧书源兼容性影响。
  - 已完成 `P1-seq258`：`main_bnv.xml / @+id/menu_discovery / 发现`。
  - `P1-seq258` 差异点清单（实施前）：
    - `legado MainActivity.onNavigationItemReselected` 对发现采用 `300ms` 双击窗口触发 `compressExplore`；当前 Flutter 实现为重选即触发压缩，触发阈值不一致。
  - `P1-seq258` 逐项对照清单（实施后）：
    - 入口：已同义（主底栏“发现”入口与 legado 同层级）。
    - 状态：已同义（选中态切换与可见性策略一致）。
    - 异常：已同义（无新增失败分支；发现页错误提示链路不变）。
    - 文案：已同义（“发现”语义一致）。
    - 排版：已同义（Cupertino 底栏形态差异属于平台允许差异）。
    - 交互触发：已同义（改为 `300ms` 双击发现触发压缩/回顶）。
    - 验证：`flutter test test/discovery_view_compile_test.dart test/widget_test.dart` 通过；手工路径 `启动应用 -> 切换到发现 -> 连续两次点击发现标签`。
  - 兼容影响：无旧书源兼容性影响。
  - 已完成 `P1-seq259`：`main_bnv.xml / @+id/menu_rss / 订阅`。
  - `P1-seq259` 差异点清单（实施前）：
    - Flutter 底栏文案为 `RSS`，legado 菜单文案语义为“订阅”；存在用户可见语义偏差。
  - `P1-seq259` 逐项对照清单（实施后）：
    - 入口：已同义（底栏订阅入口可见性受 `showRss` 控制，与 legado `showRSS` 同义）。
    - 状态：已同义（选中态与切换路径一致）。
    - 异常：已同义（无新增失败分支）。
    - 文案：已同义（改为“订阅”）。
    - 排版：已同义（Cupertino 底栏形态差异属于平台允许差异）。
    - 交互触发：已同义（点击切换到订阅页；重选无额外动作）。
    - 验证：`flutter test test/widget_test.dart test/discovery_view_compile_test.dart test/rss_subscription_view_compile_test.dart` 通过；手工路径 `启动应用 -> 点击底栏订阅标签`。
  - 兼容影响：无旧书源兼容性影响。
  - 已完成 `P1-seq260`：`main_bnv.xml / @+id/menu_my_config / 我的`。
  - `P1-seq260` 差异点清单（实施前）：
    - 未发现语义差异；需完成逐项核验并留存证据。
  - `P1-seq260` 逐项对照清单（实施后）：
    - 入口：已同义（底栏“我的”入口与 legado 同层级）。
    - 状态：已同义（选中态与切换路径一致）。
    - 异常：已同义（无新增失败分支）。
    - 文案：已同义（“我的”语义一致）。
    - 排版：已同义（Cupertino 底栏形态差异属于平台允许差异）。
    - 交互触发：已同义（点击切换到“我的”页；重选无额外动作）。
    - 验证：`flutter test test/widget_test.dart test/discovery_view_compile_test.dart test/rss_subscription_view_compile_test.dart` 通过；手工路径 `启动应用 -> 点击底栏我的标签`。
  - 兼容影响：无旧书源兼容性影响。
  - 已完成 `P1-seq261`：`main_bookshelf.xml / @+id/menu_search / 搜索`。
  - `P1-seq261` 差异点清单（实施前）：
    - 未发现语义差异；需确认入口层级与触发路径是否保持 legado `menu_search -> SearchActivity` 同义。
  - `P1-seq261` 逐项对照清单（实施后）：
    - 入口：已同义（书架顶栏常驻搜索入口，非“更多菜单”二级入口）。
    - 状态：已同义（入口常驻可用，不受书架空态/列表态影响）。
    - 异常：已同义（无新增失败分支；导航失败仍由 Flutter 路由异常链路可观测）。
    - 文案：已同义（入口语义为“搜索”）。
    - 排版：已同义（平台图标样式差异属于 `Shadcn + Cupertino` 允许差异）。
    - 交互触发：已同义（点击搜索图标打开 `SearchView`，等价 legado 启动 `SearchActivity`）。
    - 验证：`flutter test test/widget_test.dart` 通过；手工路径 `启动应用 -> 书架顶栏搜索按钮 -> 进入搜索页`。
  - 兼容影响：无旧书源兼容性影响。
  - 已完成 `P1-seq262`：`main_bookshelf.xml / @+id/menu_update_toc / 更新目录`。
  - `P1-seq262` 差异点清单（实施前）：
    - 未发现入口层级差异；需确认“更多菜单 -> 更新目录”触发与空数据反馈是否保持 legado 同义。
  - `P1-seq262` 逐项对照清单（实施后）：
    - 入口：已同义（位于书架“更多”菜单，层级与 legado `main_bookshelf` 菜单一致）。
    - 状态：已同义（非进行中显示“更新目录”，进行中显示“更新目录（进行中）”用于可观测状态提示）。
    - 异常：已同义（无可更新网络书籍时提示“当前书架没有可更新的网络书籍”）。
    - 文案：已同义（动作语义保持“更新目录”）。
    - 排版：已同义（平台 ActionSheet 差异属于 `Shadcn + Cupertino` 允许差异）。
    - 交互触发：已同义（点击后进入目录更新链路，空书架场景走同义失败提示）。
    - 验证：`flutter test test/widget_test.dart` 通过；手工路径 `启动应用 -> 书架更多菜单 -> 更新目录`。
  - 兼容影响：无旧书源兼容性影响。
  - 已完成 `P1-seq263`：`main_bookshelf.xml / @+id/menu_add_local / 添加本地`。
  - `P1-seq263` 差异点清单（实施前）：
    - Flutter 书架更多菜单文案为“本机导入”，与 legado `book_local=添加本地` 用户可见语义不一致。
  - `P1-seq263` 逐项对照清单（实施后）：
    - 入口：已同义（位于书架“更多”菜单，层级与 legado `main_bookshelf` 菜单一致）。
    - 状态：已同义（入口常驻可点击，不依赖书架内容状态）。
    - 异常：已同义（沿用既有本地导入异常提示链路，无新增静默失败分支）。
    - 文案：已同义（由“本机导入”收敛为“添加本地”）。
    - 排版：已同义（平台 ActionSheet 差异属于 `Shadcn + Cupertino` 允许差异）。
    - 交互触发：已同义（点击后触发本地导入流程，等价 legado `menu_add_local -> ImportBookActivity` 入口语义）。
    - 验证：`flutter test test/widget_test.dart` 通过；手工路径 `启动应用 -> 书架更多菜单 -> 添加本地`。
  - 兼容影响：无旧书源兼容性影响。
  - 已完成 `P1-seq264`：`main_bookshelf.xml / @+id/menu_remote / 远程书籍`。
  - `P1-seq264` 差异点清单（实施前）：
    - Flutter 书架更多菜单文案为“远程导入”，与 legado `add_remote_book=远程书籍` 用户可见语义不一致。
    - 当前点击仅走“暂未实现”提示，未形成与 legado `menu_remote -> RemoteBookActivity` 同义的页面导航路径。
  - `P1-seq264` 逐项对照清单（实施后）：
    - 入口：已同义（位于书架“更多”菜单，层级与 legado `main_bookshelf` 菜单一致）。
    - 状态：已同义（入口常驻可点击，不依赖书架内容状态）。
    - 异常：已同义（移除静默占位提示，进入远程书籍承载页后可见当前迁移状态说明）。
    - 文案：已同义（由“远程导入”收敛为“远程书籍”）。
    - 排版：已同义（平台页面容器差异属于 `Shadcn + Cupertino` 允许差异）。
    - 交互触发：已同义（点击后进入远程书籍页，等价 legado 进入 `RemoteBookActivity` 的入口语义）。
    - 验证：`flutter test test/widget_test.dart` 通过；手工路径 `启动应用 -> 书架更多菜单 -> 远程书籍`。
  - 兼容影响：无旧书源兼容性影响；远程书籍页内菜单能力按后续 `seq101~107` 继续收敛。
  - 已完成 `P1-seq265`：`main_bookshelf.xml / @+id/menu_add_url / 添加网址`。
  - `P1-seq265` 差异点清单（实施前）：
    - Flutter 书架更多菜单文案为“URL 导入”，与 legado `add_url=添加网址` 用户可见语义不一致。
    - 当前点击仅走占位提示，缺少 legado `添加书籍网址` 输入弹窗与网址加书触发链路。
  - `P1-seq265` 逐项对照清单（实施后）：
    - 入口：已同义（位于书架“更多”菜单，层级与 legado `main_bookshelf` 菜单一致）。
    - 状态：已同义（入口常驻可点击；加书过程中展示“添加中...（计数）”，并支持取消中断与清理）。
    - 异常：已同义（未成功匹配/导入时统一反馈“添加网址失败”，与 legado 失败语义一致）。
    - 文案：已同义（由“URL 导入”收敛为“添加网址”；弹窗标题为“添加书籍网址”）。
    - 排版：已同义（Cupertino 对话框与平台输入控件差异属于 `Shadcn + Cupertino` 允许差异）。
    - 交互触发：已同义（点击后弹出 URL 输入框，确认后按 `baseUrl -> bookUrlPattern` 规则匹配书源并执行加书链路；过程支持取消）。
    - 验证：`flutter test test/widget_test.dart` 通过；手工路径 `启动应用 -> 书架更多菜单 -> 添加网址 -> 输入 URL -> 确定`。
  - 兼容影响：无旧书源兼容性影响。
  - 已完成 `P1-seq266`：`main_bookshelf.xml / @+id/menu_bookshelf_manage / 书架管理`。
  - `P1-seq266` 差异点清单（实施前）：
    - Flutter 书架更多菜单“书架管理”仅弹占位提示，缺少 legado `menu_bookshelf_manage -> BookshelfManageActivity` 页面导航路径。
  - `P1-seq266` 逐项对照清单（实施后）：
    - 入口：已同义（位于书架“更多”菜单，层级与 legado `main_bookshelf` 菜单一致）。
    - 状态：已同义（入口常驻可点击，不依赖书架内容状态）。
    - 异常：已同义（从占位提示改为页面承载，当前迁移状态可见且不静默失败）。
    - 文案：已同义（“书架管理”语义保持一致）。
    - 排版：已同义（平台页面容器差异属于 `Shadcn + Cupertino` 允许差异）。
    - 交互触发：已同义（点击后进入书架管理页，等价 legado 进入 `BookshelfManageActivity` 的入口语义）。
    - 验证：`flutter test test/widget_test.dart` 通过；手工路径 `启动应用 -> 书架更多菜单 -> 书架管理`。
  - 兼容影响：无旧书源兼容性影响；页内批量管理动作按后续对应序号逐项迁移。
  - 已完成 `P1-seq267`：`main_bookshelf.xml / @+id/menu_download / 缓存/导出`。
  - `P1-seq267` 差异点清单（实施前）：
    - Flutter 书架更多菜单文案为“缓存导出”，与 legado `cache_export=缓存/导出` 用户可见语义不一致。
    - 当前点击仅走占位提示，缺少 legado `menu_download -> CacheActivity` 页面导航路径。
  - `P1-seq267` 逐项对照清单（实施后）：
    - 入口：已同义（位于书架“更多”菜单，层级与 legado `main_bookshelf` 菜单一致）。
    - 状态：已同义（入口常驻可点击，不依赖书架内容状态）。
    - 异常：已同义（从占位提示改为页面承载，当前迁移状态可见且不静默失败）。
    - 文案：已同义（由“缓存导出”收敛为“缓存/导出”）。
    - 排版：已同义（平台页面容器差异属于 `Shadcn + Cupertino` 允许差异）。
    - 交互触发：已同义（点击后进入缓存/导出页，等价 legado 进入 `CacheActivity` 的入口语义）。
    - 验证：`flutter test test/widget_test.dart` 通过；手工路径 `启动应用 -> 书架更多菜单 -> 缓存/导出`。
  - 兼容影响：无旧书源兼容性影响；缓存下载与导出页内菜单动作按后续对应序号逐项迁移。
  - 已完成 `P1-seq268`：`main_bookshelf.xml / @+id/menu_group_manage / 分组管理`。
  - `P1-seq268` 差异点清单（实施前）：
    - Flutter 书架更多菜单“分组管理”点击后仅弹占位提示，缺少 legado `menu_group_manage -> GroupManageDialog` 的对话框层级触发语义。
  - `P1-seq268` 逐项对照清单（实施后）：
    - 入口：已同义（位于书架“更多”菜单，层级与 legado `main_bookshelf` 菜单一致）。
    - 状态：已同义（入口常驻可点击，不依赖书架内容状态）。
    - 异常：已同义（移除占位提示；改为弹窗承载并明确当前迁移状态，避免静默失败）。
    - 文案：已同义（保留“分组管理”语义，与 legado 一致）。
    - 排版：已同义（改为对话框层级承载；Cupertino 对话框视觉差异属于 `Shadcn + Cupertino` 允许差异）。
    - 交互触发：已同义（点击后弹出分组管理弹窗，等价 legado `showDialogFragment<GroupManageDialog>()` 的入口语义）。
    - 验证：`flutter test test/widget_test.dart` 通过；手工路径 `启动应用 -> 书架更多菜单 -> 分组管理 -> 弹出分组管理对话框`。
  - 兼容影响：无旧书源兼容性影响；分组新增/编辑/排序等页内动作按后续对应序号逐项迁移。
  - 已完成 `P1-seq269`：`main_bookshelf.xml / @+id/menu_bookshelf_layout / 书架布局`。
  - `P1-seq269` 差异点清单（实施前）：
    - Flutter 书架布局入口为 `ActionSheet` 即时选择，缺少 legado `configBookshelf` 的“确认式弹窗 + 统一提交”交互语义。
    - Flutter 仅支持“图墙/列表 + 4 种排序”，缺少 legado 入口内“分组样式、未读数量、最新更新时间、待更新计数、快速滚动条、5 档布局、6 档排序”配置项。
    - AppSettings 缺少 legado 对应配置字段（`bookGroupStyle/bookshelfLayout/bookshelfSort/showUnread/showLastUpdateTime/showWaitUpCount/showBookshelfFastScroller`）的持久化映射。
  - `P1-seq269` 逐项对照清单（实施后）：
    - 入口：已同义（书架“更多”菜单点击“书架布局”后进入配置弹窗）。
    - 状态：已同义（改为“取消不生效、确定统一提交”的确认式状态流转，匹配 legado `okButton/cancelButton` 语义）。
    - 异常：已同义（配置数据统一落盘；非法索引在解析时归一到合法区间，避免异常值导致 UI 崩溃）。
    - 文案：已同义（配置项采用 legado 语义：分组样式、显示未读数量、显示最新更新时间、显示待更新计数、显示快速滚动条、视图、排序）。
    - 排版：已同义（采用 `CupertinoAlertDialog` + 分区选项承载；视觉差异属于 `Shadcn + Cupertino` 平台允许差异）。
    - 交互触发：已同义（确定后应用布局索引/排序索引并刷新书架；未读/更新时间/快速滚动条/待更新计数开关即时反映在书架页表现层）。
    - 验证：`flutter test test/widget_test.dart test/app_settings_test.dart` 通过；手工路径 `启动应用 -> 书架更多菜单 -> 书架布局 -> 修改选项 -> 确定`。
  - 兼容影响：无旧书源兼容性影响；新增配置字段已兼容 legacy key 读写（`bookshelfLayout/bookshelfSort/showUnread/...`），对旧配置文件回放无破坏性。
  - 已完成 `P1-seq270`：`main_bookshelf.xml / @+id/menu_export_bookshelf / 导出书单`。
  - `P1-seq270` 差异点清单（实施前）：
    - Flutter 书架更多菜单文案为“导出书架”，与 legado `export_bookshelf=导出书单` 用户可见语义不一致。
    - Flutter 成功路径仅弹出“导出成功：路径”文案，缺少 legado `export_success` 成功弹窗中的路径可复制交互语义。
  - `P1-seq270` 逐项对照清单（实施后）：
    - 入口：已同义（位于书架“更多”菜单，层级与 legado `main_bookshelf` 菜单一致）。
    - 状态：已同义（用户取消文件保存时不提示成功；保存成功后弹出导出成功确认弹窗）。
    - 异常：已同义（导出异常统一反馈“导出书籍出错\n错误摘要”，保持可观测失败分支）。
    - 文案：已同义（由“导出书架”收敛为“导出书单”）。
    - 排版：已同义（采用 `CupertinoAlertDialog` 承载成功提示与复制动作；视觉差异属于 `Shadcn + Cupertino` 平台允许差异）。
    - 交互触发：已同义（点击后进入保存路径选择；成功后展示路径并支持“复制”，等价 legado 导出成功弹窗可复制 URI 的语义）。
    - 验证：`flutter test test/widget_test.dart` 通过；手工路径 `启动应用 -> 书架更多菜单 -> 导出书单 -> 选择保存路径 -> 导出成功弹窗 -> 点击复制`。
  - 兼容影响：无旧书源兼容性影响；导出 JSON 仍保持 legado 同义字段 `name/author/intro`。
  - 已完成 `P1-seq271`：`main_bookshelf.xml / @+id/menu_import_bookshelf / 导入书单`。
  - `P1-seq271` 差异点清单（实施前）：
    - Flutter 书架更多菜单文案为“导入书架”，与 legado `import_bookshelf=导入书单` 用户可见语义不一致。
    - Flutter 入口点击后直接选择文件，缺少 legado `importBookshelfAlert` 的 `url/json` 输入弹窗与“选择文件”并存入口。
    - Flutter 解析口径支持“文件 JSON/对象容错”，但缺少 legado 同义的 `http/https 链接 -> 拉取文本 -> 按 url/json 递归解析` 路径与“非 JSON 数组即格式不对”语义。
  - `P1-seq271` 逐项对照清单（实施后）：
    - 入口：已同义（位于书架“更多”菜单，层级与 legado `main_bookshelf` 菜单一致）。
    - 状态：已同义（点击后弹出“导入书单”对话框，支持输入框与文件选择双入口；导入过程中展示进度弹窗）。
    - 异常：已同义（空输入或非数组 JSON 统一反馈“格式不对”；URL 请求失败可见 `HTTP/网络请求失败` 错误摘要）。
    - 文案：已同义（由“导入书架”收敛为“导入书单”；输入框提示为 `url/json`）。
    - 排版：已同义（采用 `CupertinoAlertDialog` 承载输入与三按钮动作；视觉差异属于 `Shadcn + Cupertino` 平台允许差异）。
    - 交互触发：已同义（“确定”按 `url/json` 语义导入；“选择文件”仅允许 `txt/json` 并复用同一解析链路，等价 legado `okButton + neutralButton(select_file)`）。
    - 验证：`flutter test test/widget_test.dart` 通过；手工路径 `启动应用 -> 书架更多菜单 -> 导入书单 -> 输入 url/json 或点击选择文件 -> 确定进入导入流程`。
  - 兼容影响：无旧书源兼容性影响；仅调整书架入口与导入解析口径，不改变既有书源数据结构。
  - 已完成 `P1-seq272`：`main_bookshelf.xml / @+id/menu_log / 日志`。
  - `P1-seq272` 差异点清单（实施前）：
    - Flutter 书架“日志”入口跳转的是 `ExceptionLogsView` 页面，触发层级与 legado `showDialogFragment<AppLogDialog>()` 的弹层语义不一致。
    - Flutter 日志页标题为“异常日志”，与 legado 菜单动作文案“日志”存在用户可见语义偏差。
  - `P1-seq272` 逐项对照清单（实施后）：
    - 入口：已同义（位于书架“更多”菜单，层级与 legado `main_bookshelf` 菜单一致）。
    - 状态：已同义（点击后弹出“日志”对话框；日志为空时展示“暂无日志”）。
    - 异常：已同义（无新增静默失败分支；日志为空与清空后状态均可见）。
    - 文案：已同义（入口与弹层标题统一为“日志”，并提供“清空”动作）。
    - 排版：已同义（改为对话框层级承载；Cupertino 弹层视觉差异属于 `Shadcn + Cupertino` 平台允许差异）。
    - 交互触发：已同义（点击菜单弹出日志弹层；点击“清空”立即清空列表；点击含堆栈条目可打开详情弹窗）。
    - 验证：`flutter test test/widget_test.dart` 通过；手工路径 `启动应用 -> 书架更多菜单 -> 日志 -> 弹出日志对话框 -> 清空`。
  - 兼容影响：无旧书源兼容性影响；仅调整日志入口承载形态与文案语义，不变更书源链路。
  - 已完成 `P1-seq273`：`main_explore.xml / @+id/menu_group / 分组`。
  - `P1-seq273` 差异点清单（实施前）：
    - Flutter 发现页分组入口为 `OptionPickerSheet`，与 legado `main_explore/menu_group` 的工具栏动态子菜单触发形态不一致。
    - Flutter 分组排序使用默认 `sort()`，与 legado `BookSourceDao.dealGroups -> cnCompare` 的中文排序语义不一致。
    - Flutter `group:` 查询分支采用“拆分后 contains”匹配，未对齐 legado `flowGroupExplore` 的逗号边界匹配语义。
  - `P1-seq273` 逐项对照清单（实施后）：
    - 入口：已同义（发现页右上角“分组”动作保留为一级入口，点击后展示动态分组动作列表）。
    - 状态：已同义（分组为空时入口不额外弹错误提示；分组存在时可直接选择并应用筛选）。
    - 异常：已同义（无新增静默失败分支；分组筛选为空结果时保持发现页原有空列表表现）。
    - 文案：已同义（入口与动作文案均为“分组/分组名”，保持 legado 业务语义）。
    - 排版：已同义（采用 `CupertinoActionSheet` 承载动态分组动作；平台视觉差异属于 `Shadcn + Cupertino` 允许差异）。
    - 交互触发：已同义（点击分组后写入 `group:<分组>` 并即时筛选，等价 legado `setQuery(\"group:...\", true)` 触发路径；筛选匹配规则收敛为 legado `flowGroupExplore` 逗号边界语义）。
    - 验证：`flutter test test/discovery_view_compile_test.dart test/widget_test.dart` 通过；手工路径 `启动应用 -> 发现页 -> 右上角分组 -> 选择分组 -> 查询框显示 group:分组 且列表即时筛选`。
  - 兼容影响：无旧书源兼容性影响；仅收敛发现页分组入口与筛选语义。
  - 已完成 `P1-seq274`：`main_my.xml / @+id/menu_help / 帮助`。
  - `P1-seq274` 差异点清单（实施前）：
    - Flutter “我的”页未提供 `main_my/menu_help` 对应的顶栏帮助入口，触发层级与 legado `MyFragment` 右上角帮助按钮不一致。
    - Flutter 无 `appHelp` 资产与加载链路，缺失 legado `showHelp("appHelp") -> assets/web/help/md/appHelp.md` 帮助文档展示语义。
    - 现有页面未提供帮助弹层承载，无法等价 legado `TextDialog(Mode.MD)` 的“同页弹层查看帮助”交互路径。
  - `P1-seq274` 逐项对照清单（实施后）：
    - 入口：已同义（“我的”页顶栏新增右上角“帮助”动作，层级与 legado `main_my/menu_help` 一致）。
    - 状态：已同义（帮助按钮常驻可点击；加载中显示活动指示器，避免重复触发）。
    - 异常：已同义（资源加载失败时弹窗提示“帮助文档加载失败”，保持失败分支可观测）。
    - 文案：已同义（入口语义为“帮助”；弹层标题为“帮助”，文档内容来自 legado 同源 `appHelp.md`）。
    - 排版：已同义（采用 `CupertinoPopupSurface` + 可滚动正文承载长文档；平台视觉差异属于 `Shadcn + Cupertino` 允许差异）。
    - 交互触发：已同义（点击后读取 `assets/web/help/md/appHelp.md` 并弹层展示，等价 legado `showHelp("appHelp")` 触发路径）。
    - 验证：`flutter test test/widget_test.dart` 通过；手工路径 `启动应用 -> 底栏我的 -> 右上角帮助 -> 弹出帮助文档弹层`。
  - 兼容影响：无旧书源兼容性影响；仅补齐“我的”页帮助入口与本地帮助文档资产。
  - 已完成 `P1-seq275`：`main_rss.xml / @+id/menu_rss_star / 收藏`。
  - `P1-seq275` 差异点清单（实施前）：
    - tracker 中 `seq275` 仍为 `pending`，缺少可复现验证证据，无法闭环该项迁移记录。
    - 需确认 Flutter 订阅页顶栏星标入口保持 legado `menu_rss_star -> RssFavoritesActivity` 的一级触发语义。
  - `P1-seq275` 逐项对照清单（实施后）：
    - 入口：已同义（订阅页顶栏星标“收藏”入口保持一级动作层级）。
    - 状态：已同义（入口常驻可点击，不依赖订阅源列表与筛选状态）。
    - 异常：已同义（无新增静默失败分支；导航异常仍由现有路由错误链路可观测）。
    - 文案：已同义（目标承载页标题为“收藏”，与 legado 业务语义一致）。
    - 排版：已同义（顶栏动作与页面容器视觉差异属于 `Shadcn + Cupertino` 平台允许差异）。
    - 交互触发：已同义（点击星标进入收藏承载页，等价 legado 打开 `RssFavoritesActivity` 的入口语义）。
    - 验证：`flutter test test/widget_test.dart` 通过；手工路径 `启动应用 -> 底栏订阅 -> 顶栏星标收藏 -> 进入收藏页`。
  - 兼容影响：无旧书源兼容性影响；仅收敛 RSS 顶栏收藏入口，收藏页内分组/删除等动作按 `P7-seq307~309` 继续迁移。
  - 已完成 `P1-seq276`：`main_rss.xml / @+id/menu_group / 分组`。
  - `P1-seq276` 差异点清单（实施前）：
    - Flutter 订阅页“分组”入口使用通用 `OptionPickerSheet`，并额外提供 legado 无对应能力的“全部”扩展项，菜单结构与触发语义不一致。
    - 缺少 `main_rss/menu_group` 的独立可复现验证证据，tracker 仍为 `pending`。
  - `P1-seq276` 逐项对照清单（实施后）：
    - 入口：已同义（订阅页顶栏保留一级“分组”入口，层级与 legado `main_rss/menu_group` 一致）。
    - 状态：已同义（仅在存在启用分组时弹出动态分组菜单；分组为空时不引入额外提示分支）。
    - 异常：已同义（无新增静默失败分支；筛选结果为空时保持订阅页原有空态语义）。
    - 文案：已同义（移除“全部”扩展项，仅展示分组名称列表并保持 `group:<分组>` 业务语义）。
    - 排版：已同义（改为 `CupertinoActionSheet` 承载动态分组菜单；视觉差异属于 `Shadcn + Cupertino` 平台允许差异）。
    - 交互触发：已同义（点击分组后查询写入 `group:<分组>` 并即时筛选，等价 legado `searchView.setQuery(\"group:...\", true)`）。
    - 验证：`flutter test test/rss_subscription_view_group_menu_test.dart test/widget_test.dart` 通过；手工路径 `启动应用 -> 底栏订阅 -> 顶栏分组 -> 选择分组 -> 查询文案显示 group:分组 且列表按启用分组筛选`。
  - 兼容影响：无旧书源兼容性影响；仅收敛订阅页分组入口形态与筛选触发语义。
  - 已完成 `P1-seq277`：`main_rss.xml / @+id/menu_rss_config / 设置`。
  - `P1-seq277` 差异点清单（实施前）：
    - tracker 中 `seq277` 仍为 `pending`，缺少可复现验证证据，无法闭环该项迁移记录。
    - 需确认 Flutter 订阅页顶栏设置入口保持 legado `menu_rss_config -> RssSourceActivity` 的一级触发语义。
  - `P1-seq277` 逐项对照清单（实施后）：
    - 入口：已同义（订阅页顶栏“设置”入口保持一级动作层级）。
    - 状态：已同义（入口常驻可点击，不依赖订阅源列表与筛选状态）。
    - 异常：已同义（无新增静默失败分支；导航异常仍由现有路由错误链路可观测）。
    - 文案：已同义（入口语义为“设置”，与 legado 菜单动作一致）。
    - 排版：已同义（顶栏动作视觉差异属于 `Shadcn + Cupertino` 平台允许差异）。
    - 交互触发：已同义（点击设置后进入 `RssSourceManageView`，等价 legado 打开 `RssSourceActivity` 的入口语义）。
    - 验证：`flutter test test/widget_test.dart --plain-name "RSS settings action opens source manage page"`、`flutter test test/rss_subscription_view_group_menu_test.dart` 通过；手工路径 `启动应用 -> 底栏订阅 -> 顶栏设置 -> 进入订阅源管理页`。
  - 兼容影响：无旧书源兼容性影响；仅补齐 `main_rss/menu_rss_config` 的独立验证证据，不改变书源数据结构与同步链路。
  - 阶段收口：`P1` 共 `21/21` 项完成，`blocked=0`。
  - 当前推进：P2（搜索/详情/目录）逐项处理中。
  - 已完成 `P2-seq30`：`book_info.xml / @+id/menu_edit / 编辑`。
  - `P2-seq30` 差异点清单（实施前）：
    - tracker 中 `seq30` 仍为 `pending`，缺少可复现验证证据，无法闭环该项迁移记录。
    - 需确认 Flutter 详情页编辑入口可见性是否对齐 legado `BookInfoActivity.upTvBookshelf -> editMenuItem.isVisible = inBookshelf` 语义。
    - 需补充“点击编辑后进入编辑页”的页面级回归用例，避免仅凭代码阅读宣称同义。
  - `P2-seq30` 逐项对照清单（实施后）：
    - 入口：已同义（详情页顶栏保留一级编辑动作入口）。
    - 状态：已同义（仅当书籍在书架中时显示编辑入口；不在书架时隐藏，与 legado 同义）。
    - 异常：已同义（非书架书籍不会暴露编辑入口，避免误触发；既有失败提示链路保持可观测）。
    - 文案：已同义（编辑页标题与字段语义保持“编辑书籍信息/书名/作者”）。
    - 排版：已同义（顶栏图标与编辑页表单采用 `Shadcn + Cupertino` 承载，平台视觉差异属于允许范围）。
    - 交互触发：已同义（点击编辑进入 `SearchBookInfoEditView`，等价 legado `menu_edit -> BookInfoEditActivity` 触发语义，保存回写链路保持不变）。
    - 验证：`flutter test test/search_book_info_edit_helper_test.dart test/search_book_info_menu_helper_test.dart test/search_book_info_view_edit_action_test.dart` 通过；手工路径 `书架 -> 书籍详情 -> 顶栏编辑 -> 进入编辑书籍信息页`。
  - 兼容影响：无旧书源兼容性影响；仅补齐 `menu_edit` 的迁移证据与页面级回归用例，不改变书源/目录数据结构。
  - 已完成 `P2-seq31`：`book_info.xml / @+id/menu_share_it / 分享`。
  - `P2-seq31` 差异点清单（实施前）：
    - Flutter 详情页分享入口点击后进入 `SourceQrShareView` 中间页，触发路径与 legado `menu_share_it -> shareWithQr` 的“直接系统分享”语义不一致。
    - Flutter 分享载荷为定制字段集合（`name/author/sourceName/...`），未对齐 legado `bookUrl#bookJson` 拼接规则。
    - Flutter 二维码生成失败时回退为文本分享，未对齐 legado `text_too_long_qr_error` 的失败提示语义。
  - `P2-seq31` 逐项对照清单（实施后）：
    - 入口：已同义（详情页顶栏保留一级分享动作入口）。
    - 状态：已同义（点击后直接进入系统分享流程，不再经过二维码预览中间页）。
    - 异常：已同义（二维码生成失败时提示“文字太多，生成二维码失败”，与 legado `text_too_long_qr_error` 语义一致）。
    - 文案：已同义（分享主题优先使用书名；失败文案收敛为 legado 同义中文语义）。
    - 排版：已同义（分享仍由系统面板承载；平台分享面板视觉差异属于 `Shadcn + Cupertino` 允许差异）。
    - 交互触发：已同义（点击分享后生成二维码图片并调用系统分享，载荷收敛为 `bookUrl#bookJson`，等价 legado `shareWithQr("$bookUrl#$bookJson", name)`）。
    - 验证：`flutter test test/search_book_info_edit_helper_test.dart test/search_book_info_menu_helper_test.dart test/search_book_info_share_helper_test.dart test/search_book_info_view_compile_test.dart test/search_book_info_view_edit_action_test.dart` 通过；手工路径 `书架 -> 书籍详情 -> 顶栏分享 -> 系统分享面板`。
  - 兼容影响：无旧书源兼容性影响；仅收敛详情页分享入口语义与载荷格式，不变更书源解析链路。
  - 已完成 `P2-seq32`：`book_info.xml / @+id/menu_upload / 上传 WebDav`。
  - `P2-seq32` 差异点清单（实施前）：
    - Flutter 详情页更多菜单文案为“上传到远程”，与 legado `upload_to_remote=上传 WebDav` 用户可见语义不一致。
    - Flutter 确认弹窗标题/文案为“提示 + 远程 WebDav 链接已存在，是否继续上传？”，并附带远程 URL，偏离 legado `draw/sure_upload` 的固定提醒语义。
    - Flutter 上传等待态仅展示无文案的活动指示器，缺少 legado `WaitDialog("上传中.....")` 的可见状态文案。
  - `P2-seq32` 逐项对照清单（实施后）：
    - 入口：已同义（详情页“更多”菜单保留一级“上传 WebDav”动作入口）。
    - 状态：已同义（仅本地书籍显示上传入口；已有远程链接时先确认，取消则不进入上传流程）。
    - 异常：已同义（上传失败沿用错误摘要提示；取消确认不产生副作用）。
    - 文案：已同义（入口文案收敛为“上传 WebDav”；确认弹窗收敛为“提醒 / 远程webDav链接已存在，是否继续”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet + CupertinoAlertDialog + CupertinoPopupSurface`；视觉差异属于 `Shadcn + Cupertino` 允许差异）。
    - 交互触发：已同义（存在远程链接时先弹确认，确认后进入上传并显示“上传中.....”等待态，等价 legado `menu_upload -> sure_upload -> upLoadBook` 状态流转）。
    - 验证：`flutter test test/search_book_info_view_upload_action_test.dart test/search_book_info_view_edit_action_test.dart test/search_book_info_menu_helper_test.dart test/search_book_info_share_helper_test.dart test/search_book_info_view_compile_test.dart` 通过；手工路径 `书架 -> 本地书籍详情 -> 右上角更多 -> 上传 WebDav -> 已有远程链接时弹确认 -> 取消`。
  - 兼容影响：无旧书源兼容性影响；仅收敛详情页上传入口文案与交互语义，不变更书源解析或目录链路。
  - 已完成 `P2-seq33`：`book_info.xml / @+id/menu_refresh / 刷新`。
  - `P2-seq33` 差异点清单（实施前）：
    - Flutter 详情页 `menu_refresh` 在书架内默认走“刷新目录”链路，本地书籍会被“缺少详情链接，无法刷新目录”直接拦截，与 legado `menu_refresh -> refreshBook()` 的统一刷新语义不一致。
    - Flutter 刷新链路缺少本地 TXT/EPUB 重解析与章节回写能力，无法对齐 legado 本地书籍刷新后“详情/目录同步更新”的状态流转。
    - 当前测试基线缺少本地刷新链路的定向验证，tracker 无法闭环该项迁移证据。
  - `P2-seq33` 逐项对照清单（实施后）：
    - 入口：已同义（详情页“更多”菜单仍保留一级“刷新”动作）。
    - 状态：已同义（书架内本地书籍走本地重解析链路；书架内网络书籍维持详情+目录刷新链路；非书架场景维持详情重载）。
    - 异常：已同义（本地路径缺失/文件不存在/不支持格式时给出可观测错误提示；网络刷新失败沿用现有可观测提示）。
    - 文案：已同义（入口文案保持“刷新”，未新增扩展入口与扩展文案）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 与既有提示弹层承载，平台视觉差异属于 `Shadcn + Cupertino` 允许差异）。
    - 交互触发：已同义（点击刷新后收敛为 legado `refreshBook` 语义：刷新详情/目录并回写书架缓存）。
    - 验证：`flutter test test/search_book_info_refresh_helper_test.dart test/search_book_info_view_upload_action_test.dart test/search_book_info_view_edit_action_test.dart test/search_book_info_menu_helper_test.dart test/search_book_info_share_helper_test.dart test/search_book_info_view_compile_test.dart` 通过；手工路径 `书架 -> 本地书籍详情 -> 右上角更多 -> 刷新`。
  - 兼容影响：无旧书源兼容性影响；新增本地刷新 helper 仅作用于详情页刷新链路，不改变既有书源规则解析接口。
  - 已完成 `P2-seq34`：`book_info.xml / @+id/menu_login / 登录`。
  - `P2-seq34` 差异点清单（实施前）：
    - tracker 中 `seq34` 仍为 `pending`，缺少可复现验证证据，无法闭环该项迁移记录。
    - 需确认 Flutter 详情页“登录”入口可见性是否严格对齐 legado `BookInfoActivity.onMenuOpened -> !bookSource.loginUrl.isNullOrBlank()` 语义。
    - 需确认点击“登录”后的分支优先级保持 legado 同义：有 `loginUi` 走表单登录，无 `loginUi` 走网页登录。
  - `P2-seq34` 逐项对照清单（实施后）：
    - 入口：已同义（详情页“更多”菜单保留一级“登录”动作入口）。
    - 状态：已同义（仅当 `bookSource.loginUrl` 非空时展示登录入口；`loginUrl` 为空即隐藏，即使 `loginUi` 非空也不展示）。
    - 异常：已同义（无书源或登录入口不可见时不会触发登录流程；保留现有可观测提示链路）。
    - 文案：已同义（入口文案为“登录”，与 legado `@string/login` 语义一致）。
    - 排版：已同义（沿用 `CupertinoActionSheet` 菜单承载；视觉差异属于 `Shadcn + Cupertino` 平台允许差异）。
    - 交互触发：已同义（点击登录时优先进入 `loginUi` 表单登录页，否则进入网页登录流程；触发语义对齐 legado `menu_login -> SourceLoginActivity(type=bookSource, key=bookSourceUrl)`）。
    - 验证：`flutter test test/search_book_info_menu_helper_test.dart test/search_book_info_view_login_action_test.dart` 通过；手工路径 `书架 -> 书籍详情 -> 右上角更多 -> 登录`（校验 `loginUrl` 为空隐藏入口、`loginUrl` 非空且 `loginUi` 存在时进入表单登录页）。
  - 兼容影响：无旧书源兼容性影响；本次仅补齐 `menu_login` 的页面级回归与台账证据，不改变书源解析与 Cookie 存储链路。
  - 已完成 `P2-seq35`：`book_info.xml / @+id/menu_top / 置顶`。
  - `P2-seq35` 差异点清单（实施前）：
    - Flutter 详情页 `menu_top` 在执行前新增了“当前书籍不在书架，无法置顶/书架记录不存在，无法置顶”的前置拦截提示，触发语义偏离 legado `menu_top -> topBook()` 的“点击即写库”路径。
    - 缺少 `menu_top` 的独立可复现验证证据，tracker 仍为 `pending`，无法闭环该项迁移记录。
  - `P2-seq35` 逐项对照清单（实施后）：
    - 入口：已同义（详情页“更多”菜单保留一级“置顶”动作入口）。
    - 状态：已同义（入口常驻可点击，不新增前置拦截弹窗分支）。
    - 异常：已同义（当书架记录缺失时静默返回，不引入扩展失败文案；保持 legado 同义无阻断语义）。
    - 文案：已同义（保留“置顶”业务语义，不新增扩展入口文案）。
    - 排版：已同义（沿用 `CupertinoActionSheet` 菜单承载；视觉差异属于 `Shadcn + Cupertino` 允许差异）。
    - 交互触发：已同义（点击后直接执行置顶写库，更新书架时间戳用于排序可见性；触发语义对齐 legado `menu_top -> topBook`）。
    - 验证：`flutter test test/search_book_info_top_helper_test.dart test/search_book_info_view_top_action_test.dart test/search_book_info_menu_helper_test.dart test/search_book_info_view_login_action_test.dart` 通过；手工路径 `书架 -> 书籍详情 -> 右上角更多 -> 置顶`（确认点击后无前置拦截，书籍置顶可见）。
  - 兼容影响：无旧书源兼容性影响；仅收敛 `menu_top` 触发语义与置顶写库测试证据，不改变书源解析与目录链路。
  - 已完成 `P2-seq36`：`book_info.xml / @+id/menu_set_source_variable / 设置源变量`。
  - `P2-seq36` 差异点清单（实施前）：
    - Flutter `SourceVariableStore.putVariable` 将空字符串视为删除，而 legado `BaseSource.setVariable(variable)` 仅在 `variable == null` 时删除，空字符串应被保留。
    - Flutter 详情页保存源变量后会额外提示“源变量已保存”，legado `BookInfoActivity.setVariable` 仅回写变量不追加成功提示，存在扩展文案偏差。
    - Flutter 源变量兜底错误文案为“书源不存在，无法设置源变量”，legado 原始文案为“书源不存在”，存在可见语义偏差。
  - `P2-seq36` 逐项对照清单（实施后）：
    - 入口：已同义（详情页“更多”菜单保留一级“设置源变量”动作入口）。
    - 状态：已同义（仅在 `bookSource` 存在时展示入口，与 legado `onMenuOpened -> menu_set_source_variable.isVisible = bookSource != null` 同义）。
    - 异常：已同义（书源缺失时提示收敛为“书源不存在”，保留可观测失败分支）。
    - 文案：已同义（入口文案“设置源变量”与注释默认文案 `源变量可在js中通过source.getVariable()获取` 保持 legado 语义）。
    - 排版：已同义（沿用 `CupertinoActionSheet + CupertinoAlertDialog` 承载输入弹窗，视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击后读取 `sourceVariable_<bookSourceUrl>` 当前值；保存时调用 `setVariable` 同义逻辑，空字符串写入不删除，且不追加扩展成功提示）。
    - 验证：`flutter test test/source_variable_store_test.dart test/search_book_info_view_source_variable_action_test.dart` 通过；手工路径 `书架 -> 书籍详情 -> 右上角更多 -> 设置源变量 -> 清空后保存并再次打开弹窗`（确认空串可回读且无额外“已保存”提示）。
  - 兼容影响：无旧书源兼容性影响；仅收敛 `menu_set_source_variable` 的存储边界与提示文案语义，不改变书源解析/目录链路。
  - 已完成 `P2-seq37`：`book_info.xml / @+id/menu_set_book_variable / 设置书籍变量`。
  - `P2-seq37` 差异点清单（实施前）：
    - Flutter `BookVariableStore.putVariable` 将空字符串/空白字符串视为删除，而 legado `Book.putCustomVariable -> RuleDataInterface.putVariable` 仅在 `value == null` 时删除，空字符串应被保留。
    - Flutter 详情页保存书籍变量后会额外提示“书籍变量已保存”，legado `BookInfoActivity.setVariable` 仅回写变量不追加成功提示，存在扩展文案偏差。
    - Flutter 书籍变量兜底错误文案为“书源不存在，无法设置书籍变量”，legado 原始文案为“书源不存在”，存在可见语义偏差。
  - `P2-seq37` 逐项对照清单（实施后）：
    - 入口：已同义（详情页“更多”菜单保留一级“设置书籍变量”动作入口）。
    - 状态：已同义（仅在 `bookSource` 存在时展示入口，与 legado `onMenuOpened -> menu_set_book_variable.isVisible = bookSource != null` 同义）。
    - 异常：已同义（书源缺失时提示收敛为“书源不存在”；书籍链接缺失时静默返回，不引入扩展失败文案）。
    - 文案：已同义（入口文案“设置书籍变量”与注释默认文案 `书籍变量可在js中通过book.getVariable("custom")获取` 保持 legado 语义）。
    - 排版：已同义（沿用 `CupertinoActionSheet + CupertinoAlertDialog` 承载输入弹窗，视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击后读取 `bookVariable_<bookUrl>` 当前值；保存时调用 `setVariable` 同义逻辑，空字符串写入不删除，且不追加扩展成功提示）。
    - 验证：`flutter test test/book_variable_store_test.dart test/search_book_info_view_book_variable_action_test.dart` 通过；手工路径 `书架 -> 书籍详情 -> 右上角更多 -> 设置书籍变量 -> 清空后保存并再次打开弹窗`（确认空串可回读且无额外“已保存”提示）。
  - 兼容影响：无旧书源兼容性影响；仅收敛 `menu_set_book_variable` 的存储边界与提示文案语义，不改变书源解析/目录链路。
  - 已完成 `P2-seq38`：`book_info.xml / @+id/menu_copy_book_url / 拷贝书籍 URL`。
  - `P2-seq38` 差异点清单（实施前）：
    - Flutter 详情页菜单文案为“复制书籍链接”，与 legado `copy_book_url=拷贝书籍 URL` 存在用户可见语义偏差。
    - Flutter 成功提示为“已复制书籍链接”且 `bookUrl` 为空时提示“当前书籍链接为空”，而 legado `menu_copy_book_url -> sendToClip(bookUrl)` 统一反馈“复制完成”，空字符串也按复制链路执行。
  - `P2-seq38` 逐项对照清单（实施后）：
    - 入口：已同义（详情页“更多”菜单保留一级“拷贝书籍 URL”动作入口）。
    - 状态：已同义（入口常驻可点击，不依赖书架/非书架状态切换）。
    - 异常：已同义（复制流程不新增扩展失败文案；空字符串场景按 legado 语义走复制完成链路）。
    - 文案：已同义（菜单文案收敛为“拷贝书籍 URL”，复制反馈收敛为“复制完成”）。
    - 排版：已同义（沿用 `CupertinoActionSheet` 菜单承载与现有提示弹窗，视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击后将 `_resolveBookUrl()` 结果写入剪贴板，包含空字符串场景，不再拦截为“链接为空”）。
    - 验证：`flutter test test/search_book_info_view_copy_book_url_action_test.dart test/search_book_info_view_compile_test.dart` 通过；手工路径 `书架 -> 书籍详情 -> 右上角更多 -> 拷贝书籍 URL`（确认剪贴板已更新且反馈“复制完成”）。
  - 兼容影响：无旧书源兼容性影响；仅收敛 `menu_copy_book_url` 的菜单文案与复制反馈语义，不影响书源解析与目录链路。
  - 已完成 `P2-seq39`：`book_info.xml / @+id/menu_copy_toc_url / 拷贝目录 URL`。
  - `P2-seq39` 差异点清单（实施前）：
    - Flutter 详情页菜单文案为“复制目录链接”，与 legado `copy_toc_url=拷贝目录 URL` 存在用户可见语义偏差。
    - Flutter `tocUrl` 为空时会提示“当前目录链接为空”并中断复制，成功提示为“已复制目录链接”；而 legado `menu_copy_toc_url -> sendToClip(tocUrl)` 不做空值拦截，统一反馈“复制完成”。
  - `P2-seq39` 逐项对照清单（实施后）：
    - 入口：已同义（详情页“更多”菜单保留一级“拷贝目录 URL”动作入口）。
    - 状态：已同义（入口常驻可点击，不依赖书架/非书架状态切换）。
    - 异常：已同义（复制流程不再追加“目录链接为空”扩展提示；空字符串场景按 legado 语义走复制完成链路）。
    - 文案：已同义（菜单文案收敛为“拷贝目录 URL”，复制反馈收敛为“复制完成”）。
    - 排版：已同义（沿用 `CupertinoActionSheet` 菜单承载与现有提示弹窗，视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击后将 `_resolveTocUrl()` 结果写入剪贴板，包含空字符串场景，不再拦截）。
    - 验证：`flutter test test/search_book_info_view_copy_toc_url_action_test.dart test/search_book_info_view_copy_book_url_action_test.dart` 通过；手工路径 `书架 -> 书籍详情 -> 右上角更多 -> 拷贝目录 URL`（确认剪贴板已更新且反馈“复制完成”）。
  - 兼容影响：无旧书源兼容性影响；仅收敛 `menu_copy_toc_url` 的菜单文案与复制反馈语义，不影响书源解析与目录链路。
  - 已完成 `P2-seq40`：`book_info.xml / @+id/menu_can_update / 允许更新`。
  - `P2-seq40` 差异点清单（实施前）：
    - Flutter 详情页将该菜单实现为“允许更新：开/关”文案，并在切换后弹出“已开启/已关闭允许更新”提示；legado 为 `checkable` 菜单项，标题固定“允许更新”，点击只切换状态不追加成功提示。
    - Flutter 菜单缺少勾选标记语义，无法对齐 legado `onMenuOpened -> menu_can_update.isChecked = book.canUpdate` 的可视状态反馈。
  - `P2-seq40` 逐项对照清单（实施后）：
    - 入口：已同义（详情页“更多”菜单保留一级“允许更新”动作入口，仅在存在书源时可见）。
    - 状态：已同义（标题固定“允许更新”，开启时展示勾选标记，关闭时移除勾选标记；对齐 legado checkable 菜单语义）。
    - 异常：已同义（不新增扩展失败分支；切换后不弹“已开启/已关闭”提示，保持 legado 同义静默切换）。
    - 文案：已同义（移除“允许更新：开/关”扩展文案，收敛为固定“允许更新”）。
    - 排版：已同义（沿用 `CupertinoActionSheet`，以勾选图标表达 checkable 状态；视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击切换 `_allowUpdate`，并保持 legado 边界：仅在书架内书籍且 `bookId` 有效时持久化写入）。
    - 验证：`flutter test test/search_book_info_view_allow_update_action_test.dart test/search_book_info_view_compile_test.dart` 通过；手工路径 `书架 -> 书籍详情 -> 右上角更多 -> 允许更新 -> 重新打开更多菜单`（确认勾选态随开关变化且无扩展提示）。
  - 兼容影响：无旧书源兼容性影响；仅收敛 `menu_can_update` 的展示与提示语义，不改变目录更新筛选逻辑。
  - 已完成 `P2-seq41`：`book_info.xml / @+id/menu_split_long_chapter / 拆分超长章节`。
  - `P2-seq41` 差异点清单（实施前）：
    - Flutter 详情页切换“分割长章节”仅保存设置并重载上下文，未确保本地 TXT 章节缓存即时重解析；与 legado `menu_split_long_chapter -> loadBookInfo` 的“切换即生效”语义不一致。
    - `TxtParser.reparseFromFile` 之前未接收 `splitLongChapter` 参数，解析层无法感知开关状态，导致“开/关”无法驱动长正文拆分策略。
    - Reader 与详情页虽共享同一设置项，但重解析调用未显式传递开关，存在“状态已改、解析未跟随”的语义漂移风险。
  - `P2-seq41` 逐项对照清单（实施后）：
    - 入口：已同义（仅本地 TXT 书籍在详情页“更多”菜单显示“分割长章节”）。
    - 状态：已同义（切换后立即刷新本地章节缓存；成功后展示“已开启/已关闭”提示，关闭分支保留“重新加载可能更慢”文案）。
    - 异常：已同义（重解析失败时保留可观测错误提示，并避免误报成功提示）。
    - 文案：已同义（菜单标题与提示语义保持 legado `split_long_chapter` 业务语义）。
    - 排版：已同义（沿用 `CupertinoActionSheet` 与勾选图标表达开关状态，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（保存设置后详情页强制触发本地重解析并回写 `ChapterRepository/BookRepository`；Reader 侧重解析同样传入开关，确保同一 `bookId` 行为一致）。
    - 验证：`flutter test test/txt_parser_charset_override_test.dart test/search_book_info_refresh_helper_test.dart test/search_book_info_view_compile_test.dart test/simple_reader_view_compile_test.dart` 通过；手工路径 `书架 -> 打开本地 TXT 详情 -> 更多 -> 分割长章节 -> 切换后进入目录确认章节即时变化`。
  - 兼容影响：无旧书源兼容性影响；仅收敛本地 TXT 的 `menu_split_long_chapter` 开关传递与即时重解析路径，不改变网络书籍目录链路。
  - 已完成 `P2-seq42`：`book_info.xml / @+id/menu_delete_alert / 删除提醒`。
  - `P2-seq42` 差异点清单（实施前）：
    - Flutter 详情页将该菜单实现为“删除提醒：开/关”文案，legado 为 `checkable` 菜单项，标题固定“删除提醒”并通过勾选态表达状态，存在状态表达偏差。
    - Flutter 切换“删除提醒”后会弹“已开启/已关闭删除提醒”扩展提示；legado 仅切换持久化状态，不追加成功提示。
  - `P2-seq42` 逐项对照清单（实施后）：
    - 入口：已同义（详情页“更多”菜单保留一级“删除提醒”动作入口）。
    - 状态：已同义（标题固定“删除提醒”，开启时展示勾选标记，关闭时移除勾选标记；默认值与持久化均对齐 `bookInfoDeleteAlert`）。
    - 异常：已同义（`SettingsService` 不可用时仅回退会话内状态，不新增崩溃与静默失败分支）。
    - 文案：已同义（移除“删除提醒：开/关”与“已开启/已关闭删除提醒”扩展文案，收敛为 legado checkable 语义）。
    - 排版：已同义（沿用 `CupertinoActionSheet` 并以勾选图标表达 checkable 状态；视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击后仅切换删除提醒状态并持久化；移出书架确认流程继续读取该开关，保持 legado 同义控制边界）。
    - 验证：`flutter test test/search_book_info_view_delete_alert_action_test.dart test/search_book_info_view_allow_update_action_test.dart` 通过；手工路径（待回归）`书架 -> 书籍详情 -> 右上角更多 -> 删除提醒 -> 重新打开更多菜单确认勾选态变化 -> 点击移出书架确认开关生效`。
  - 兼容影响：无旧书源兼容性影响；仅收敛 `menu_delete_alert` 的 checkable 状态表达与提示文案语义，不改变书架删除数据链路。
  - 已完成 `P2-seq43`：`book_info.xml / @+id/menu_clear_cache / 清理缓存`。
  - `P2-seq43` 差异点清单（实施前）：
    - Flutter 详情页 `menu_clear_cache` 仅允许书架内 `bookId` 非空场景触发，非书架场景会提示“当前书籍不在书架，无法清理缓存”；legado `BookInfoActivity.menu_clear_cache -> viewModel.clearCache` 不依赖 `inBookshelf`，点击即执行清理。
    - Flutter 清理后按章节数分支提示“暂无可清理的章节缓存 / 已清理缓存：x 章”，与 legado `clear_cache_success=成功清理缓存` 的统一成功反馈语义不一致。
    - Flutter `Chapter.copyWith` 采用 `content ?? this.content`，导致清理缓存时无法显式将 `content` 置空，出现“已清理但内存正文仍残留”的语义偏差风险。
  - `P2-seq43` 逐项对照清单（实施后）：
    - 入口：已同义（详情页“更多”菜单保留一级“清理缓存”动作入口）。
    - 状态：已同义（不再依赖书架状态拦截；书架与非书架详情均可触发清理）。
    - 异常：已同义（清理异常统一提示“清理缓存出错\n<摘要>”，保持可观测失败分支）。
    - 文案：已同义（清理成功统一提示“成功清理缓存”，移除“无法清理/暂无缓存/已清理 x 章”等扩展文案）。
    - 排版：已同义（沿用 `CupertinoActionSheet + ShadDialog` 承载动作与反馈，视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击后按当前书籍 `bookId` 清理；当 `bookId` 缺失时使用 `ephemeral` 会话 ID 回退执行清理，保持 legado “点击即清理”语义）。
    - 验证：`flutter test test/search_book_info_view_clear_cache_action_test.dart test/search_book_info_view_compile_test.dart` 通过；手工路径 `书架 -> 书籍详情 -> 右上角更多 -> 清理缓存`（确认反馈“成功清理缓存”且不再出现“无法清理缓存/暂无可清理/已清理 x 章”扩展提示），以及 `非书架详情 -> 更多 -> 清理缓存`（确认无书架拦截）。
  - 兼容影响：无旧书源解析兼容性影响；仅收敛 `menu_clear_cache` 触发与反馈语义，并修复章节缓存模型 `content` 可显式置空能力，避免清理后内存残留。
  - 已完成 `P2-seq44`：`book_info.xml / @+id/menu_log / 日志`。
  - `P2-seq44` 差异点清单（实施前）：
    - Flutter 详情页 `menu_log` 触发 `_openExceptionLogs` 页面跳转到 `ExceptionLogsView`，而 legado `BookInfoActivity` 为 `menu_log -> showDialogFragment<AppLogDialog>()`，触发层级存在偏差。
    - Flutter 日志页标题/空态文案为“异常日志 / 暂无异常日志”，与 legado `@string/log` 菜单语义及 `AppLogDialog` 的“日志 / 暂无日志”可见文案不一致。
    - tracker `seq44` 仍为 `pending`，缺少页面级回归证据与手工路径记录，无法闭环本序号迁移。
  - `P2-seq44` 逐项对照清单（实施后）：
    - 入口：已同义（详情页“更多”菜单保留一级“日志”动作入口）。
    - 状态：已同义（点击后弹出日志对话框，保留“清空”动作与空态可见反馈）。
    - 异常：已同义（无日志时展示“暂无日志”；不新增静默失败分支）。
    - 文案：已同义（收敛为“日志 / 暂无日志”，移除“异常日志”页面级文案偏差）。
    - 排版：已同义（沿用 `CupertinoActionSheet + CupertinoDialog` 承载菜单与日志弹层；视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（动作路径收敛为 `menu_log -> showAppLogDialog` 弹层语义，对齐 legado `menu_log -> AppLogDialog`）。
    - 验证：`flutter test test/search_book_info_view_log_action_test.dart test/search_book_info_view_compile_test.dart` 通过；手工路径 `书架 -> 书籍详情 -> 右上角更多 -> 日志`（确认弹出日志对话框，显示“清空/暂无日志”且不出现“异常日志”）。
  - 兼容影响：无旧书源兼容性影响；仅收敛 `menu_log` 入口触发层级与可见文案语义，不变更搜索/详情/目录请求链路。
  - 已完成 `P2-seq45`：`book_info_edit.xml / @+id/menu_save / 保存`。
  - `P2-seq45` 差异点清单（实施前）：
    - Flutter 编辑页保存后会额外提示“书籍信息已保存”，而 legado `BookInfoEditActivity.menu_save -> saveData` 仅写库并返回上一页，不追加成功提示。
    - Flutter `SearchBookInfoEditHelper.applyDraft` 在作者输入为空白时回退旧值，偏离 legado `saveData` 直接按输入写入（可保存空字符串）的语义。
    - Flutter 编辑保存链路缺少写库失败可观测分支；若落库异常，当前路径会静默失败，不符合迁移期“异常可观测”要求。
  - `P2-seq45` 逐项对照清单（实施后）：
    - 入口：已同义（编辑页右上角保留一级“保存”动作，文案为“保存”）。
    - 状态：已同义（点击保存后直接返回详情页并回写书籍信息，不追加扩展成功提示）。
    - 异常：已同义（落库失败时输出“保存失败\n<摘要>”提示，失败分支可观测）。
    - 文案：已同义（保存按钮文案固定“保存”，移除“书籍信息已保存”扩展提示）。
    - 排版：已同义（沿用 `AppCupertinoPageScaffold` 顶栏保存按钮承载；视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（保存时字段按输入值落库，作者空白输入不回退旧值；对齐 legado `menu_save -> saveData -> finish` 的提交语义）。
    - 验证：`flutter test test/search_book_info_edit_helper_test.dart test/search_book_info_view_edit_action_test.dart test/search_book_info_view_compile_test.dart` 通过；手工路径 `书架 -> 书籍详情 -> 点击编辑 -> 编辑页右上角保存`（确认保存后返回详情页且无“书籍信息已保存”扩展提示）。
  - 兼容影响：无旧书源兼容性影响；仅收敛 `menu_save` 的保存反馈与字段覆盖语义，不改书源请求与阅读链路。
  - 已完成 `P2-seq101`：`book_remote.xml / @+id/menu_refresh / 刷新`。
  - `P2-seq101` 差异点清单（实施前）：
    - Flutter 远程书籍页仍为静态占位文案，缺少 legado `menu_refresh -> upPath()` 的“重载当前目录”行为。
    - 当前远程页无目录路径状态，无法对齐 legado 刷新时的“路径栏 + 返回上级 + 当前目录数据重拉”联动语义。
    - 缺少 WebDav 目录拉取链路与失败可观测输出，无法满足 legado `loadRemoteBookList` 的错误可见边界。
  - `P2-seq101` 逐项对照清单（实施后）：
    - 入口：已同义（书架更多菜单进入“远程书籍”后，顶栏提供独立“刷新”动作）。
    - 状态：已同义（刷新时清空当前目录列表并显示加载态，完成后更新“最近刷新时间”）。
    - 异常：已同义（WebDav 配置缺失或请求失败时，统一可观测输出“获取webDav书籍出错\n<原因>”）。
    - 文案：已同义（刷新动作标题语义保持“刷新”，错误口径与 legado `获取webDav书籍出错` 语义一致）。
    - 排版：已同义（采用 `AppCupertinoPageScaffold` 顶栏刷新按钮 + 路径栏 + 列表区结构，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击刷新会重载当前目录；进入子目录/返回上级后再次刷新仍以“当前目录”为目标重拉数据）。
    - 验证：`flutter test test/remote_books_service_test.dart test/remote_books_placeholder_view_test.dart test/widget_test.dart` 通过；手工路径 `书架 -> 更多 -> 远程书籍 -> 点击右上角刷新`（确认列表重载、路径状态保持、失败分支可见）。
  - 兼容影响：无旧书源兼容性影响；新增能力仅作用于 WebDav 远程目录列表读取与刷新，不影响五段链路与本地书架数据结构。
  - 已完成 `P2-seq102`：`book_remote.xml / @+id/menu_sort / 排序`。
  - `P2-seq102` 差异点清单（实施前）：
    - Flutter 远程书籍页仅有刷新按钮，缺少 legado `menu_sort` 的独立排序入口，入口层级与交互热区不一致。
    - Flutter 远程书籍页缺少 `menu_sort` 对应的排序子菜单承载，无法进入 legado 同义的“排序菜单”路径。
    - 现有页面级回归仅覆盖 `menu_refresh`，缺少 `menu_sort` 可复现证据，tracker 无法闭环该序号。
  - `P2-seq102` 逐项对照清单（实施后）：
    - 入口：已同义（远程书籍页顶栏补齐一级“排序”入口，与 legado `menu_sort` 同层级）。
    - 状态：已同义（非加载态可点击排序入口；加载态禁用，避免与刷新并发触发）。
    - 异常：已同义（仅补齐入口承载，不新增静默失败分支与扩展错误文案）。
    - 文案：已同义（排序弹层标题“排序”，菜单项文案“名称排序/更新时间排序”对齐 legado 字符串语义）。
    - 排版：已同义（采用 `CupertinoActionSheet` 承载排序子菜单，视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击顶栏排序可弹出子菜单；具体排序行为按 `seq103/seq104` 逐项收敛，未跨序号并项实现）。
    - 验证：`flutter test test/remote_books_placeholder_view_test.dart test/remote_books_service_test.dart test/widget_test.dart` 通过；手工路径 `书架 -> 更多 -> 远程书籍 -> 点击右上角排序`（确认弹出“排序/名称排序/更新时间排序”菜单）。
  - 兼容影响：无旧书源兼容性影响；本序号仅补齐 `menu_sort` 入口层级与菜单承载，不改动 WebDav 拉取与书架数据结构。
  - 已完成 `P2-seq103`：`book_remote.xml / @+id/menu_sort_name / 名称排序`。
  - `P2-seq103` 差异点清单（实施前）：
    - Flutter 排序弹层中“名称排序”仅关闭弹层，不触发排序状态变更，与 legado `menu_sort_name -> sortCheck(RemoteBookSort.Name) -> upPath()` 不同义。
    - Flutter 远程书籍页缺少 `sortKey/sortAscending` 状态流，无法复刻 legado 的“首次点击名称升序、再次点击同项切换升降序”语义。
    - Flutter 远程书籍页缺少 legado `AlphanumComparator` 等价比较，文件名会退化为普通字符串序或时间序，出现 `b10`/`b2` 顺序偏差风险。
  - `P2-seq103` 逐项对照清单（实施后）：
    - 入口：已同义（远程书籍页“排序”子菜单保留一级“名称排序”入口）。
    - 状态：已同义（首次点击“名称排序”切换为名称升序；再次点击同项在升/降序间切换，保持 legado `sortCheck` 语义）。
    - 异常：已同义（排序切换沿用既有刷新链路；WebDav 异常仍统一可观测输出“获取webDav书籍出错\n<原因>”）。
    - 文案：已同义（动作文案保持“名称排序”，不新增扩展文案）。
    - 排版：已同义（沿用 `CupertinoActionSheet` 承载排序子菜单；视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“名称排序”后按 legado 同义链路重载当前目录；目录始终优先，文件名比较按 `AlphanumComparator` 等价规则执行）。
    - 验证：`flutter test test/remote_books_placeholder_view_test.dart test/remote_books_service_test.dart test/widget_test.dart` 通过；手工路径 `书架 -> 更多 -> 远程书籍 -> 右上角排序 -> 名称排序（再点击一次名称排序）`（确认首次名称升序、再次切换降序且均触发目录重载）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛远程书籍页 `menu_sort_name` 排序状态流与文件名比较语义，不改动 WebDav 认证与导入链路。
  - 已完成 `P2-seq104`：`book_remote.xml / @+id/menu_sort_time / 更新时间排序`。
  - `P2-seq104` 差异点清单（实施前）：
    - Flutter 排序弹层中“更新时间排序”仅关闭弹层，不触发排序状态变更，与 legado `menu_sort_time -> sortCheck(RemoteBookSort.Default) -> upPath()` 不同义。
    - Flutter 缺少更新时间排序的状态切换逻辑，无法复刻 legado “若已是时间排序则重复点击切换升降序；若从其它排序切回则先设为升序”的 `sortCheck` 语义。
    - 远程书籍页当前仅覆盖名称排序回归，缺少“更新时间排序切换 + 目录重载次数”可复现证据，tracker 无法闭环 `seq104`。
  - `P2-seq104` 逐项对照清单（实施后）：
    - 入口：已同义（远程书籍页“排序”子菜单保留一级“更新时间排序”入口）。
    - 状态：已同义（从名称排序切换到更新时间排序时先进入时间升序；再次点击“更新时间排序”在升/降序间切换，对齐 legado `sortCheck(RemoteBookSort.Default)`）。
    - 异常：已同义（排序切换沿用刷新链路；WebDav 异常仍统一可观测输出“获取webDav书籍出错\n<原因>”）。
    - 文案：已同义（动作文案保持“更新时间排序”，不新增扩展文案）。
    - 排版：已同义（沿用 `CupertinoActionSheet` 承载排序子菜单；视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“更新时间排序”后按 legado 同义链路重载当前目录；目录始终优先，文件按更新时间升/降序切换）。
    - 验证：`flutter test test/remote_books_placeholder_view_test.dart test/remote_books_service_test.dart test/widget_test.dart` 通过；手工路径 `书架 -> 更多 -> 远程书籍 -> 右上角排序 -> 更新时间排序（再点击一次更新时间排序）`（确认首次时间升序、再次切换降序且均触发目录重载）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛远程书籍页 `menu_sort_time` 排序状态流，不改动 WebDav 认证与导入链路。
  - 已完成 `P2-seq105`：`book_remote.xml / @+id/menu_server_config / 服务器配置`。
  - `P2-seq105` 差异点清单（实施前）：
    - Flutter 远程书籍页仅提供“刷新/排序”操作，缺少 legado `menu_server_config` 的一级入口，入口层级与热区不一致。
    - Flutter 远程书籍页无独立服务器配置承载路径；WebDav 字段仅散落在“备份与恢复”页面，无法满足 legado “从远程书籍页直接进入服务器配置”的语义。
    - Flutter 在配置返回后不会自动重载远程目录，缺少 legado `onDialogDismiss -> initData -> upPath` 的回调刷新语义。
  - `P2-seq105` 逐项对照清单（实施后）：
    - 入口：已同义（远程书籍页顶栏补齐“更多”入口，弹层内提供一级“服务器配置”动作）。
    - 状态：已同义（配置页展示并可编辑 WebDav 地址/账号/密码/同步目录，保存后即时持久化）。
    - 异常：已同义（测试连接失败时保留可观测错误摘要；不新增静默失败分支）。
    - 文案：已同义（入口文案固定“服务器配置”，配置页标题与字段语义对齐 legado `server_config`）。
    - 排版：已同义（采用 `CupertinoActionSheet + AppCupertinoPageScaffold` 承载菜单与配置页；视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（`服务器配置` 返回后强制重载当前目录，收敛为 legado `onDialogDismiss -> upPath` 语义）。
    - 验证：`flutter test test/remote_books_placeholder_view_test.dart`、`flutter test test/widget_test.dart --plain-name "Bookshelf remote action opens remote books page"` 通过；手工路径 `书架 -> 更多 -> 远程书籍 -> 右上角更多 -> 服务器配置 -> 返回远程书籍页`（确认返回后自动重载目录）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛远程书籍页 `menu_server_config` 入口与回调刷新语义，不改动 WebDav 拉取与导入链路。
  - 已完成 `P2-seq106`：`book_remote.xml / @+id/menu_help / 帮助`。
  - `P2-seq106` 差异点清单（实施前）：
    - Flutter 远程书籍页“更多”菜单仅有“服务器配置”，缺少 legado `menu_help` 一级入口，入口层级不一致。
    - Flutter 项目仅接入 `appHelp.md`，缺少 legado 同源 `webDavBookHelp.md` 资产，无法还原 `showHelp("webDavBookHelp")` 文档语义。
    - 远程书籍页缺少 `menu_help` 定向回归，tracker 无法提供该序号可复现证据。
  - `P2-seq106` 逐项对照清单（实施后）：
    - 入口：已同义（远程书籍页“更多”菜单补齐一级“帮助”动作，层级与 legado `menu_help` 一致）。
    - 状态：已同义（非加载态可点击“帮助”；加载态禁用更多菜单，避免与刷新并发触发）。
    - 异常：已同义（帮助文档加载失败时弹出“帮助文档加载失败：<原因>”可观测提示，不新增静默失败分支）。
    - 文案：已同义（动作文案固定“帮助”，弹层标题“帮助”与 legado 语义一致）。
    - 排版：已同义（菜单使用 `CupertinoActionSheet`，帮助内容复用现有帮助弹层承载；视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“帮助”后读取 `assets/web/help/md/webDavBookHelp.md` 并弹层展示，对齐 legado `showHelp("webDavBookHelp")` 触发链路）。
    - 验证：`flutter test test/remote_books_placeholder_view_test.dart` 通过；手工路径 `书架 -> 更多 -> 远程书籍 -> 右上角更多 -> 帮助`（确认弹层展示 “WebDav 书籍简明使用教程”）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛远程书籍页 `menu_help` 入口与帮助文档展示链路，不改动 WebDav 拉取、排序与导入逻辑。
  - 已完成 `P2-seq107`：`book_remote.xml / @+id/menu_log / 日志`。
  - `P2-seq107` 差异点清单（实施前）：
    - Flutter 远程书籍页“更多”菜单仅提供“服务器配置/帮助”，缺少 legado `menu_log` 一级入口，入口层级不一致。
    - Flutter 远程书籍页缺少 `menu_log -> AppLogDialog` 触发链路，无法在当前页面就地查看/清空日志。
    - `test/remote_books_placeholder_view_test.dart` 缺少 `menu_log` 定向回归，tracker 无法提供本序号可复现证据。
  - `P2-seq107` 逐项对照清单（实施后）：
    - 入口：已同义（远程书籍页“更多”菜单补齐一级“日志”动作，层级与 legado `menu_log` 一致）。
    - 状态：已同义（非加载态可点击“日志”；进入日志弹层后保留“清空”动作与空态展示）。
    - 异常：已同义（沿用现有日志服务，不新增静默失败分支；无日志时可观测提示“暂无日志”）。
    - 文案：已同义（动作文案固定“日志”，移除“异常日志”扩展文案口径）。
    - 排版：已同义（菜单使用 `CupertinoActionSheet`，日志内容使用现有 `showAppLogDialog` 弹层承载；视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“日志”后直接弹出 `AppLogDialog`，对齐 legado `menu_log -> showDialogFragment<AppLogDialog>()` 链路）。
    - 验证：`flutter test test/remote_books_placeholder_view_test.dart` 通过；手工路径 `书架 -> 更多 -> 远程书籍 -> 右上角更多 -> 日志`（确认可见“清空/暂无日志”，且不出现“异常日志”文案）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛远程书籍页 `menu_log` 入口与弹层触发语义，不改动 WebDav 拉取、排序与导入逻辑。
  - 已完成 `P2-seq108`：`book_search.xml / @+id/menu_precision_search / 精准搜索`。
  - `P2-seq108` 差异点清单（实施前）：
    - Flutter 搜索设置中“精准搜索”以“开启/关闭”值文本展示，未对齐 legado `menu_precision_search` 的 `checkable` 勾选态语义。
    - Flutter 切换精准搜索时仅在输入框非空才触发 `_search()`，空输入时会走本地重排分支，与 legado `setQuery(..., true)` 的统一重提交流程不一致。
    - tracker `seq108` 仍为 `pending`，缺少“勾选态切换 + 持久化”定向回归证据，无法闭环本序号。
  - `P2-seq108` 逐项对照清单（实施后）：
    - 入口：已同义（搜索页设置弹层保留一级“精准搜索”入口，层级与 legado `book_search.xml` 一致）。
    - 状态：已同义（“精准搜索”改为勾选态显示，开启时展示 `check_mark`，关闭时无勾选）。
    - 异常：已同义（切换后复用既有搜索链路的错误可观测输出，不新增静默失败分支）。
    - 文案：已同义（菜单标题固定“精准搜索”，移除“开启/关闭”扩展值文本）。
    - 排版：已同义（仍使用 `CupertinoActionSheet` 承载，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（切换后统一触发 `_search()`，收敛为 legado `menu_precision_search -> setQuery(..., true)` 的同义重提交流程）。
    - 验证：`flutter test test/search_view_precision_search_action_test.dart test/search_view_compile_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 精准搜索 -> 再次打开设置`（确认勾选态随开关变化且配置持久化）。
  - 兼容影响：无旧书源兼容性影响；仅收敛 `menu_precision_search` 的展示与触发语义，不改动搜索源解析链路与缓存结构。
  - 已完成 `P2-seq109`：`book_search.xml / @+id/menu_source_manage / 书源管理`。
  - `P2-seq109` 差异点清单（实施前）：
    - 需确认当前搜索页“设置 -> 书源管理”入口是否与 legado `menu_source_manage -> startActivity<BookSourceActivity>()` 的一级跳转语义同义，并补齐迁移证据。
    - 定向回归时发现进入 `SourceListView` 会在 Linux/测试环境触发 QuickJS 动态库缺失（`libquickjs_c_bridge_plugin.so`）异常，导致入口崩溃并无法闭环该序号验证。
    - `tracker seq109` 仍为 `pending`，缺少页面级回归证据与兼容记录。
  - `P2-seq109` 逐项对照清单（实施后）：
    - 入口：已同义（搜索页设置弹层保留一级“书源管理”入口，层级与 legado `book_search.xml` 一致）。
    - 状态：已同义（入口常驻可点击，不依赖搜索关键字与结果状态）。
    - 异常：已同义（`js_runtime_native` 改为惰性初始化并在 QuickJS 动态库缺失时降级为空运行时，避免进入书源管理页即崩溃）。
    - 文案：已同义（入口文案固定“书源管理”，与 legado `@string/book_source_manage` 一致）。
    - 排版：已同义（设置弹层与页面跳转承载保持 `Shadcn + Cupertino`，视觉差异属于平台允许范围）。
    - 交互触发：已同义（点击“书源管理”后直接进入 `SourceListView`，对齐 legado `menu_source_manage -> BookSourceActivity` 的页面跳转语义）。
    - 验证：`flutter test test/search_view_source_manage_action_test.dart test/search_view_compile_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理`（确认可进入书源管理页且无崩溃）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_source_manage` 入口与运行时兼容边界，不改动书源数据结构与五段链路。
  - 已完成 `P2-seq110`：`book_search.xml / @+id/menu_search_scope / 多分组/书源`。
  - `P2-seq110` 差异点清单（实施前）：
    - Flutter 搜索设置中该入口文案为“搜索范围”，与 legado `@string/groups_or_source=多分组/书源` 不一致。
    - 点击入口后先进入自定义 quick sheet，再二次点击“多分组/单源模式…”才进入范围选择页；与 legado `menu_search_scope -> showDialogFragment<SearchScopeDialog>()` 的直达触发链路不一致。
    - 当书源列表为空时，Flutter 会提前提示“没有可用书源。”并阻断进入范围页；legado 在空数据场景仍允许进入 `SearchScopeDialog` 并通过空列表态交互。
  - `P2-seq110` 逐项对照清单（实施后）：
    - 入口：已同义（搜索页设置弹层保留一级“多分组/书源”入口，层级与 legado `book_search.xml` 一致）。
    - 状态：已同义（点击入口后直接进入 `SearchScopePickerView`，不再经过扩展 quick sheet；范围保存后仍按现有同义规则自动重搜）。
    - 异常：已同义（移除“无书源即阻断”扩展分支；空书源场景可进入范围页并保持可取消返回）。
    - 文案：已同义（入口文案由“搜索范围”收敛为“多分组/书源”，移除“多分组/单源模式…”扩展文案入口）。
    - 排版：已同义（继续使用 `Shadcn + Cupertino` 页面承载范围选择，平台视觉差异属于允许范围）。
    - 交互触发：已同义（点击“多分组/书源”后直接打开范围页，对齐 legado `menu_search_scope` 的一级触发语义）。
    - 验证：`flutter test test/search_view_precision_search_action_test.dart test/search_view_source_manage_action_test.dart test/search_view_search_scope_action_test.dart test/search_scope_picker_view_compile_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 多分组/书源`（确认直接进入范围页）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_search_scope` 入口文案与触发链路，不改动搜索数据结构与缓存键规则。
  - 已完成 `P2-seq111`：`book_search.xml / @+id/menu_log / 日志`。
  - `P2-seq111` 差异点清单（实施前）：
    - Flutter 搜索设置“日志”动作触发的是页面跳转 `ExceptionLogsView`，与 legado `menu_log -> showDialogFragment(AppLogDialog())` 的弹层语义不一致。
    - Flutter 日志页面标题语义为“异常日志”，与 legado 菜单文案“日志”存在用户可见语义偏差。
    - tracker `seq111` 仍为 `pending`，缺少“搜索设置日志入口 -> 日志弹层”定向回归证据。
  - `P2-seq111` 逐项对照清单（实施后）：
    - 入口：已同义（搜索页设置弹层保留一级“日志”入口，层级与 legado `book_search.xml` 一致）。
    - 状态：已同义（点击后直接弹出日志对话框；日志为空时展示“暂无日志”，并提供“清空”动作）。
    - 异常：已同义（沿用现有日志存储与弹层承载，不新增静默失败分支；清空后状态即时可见）。
    - 文案：已同义（入口与弹层标题均为“日志”，移除“异常日志”页面级文案偏差）。
    - 排版：已同义（`CupertinoActionSheet` 入口 + `showAppLogDialog` 弹层承载，视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“日志”后直接触发 `AppLogDialog`，对齐 legado `menu_log` 弹层触发链路）。
    - 验证：`flutter test test/search_view_log_action_test.dart test/search_view_precision_search_action_test.dart test/search_view_source_manage_action_test.dart test/search_view_search_scope_action_test.dart test/search_view_compile_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 日志`（确认弹出日志弹层且可见“清空/暂无日志”）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_log` 触发承载与文案语义，不改动搜索链路与书源数据结构。
  - 已完成 `P2-seq112`：`book_search_scope.xml / @+id/menu_screen / 筛选`。
  - `P2-seq112` 差异点清单（实施前）：
    - Flutter 搜索范围页将筛选输入放在内容区，未对齐 legado `menu_screen` 作为工具栏 actionView 的入口层级语义。
    - Flutter 虽然仅在“书源”模式显示筛选框，但缺少“顶栏菜单位显隐”这一 legacy 触发形态，`menu_screen` 对照证据不足。
    - tracker `seq112` 仍为 `pending`，缺少“分组模式隐藏 / 书源模式显示 / 输入后筛选生效”的页面级定向回归。
  - `P2-seq112` 逐项对照清单（实施后）：
    - 入口：已同义（筛选入口迁移到导航栏 `trailing`，对应 legacy `menu_screen` 顶栏动作位）。
    - 状态：已同义（分组模式隐藏筛选入口；切换到书源模式后显示筛选输入）。
    - 异常：已同义（筛选仅作用于本地列表过滤，不新增静默失败分支；无匹配时保持现有空态提示）。
    - 文案：已同义（入口文案统一“筛选”，不追加扩展标题）。
    - 排版：已同义（采用 `CupertinoNavigationBar` trailing 搜索框承载；平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（输入后即时按书源名/分组/URL/备注过滤，且模式切换后保留筛选词以对齐 legacy `screenText` 持续语义）。
    - 验证：`flutter test test/search_scope_picker_view_menu_screen_test.dart test/search_scope_picker_helper_test.dart test/search_scope_picker_view_compile_test.dart test/search_view_search_scope_action_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 多分组/书源 -> 切换书源 -> 顶栏输入筛选词`。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_screen` 入口承载与筛选触发形态，不改动搜索范围保存格式。
  - 已完成 `P2-seq113`：`book_source.xml / @+id/action_sort / 排序`。
  - `P2-seq113` 差异点清单（实施前）：
    - Flutter 书源管理页排序弹层标题为“排序选项”，与 legado `action_sort` 的父级标题语义“排序”不一致。
    - `tracker seq113` 仍为 `pending`，缺少“顶栏排序入口 -> 打开排序菜单”的定向回归证据。
  - `P2-seq113` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理页顶栏保留一级排序入口 `CupertinoIcons.arrow_up_arrow_down`，层级与 legado `action_sort` 一致）。
    - 状态：已同义（点击排序入口后可打开排序菜单，后续子项动作保持待 `seq114~121` 逐项收敛）。
    - 异常：已同义（仅收敛父级标题与回归证据，不新增静默失败分支）。
    - 文案：已同义（排序弹层父级标题由“排序选项”收敛为 legado 同义“排序”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载父级排序菜单；视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击顶栏排序入口即可弹出排序菜单，对齐 legado `action_sort` 一级触发语义）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 顶栏排序`（确认弹出标题“排序”的排序菜单）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `action_sort` 父级入口文案与触发证据，不改动排序子项比较逻辑与书源数据结构。
  - 已完成 `P2-seq114`：`book_source.xml / @+id/menu_sort_desc / 反序`。
  - `P2-seq114` 差异点清单（实施前）：
    - Flutter 排序菜单子项使用动态文案“切换为降序/升序”，与 legado `menu_sort_desc` 的固定“反序” checkable 语义不一致。
    - `tracker seq114` 仍为 `pending`，缺少“反序勾选态切换”定向回归证据。
  - `P2-seq114` 逐项对照清单（实施后）：
    - 入口：已同义（位于排序菜单一级子项，层级与 legado `menu_sort_desc` 一致）。
    - 状态：已同义（默认未勾选；点击后切换为勾选态并同步反转排序方向）。
    - 异常：已同义（仅切换本地排序状态，不新增静默失败分支）。
    - 文案：已同义（由“切换为降序/升序”收敛为固定“反序”）。
    - 排版：已同义（使用 `CupertinoActionSheet` 子项并通过前缀 `✓` 呈现 checkable 勾选态，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“反序”后仅执行 `sortAscending` 翻转并关闭菜单，对齐 legado `menu_sort_desc` 触发语义）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 顶栏排序 -> 反序`（再次打开排序菜单确认“反序”勾选态切换）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_sort_desc` 展示与状态语义，不改动排序算法与书源数据结构。
  - 已完成 `P2-seq115`：`book_source.xml / @+id/menu_sort_manual / 手动排序`。
  - `P2-seq115` 差异点清单（实施前）：
    - legado `menu_sort_manual` 属于 `menu_group_sort` 单选组中的 checkable 子项；语义要求为“切回手动排序后该子项独占勾选态，并恢复默认排序模式”。
    - Flutter 端虽已有“手动排序”菜单项与 `sortMode=manual` 切换能力，但缺少“先切到其它排序再切回手动”的独立可复现回归证据。
    - tracker `seq115` 仍为 `pending`，缺少页面级定向验证记录，无法闭环迁移证据。
  - `P2-seq115` 逐项对照清单（实施后）：
    - 入口：已同义（位于排序菜单一级子项，层级与 legado `menu_sort_manual` 一致）。
    - 状态：已同义（从其它排序切回后“手动排序”独占勾选态；再次打开菜单可见勾选结果）。
    - 异常：已同义（仅切换本地排序模式，不新增静默失败分支）。
    - 文案：已同义（菜单项文案保持“手动排序”，与 legado `@string/sort_manual` 一致）。
    - 排版：已同义（使用 `CupertinoActionSheet` 子项并通过前缀 `✓` 呈现单选勾选态，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“手动排序”后仅切换 `_sortMode=manual` 并关闭菜单，对齐 legado `menu_sort_manual -> sort=Default -> upBookSource(...)` 触发语义）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 顶栏排序 -> 智能排序 -> 再次顶栏排序 -> 手动排序`（确认切回后仅“手动排序”带勾选）。
  - 兼容影响：无旧书源兼容性影响；本序号仅补齐 `menu_sort_manual` 的单选勾选态回归证据，不改动书源排序算法与持久化结构。
  - 已完成 `P2-seq116`：`book_source.xml / @+id/menu_sort_auto / 智能排序`。
  - `P2-seq116` 差异点清单（实施前）：
    - legado `menu_sort_auto` 文案为“智能排序”，且属于 `menu_group_sort` 单选组 checkable 子项；Flutter 端当前文案为“权重”，存在用户可见语义偏差。
    - Flutter 端虽已存在 `_SourceSortMode.weight` 排序逻辑，但缺少以“智能排序”文案触发并保持单选勾选态的定向回归证据。
    - tracker `seq116` 仍为 `pending`，缺少可复现验证记录，无法闭环迁移证据。
  - `P2-seq116` 逐项对照清单（实施后）：
    - 入口：已同义（位于排序菜单一级子项，层级与 legado `menu_sort_auto` 一致）。
    - 状态：已同义（点击后切换到 `_SourceSortMode.weight`，再次打开菜单仅“智能排序”保留勾选态）。
    - 异常：已同义（仅切换本地排序模式，不新增静默失败分支）。
    - 文案：已同义（菜单项文案由“权重”收敛为 legado 同义“智能排序”）。
    - 排版：已同义（使用 `CupertinoActionSheet` 子项并通过前缀 `✓` 呈现单选勾选态，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“智能排序”后仅切换 `_sortMode=weight` 并关闭菜单，对齐 legado `menu_sort_auto -> sort=Weight -> upBookSource(...)` 触发语义）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 顶栏排序 -> 智能排序 -> 再次顶栏排序`（确认“智能排序”勾选态保持）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_sort_auto` 文案与勾选态证据，不改动排序算法与持久化结构。
  - 已完成 `P2-seq117`：`book_source.xml / @+id/menu_sort_name / 名称排序`。
  - `P2-seq117` 差异点清单（实施前）：
    - legado `menu_sort_name` 文案为“名称排序”，且属于 `menu_group_sort` 单选组 checkable 子项；Flutter 端当前文案为“名称”，存在用户可见语义偏差。
    - Flutter 端虽已存在 `_SourceSortMode.name` 排序逻辑，但缺少以“名称排序”文案触发并保持单选勾选态的定向回归证据。
    - tracker `seq117` 仍为 `pending`，缺少可复现验证记录，无法闭环迁移证据。
  - `P2-seq117` 逐项对照清单（实施后）：
    - 入口：已同义（位于排序菜单一级子项，层级与 legado `menu_sort_name` 一致）。
    - 状态：已同义（点击后切换到 `_SourceSortMode.name`，再次打开菜单仅“名称排序”保留勾选态）。
    - 异常：已同义（仅切换本地排序模式，不新增静默失败分支）。
    - 文案：已同义（菜单项文案由“名称”收敛为 legado 同义“名称排序”）。
    - 排版：已同义（使用 `CupertinoActionSheet` 子项并通过前缀 `✓` 呈现单选勾选态，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“名称排序”后仅切换 `_sortMode=name` 并关闭菜单，对齐 legado `menu_sort_name -> sort=Name -> upBookSource(...)` 触发语义）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 顶栏排序 -> 名称排序 -> 再次顶栏排序`（确认“名称排序”勾选态保持）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_sort_name` 文案与勾选态证据，不改动排序算法与持久化结构。
  - 已完成 `P2-seq118`：`book_source.xml / @+id/menu_sort_url / 地址排序`。
  - `P2-seq118` 差异点清单（实施前）：
    - legado `menu_sort_url` 文案为“地址排序”，且属于 `menu_group_sort` 单选组 checkable 子项；Flutter 端当前文案为“地址”，存在用户可见语义偏差。
    - Flutter 端虽已存在 `_SourceSortMode.url` 排序逻辑，但缺少以“地址排序”文案触发并保持单选勾选态的定向回归证据。
    - tracker `seq118` 仍为 `pending`，缺少可复现验证记录，无法闭环迁移证据。
  - `P2-seq118` 逐项对照清单（实施后）：
    - 入口：已同义（位于排序菜单一级子项，层级与 legado `menu_sort_url` 一致）。
    - 状态：已同义（点击后切换到 `_SourceSortMode.url`，再次打开菜单仅“地址排序”保留勾选态）。
    - 异常：已同义（仅切换本地排序模式，不新增静默失败分支）。
    - 文案：已同义（菜单项文案由“地址”收敛为 legado 同义“地址排序”）。
    - 排版：已同义（使用 `CupertinoActionSheet` 子项并通过前缀 `✓` 呈现单选勾选态，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“地址排序”后仅切换 `_sortMode=url` 并关闭菜单，对齐 legado `menu_sort_url -> sort=Url -> upBookSource(...)` 触发语义）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 顶栏排序 -> 地址排序 -> 再次顶栏排序`（确认“地址排序”勾选态保持）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_sort_url` 文案与勾选态证据，不改动排序算法与持久化结构。
  - 已完成 `P2-seq119`：`book_source.xml / @+id/menu_sort_time / 更新时间排序`。
  - `P2-seq119` 差异点清单（实施前）：
    - legado `menu_sort_time` 文案为“更新时间排序”，且属于 `menu_group_sort` 单选组 checkable 子项；Flutter 端当前文案为“更新时间”，存在用户可见语义偏差。
    - Flutter 端虽已存在 `_SourceSortMode.update` 排序逻辑，但缺少以“更新时间排序”文案触发并保持单选勾选态的定向回归证据。
    - tracker `seq119` 仍为 `pending`，缺少可复现验证记录，无法闭环迁移证据。
  - `P2-seq119` 逐项对照清单（实施后）：
    - 入口：已同义（位于排序菜单一级子项，层级与 legado `menu_sort_time` 一致）。
    - 状态：已同义（点击后切换到 `_SourceSortMode.update`，再次打开菜单仅“更新时间排序”保留勾选态；切换“反序”后该勾选态保持）。
    - 异常：已同义（仅切换本地排序模式与方向，不新增静默失败分支）。
    - 文案：已同义（菜单项文案由“更新时间”收敛为 legado 同义“更新时间排序”）。
    - 排版：已同义（使用 `CupertinoActionSheet` 子项并通过前缀 `✓` 呈现单选勾选态，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“更新时间排序”后仅切换 `_sortMode=update` 并关闭菜单，对齐 legado `menu_sort_time -> sort=Update -> upBookSource(...)` 触发语义）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart` 通过；手工路径（待回归）`书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 顶栏排序 -> 更新时间排序 -> 反序 -> 再次顶栏排序`（确认“更新时间排序”“反序”勾选态保持）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_sort_time` 文案与勾选态证据，不改动排序算法与持久化结构。
  - 已完成 `P2-seq120`：`book_source.xml / @+id/menu_sort_respondTime / 响应时间排序`。
  - `P2-seq120` 差异点清单（实施前）：
    - legado `menu_sort_respondTime` 文案为“响应时间排序”，且属于 `menu_group_sort` 单选组 checkable 子项；Flutter 端当前文案为“响应时间”，存在用户可见语义偏差。
    - Flutter 端虽已存在 `_SourceSortMode.respond` 排序逻辑，但缺少以“响应时间排序”文案触发并保持单选勾选态的定向回归证据。
    - tracker `seq120` 仍为 `pending`，缺少可复现验证记录，无法闭环迁移证据。
  - `P2-seq120` 逐项对照清单（实施后）：
    - 入口：已同义（位于排序菜单一级子项，层级与 legado `menu_sort_respondTime` 一致）。
    - 状态：已同义（点击后切换到 `_SourceSortMode.respond`，再次打开菜单仅“响应时间排序”保留勾选态）。
    - 异常：已同义（仅切换本地排序模式，不新增静默失败分支）。
    - 文案：已同义（菜单项文案由“响应时间”收敛为 legado 同义“响应时间排序”）。
    - 排版：已同义（使用 `CupertinoActionSheet` 子项并通过前缀 `✓` 呈现单选勾选态，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“响应时间排序”后仅切换 `_sortMode=respond` 并关闭菜单，对齐 legado `menu_sort_respondTime -> sort=Respond -> upBookSource(...)` 触发语义）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 顶栏排序 -> 响应时间排序 -> 再次顶栏排序`（确认“响应时间排序”勾选态保持）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_sort_respondTime` 文案与勾选态证据，不改动排序算法与持久化结构。
  - 已完成 `P2-seq121`：`book_source.xml / @+id/menu_sort_enable / 是否启用`。
  - `P2-seq121` 差异点清单（实施前）：
    - legado `menu_sort_enable` 文案为“是否启用”，且属于 `menu_group_sort` 单选组 checkable 子项；Flutter 端当前文案为“启用状态”，存在用户可见语义偏差。
    - legado 在 `BookSourceSort.Enable` 反序场景的边界是“仅反转启用分组，同组名称仍按正序比较”；Flutter 端当前实现按通用 `-compare` 反转，导致同组名称被反序，存在排序语义偏差。
    - tracker `seq121` 仍为 `pending`，缺少“是否启用勾选态 + 反序边界排序”定向回归证据，无法闭环迁移证据。
  - `P2-seq121` 逐项对照清单（实施后）：
    - 入口：已同义（位于排序菜单一级子项，层级与 legado `menu_sort_enable` 一致）。
    - 状态：已同义（点击后切换到 `_SourceSortMode.enabled`，再次打开菜单仅“是否启用”保留勾选态）。
    - 异常：已同义（仅切换本地排序模式与方向，不新增静默失败分支）。
    - 文案：已同义（菜单项文案由“启用状态”收敛为 legado 同义“是否启用”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 子项并通过前缀 `✓` 呈现单选勾选态，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“是否启用”后仅切换 `_sortMode=enabled` 并关闭菜单，对齐 legado `menu_sort_enable -> sort=Enable -> upBookSource(...)` 触发语义；反序时仅反转启用分组，同组名称保持正序）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 顶栏排序 -> 是否启用 -> 反序 -> 观察列表顺序`（确认“禁用组在前，且同组名称保持正序”）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_sort_enable` 文案与排序边界语义，不改动书源数据结构与持久化字段。
  - 已完成 `P2-seq122`：`book_source.xml / @+id/menu_group / 分组`。
  - `P2-seq122` 差异点清单（实施前）：
    - legado `menu_group` 为顶栏一级 action（`showAsAction=always`），图标语义为分组（`ic_groups`）；Flutter 端当前入口使用 `folder` 图标，存在入口图标语义偏差。
    - 现有回归仅覆盖排序菜单，缺少 `menu_group` 入口触发与动态分组 `group:<组名>` 筛选链路的页面级证据，tracker `seq122` 仍为 `pending`。
    - 搜索页进入书源管理的回归仍断言旧图标，无法反映 `menu_group` 入口语义收敛结果。
  - `P2-seq122` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理顶栏保留一级“分组”入口，图标收敛为 `CupertinoIcons.square_grid_2x2` 以对齐 legado 分组动作语义）。
    - 状态：已同义（点击入口后弹出“分组”动作面板，保持静态分组动作与动态分组列表同层级承载）。
    - 异常：已同义（分组菜单为空时不新增额外失败分支，继续由页面现有空态承载）。
    - 文案：已同义（分组菜单标题保持“分组”，与 legado `@string/menu_action_group` 语义一致）。
    - 排版：已同义（使用 `CupertinoActionSheet` 承载分组菜单，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击动态分组项后写入 `group:<组名>` 并即时筛选，等价 legado `searchView.setQuery("group:${item.title}", true)`）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart test/search_view_source_manage_action_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 顶栏分组 -> 选择分组`（确认菜单弹出且列表按 `group:` 即时筛选）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_group` 顶栏入口图标语义并补齐回归证据，不改动书源数据结构与筛选算法。
  - 已完成 `P2-seq123`：`book_source.xml / @+id/menu_group_manage / 分组管理`。
  - `P2-seq123` 差异点清单（实施前）：
    - Flutter 端分组菜单虽已提供“分组管理”入口，但缺少与 legado `menu_group_manage -> showDialogFragment<GroupManageDialog>()` 的逐项对照记录，tracker `seq123` 仍为 `pending`。
    - 分组管理弹层文案存在细节偏差（“新增分组/重命名分组/输入分组名”），与 legado `GroupManageDialog` 的“添加分组/编辑分组/分组名称”语义不一致。
    - 现有回归证据仅覆盖分组入口与动态分组筛选，缺少 `menu_group_manage` 的入口触发与“新增分组输入弹窗”页面级证据。
  - `P2-seq123` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理顶栏“分组”菜单内保留一级“分组管理”入口，点击后直接打开分组管理弹层）。
    - 状态：已同义（分组管理弹层标题固定“分组管理”，头部保留新增分组按钮；分组行保留“编辑/删除”操作入口）。
    - 异常：已同义（无分组时不新增扩展提示，保持空列表承载；不引入静默失败分支）。
    - 文案：已同义（弹层与输入弹窗文案收敛为 legado 语义：`添加分组/编辑分组/分组名称`）。
    - 排版：已同义（使用 `CupertinoPopupSurface` 承载分组管理弹层，列表行信息结构与操作热区保持 legado 同层级语义；视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（`menu_group_manage` 触发分组管理弹层；新增按钮触发输入弹窗，分组行保留编辑/删除入口，不提前并入 `seq124~129` 的筛选子项语义）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart test/search_view_source_manage_action_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 顶栏分组 -> 分组管理`（确认弹层打开，且可见“添加分组”输入弹窗与分组行“编辑/删除”入口）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_group_manage` 入口层级、弹层文案与回归证据，不改动书源数据结构与筛选算法。
  - 已完成 `P2-seq124`：`book_source.xml / @+id/menu_enabled_group / 已启用`。
  - `P2-seq124` 差异点清单（实施前）：
    - legado 在 `menu_enabled_group` 点击后执行 `searchView.setQuery(getString(R.string.enabled), true)`，查询词为“已启用”；Flutter 端当前分组菜单文案与查询词均为“启用”，存在用户可见语义偏差。
    - Flutter 端过滤逻辑仅识别“启用”关键字，无法与 legado 的“已启用”查询词完全同义，存在迁移语义断层。
    - tracker `seq124` 仍为 `pending`，缺少“已启用入口文案 + enabled 过滤结果”的定向回归证据。
  - `P2-seq124` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理顶栏“分组”菜单保留一级“已启用”筛选项，层级与 legado `menu_enabled_group` 一致）。
    - 状态：已同义（点击后写入查询词“已启用”，列表即时收敛为 `enabled=true` 书源集合）。
    - 异常：已同义（仅切换查询词与筛选结果，不新增静默失败分支）。
    - 文案：已同义（筛选项文案由“启用”收敛为 legado 同义“已启用”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载分组筛选项，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“已启用”后走 `_applySearchQuery('已启用')`，等价 legado `setQuery('已启用', true)` 的即时筛选语义；并保留“启用”旧词兼容匹配，避免历史输入失效）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart test/search_view_source_manage_action_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 顶栏分组 -> 已启用`（确认仅显示启用书源）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_enabled_group` 文案与查询词语义，不改动书源数据结构与启用状态存储字段。
  - 已完成 `P2-seq125`：`book_source.xml / @+id/menu_disabled_group / 已禁用`。
  - `P2-seq125` 差异点清单（实施前）：
    - legado 在 `menu_disabled_group` 点击后执行 `searchView.setQuery(getString(R.string.disabled), true)`，查询词为“已禁用”；Flutter 端当前分组菜单文案与查询词均为“禁用”，存在用户可见语义偏差。
    - Flutter 端过滤逻辑仅识别“禁用”关键字，无法与 legado 的“已禁用”查询词完全同义，存在迁移语义断层。
    - tracker `seq125` 仍为 `pending`，缺少“已禁用入口文案 + disabled 过滤结果”的定向回归证据。
  - `P2-seq125` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理顶栏“分组”菜单保留一级“已禁用”筛选项，层级与 legado `menu_disabled_group` 一致）。
    - 状态：已同义（点击后写入查询词“已禁用”，列表即时收敛为 `enabled=false` 书源集合）。
    - 异常：已同义（仅切换查询词与筛选结果，不新增静默失败分支）。
    - 文案：已同义（筛选项文案由“禁用”收敛为 legado 同义“已禁用”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载分组筛选项，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“已禁用”后走 `_applySearchQuery('已禁用')`，等价 legado `setQuery('已禁用', true)` 的即时筛选语义；并保留“禁用”旧词兼容匹配，避免历史输入失效）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart test/search_view_source_manage_action_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 顶栏分组 -> 已禁用`（确认仅显示禁用书源）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_disabled_group` 文案与查询词语义，不改动书源数据结构与启用状态存储字段。
  - 已完成 `P2-seq126`：`book_source.xml / @+id/menu_group_login / 需要登录`。
  - `P2-seq126` 差异点清单（实施前）：
    - legado 在 `menu_group_login` 点击后执行 `searchView.setQuery(getString(R.string.need_login), true)`，中文语义为“需要登录”；Flutter 端当前分组菜单文案与查询词均为“需登录”，存在用户可见语义偏差。
    - Flutter 端过滤逻辑仅识别“需登录”，无法与 legado 的“需要登录”查询词完全同义，存在入口文案与过滤触发解耦风险。
    - tracker `seq126` 仍为 `pending`，缺少“需要登录入口文案 + loginUrl 非空筛选结果”的定向回归证据。
  - `P2-seq126` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理顶栏“分组”菜单保留一级“需要登录”筛选项，层级与 legado `menu_group_login` 一致）。
    - 状态：已同义（点击后写入查询词“需要登录”，列表即时收敛为 `loginUrl` 非空书源集合）。
    - 异常：已同义（仅切换查询词与筛选结果，不新增静默失败分支）。
    - 文案：已同义（筛选项文案由“需登录”收敛为 legado 同义“需要登录”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载分组筛选项，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“需要登录”后走 `_applySearchQuery('需要登录')`，等价 legado `setQuery('需要登录', true)` 的即时筛选语义；并保留“需登录”旧词兼容匹配，避免历史输入失效）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart --plain-name "书源管理顶栏分组入口会打开分组菜单"`、`flutter test test/source_list_view_sort_action_test.dart --plain-name "书源管理分组菜单需要登录项写入需要登录查询并即时筛选"`、`flutter test test/search_view_source_manage_action_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 顶栏分组 -> 需要登录`（确认仅显示存在登录地址的书源）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_group_login` 文案与查询词语义，不改动书源数据结构与登录字段持久化逻辑。
  - 已完成 `P2-seq127`：`book_source.xml / @+id/menu_group_null / 未分组`。
  - `P2-seq127` 差异点清单（实施前）：
    - legado 在 `menu_group_null` 点击后执行 `searchView.setQuery(getString(R.string.no_group), true)`，中文语义为“未分组”；Flutter 端当前分组菜单文案与查询词为“无分组”，存在用户可见语义偏差。
    - Flutter 端过滤逻辑仅识别“无分组”，无法与 legado 的“未分组”查询词完全同义，存在入口文案与过滤触发解耦风险。
    - tracker `seq127` 仍为 `pending`，缺少“未分组入口文案 + no_group 筛选结果”的定向回归证据。
  - `P2-seq127` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理顶栏“分组”菜单保留一级“未分组”筛选项，层级与 legado `menu_group_null` 一致）。
    - 状态：已同义（点击后写入查询词“未分组”，列表即时收敛为 `bookSourceGroup` 为空或包含“未分组”的书源集合）。
    - 异常：已同义（仅切换查询词与筛选结果，不新增静默失败分支）。
    - 文案：已同义（筛选项文案由“无分组”收敛为 legado 同义“未分组”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载分组筛选项，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“未分组”后走 `_applySearchQuery('未分组')`，等价 legado `setQuery('未分组', true)` 的即时筛选语义；并保留“无分组”旧词兼容匹配，避免历史输入失效）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart --plain-name "书源管理顶栏分组入口会打开分组菜单"`、`flutter test test/source_list_view_sort_action_test.dart --plain-name "书源管理分组菜单未分组项写入未分组查询并即时筛选"`、`flutter test test/search_view_source_manage_action_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 顶栏分组 -> 未分组`（确认仅显示分组为空或包含“未分组”的书源）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_group_null` 文案与查询词语义，不改动书源数据结构与分组字段持久化逻辑。
  - 已完成 `P2-seq128`：`book_source.xml / @+id/menu_enabled_explore_group / 已启用发现`。
  - `P2-seq128` 差异点清单（实施前）：
    - legado 在 `menu_enabled_explore_group` 点击后执行 `searchView.setQuery(getString(R.string.enabled_explore), true)`，中文语义为“已启用发现”；Flutter 端当前分组菜单文案与查询词为“启用发现”，存在用户可见语义偏差。
    - Flutter 端过滤逻辑仅识别“启用发现”，无法与 legado 的“已启用发现”查询词完全同义，存在入口文案与过滤触发解耦风险。
    - tracker `seq128` 仍为 `pending`，缺少“已启用发现入口文案 + enabledExplore=true 筛选结果”的定向回归证据。
  - `P2-seq128` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理顶栏“分组”菜单保留一级“已启用发现”筛选项，层级与 legado `menu_enabled_explore_group` 一致）。
    - 状态：已同义（点击后写入查询词“已启用发现”，列表即时收敛为 `enabledExplore=true` 书源集合）。
    - 异常：已同义（仅切换查询词与筛选结果，不新增静默失败分支）。
    - 文案：已同义（筛选项文案由“启用发现”收敛为 legado 同义“已启用发现”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载分组筛选项，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“已启用发现”后走 `_applySearchQuery('已启用发现')`，等价 legado `setQuery('已启用发现', true)` 的即时筛选语义；并保留“启用发现”旧词兼容匹配，避免历史输入失效）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart --plain-name "书源管理顶栏分组入口会打开分组菜单"`、`flutter test test/source_list_view_sort_action_test.dart --plain-name "书源管理分组菜单已启用发现项写入已启用发现查询并即时筛选"` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 顶栏分组 -> 已启用发现`（确认仅显示启用发现的书源）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_enabled_explore_group` 文案与查询词语义，不改动书源数据结构与发现开关持久化逻辑。
  - 已完成 `P2-seq129`：`book_source.xml / @+id/menu_disabled_explore_group / 已禁用发现`。
  - `P2-seq129` 差异点清单（实施前）：
    - legado 在 `menu_disabled_explore_group` 点击后执行 `searchView.setQuery(getString(R.string.disabled_explore), true)`，中文语义为“已禁用发现”；Flutter 端当前分组菜单文案与查询词为“禁用发现”，存在用户可见语义偏差。
    - Flutter 端过滤逻辑仅识别“禁用发现”，无法与 legado 的“已禁用发现”查询词完全同义，存在入口文案与过滤触发解耦风险。
    - tracker `seq129` 仍为 `pending`，缺少“已禁用发现入口文案 + enabledExplore=false 筛选结果”的定向回归证据。
  - `P2-seq129` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理顶栏“分组”菜单保留一级“已禁用发现”筛选项，层级与 legado `menu_disabled_explore_group` 一致）。
    - 状态：已同义（点击后写入查询词“已禁用发现”，列表即时收敛为 `enabledExplore=false` 书源集合）。
    - 异常：已同义（仅切换查询词与筛选结果，不新增静默失败分支）。
    - 文案：已同义（筛选项文案由“禁用发现”收敛为 legado 同义“已禁用发现”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载分组筛选项，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“已禁用发现”后走 `_applySearchQuery('已禁用发现')`，等价 legado `setQuery('已禁用发现', true)` 的即时筛选语义；并保留“禁用发现”旧词兼容匹配，避免历史输入失效）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart --plain-name "书源管理顶栏分组入口会打开分组菜单"`、`flutter test test/source_list_view_sort_action_test.dart --plain-name "书源管理分组菜单已禁用发现项写入已禁用发现查询并即时筛选"` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 顶栏分组 -> 已禁用发现`（确认仅显示禁用发现的书源）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_disabled_explore_group` 文案与查询词语义，不改动书源数据结构与发现开关持久化逻辑。
  - 已完成 `P2-seq130`：`book_source.xml / @+id/menu_add_book_source / 新建书源`。
  - `P2-seq130` 差异点清单（实施前）：
    - legado `menu_add_book_source` 位于书源管理溢出菜单，点击后直接进入 `BookSourceEditActivity`；Flutter 端虽已存在“更多 -> 新建书源”入口，但当前序号缺少逐项迁移证据闭环。
    - tracker `seq130` 仍为 `pending`，缺少“入口层级 + 触发路径 + 默认状态”的定向回归证据，无法宣称完成同义迁移。
    - 既有回归主要覆盖排序/分组子菜单，未单独验证“新建书源”入口点击后是否进入书源编辑页且默认保持 legado 同义配置状态。
  - `P2-seq130` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理页“更多”菜单保留一级“新建书源”入口，对齐 legado `menu_add_book_source` 的溢出菜单层级语义）。
    - 状态：已同义（点击后进入“书源编辑”页，基础字段与顶部开关可见，默认“自动保存Cookie”为开启状态）。
    - 异常：已同义（不新增静默失败分支；导航失败仍走 Flutter 路由异常链路可观测输出）。
    - 文案：已同义（菜单项文案保持“新建书源”）。
    - 排版：已同义（使用 `CupertinoActionSheet` 承载“更多”菜单与 `AppCupertinoPageScaffold` 承载编辑页，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“新建书源”后打开 `SourceEditLegacyView`，对齐 legado `menu_add_book_source -> startActivity<BookSourceEditActivity>()` 的入口触发语义）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart --plain-name "书源管理更多菜单新建书源入口会打开书源编辑页"` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 右上角更多 -> 新建书源`（确认进入书源编辑页且可见“自动保存Cookie”开启态）。
  - 兼容影响：无旧书源兼容性影响；本序号仅补齐 `menu_add_book_source` 入口语义与验证证据，不改动书源持久化结构与导入链路。
  - 已完成 `P2-seq131`：`book_source.xml / @+id/menu_import_local / 本地导入`。
  - `P2-seq131` 差异点清单（实施前）：
    - legado `book_source.xml` 将 `menu_import_local` 文案定义为 `@string/import_local`（“本地导入”）；Flutter 端“更多”菜单文案为“从文件导入”，存在用户可见语义偏差。
    - legado `BookSourceActivity.onCompatOptionsItemSelected` 在 `menu_import_local` 分支直接触发文件导入链路（`HandleFileContract.FILE + txt/json`）；Flutter 端已具备导入实现，但缺少本序号的逐项迁移证据闭环。
    - 网络导入 CORS 降级提示仍使用“从文件导入”旧文案，与本序号“本地导入”口径不一致。
  - `P2-seq131` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理页“更多”菜单保留一级“本地导入”入口，对齐 legado `menu_import_local` 层级）。
    - 状态：已同义（点击后进入本地文件导入链路，支持 `txt/json` 文件输入）。
    - 异常：已同义（本地导入失败仍走可观测错误提示链路，不新增静默失败分支）。
    - 文案：已同义（菜单文案由“从文件导入”收敛为“本地导入”；网络导入 CORS 提示同步收敛为“本地导入”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载“更多”菜单，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“本地导入”后调用 `_importFromFile()`，对应 legado `menu_import_local -> importDoc.launch(FILE, txt/json)` 的入口触发语义）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart --plain-name "书源管理更多菜单本地导入入口文案与 legado 一致"`、`flutter test test/source_import_export_service_test.dart --plain-name "importFromUrl returns actionable CORS hint on web"` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 右上角更多 -> 本地导入`（确认入口文案与触发链路同义）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_import_local` 入口文案与提示口径，不改动导入解析策略与书源存储结构。
  - 已完成 `P2-seq132`：`book_source.xml / @+id/menu_import_onLine / 网络导入`。
  - `P2-seq132` 差异点清单（实施前）：
    - legado `book_source.xml` 将 `menu_import_onLine` 文案定义为 `@string/import_on_line`（“网络导入”）；Flutter 端“更多”菜单文案为“从网络导入”，存在用户可见语义偏差。
    - legado `BookSourceActivity.showImportDialog()` 使用 `import_on_line` 作为弹层标题并以 `url` 作为输入提示；Flutter 端弹层标题为“在线导入”、输入占位为“输入书源链接（http/https）”，与 legado 文案口径不一致。
    - 导入错误提示中仍存在“文件导入”旧文案，与 `menu_import_local` 已收敛为“本地导入”的语义不一致，导致同链路文案漂移。
  - `P2-seq132` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理页“更多”菜单保留一级“网络导入”入口，对齐 legado `menu_import_onLine` 层级）。
    - 状态：已同义（点击后打开网络导入输入弹层，并保留历史导入记录展示与删除能力）。
    - 异常：已同义（网络导入失败仍走可观测错误提示链路；Web 跨域降级建议口径与本地导入入口一致）。
    - 文案：已同义（菜单文案由“从网络导入”收敛为“网络导入”；弹层标题由“在线导入”收敛为“网络导入”；输入占位收敛为“输入书源网址”；跨域提示统一为“本地导入”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet + CupertinoPopupSurface` 承载入口与输入弹层，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“网络导入”后调用 `_importFromUrl()`，对应 legado `menu_import_onLine -> showImportDialog()` 的入口触发语义）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart --plain-name "书源管理更多菜单网络导入入口文案与 legado 一致"`、`flutter test test/source_import_export_service_test.dart --plain-name "importFromUrl returns actionable CORS hint on web"` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 右上角更多 -> 网络导入`（确认入口文案、弹层标题与导入提示口径同义）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_import_onLine` 文案与提示口径，不改动导入解析策略与书源存储结构。
  - 已完成 `P2-seq133`：`book_source.xml / @+id/menu_import_qr / 二维码导入`。
  - `P2-seq133` 差异点清单（实施前）：
    - legado `book_source.xml` 将 `menu_import_qr` 文案定义为 `@string/import_by_qr_code`（“二维码导入”）；Flutter 端“更多”菜单文案为“扫码导入”，存在用户可见语义偏差。
    - legado `BookSourceActivity.onCompatOptionsItemSelected` 在 `menu_import_qr` 分支执行 `qrResult.launch()`，扫码结果回调后直接进入 `ImportBookSourceDialog`；Flutter 端虽已具备扫码导入能力，但保留了“扫码 URL 自动写入网络导入历史”的扩展路径，存在行为偏差风险。
    - tracker `seq133` 仍为 `pending`，缺少“入口文案 + 触发路径”的可复现验证证据，无法闭环本序号迁移记录。
  - `P2-seq133` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理页“更多”菜单保留一级“二维码导入”入口，对齐 legado `menu_import_qr` 层级）。
    - 状态：已同义（点击后进入扫码页；扫码取消时直接返回，不触发导入链路）。
    - 异常：已同义（扫码结果为空时保持静默返回，不新增错误提示分支）。
    - 文案：已同义（菜单文案由“扫码导入”收敛为 legado 同义“二维码导入”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载“更多”菜单，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“二维码导入”后调用 `_importFromQrCode()`，扫码结果统一走 `importFromText` 进入导入解析链路，等价 legado “扫码结果直接进入导入弹层”语义；移除扫码 URL 写入网络导入历史的扩展行为）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart --plain-name "书源管理更多菜单"` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 右上角更多 -> 二维码导入`（确认入口文案与触发路径同义，取消扫码不触发导入）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_import_qr` 入口文案与触发边界，不改动书源解析规则与持久化结构。
  - 已完成 `P2-seq134`：`book_source.xml / @+id/menu_group_sources_by_domain / 按域名分组显示`。
  - `P2-seq134` 差异点清单（实施前）：
    - legado `book_source.xml` 将 `menu_group_sources_by_domain` 定义为 `checkable` 菜单项，标题固定为“按域名分组显示”；Flutter 端当前实现为“按域名分组/关闭按域名分组”动态文案，存在用户可见语义偏差。
    - legado `BookSourceActivity.onCompatOptionsItemSelected` 通过 `item.isChecked` 表达开关状态并复用同一文案；Flutter 端缺少勾选态反馈，无法等价表达 checkable 语义。
    - tracker `seq134` 仍为 `pending`，缺少“固定文案 + 勾选态切换 + 域名分组生效”的可复现验证证据，无法闭环本序号迁移记录。
  - `P2-seq134` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理页“更多”菜单保留一级“按域名分组显示”入口，对齐 legado `menu_group_sources_by_domain` 层级）。
    - 状态：已同义（关闭态显示“按域名分组显示”；开启后再次打开菜单显示“✓ 按域名分组显示”，与 legado checkable 语义同义）。
    - 异常：已同义（仅切换分组状态与列表排序，不新增静默失败分支）。
    - 文案：已同义（移除“关闭按域名分组”扩展文案，统一为固定“按域名分组显示”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载“更多”菜单，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击后切换 `_groupSourcesByDomain`，列表按“域名升序 + 同域名按更新时间降序”重排并展示域名分组头，对齐 legado `groupSourcesByDomain + adapter.showSourceHost` 联动语义）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart --plain-name "书源管理更多菜单按域名分组显示为勾选态切换语义"` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 右上角更多 -> 按域名分组显示`（确认文案固定、勾选态可见、列表出现域名分组头）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_group_sources_by_domain` 的菜单文案与勾选态语义，不改动书源数据结构与持久化字段。
  - 已完成 `P2-seq135`：`book_source.xml / @+id/menu_help / 帮助`。
  - `P2-seq135` 差异点清单（实施前）：
    - legado `BookSourceActivity` 在 `menu_help` 分支固定执行 `showHelp("SourceMBookHelp")`；Flutter 端书源管理页“帮助”动作仅展示 `SourceHelpTexts.manage` 简版文本，未加载 legado 同源帮助文档资产，语义不一致。
    - legado 首次进入书源管理页与菜单帮助均复用 `SourceMBookHelp` 文档链路；Flutter 端首次提示与菜单帮助虽复用同一方法，但内容仍为扩展简版文本，存在文案与结构偏差。
    - 当前资产目录缺少 `assets/web/help/md/SourceMBookHelp.md`，无法对齐 legado 帮助文档内容与入口触发语义。
  - `P2-seq135` 逐项对照清单（实施后）：
    - 入口：已同义（书源管理页“更多”菜单保留一级“帮助”入口，对齐 legado `menu_help` 层级）。
    - 状态：已同义（点击帮助后弹出帮助对话框；首次进入书源管理在未标记已读时自动展示同一帮助文档）。
    - 异常：已同义（文档加载失败时展示“帮助文档加载失败：<原因>”可观测提示，不新增静默失败分支）。
    - 文案：已同义（帮助内容切换为 legado 同源 `SourceMBookHelp.md` 文档，不再使用本地扩展简版文案）。
    - 排版：已同义（复用现有 `showAppHelpDialog` 弹层承载文档，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（菜单 `menu_help` 与首次进入引导均调用同一 `_showSourceManageHelp()`，等价 legado `showHelp("SourceMBookHelp")` 的统一触发语义）。
    - 验证：`flutter test test/source_list_view_sort_action_test.dart --plain-name "书源管理更多菜单帮助入口会打开帮助弹层"` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 右上角更多 -> 帮助`（确认弹层展示 SourceMBookHelp 文档内容）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_help` 帮助文档触发与展示语义，不改动书源解析、校验与持久化链路。
  - 已完成 `P2-seq136`：`book_source_debug.xml / @+id/menu_scan / 扫描二维码`。
  - `P2-seq136` 差异点清单（实施前）：
    - legado `book_source_debug.xml` 将 `menu_scan` 定义为顶栏常驻动作，标题语义来自 `@string/scan_qr_code`（“扫描二维码”）；Flutter 端调试页扫码调用 `QrScanService.scanText(..., title: "扫码调试")`，存在用户可见文案偏差。
    - legado `BookSourceDebugActivity` 在 `menu_scan` 点击后直接执行 `qrCodeResult.launch()`，扫码结果回调进入 `startSearch(it)`；Flutter 端虽具备扫码入口，但缺少“点击即触发扫码动作”可控回归证据。
    - tracker `seq136` 仍为 `pending`，缺少 `menu_scan` 的单项迁移记录与验证证据，无法闭环本序号。
  - `P2-seq136` 逐项对照清单（实施后）：
    - 入口：已同义（书源调试页顶栏保留二维码图标一级入口，对齐 legado `menu_scan` 常驻 action 语义）。
    - 状态：已同义（点击顶栏扫码入口后直接发起扫码链路；取消扫码保持静默返回）。
    - 异常：已同义（扫码结果为空/取消时不触发调试流程，不新增扩展失败提示）。
    - 文案：已同义（扫码页标题由“扫码调试”收敛为 legado 同义“扫描二维码”）。
    - 排版：已同义（继续使用 `CupertinoNavigationBar` 顶栏 action 承载扫码入口，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击 `menu_scan` 对应图标后执行扫码启动器；扫码返回文本后按既有调试链路进入 `_runDebug`，等价 legado “扫码结果直达 startSearch”语义）。
    - 验证：`flutter test test/source_debug_legacy_view_scan_action_test.dart test/source_debug_legacy_view_compile_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 长按书源卡片 -> 调试 -> 顶栏扫码图标`（确认触发扫码页且标题为“扫描二维码”）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_scan` 的标题文案与触发可测性，不改动书源调试解析、日志输出与数据持久化链路。
  - 已完成 `P2-seq137`：`book_source_debug.xml / @+id/menu_search_src / 搜索源码`。
  - `P2-seq137` 差异点清单（实施前）：
    - legado `BookSourceDebugActivity` 在 `menu_search_src` 点击后直接执行 `showDialogFragment(TextDialog("html", viewModel.searchSrc))`；Flutter 端当前实现会在源码为空时额外拦截并提示“暂无搜索源码”，存在状态流转偏差。
    - legado 源码承载标题固定为 `html`；Flutter 端当前“搜索源码”路径使用“搜索源码”作为承载标题，存在用户可见文案偏差。
    - tracker `seq137` 仍为 `pending`，缺少 `menu_search_src` 的单项迁移记录与验证证据，无法闭环本序号。
  - `P2-seq137` 逐项对照清单（实施后）：
    - 入口：已同义（书源调试页“更多”菜单保留一级“搜索源码”动作，对齐 legado `menu_search_src` 层级）。
    - 状态：已同义（点击后直接进入源码承载页；源码为空时也保持可进入，不再新增拦截分支）。
    - 异常：已同义（移除“暂无搜索源码”扩展提示分支，不新增静默失败路径）。
    - 文案：已同义（源码承载标题收敛为 legacy 同义 `html`）。
    - 排版：已同义（继续使用 `CupertinoPageRoute` 承载源码文本，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击 `menu_search_src` 后直接打开源码承载页，等价 legado `TextDialog` 直接展示内容语义）。
    - 验证：`flutter test test/source_debug_legacy_view_search_src_action_test.dart test/source_debug_legacy_view_scan_action_test.dart test/source_debug_legacy_view_compile_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 长按书源卡片 -> 调试 -> 右上角更多 -> 搜索源码`（确认源码为空时也直接打开承载页且标题为 `html`）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_search_src` 触发与标题语义，不改动调试执行链路与源码采集逻辑。
  - 已完成 `P2-seq138`：`book_source_debug.xml / @+id/menu_book_src / 书籍源码`。
  - `P2-seq138` 差异点清单（实施前）：
    - legado `BookSourceDebugActivity` 在 `menu_book_src` 点击后直接执行 `showDialogFragment(TextDialog("html", viewModel.bookSrc))`；Flutter 端当前实现会在源码为空时额外拦截并提示“暂无详情源码”，存在状态流转偏差。
    - legado 源码承载标题固定为 `html`，且菜单文案为 `boo_src=书籍源码`；Flutter 端当前“详情源码”路径使用“详情源码”作为菜单与承载标题，存在用户可见文案偏差。
    - tracker `seq138` 仍为 `pending`，缺少 `menu_book_src` 的单项迁移记录与验证证据，无法闭环本序号。
  - `P2-seq138` 逐项对照清单（实施后）：
    - 入口：已同义（书源调试页“更多”菜单保留一级“书籍源码”动作，对齐 legado `menu_book_src` 层级）。
    - 状态：已同义（点击后直接进入源码承载页；源码为空时也保持可进入，不再新增拦截分支）。
    - 异常：已同义（移除“暂无详情源码/暂无书籍源码”扩展提示分支，不新增静默失败路径）。
    - 文案：已同义（菜单文案收敛为 legado 同义“书籍源码”，源码承载标题收敛为 `html`）。
    - 排版：已同义（继续使用 `CupertinoPageRoute` 承载源码文本，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击 `menu_book_src` 后直接打开源码承载页，等价 legado `TextDialog("html", bookSrc)` 直接展示内容语义）。
    - 验证：`flutter test test/source_debug_legacy_view_book_src_action_test.dart test/source_debug_legacy_view_search_src_action_test.dart test/source_debug_legacy_view_scan_action_test.dart test/source_debug_legacy_view_compile_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 长按书源卡片 -> 调试 -> 右上角更多 -> 书籍源码`（确认源码为空时也直接打开承载页且标题为 `html`）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_book_src` 触发、文案与标题语义，不改动调试执行链路与源码采集逻辑。
  - 已完成 `P2-seq139`：`book_source_debug.xml / @+id/menu_toc_src / 目录源码`。
  - `P2-seq139` 差异点清单（实施前）：
    - legado `BookSourceDebugActivity` 在 `menu_toc_src` 点击后直接执行 `showDialogFragment(TextDialog("html", viewModel.tocSrc))`；Flutter 端当前实现复用了 `_openRawSource(title: "目录源码", raw: _tocSrcRaw)`，源码为空时会额外拦截并提示“暂无目录源码”，存在状态流转偏差。
    - legado 源码承载标题固定为 `html`；Flutter 端当前“目录源码”路径使用“目录源码”作为承载标题，存在用户可见文案偏差。
    - tracker `seq139` 仍为 `pending`，缺少 `menu_toc_src` 的单项迁移记录与验证证据，无法闭环本序号。
  - `P2-seq139` 逐项对照清单（实施后）：
    - 入口：已同义（书源调试页“更多”菜单保留一级“目录源码”动作，对齐 legado `menu_toc_src` 层级）。
    - 状态：已同义（点击后直接进入源码承载页；源码为空时也保持可进入，不再新增拦截分支）。
    - 异常：已同义（移除“暂无目录源码”扩展提示分支，不新增静默失败路径）。
    - 文案：已同义（源码承载标题收敛为 legacy 同义 `html`）。
    - 排版：已同义（继续使用 `CupertinoPageRoute` 承载源码文本，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击 `menu_toc_src` 后直接打开源码承载页，等价 legado `TextDialog("html", tocSrc)` 直接展示内容语义）。
    - 验证：`flutter test test/source_debug_legacy_view_toc_src_action_test.dart test/source_debug_legacy_view_book_src_action_test.dart test/source_debug_legacy_view_search_src_action_test.dart test/source_debug_legacy_view_scan_action_test.dart test/source_debug_legacy_view_compile_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 长按书源卡片 -> 调试 -> 右上角更多 -> 目录源码`（确认源码为空时也直接打开承载页且标题为 `html`）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_toc_src` 触发与标题语义，不改动调试执行链路与源码采集逻辑。
  - 已完成 `P2-seq140`：`book_source_debug.xml / @+id/menu_content_src / 正文源码`。
  - `P2-seq140` 差异点清单（实施前）：
    - legado `BookSourceDebugActivity` 在 `menu_content_src` 点击后直接执行 `showDialogFragment(TextDialog("html", viewModel.contentSrc))`；Flutter 端当前实现复用了 `_openRawSource(title: "正文源码", raw: _contentSrcRaw)`，源码为空时会额外拦截并提示“暂无正文源码”，存在状态流转偏差。
    - legado 源码承载标题固定为 `html`；Flutter 端当前“正文源码”路径使用“正文源码”作为承载标题，存在用户可见文案偏差。
    - tracker `seq140` 仍为 `pending`，缺少 `menu_content_src` 的单项迁移记录与验证证据，无法闭环本序号。
  - `P2-seq140` 逐项对照清单（实施后）：
    - 入口：已同义（书源调试页“更多”菜单保留一级“正文源码”动作，对齐 legado `menu_content_src` 层级）。
    - 状态：已同义（点击后直接进入源码承载页；源码为空时也保持可进入，不再新增拦截分支）。
    - 异常：已同义（移除“暂无正文源码”扩展提示分支，不新增静默失败路径）。
    - 文案：已同义（源码承载标题收敛为 legacy 同义 `html`）。
    - 排版：已同义（继续使用 `CupertinoPageRoute` 承载源码文本，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击 `menu_content_src` 后直接打开源码承载页，等价 legado `TextDialog("html", contentSrc)` 直接展示内容语义）。
    - 验证：`flutter test test/source_debug_legacy_view_content_src_action_test.dart test/source_debug_legacy_view_toc_src_action_test.dart test/source_debug_legacy_view_book_src_action_test.dart test/source_debug_legacy_view_search_src_action_test.dart test/source_debug_legacy_view_scan_action_test.dart test/source_debug_legacy_view_compile_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 长按书源卡片 -> 调试 -> 右上角更多 -> 正文源码`（确认源码为空时也直接打开承载页且标题为 `html`）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_content_src` 触发与标题语义，不改动调试执行链路与源码采集逻辑。
  - 已完成 `P2-seq141`：`book_source_debug.xml / @+id/menu_refresh_explore / 刷新发现`。
  - `P2-seq141` 差异点清单（实施前）：
    - legado `BookSourceDebugActivity` 在 `menu_refresh_explore` 点击后执行 `clearExploreKindsCache -> adapter.clearItems -> openOrCloseHelp(true) -> initExploreKinds()`；Flutter 端虽已存在 `_refreshExploreKinds()`，但缺少“清缓存 + 强制重载 + 帮助区恢复 + 日志清空”的单项可复现证据。
    - Flutter 端 `SourceDebugLegacyView` 将发现分类服务实例内置在组件状态内，测试环境难以稳定注入“首次失败、刷新后成功”的对照场景，导致本序号无法闭环迁移验收证据。
    - tracker `seq141` 仍为 `pending`，缺少 `menu_refresh_explore` 的单项迁移记录与验证证据，无法闭环本序号。
  - `P2-seq141` 逐项对照清单（实施后）：
    - 入口：已同义（书源调试页“更多”菜单保留一级“刷新发现”动作，对齐 legado `menu_refresh_explore` 层级）。
    - 状态：已同义（点击后先清理发现缓存，再清空调试日志，帮助区恢复可见，并强制重载发现分类）。
    - 异常：已同义（发现分类重载失败仍走可观测日志输出，不新增静默失败分支）。
    - 文案：已同义（菜单文案保持 legado 同义“刷新发现”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载“更多”菜单，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击 `menu_refresh_explore` 后调用 `_refreshExploreKinds()`，其顺序为 `clearExploreKindsCache -> _events.clear + _helpVisible=true + _selectedExploreIndex=0 -> _loadExploreKinds(forceRefresh: true)`，与 legado 刷新发现状态流转同义）。
    - 验证：`flutter test test/source_debug_legacy_view_refresh_explore_action_test.dart test/source_debug_legacy_view_compile_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 长按书源卡片 -> 调试 -> 右上角更多 -> 刷新发现`（确认刷新后帮助区可见、日志区清空、发现快捷项重新加载）。
  - 兼容影响：无旧书源兼容性影响；本序号仅补齐 `menu_refresh_explore` 的可测性注入点与验证证据，不改动调试主链路与书源数据结构。
  - 已完成 `P2-seq142`：`book_source_debug.xml / @+id/menu_help / 帮助`。
  - `P2-seq142` 差异点清单（实施前）：
    - legado `BookSourceDebugActivity` 在 `menu_help` 点击后执行 `showHelp("debugHelp")`，会读取 `assets/web/help/md/debugHelp.md` 并以帮助弹层展示 Markdown 文档。
    - Flutter 端当前 `menu_help` 仍执行 `_showMessage(SourceHelpTexts.debug)`，属于内置提示文本弹窗，不是 legado 的文档帮助链路，交互语义与文档来源均不一致。
    - Flutter 资产目录中缺少 `debugHelp.md`，即使改造为文档弹层也无法等价复现 legado 内容。
  - `P2-seq142` 逐项对照清单（实施后）：
    - 入口：已同义（书源调试页“更多”菜单保留一级“帮助”动作，对齐 legado `menu_help` 层级）。
    - 状态：已同义（点击后读取 `debugHelp.md` 并打开帮助弹层，等价 legado `showHelp("debugHelp")` 文档链路）。
    - 异常：已同义（文档加载失败时给出“帮助文档加载失败：<error>”可观测提示，不新增静默失败分支）。
    - 文案：已同义（动作文案保持“帮助”，帮助弹层标题保持“帮助”）。
    - 排版：已同义（复用统一 `showAppHelpDialog` 承载文档内容，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击 `menu_help` 后调用 `_showDebugHelp()`，先从 `assets/web/help/md/debugHelp.md` 读取文档，再展示帮助弹层）。
    - 验证：`flutter test test/source_debug_legacy_view_help_action_test.dart test/source_debug_legacy_view_refresh_explore_action_test.dart test/source_debug_legacy_view_compile_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 长按书源卡片 -> 调试 -> 右上角更多 -> 帮助`（确认打开帮助弹层并展示 `debugHelp.md` 文档内容）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_help` 的文档帮助链路与资产，不改动调试执行主链路。
  - 已完成 `P2-seq143`：`book_source_item.xml / @+id/menu_top / 置顶`。
  - `P2-seq143` 差异点清单（实施前）：
    - legado `BookSourceAdapter.showMenu` 仅在 `sort == BookSourceSort.Default` 显示 `menu_top`，点击后走 `callBack.toTop(source)`；`BookSourceActivity.toTop` 再按 `sortAscending` 分流到 `viewModel.topSource/bottomSource`，形成“反序时置顶走底序写库”的边界语义。
    - Flutter 端虽已有条目“置顶”入口与 `_toTop`，但缺少可复现证据证明“仅手动排序展示入口 + 反序时 `toTop=false` 分流”这两条关键语义。
    - `widget test` 场景下条目菜单触发置顶会命中 Drift 批量写库阻塞，导致迁移证据无法稳定闭环。
  - `P2-seq143` 逐项对照清单（实施后）：
    - 入口：已同义（书源条目“更多”菜单仅在手动排序展示“置顶”，对齐 legado `menu_top` 可见性边界）。
    - 状态：已同义（点击 `menu_top` 后进入 `_toTop`；升序传递 `toTop=true`，反序传递 `toTop=false`，对齐 legado `toTop -> topSource/bottomSource` 分流语义）。
    - 异常：已同义（未新增成功弹窗或失败静默分支；沿用原有可观测链路）。
    - 文案：已同义（动作文案保持“置顶”，无扩展文案漂移）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载条目菜单，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（条目“更多”菜单点击 `menu_top` 后直接进入置顶链路，等价 legado `menu_top -> CallBack.toTop(bookSource)`）。
    - 验证：`flutter test test/source_list_view_item_top_action_test.dart test/source_list_view_compile_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 书源条目右侧更多 -> 置顶`（确认手动排序显示入口，切换“反序”后再次点击“置顶”按 legacy 语义走反向分流）。
  - 兼容影响：无旧书源兼容性影响；本序号仅补齐 `menu_top` 的入口可见性/分流语义与回归证据，不改动书源数据结构与导入链路。
  - 已完成 `P2-seq144`：`book_source_item.xml / @+id/menu_bottom / 置底`。
  - `P2-seq144` 差异点清单（实施前）：
    - legado `BookSourceAdapter.showMenu` 在 `sort == BookSourceSort.Default` 时展示 `menu_bottom`，点击后固定走 `callBack.toBottom(source)`，并由 `BookSourceActivity.toBottom` 按 `sortAscending` 分流到 `viewModel.bottomSource/topSource`。
    - Flutter 端运行链路虽已存在 `_toBottom`，但缺少可复现证据证明“仅手动排序展示置底入口 + 升序置底传递 `toTop=false` + 反序置底传递 `toTop=true`”三条关键语义。
  - `P2-seq144` 逐项对照清单（实施后）：
    - 入口：已同义（书源条目“更多”菜单仅在手动排序展示“置底”，对齐 legado `menu_bottom` 可见性边界）。
    - 状态：已同义（点击 `menu_bottom` 后进入 `_toBottom`；升序传递 `toTop=false`，反序传递 `toTop=true`，对齐 legado `toBottom -> bottomSource/topSource` 分流语义）。
    - 异常：已同义（未新增成功弹窗或失败静默分支；沿用原有可观测链路）。
    - 文案：已同义（动作文案保持“置底”，无扩展文案漂移）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载条目菜单，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（条目“更多”菜单点击 `menu_bottom` 后直接进入置底链路，等价 legado `menu_bottom -> CallBack.toBottom(bookSource)`）。
    - 验证：`flutter test test/source_list_view_item_top_action_test.dart test/source_list_view_compile_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 书源条目右侧更多 -> 置底`（确认手动排序显示入口，切换“反序”后再次点击“置底”按 legacy 语义走反向分流）。
  - 兼容影响：无旧书源兼容性影响；本序号仅补齐 `menu_bottom` 的入口可见性/分流语义与回归证据，不改动书源数据结构与导入链路。
  - 已完成 `P2-seq145`：`book_source_item.xml / @+id/menu_login / 登录`。
  - `P2-seq145` 差异点清单（实施前）：
    - legado `BookSourceAdapter.showMenu` 仅在 `source.hasLoginUrl` 时展示 `menu_login`，点击后固定以 `type=bookSource` 和 `key=bookSourceUrl` 触发登录链路。
    - Flutter 端 `menu_login` 显示与主链路已接近同义，但缺少 `book_source_item` 维度的可复现回归证据，且登录动作未在触发前按 URL 回查书源边界。
  - `P2-seq145` 逐项对照清单（实施后）：
    - 入口：已同义（`loginUrl` 为空时不显示“登录”，与 legado `hasLoginUrl` 可见性边界一致）。
    - 状态：已同义（`loginUrl` 非空且存在 `loginUi` 时，点击“登录”进入表单登录页；保持与 legado 登录入口状态分流同义）。
    - 异常：已同义（触发登录前按 `bookSourceUrl` 回查最新书源；缺失时提示“未找到书源”，避免静默失败）。
    - 文案：已同义（菜单项文案保持“登录”，不引入扩展文案）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载条目菜单，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（条目“更多”菜单点击 `menu_login` 后直达登录链路，等价 legado `menu_login -> SourceLoginActivity(type=bookSource,key=bookSourceUrl)` 的入口语义）。
    - 验证：`flutter test test/source_list_view_item_top_action_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 书源条目右侧更多 -> 登录`（验证 `loginUrl` 为空不显示登录入口、`loginUrl` 非空且有 `loginUi` 时进入登录表单页）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_login` 的入口可见性与触发边界，不改动书源登录脚本与 Cookie 存储结构。
  - 已完成 `P2-seq146`：`book_source_item.xml / @+id/menu_search / 搜索`。
  - `P2-seq146` 差异点清单（实施前）：
    - legado `BookSourceAdapter.showMenu` 点击 `menu_search` 后固定走 `BookSourceActivity.searchBook`，并以当前条目快照构造 `SearchScope(bookSource)` 传给 `SearchActivity`，不依赖再次查库。
    - Flutter 端此前使用 `SearchView.scoped(sourceUrls:[url])` 在搜索页初始化时再按 URL 回查书源生成 scope；若 action sheet 打开后条目被删除，会退化为沿用旧 scope，和 legado 快照语义不一致。
  - `P2-seq146` 逐项对照清单（实施后）：
    - 入口：已同义（书源条目“更多”菜单常驻“搜索”入口，与 legado `menu_search` 同层级）。
    - 状态：已同义（点击后先按条目快照写入 `searchScope=<书源名去冒号>::<bookSourceUrl>`，再进入搜索页，保持 legacy 快照状态流转）。
    - 异常：已同义（移除“依赖二次查库才能生成 scope”的边界漂移；即使条目在弹层打开后被删除，仍保留快照 scope，后续由搜索页按 legacy 规则在解析阶段兜底回退）。
    - 文案：已同义（菜单项文案保持“搜索”，不引入扩展文案）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载条目菜单，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（条目“更多”菜单点击 `menu_search` 后直达搜索页，等价 legado `menu_search -> SearchActivity(searchScope=SearchScope(bookSource))`）。
    - 验证：`flutter test test/source_list_view_item_top_action_test.dart`、`flutter test test/source_list_view_compile_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 书源条目右侧更多 -> 搜索`。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_search` 的 scope 快照写入时机与入口触发语义，不改动搜索算法与书源数据结构。
  - 已完成 `P2-seq147`：`book_source_item.xml / @+id/menu_debug_source / 调试`。
  - `P2-seq147` 差异点清单（实施前）：
    - legado `BookSourceAdapter.showMenu` 点击 `menu_debug_source` 后直接调用 `callBack.debug(source)`；`BookSourceActivity.debug` 固定携带当前条目 `bookSourceUrl` 打开 `BookSourceDebugActivity`，入口不做二次查库拦截。
    - Flutter 端此前复用了 `_openEditor(bookSourceUrl, initialTab: 3)`，会先按 URL 回查书源；若 action sheet 打开后条目被删，会提前提示“书源不存在或已被删除”并中断进入调试页，触发语义偏离 legado。
  - `P2-seq147` 逐项对照清单（实施后）：
    - 入口：已同义（书源条目“更多”菜单常驻“调试”入口，与 legado `menu_debug_source` 同层级）。
    - 状态：已同义（点击后按当前条目快照直接进入 `SourceDebugLegacyView`，不再依赖入口前二次查库）。
    - 异常：已同义（移除入口前置拦截；即使弹层打开后条目被删除，仍可进入调试页，由调试页内部链路处理后续状态）。
    - 文案：已同义（菜单项文案保持“调试”，不引入扩展文案）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载条目菜单，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（条目“更多”菜单点击 `menu_debug_source` 后直达调试页，等价 legado `menu_debug_source -> BookSourceDebugActivity(key=bookSourceUrl)` 的入口触发语义）。
    - 验证：`flutter test test/source_list_view_item_top_action_test.dart`、`flutter test test/source_list_view_compile_test.dart` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 书源条目右侧更多 -> 调试`。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_debug_source` 的入口触发语义与边界行为，不改动调试引擎、书源数据结构与存储字段。
  - 已完成 `P2-seq148`：`book_source_item.xml / @+id/menu_del / 删除`。
  - `P2-seq148` 差异点清单（实施前）：
    - legado `BookSourceAdapter.showMenu` 在 `menu_del` 点击后执行 `callBack.del(source)`，并立即 `selected.remove(source)`；`BookSourceActivity.del` 再以 `draw + sure_del + "\n" + bookSourceName` 弹出二次确认，确认后执行 `viewModel.del(listOf(bookSource))`。
    - Flutter 端条目删除链路虽已具备“先移除选中态 + 二次确认 + 删除书源”的主流程，但确认弹窗标题仍为“提示”，与 legado `R.string.draw=提醒` 存在文案偏差。
    - tracker `seq148` 仍为 `pending`，缺少本序号“弹窗文案 + 状态流转 + 删除落库”的独立可复现验证证据。
  - `P2-seq148` 逐项对照清单（实施后）：
    - 入口：已同义（书源条目“更多”菜单保留一级“删除”入口，对齐 legado `menu_del` 层级）。
    - 状态：已同义（点击“删除”后先移除当前条目选中态，再弹出确认弹窗；取消后不恢复选中态，保持与 legado `selected.remove(source)` 时序一致）。
    - 异常：已同义（取消确认不触发删除；确认后删除书源记录并继续执行源变量清理，不新增静默失败分支）。
    - 文案：已同义（确认弹窗标题由“提示”收敛为 legado 同义“提醒”，正文保持“是否确认删除？\\n<书源名>”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet + CupertinoAlertDialog` 承载菜单与确认弹窗，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击 `menu_del` 后进入 `_confirmDeleteSource`；确认按钮直接触发 `_deleteSourceByLegacyRule`，等价 legado `yesButton -> viewModel.del` 删除确认语义）。
    - 验证：`flutter test test/source_list_view_item_top_action_test.dart --plain-name "书源条目菜单删除会先移除选中态，取消后保留条目"`、`flutter test test/source_list_view_item_top_action_test.dart --plain-name "书源条目菜单确认删除后会删除条目"`、`flutter test test/source_variable_store_test.dart --plain-name "remove variable"` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 书源条目右侧更多 -> 删除`（确认标题“提醒”、取消不删除、确认后条目删除）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_del` 的确认文案与触发语义，不改动书源数据结构与排序字段。
  - 已完成 `P2-seq149`：`book_source_item.xml / @+id/menu_enable_explore / 启用发现`。
  - `P2-seq149` 差异点清单（实施前）：
    - legado `BookSourceAdapter.showMenu` 仅在 `source.hasExploreUrl` 时展示 `menu_enable_explore`，并按 `source.enabledExplore` 动态切换菜单文案“启用发现/禁用发现”。
    - Flutter 端入口显隐与文案已接近同义，但点击动作直接调用 `_sourceRepo.updateSource(source.copyWith(...))`；由于 `updateSource` 为 upsert，若 action sheet 打开后书源被删除，点击该动作会把书源重新写回，偏离 legado `BookSourceDao.enableExplore` 仅更新现存记录的语义。
    - tracker `seq149` 仍为 `pending`，缺少“入口显隐 + 文案切换 + 删除后不重建”的独立可复现证据。
  - `P2-seq149` 逐项对照清单（实施后）：
    - 入口：已同义（仅 `exploreUrl` 非空的书源在条目“更多”菜单显示“启用发现/禁用发现”入口，对齐 legado `hasExploreUrl` 可见性边界）。
    - 状态：已同义（文案按条目快照 `enabledExplore` 状态在“启用发现/禁用发现”间切换，点击后写库并由列表数据流刷新状态）。
    - 异常：已同义（点击动作改为先按 `bookSourceUrl` 回查当前记录；若记录已不存在则静默返回，不再发生“删除后被重建”的语义偏差）。
    - 文案：已同义（菜单项文案保持 legado 同义“启用发现/禁用发现”，不引入额外状态提示文案）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载条目菜单，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击 `menu_enable_explore` 后执行 `enabledExplore` 切换并写库，等价 legado `menu_enable_explore -> enableExplore(!enabledExplore, source)` 链路）。
    - 验证：`flutter test test/source_list_view_item_top_action_test.dart --plain-name "书源条目菜单启用发现入口显隐与切换文案对齐 legado"`、`flutter test test/source_list_view_item_top_action_test.dart --plain-name "书源条目菜单启用发现在弹层期间删除书源不会重建记录"` 通过；手工路径 `书架 -> 搜索 -> 右上角设置 -> 书源管理 -> 书源条目右侧更多 -> 启用发现/禁用发现`（确认入口显隐、文案切换与删除后不重建边界）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_enable_explore` 的触发边界与写库语义，不改动书源结构与发现解析链路。
  - 已完成 `P2-seq162`：`book_toc.xml / @+id/menu_search / 搜索`。
  - `P2-seq162` 差异点清单（实施前）：
    - legado `TocActivity` 的 `menu_search` 为顶栏 `SearchView` actionView，默认折叠为搜索图标；点击后展开搜索框并在 `onQueryTextChange` 里实时触发目录过滤。
    - legado 在搜索框失焦时会执行 `isIconified = true` 收起搜索 actionView；关闭搜索时恢复非搜索态，不保留“常驻内联输入框”形态。
    - Flutter 端目录页此前使用页面内联 `ShadInput(搜索章节)`，缺少 `menu_search` 顶栏入口、展开/收起状态流转与对应定向回归证据。
  - `P2-seq162` 逐项对照清单（实施后）：
    - 入口：已同义（目录页顶栏新增一级“搜索”图标入口，对齐 legado `menu_search` action 入口层级）。
    - 状态：已同义（默认折叠；点击搜索图标展开搜索框；失焦自动收起；点击关闭按钮清空查询并恢复全量目录）。
    - 异常：已同义（仅收敛 `menu_search` 入口与状态流转，不新增静默失败分支或扩展错误文案）。
    - 文案：已同义（搜索占位与动作语义统一为“搜索”，去除“搜索章节”扩展口径）。
    - 排版：已同义（采用 `CupertinoNavigationBar` 顶栏 action + `CupertinoSearchTextField` 承载，视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（输入关键字后即时按章节标题过滤目录，等价 legado `menu_search -> onQueryTextChange -> startChapterListSearch` 的检索触发语义）。
    - 验证：`flutter test test/search_book_info_view_toc_search_action_test.dart test/search_book_info_view_compile_test.dart` 通过；手工路径 `书架 -> 书籍详情 -> 目录查看 -> 顶栏搜索图标 -> 输入关键词过滤 -> 关闭搜索`。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_search` 的入口形态与目录过滤状态流转，不改动目录解析与阅读跳转链路。
  - 已完成 `P2-seq163`：`book_toc.xml / @+id/menu_toc_regex / TXT 目录规则`。
  - `P2-seq163` 差异点清单（实施前）：
    - legado `TocActivity` 在本地 TXT 场景显示 `menu_toc_regex`，点击后直接进入 `TxtTocRuleDialog`，确认后回调 `onTocRegexDialogResult`，并执行 `upBookAndToc` 立即重建目录。
    - Flutter 目录页缺失 `menu_toc_regex` 入口；本地 TXT 仅支持“自动识别”分章，无“按书籍指定 toc 正则并立即重建目录”的状态流转。
    - `TxtParser` 仅有内置规则自动匹配策略，`SearchBookInfoRefreshHelper` / 阅读器重解析链路未透传目录正则参数。
  - `P2-seq163` 逐项对照清单（实施后）：
    - 入口：已同义（目录页右上角“更多”菜单仅在本地 TXT 书籍显示“TXT 目录规则”入口，对齐 legado `menu_group_text` 可见性边界）。
    - 状态：已同义（目录规则按“书籍级”持久化；选择规则后立即触发本地 TXT 重解析并刷新目录缓存；取消选择不落库不生效）。
    - 异常：已同义（正则非法/不匹配导致章节为空时，刷新链路维持可观测失败提示，不新增静默成功分支）。
    - 文案：已同义（菜单文案固定“TXT 目录规则”，规则面板标题同名，不引入扩展提示文案）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载目录操作与规则选择，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（`menu_toc_regex` 触发规则选择；确认后写入书籍级 `tocRuleRegex` 并执行本地重解析，等价 legado `menu_toc_regex -> onTocRegexDialogResult -> upBookAndToc` 状态流转）。
    - 验证：`flutter test test/txt_parser_toc_rule_regex_test.dart test/search_book_info_refresh_helper_test.dart test/app_settings_test.dart test/search_book_info_view_toc_search_action_test.dart test/search_book_info_view_compile_test.dart` 通过；手工路径 `书架 -> 书籍详情 -> 查看目录 -> 右上角更多 -> TXT 目录规则 -> 选择规则`（确认入口可见性、规则落库与目录重建）。
  - 兼容影响：无旧书源兼容性影响；本序号仅新增书籍级 TXT 目录规则配置与重解析透传，不改动书源模型与网络目录解析链路。
  - 已完成 `P2-seq165`：`book_toc.xml / @+id/menu_reverse_toc / 反转目录`。
  - `P2-seq165` 差异点清单（实施前）：
    - legado `TocActivity` 将 `menu_reverse_toc` 放在顶栏“更多”菜单中，文案固定“反转目录”，点击后执行一次性动作 `reverseToc`，不是页面内常驻排序按钮。
    - Flutter 端目录页此前使用页面内“倒序”按钮触发 `_reversed` 切换，入口层级与文案均与 legado 存在偏差（按钮入口 + “倒序”文案）。
    - 目录页“更多”菜单此前仅承载 `menu_toc_regex`（本地 TXT 场景），非本地 TXT 场景无菜单入口，无法等价承载 `menu_reverse_toc`。
  - `P2-seq165` 逐项对照清单（实施后）：
    - 入口：已同义（目录页右上角“更多”菜单常驻可见，`menu_reverse_toc` 在菜单内一级展示；本地 TXT 场景继续与 `menu_toc_regex` 同层并存）。
    - 状态：已同义（点击“反转目录”后切换目录顺序；目录计数与搜索结果数量保持实时刷新）。
    - 异常：已同义（仅调整入口层级与触发动作，不新增静默失败分支或扩展错误提示）。
    - 文案：已同义（动作文案由“倒序”收敛为 legado 同义固定“反转目录”）。
    - 排版：已同义（移除页面内倒序按钮，改为 `CupertinoActionSheet` 承载目录动作；平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击 `menu_reverse_toc` 后切换 `_reversed`，并继续保持“先按章节标题过滤，再执行倒序”的目录检索边界，与既有 legado 检索顺序要求同义）。
    - 验证：`flutter test test/search_book_info_view_toc_search_action_test.dart test/search_book_info_view_compile_test.dart` 通过；手工路径 `书架 -> 书籍详情 -> 查看目录 -> 右上角更多 -> 反转目录`（确认菜单入口层级、文案与倒序结果）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_reverse_toc` 的入口层级与文案语义，不改动目录解析、章节索引落库与阅读跳转链路。
  - 已完成 `P2-seq168`：`book_toc.xml / @+id/menu_export_bookmark / 导出`。
  - `P2-seq168` 差异点清单（实施前）：
    - legado `TocActivity` 在书签菜单组暴露 `menu_export_bookmark`，点击后通过 `HandleFileContract(requestCode=1)` 选择导出位置，再调用 `TocViewModel.saveBookmark` 落盘 JSON 并提示“导出成功”。
    - Flutter 端目录页“更多”菜单仅包含 `TXT 目录规则/反转目录`，缺少 `menu_export_bookmark` 入口与导出触发链路，无法提供同义导出能力。
    - Flutter 详情页目录弹层未接入书签导出可观测链路（成功提示、取消静默、失败日志），`seq168` 缺少独立回归证据。
  - `P2-seq168` 逐项对照清单（实施后）：
    - 入口：已同义（目录页右上角“更多”菜单新增固定文案“导出”入口，对齐 legado `menu_export_bookmark` 动作层级）。
    - 状态：已同义（点击“导出”后进入书签 JSON 导出流程；成功提示“导出成功”，取消保存保持静默返回）。
    - 异常：已同义（导出初始化或落盘失败时记录异常日志并弹出可观测失败提示，不新增静默失败分支）。
    - 文案：已同义（菜单项文案固定“导出”，成功反馈固定“导出成功”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载目录动作，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击 `menu_export_bookmark` 后读取当前书籍书签并执行 JSON 导出，等价 legado `menu_export_bookmark -> saveBookmark` 主链路语义）。
    - 验证：`flutter test test/search_book_info_view_toc_search_action_test.dart test/search_book_info_view_compile_test.dart` 通过；手工路径 `书架 -> 书籍详情 -> 查看目录 -> 右上角更多 -> 导出`（确认入口可见、导出成功提示与取消静默边界）。
  - 兼容影响：无旧书源兼容性影响；本序号仅补齐目录页 `menu_export_bookmark` 入口与 JSON 导出触发链路，不改动目录解析、书签存储结构与阅读跳转逻辑。
  - 已完成 `P2-seq169`：`book_toc.xml / @+id/menu_export_md / 导出(MD)`。
  - `P2-seq169` 差异点清单（实施前）：
    - legado `TocActivity` 在书签菜单组暴露 `menu_export_md`，点击后通过 `HandleFileContract(requestCode=2)` 选择导出位置，再调用 `TocViewModel.saveBookmarkMd` 落盘 Markdown 并提示“导出成功”。
    - Flutter 端目录页“更多”菜单仅补齐了 `menu_export_bookmark`（JSON 导出），缺少 `menu_export_md` 入口与 Markdown 导出触发链路，无法覆盖 legado 书签菜单组第二个导出动作。
    - `seq168` 的定向回归只验证了 JSON 导出参数（`.json`），未覆盖 Markdown 导出参数（`.md`）与入口文案“导出(MD)”。
  - `P2-seq169` 逐项对照清单（实施后）：
    - 入口：已同义（目录页右上角“更多”菜单新增固定文案“导出(MD)”入口，对齐 legado `menu_export_md` 动作层级）。
    - 状态：已同义（点击“导出(MD)”后进入书签 Markdown 导出流程；成功提示“导出成功”，取消保存保持静默返回）。
    - 异常：已同义（导出初始化或落盘失败时记录异常日志并弹出可观测失败提示，不新增静默失败分支）。
    - 文案：已同义（菜单项文案固定“导出(MD)”，成功反馈固定“导出成功”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载目录动作，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击 `menu_export_md` 后读取当前书籍书签并执行 Markdown 导出，等价 legado `menu_export_md -> saveBookmarkMd` 主链路语义）。
    - 验证：`flutter test test/search_book_info_view_toc_search_action_test.dart test/search_book_info_view_compile_test.dart` 通过；手工路径 `书架 -> 书籍详情 -> 查看目录 -> 右上角更多 -> 导出(MD)`（确认入口可见、导出成功提示与取消静默边界）。
  - 兼容影响：无旧书源兼容性影响；本序号仅补齐目录页 `menu_export_md` 入口与 Markdown 导出触发链路，不改动目录解析、书签存储结构与阅读跳转逻辑。
  - 已完成 `P2-seq64`：`book_read.xml / @+id/menu_change_source / 换源`。
  - `P2-seq64` 差异点清单（实施前）：
    - legado `ReadBookActivity` 中 `menu_change_source` 属于在线阅读顶栏一级 action，点击即触发整书换源（`ChangeBookSourceDialog`）；当前 Flutter 端仅在“阅读操作”二级菜单提供“换源”，入口层级不一致。
    - legado 对 `menu_change_source` 额外提供“长按图标 -> `book_read_change_source.xml` 分支菜单（章节换源/书籍换源）”语义；Flutter 端未在顶栏动作上提供长按分支入口。
    - Flutter 端“换源”默认行为是“先弹章节/整书二级选择”，与 legado “点击即整书换源”默认触发路径不一致。
  - `P2-seq64` 逐项对照清单（实施后）：
    - 入口：已同义（阅读页顶部新增“换源”一级动作按钮，仅在线书籍显示，对齐 legado `menu_group_on_line -> menu_change_source` 层级）。
    - 状态：已同义（点击换源后先收起阅读菜单，再进入换源候选流程；本地书籍隐藏入口，保持在线/本地分组边界一致）。
    - 异常：已同义（沿用现有换源失败可观测提示链路，不新增静默失败分支）。
    - 文案：已同义（一级入口固定“换源”，长按分支菜单保持“章节换源/书籍换源”顺序与文案同义）。
    - 排版：已同义（采用顶栏圆角图标按钮承载一级动作，Cupertino 样式差异属于 `Shadcn + Cupertino` 平台允许范围）。
    - 交互触发：已同义（点击“换源”默认直达整书换源；长按“换源”弹出分支菜单并承载章节/整书换源选择，对齐 legado `iconItemOnLongClick(menu_change_source)` 语义）。
    - 验证：`flutter test test/reader_top_menu_test.dart test/simple_reader_view_compile_test.dart` 通过；手工路径 `阅读页 -> 顶部换源按钮（点击）`、`阅读页 -> 顶部换源按钮（长按）`（确认默认整书换源与长按分支菜单）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛阅读页 `menu_change_source` 入口层级与默认触发语义，不改动章节换源/整书换源数据匹配与落库策略。
  - 已完成 `P2-seq65`：`book_read.xml / @+id/menu_refresh / 刷新`。
  - `P2-seq65` 差异点清单（实施前）：
    - legado `ReadBookActivity` 中 `menu_refresh` 属于在线阅读顶栏一级 action，点击语义等价 `menu_refresh_dur`（刷新当前章节）；当前 Flutter 端仅在“阅读操作”二级菜单提供刷新，入口层级不一致。
    - legado 对 `menu_refresh` 额外提供“长按图标 -> `book_read_refresh.xml` 分支菜单（刷新当前章节/刷新之后章节/刷新全部章节）”语义；Flutter 端未在顶栏动作上提供长按分支入口。
    - Flutter 端“阅读操作”菜单仍包含“刷新”，与 legado 顶栏一级入口语义存在层级偏差。
  - `P2-seq65` 逐项对照清单（实施后）：
    - 入口：已同义（阅读页顶部新增“刷新”一级动作按钮，仅在线书籍显示，对齐 legado `menu_group_on_line -> menu_refresh` 层级）。
    - 状态：已同义（点击刷新后先收起阅读菜单，再按当前章节执行刷新；本地书籍隐藏入口，保持在线/本地分组边界一致）。
    - 异常：已同义（沿用现有刷新失败可观测提示链路，不新增静默失败分支）。
    - 文案：已同义（一级入口固定“刷新”，长按分支菜单保持“刷新当前章节/刷新之后章节/刷新全部章节”顺序与文案同义）。
    - 排版：已同义（采用顶栏圆角图标按钮承载一级动作，Cupertino 样式差异属于 `Shadcn + Cupertino` 平台允许范围）。
    - 交互触发：已同义（点击“刷新”默认执行当前章节刷新；长按“刷新”弹出分支菜单并承载当前/之后/全部刷新选择，对齐 legado `iconItemOnLongClick(menu_refresh)` 与 `menu_refresh=menu_refresh_dur` 语义）。
    - 验证：`flutter test test/reader_top_menu_test.dart test/reader_legacy_menu_helper_test.dart test/simple_reader_view_compile_test.dart` 通过；手工路径 `阅读页 -> 顶部刷新按钮（点击）`、`阅读页 -> 顶部刷新按钮（长按）`（确认默认当前章节刷新与长按分支菜单）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛阅读页 `menu_refresh` 入口层级与默认触发语义，不改动章节刷新缓存清理与正文重载策略。
  - 已完成 `P2-seq66`：`book_read.xml / @+id/menu_download / 离线缓存`。
  - `P2-seq66` 差异点清单（实施前）：
    - legado `ReadBookActivity` 中 `menu_download` 属于在线阅读顶栏一级 action（`showAsAction=always`），当前 Flutter 端仅在“阅读操作”二级菜单提供“离线缓存”，入口层级不一致。
    - legado 点击 `menu_download` 会弹出章节范围输入并启动缓存流程；当前 Flutter 端点击仅提示“离线缓存：当前版本暂未支持”，未进入缓存链路。
    - legado 对 `menu_download` 保持在线/本地边界（本地书隐藏入口）；当前 Flutter 顶栏未提供同层级入口，无法完成同义触发路径。
  - `P2-seq66` 逐项对照清单（实施后）：
    - 入口：已同义（阅读页顶部新增“离线缓存”一级动作按钮，仅在线书籍显示，对齐 legado `menu_group_on_line -> menu_download` 层级）。
    - 状态：已同义（在线书籍显示入口，本地书籍隐藏；离线缓存执行期间避免重复触发，保持“进行中”保护分支）。
    - 异常：已同义（范围输入无效与空范围保持可观测提示；章节抓取失败记录到 `ExceptionLogService`，避免静默失败）。
    - 文案：已同义（入口固定“离线缓存”；范围对话框标题固定“离线缓存”，输入项“开始章节/结束章节”）。
    - 排版：已同义（顶栏圆角图标按钮承载一级动作；范围输入采用 `CupertinoAlertDialog`，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击顶栏“离线缓存”后弹出章节范围对话框，默认起止为“当前章/末章”；确认后按范围执行章节正文缓存并回报完成摘要；更多菜单移除离线缓存项以避免双入口层级偏差）。
    - 验证：`flutter test test/reader_top_menu_test.dart test/reader_legacy_menu_helper_test.dart test/simple_reader_view_compile_test.dart` 通过；手工路径 `阅读页 -> 顶部离线缓存按钮 -> 输入开始/结束章节 -> 确定`（确认入口层级、在线/本地显隐、缓存完成摘要与失败日志可观测）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_download` 入口层级与阅读页范围缓存触发链路，不改动目录解析、章节存储结构与书源规则执行语义。
  - 已完成 `P2-seq67`：`book_read.xml / @+id/menu_toc_regex / TXT 目录规则`。
  - `P2-seq67` 差异点清单（实施前）：
    - legado `ReadBookActivity` 在 `menu_group_text` 中将 `menu_toc_regex` 作为本地 TXT 专属顶栏一级 action，点击后进入 `TxtTocRuleDialog`，采用“取消不生效、确定统一提交”的确认式状态流转。
    - Flutter 端阅读页虽然已有顶栏 `TXT 目录规则` 入口，但规则弹层为“点选即提交”语义，未对齐 legado `tvCancel/tvOk` 的提交时机边界。
    - Flutter 端规则提交成功后追加“TXT 目录规则已应用”扩展提示；legado 在该链路仅触发目录重建，不追加成功提示文案。
  - `P2-seq67` 逐项对照清单（实施后）：
    - 入口：已同义（阅读页顶部 `TXT 目录规则` 仅在本地 TXT 书籍显示，对齐 legado `menu_group_text -> menu_toc_regex` 可见性边界）。
    - 状态：已同义（规则弹窗改为确认式状态流转：取消不生效，确定后统一提交并触发目录重建）。
    - 异常：已同义（目录重建失败统一输出 `LoadTocError:<error>` 可观测提示，不新增静默失败分支）。
    - 文案：已同义（入口文案固定“TXT 目录规则”；移除扩展成功提示，避免偏离 legado 业务文案语义）。
    - 排版：已同义（规则选择改为 `CupertinoAlertDialog` 承载确认式列表，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击顶栏 `menu_toc_regex` 后弹出规则确认框；确定后保存书籍级规则并按当前编码/拆分配置立即重解析本地 TXT，等价 legado `menu_toc_regex -> onTocRegexDialogResult -> loadChapterList` 主链路）。
    - 验证：`flutter test test/reader_txt_toc_rule_dialog_test.dart test/reader_top_menu_test.dart test/reader_legacy_menu_helper_test.dart test/simple_reader_view_compile_test.dart` 通过；手工路径 `阅读页 -> 本地 TXT 书籍 -> 顶部 TXT 目录规则 -> 选择规则 -> 取消/确定`（确认取消不生效与确定后重建目录）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛阅读页 `menu_toc_regex` 的提交时机与提示语义，不改动书源模型与网络目录解析链路。
  - 已完成 `P2-seq68`：`book_read.xml / @+id/menu_set_charset / 设置编码`。
  - `P2-seq68` 差异点清单（实施前）：
    - legado `ReadBookActivity` 在 `menu_group_local` 将 `menu_set_charset` 作为本地书籍顶栏一级 action（`showAsAction=always`），点击进入 `showCharsetConfig`；Flutter 端该动作仍位于“阅读操作”二级菜单，入口层级不一致。
    - legado `showCharsetConfig` 为输入式对话框（标题“设置编码”、输入框 hint=`charset`、预填当前编码、支持建议值过滤），点击确定后直接调用 `ReadBook.setCharset`；Flutter 端为固定选项 picker，不支持自由输入。
    - legado `ReadBook.setCharset` 在保存编码后统一触发 `loadChapterList(book)`，本地 TXT/非 TXT 都会走目录重载链路；Flutter 端非 TXT 本地仅保存编码并提示成功，未触发重载。
  - `P2-seq68` 逐项对照清单（实施后）：
    - 入口：已同义（本地书籍时“设置编码”改为顶栏一级动作；“阅读操作”菜单移除该项，避免双入口层级偏差）。
    - 状态：已同义（确认后先持久化编码，再立即触发本地目录重载；本地 TXT 走带编码重解析，本地非 TXT 也执行目录重载）。
    - 异常：已同义（重载失败统一保持 `LoadTocError:<error>` 可观测提示，不新增静默失败分支）。
    - 文案：已同义（对话框标题固定“设置编码”，输入框占位 `charset`；移除“编码已保存/已切换”扩展成功提示）。
    - 排版：已同义（顶栏一级动作使用 `Cupertino` 圆角按钮承载，输入对话框使用 `CupertinoAlertDialog`，平台样式差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击顶栏 `menu_set_charset` 打开输入式对话框，取消不生效；确定后对齐 legado `menu_set_charset -> showCharsetConfig -> ReadBook.setCharset -> loadChapterList` 主链路语义）。
    - 验证：`flutter test test/reader_top_menu_test.dart test/reader_legacy_menu_helper_test.dart test/simple_reader_view_compile_test.dart` 通过；手工路径 `阅读页 -> 本地书籍 -> 顶部设置编码 -> 输入 GBK -> 确定`（确认顶栏入口、自由输入与立即重载生效）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_set_charset` 入口层级与编码设置状态流转，不改动书源规则解析与网络阅读链路。
  - 已完成 `P2-seq83`：`book_read.xml / @+id/menu_update_toc / 更新目录`。
  - `P2-seq83` 差异点清单（实施前）：
    - legado `ReadBookActivity.menu_update_toc` 对本地与在线书籍都执行目录重载；本地 EPUB/MOBI 会先清缓存再触发 `loadChapterList`。Flutter 端此前将本地书籍拦截为“不支持检查更新”，存在行为偏差。
    - legado 触发 `menu_update_toc` 后仅进入“更新目录中”加载态并在成功后静默结束，不追加成功提示；Flutter 端此前会弹“目录已更新，共X章”扩展提示，文案语义不一致。
    - legado 失败口径为“在线统一 `加载目录失败`、本地统一 `LoadTocError:*`”；Flutter 端此前按异常原文拼接“更新目录失败：$e”，错误语义不一致。
  - `P2-seq83` 逐项对照清单（实施后）：
    - 入口：已同义（阅读操作菜单保留“更新目录”入口，触发层级与 legado `book_read.xml/menu_update_toc` 同义）。
    - 状态：已同义（点击后进入加载态执行目录刷新，成功后不再追加“目录已更新，共X章”扩展提示）。
    - 异常：已同义（在线失败收敛为“加载目录失败”；本地失败收敛为 `LoadTocError:*`，并写入异常日志，保持可观测）。
    - 文案：已同义（动作文案固定“更新目录”，失败文案口径对齐 legado）。
    - 排版：已同义（沿用 `CupertinoActionSheet` 菜单承载，平台样式差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（在线书走目录更新服务并刷新章节；本地书走本地目录重解析链路，TXT 透传编码/TXT目录规则/拆分配置，EPUB 刷新前清缓存后重载）。
    - 验证：`flutter test test/reader_top_menu_test.dart test/reader_legacy_menu_helper_test.dart test/simple_reader_view_compile_test.dart test/search_book_info_refresh_helper_test.dart`、`flutter test test/reader_catalog_sheet_test.dart` 通过；手工路径 `阅读页 -> 阅读操作 -> 更新目录`（在线书/本地 TXT/本地 EPUB 分别验证）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛阅读页 `menu_update_toc` 的本地/在线目录刷新语义与提示口径，不改动书源规则模型与章节存储结构。
  - 已完成 `P3-seq94`：`book_read_refresh.xml / @+id/menu_refresh_dur / 刷新当前章节`。
  - `P3-seq94` 差异点清单（实施前）：
    - legado `ReadBookActivity` 中 `menu_refresh` 与 `menu_refresh_dur` 处于同一 `when` 分支，默认都执行“刷新当前章节”；Flutter 端 `ReaderLegacyReadMenuAction.refresh` 仍指向“弹出刷新分支菜单”，存在默认触发语义偏差。
    - legado 长按顶栏刷新图标仅负责打开 `book_read_refresh.xml` 三分支菜单（当前/之后/全部），其中“刷新当前章节”应与顶栏点击链路完全同义，不能额外分叉独立行为。
    - tracker/ExecPlan 尚缺少 `seq94` 的单项证据，当前仅有 `seq65(menu_refresh)` 的入口层级证明，缺少 `menu_refresh_dur` 与默认刷新同分支的明确回归记录。
  - `P3-seq94` 逐项对照清单（实施后）：
    - 入口：已同义（顶栏刷新按钮长按仍弹出 `刷新当前章节/刷新之后章节/刷新全部章节` 子菜单，入口层级保持与 legado `book_read_refresh.xml` 同义）。
    - 状态：已同义（新增 `ReaderLegacyMenuHelper.defaultRefreshAction()` 固化默认刷新动作；顶栏点击刷新与 `menu_refresh_dur` 都统一走“刷新当前章节”分支）。
    - 异常：已同义（无可用书源时默认刷新仍回落到当前章节重载，不新增扩展错误分支）。
    - 文案：已同义（默认动作文案保持“刷新当前章节”，不引入额外提示文案）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载长按分支菜单，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（`menu_refresh` 点击与 `menu_refresh_dur` 点击统一进入 `_runLegacyDefaultRefreshAction -> _executeLegacyRefreshMenuAction(current)`，对齐 legado “同一分支”语义）。
    - 验证：`flutter test test/reader_legacy_menu_helper_test.dart test/reader_top_menu_test.dart test/simple_reader_view_compile_test.dart` 通过；手工路径 `阅读页 -> 顶部刷新按钮（点击）` 与 `阅读页 -> 顶部刷新按钮（长按）-> 刷新当前章节`（确认两条路径同分支）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_refresh_dur` 与默认刷新动作映射关系，不改动章节缓存结构与目录数据模型。
  - 已完成 `P3-seq95`：`book_read_refresh.xml / @+id/menu_refresh_after / 刷新之后章节`。
  - `P3-seq95` 差异点清单（实施前）：
    - 现有实现虽已具备“清理当前及后续章节缓存”行为，但缺少独立可复现证据，tracker 中 `seq95` 仍为 `pending`，无法闭环迁移记录。
    - 刷新范围计算散落在页面状态类中，难以稳定验证 `menu_refresh_after` “从当前章节开始清理后续缓存、前序章节保持不变” 的 legado 边界语义。
  - `P3-seq95` 逐项对照清单（实施后）：
    - 入口：已同义（顶栏刷新按钮长按进入 `book_read_refresh` 分支菜单，选择“刷新之后章节”触发对应动作）。
    - 状态：已同义（执行后清理当前及后续章节缓存并重载当前章节，前序章节缓存保持不变）。
    - 异常：已同义（无可用书源时回落到当前章节重载，不新增扩展失败分支，对齐 legado `bookSource==null -> upContent()` 边界）。
    - 文案：已同义（分支文案固定“刷新之后章节”，不引入额外状态文案）。
    - 排版：已同义（分支菜单继续由 `CupertinoActionSheet` 承载，平台样式差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（`menu_refresh_after` 收敛为 `ReaderRefreshScopeHelper.selectionFromLegacyAction(after)`，统一走“从当前章节起清理后续缓存”链路）。
    - 验证：`flutter test test/reader_refresh_scope_helper_test.dart test/reader_legacy_menu_helper_test.dart test/reader_top_menu_test.dart test/simple_reader_view_compile_test.dart` 通过；手工路径 `阅读页 -> 顶部刷新按钮（长按）-> 刷新之后章节`（确认当前及后续缓存被清理且当前章节立即重载）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛 `menu_refresh_after` 的范围计算与验证证据，不改动书源模型与章节数据结构。
  - 已完成 `P3-seq96`：`book_read_refresh.xml / @+id/menu_refresh_all / 刷新全部章节`。
  - `P3-seq96` 差异点清单（实施前）：
    - 现有实现已具备 `ReaderLegacyRefreshMenuAction.all` 分支，但缺少“从首章开始清理全量缓存并回写变更章节”的独立可复现证据，tracker 中 `seq96` 仍为 `pending`。
    - `menu_refresh_all` 的关键语义（`startIndex=0, clearFollowing=true`）尚未有单测固定，存在后续序号改动时被回归破坏的风险。
    - “无可用书源时回落到当前章节重载”的 legado 边界虽由共用链路承载，但本序号尚未形成单项迁移结论记录。
  - `P3-seq96` 逐项对照清单（实施后）：
    - 入口：已同义（顶栏刷新按钮长按进入 `book_read_refresh` 分支菜单，选择“刷新全部章节”触发对应动作）。
    - 状态：已同义（有可用书源时从首章起清理全量章节缓存并回写变更章节，随后重载当前章节）。
    - 异常：已同义（无可用书源时回落到当前章节重载，对齐 legado `bookSource==null -> upContent()` 边界）。
    - 文案：已同义（分支文案固定“刷新全部章节”，不新增扩展提示文案）。
    - 排版：已同义（分支菜单继续由 `CupertinoActionSheet` 承载，平台样式差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（`menu_refresh_all` 收敛为 `ReaderRefreshScopeHelper.selectionFromLegacyAction(all)`，统一走 `startIndex=0 + clearFollowing=true` 的全量缓存清理链路）。
    - 验证：`flutter test test/reader_refresh_scope_helper_test.dart test/reader_legacy_menu_helper_test.dart test/reader_top_menu_test.dart test/simple_reader_view_compile_test.dart` 通过；手工路径 `阅读页 -> 顶部刷新按钮（长按）-> 刷新全部章节`（确认全量缓存清理并重载当前章节）。
  - 兼容影响：无旧书源兼容性影响；本序号仅补齐 `menu_refresh_all` 的迁移证据与边界固化，不改动书源模型与章节数据结构。
  - 已完成 `P3-seq97`：`book_read_source.xml / @+id/menu_login / 登录`。
  - `P3-seq97` 差异点清单（实施前）：
    - legado `ReadMenu` 在点击“登录”时通过 `showLogin()` 回调，以 `bookSourceUrl` 作为键启动登录链路；登录动作天然基于“当前最新书源状态”。
    - Flutter 阅读页“登录”动作使用弹层打开时的 `BookSource` 快照对象直接触发登录，缺少按 URL 回查最新书源的边界收敛；在弹层期间书源被删除或替换时可能使用过期快照。
    - `seq97` 在台账中仍为 `pending`，缺少单项迁移闭环记录与可复现验证路径。
  - `P3-seq97` 逐项对照清单（实施后）：
    - 入口：已同义（阅读页顶部“书源名”动作弹层内保留一级“登录”入口）。
    - 状态：已同义（仅当 `loginUrl` 非空时显示“登录”动作；`loginUrl` 为空时隐藏）。
    - 异常：已同义（点击后先按 `bookSourceUrl` 回查最新书源，缺失时提示“未找到书源”，避免使用过期快照静默失败）。
    - 文案：已同义（入口文案保持“登录”，与 legado `@string/login` 语义一致）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载书源动作菜单，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“登录”后按当前书源状态进入登录流程，等价 legado `menu_login -> SourceLoginActivity(type=bookSource,key=bookSourceUrl)` 的实时触发语义）。
    - 验证：手工路径 `阅读页(网络书) -> 顶部书源名 -> 登录`（校验 `loginUrl` 为空时不展示登录；`loginUrl` 非空时点击可进入登录流程）。
  - 兼容影响：无旧书源兼容性影响；本序号仅收敛阅读页 `menu_login` 触发边界，不改动书源解析规则与 Cookie 持久化结构。
  - 已完成 `P3-seq98`：`book_read_source.xml / @+id/menu_chapter_pay / 购买`。
  - `P3-seq98` 差异点清单（实施前）：
    - legado `ReadMenu` 对 `menu_chapter_pay` 的显隐条件是 `loginUrl 非空 && curTextChapter.isVip == true && curTextChapter.isPay != true`；Flutter 端额外依赖 `payAction` 非空，且在章节 `isVip/isPay` 未命中缓存时兜底显示，存在入口显隐语义偏差。
    - legado `payAction()` 仅在异常分支记录 `执行购买操作出错` 日志，不弹扩展失败提示；Flutter 端存在“未配置购买动作/执行失败/返回值不支持”等扩展 toast，状态流转不一致。
    - legado 结果分流为 `isAbsUrl -> 打开网页`、`isTrue -> 清当前章缓存并刷新目录`；Flutter 端使用自定义结果枚举，true 判定口径偏窄，且成功分支仅重载当前章节未刷新目录。
  - `P3-seq98` 逐项对照清单（实施后）：
    - 入口：已同义（书源动作弹层保留“章节购买”一级入口）。
    - 状态：已同义（仅当 `loginUrl` 非空且当前章节 `isVip=true && isPay!=true` 时显示“章节购买”）。
    - 异常：已同义（购买执行异常统一写入日志 `执行购买操作出错`，不追加扩展失败提示；目录刷新失败独立记录日志并保持可观测错误提示）。
    - 文案：已同义（确认弹窗标题固定“章节购买”，正文展示章节标题，不追加扩展成功提示）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` + `CupertinoAlertDialog` 承载入口与确认交互，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（确认后按 `bookSourceUrl` 回查当前书源执行 `payAction`，结果分流对齐 legado：绝对 URL 打开网页、`isTrue` 返回清缓存并刷新目录）。
    - 验证：手工路径 `阅读页(网络书,VIP未购买章节) -> 顶部书源名 -> 章节购买 -> 确定`（校验入口显隐、URL 跳转分支、truthy 分支目录刷新、异常仅写日志）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_chapter_pay` 显隐与结果分流语义，不改动书源规则字段结构与 Cookie 持久化链路。
  - 已完成 `P3-seq99`：`book_read_source.xml / @+id/menu_edit_source / 编辑书源`。
  - `P3-seq99` 差异点清单（实施前）：
    - legado `menu_edit_source` 在点击时调用 `openSourceEditActivity()`，内部按当前 `ReadBook.bookSource.bookSourceUrl` 实时启动编辑页；Flutter 端当前使用 action sheet 打开时捕获的 `source` 快照直接打开编辑页，弹层期间若书源状态变化会出现过期触发。
    - legado 仅在 `BookSourceEditActivity` 返回 `RESULT_OK` 时执行 `upBookSource -> upMenuView` 刷新菜单；Flutter 端当前无论保存或取消都刷新书源显示，状态回调边界不一致。
  - `P3-seq99` 逐项对照清单（实施后）：
    - 入口：已同义（书源动作弹层保留“编辑书源”一级入口）。
    - 状态：已同义（点击时按 `bookSourceUrl` 回查当前书源后再打开编辑页，缺失时给出“未找到书源”可观测反馈）。
    - 异常：已同义（弹层期间书源被删除时不再使用过期快照，改为即时拦截并提示，避免静默失败）。
    - 文案：已同义（入口文案维持“编辑书源”，缺失提示与阅读域既有口径一致为“未找到书源”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载入口，平台样式差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（仅在编辑页保存返回时刷新阅读页书源显示，取消返回不刷新，对齐 legado `RESULT_OK` 回调边界）。
    - 验证：手工路径 `阅读页(网络书) -> 顶部书源名 -> 编辑书源`（校验进入编辑页、删除后回查提示、取消不刷新、保存后刷新）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_edit_source` 触发与回调边界，不改动书源保存规则与正文链路。
  - 已完成 `P3-seq100`：`book_read_source.xml / @+id/menu_disable_source / 禁用书源`。
  - `P3-seq100` 差异点清单（实施前）：
    - legado `ReadMenu.menu_disable_source` 点击后直接回调 `disableSource()`，`ReadBookViewModel.disableSource()` 仅执行“将当前书源 `enabled=false` 写库”链路，不弹确认、不弹成功提示。
    - Flutter 阅读页“禁用书源”当前实现为“确认弹窗 + 确认后提示‘已禁用书源’”，状态流转与 legado 直接执行语义不一致。
    - Flutter 当前禁用动作直接使用 action sheet 打开时的 `BookSource` 快照调用 `updateSource(copyWith(enabled:false))`；在弹层期间书源被删除时，`updateSource` 的 upsert 语义可能把已删书源重新写回，偏离实时状态边界。
  - `P3-seq100` 逐项对照清单（实施后）：
    - 入口：已同义（书源动作弹层保留一级“禁用书源”入口）。
    - 状态：已同义（点击后直接执行禁用写库，不再弹确认对话框，不再追加成功提示）。
    - 异常：已同义（执行前按 `bookSourceUrl` 回查当前书源，缺失时提示“未找到书源”，避免使用过期快照写回已删除记录）。
    - 文案：已同义（入口文案保持“禁用书源”，移除“确定禁用/已禁用书源”扩展文案）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载书源动作菜单，平台样式差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击后按 `bookSourceUrl` 回查并写库 `enabled=false`，等价 legado `menu_disable_source -> disableSource()` 的直接触发语义）。
    - 验证：手工路径 `阅读页(网络书) -> 顶部书源名 -> 禁用书源`（校验无确认弹窗、点击后立即禁用、无成功 toast）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_disable_source` 的触发与状态边界，不改动书源规则结构与阅读正文链路。
  - 已完成 `P2-seq164`：`book_toc.xml / @+id/menu_split_long_chapter / 拆分超长章节`。
  - `P2-seq164` 差异点清单（实施前）：
    - legado `TocActivity` 在目录“更多”菜单 `menu_group_text` 下提供 `menu_split_long_chapter`（固定标题、checkable 勾选态），并且仅本地 TXT 显示；Flutter 目录页当前缺失该入口。
    - legado 点击 `menu_split_long_chapter` 后会立即执行 `upBookAndToc(book)` 重建本地 TXT 目录；Flutter 仅在详情页提供“分割长章节”入口，目录页无法原位切换并即时生效。
  - `P2-seq164` 逐项对照清单（实施后）：
    - 入口：已同义（目录页“更多”菜单补齐“拆分超长章节”，层级与 legado 一致）。
    - 状态：已同义（仅本地 TXT 显示该项，标题固定“拆分超长章节”，通过勾选态表达开关）。
    - 异常：已同义（切换后沿用本地 TXT 目录重建链路，失败继续走既有可观测错误提示）。
    - 文案：已同义（目录菜单文案收敛为“拆分超长章节”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载目录菜单，平台样式差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击后立即切换勾选态并触发本地 TXT 目录重建，目录列表实时刷新，对齐 legado `menu_split_long_chapter -> upBookAndToc` 的即时生效语义）。
    - 验证：手工路径 `书籍详情页 -> 查看目录 -> 更多 -> 拆分超长章节`（校验仅本地 TXT 显示、勾选态切换生效、目录列表即时刷新）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐目录页 `menu_split_long_chapter` 入口与触发链路，不改动网络书目录解析规则。
  - 已完成 `P2-seq166`：`book_toc.xml / @+id/menu_use_replace / 使用替换`。
  - `P2-seq166` 差异点清单（实施前）：
    - legado `TocActivity` 在目录菜单 `menu_group_toc` 中提供 `menu_use_replace`（固定标题“使用替换”、checkable 勾选态），并在点击时仅切换 `AppConfig.tocUiUseReplace`。
    - legado 点击后执行 `chapterListCallBack.clearDisplayTitle() -> upChapterList(searchKey)`，目录标题会即时按开关重算；当前 Flutter 目录页缺失该入口，标题始终应用替换规则，缺少目录级开关语义。
    - legado `tocUiUseReplace` 为全局持久化偏好；当前 Flutter 无对应持久化键，目录替换开关无法跨页面保持一致。
  - `P2-seq166` 逐项对照清单（实施后）：
    - 入口：已同义（目录页“更多”菜单补齐“使用替换”checkable 入口，层级与 legado 一致）。
    - 状态：已同义（标题固定“使用替换”，通过勾选态表达开关，不引入“开/关”动态文案）。
    - 异常：已同义（切换后仅重算目录展示标题，单条标题处理失败时回退原始标题，不新增静默失败分支）。
    - 文案：已同义（菜单文案固定“使用替换”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载目录菜单，视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击后切换全局 `tocUiUseReplace` 并即时刷新目录展示标题，等价 legado `menu_use_replace -> clearDisplayTitle -> upChapterList` 状态流转）。
    - 验证：手工路径 `书籍详情页 -> 查看目录 -> 更多 -> 使用替换`（校验固定文案+勾选态切换、切换后目录标题即时刷新、无成功提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐目录页 `menu_use_replace` 入口与标题展示开关，不改动书源规则解析与正文读取链路。
  - 已完成 `P2-seq167`：`book_toc.xml / @+id/menu_load_word_count / 加载字数`。
  - `P2-seq167` 差异点清单（实施前）：
    - legado `TocActivity` 在目录菜单 `menu_group_toc` 中提供 `menu_load_word_count`（固定标题“加载字数”、checkable 勾选态），并在点击时仅切换 `AppConfig.tocCountWords`，随后调用 `chapterListCallBack.upAdapter()` 刷新目录适配器。
    - legado `tocCountWords` 为全局持久化偏好，默认值 `true`；当前 Flutter 缺失对应持久化键，目录字数开关无法跨页面保持一致。
    - 当前 Flutter 详情目录页“更多”菜单缺失“加载字数”入口，且目录列表未接入“按开关显示字数”的展示链路。
  - `P2-seq167` 逐项对照清单（实施后）：
    - 入口：已同义（目录页“更多”菜单补齐“加载字数”checkable 入口，层级与 legado 一致）。
    - 状态：已同义（标题固定“加载字数”，通过勾选态表达开关；全局键 `toc_ui_load_word_count` 默认 `true`，与 legado `tocCountWords` 默认语义一致）。
    - 异常：已同义（切换动作仅刷新目录展示状态；无可用字数字段时保持不显示且不报错）。
    - 文案：已同义（菜单文案固定“加载字数”，未引入“已开启/已关闭”扩展提示）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载目录菜单，平台样式差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击后切换全局 `toc_ui_load_word_count` 并即时刷新目录项字数显隐，等价 legado `menu_load_word_count -> upAdapter` 的刷新语义）。
    - 验证：`flutter test test/search_book_info_view_compile_test.dart`、`flutter test test/simple_reader_view_compile_test.dart`、`flutter test test/reader_catalog_sheet_test.dart` 通过；手工路径 `书籍详情页 -> 查看目录 -> 更多 -> 加载字数`（校验固定文案+勾选态切换、无成功提示、目录项字数按开关显隐）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐目录页 `menu_load_word_count` 开关与字数展示链路，不改动书源规则结构。
  - 已完成 `P3-seq69`：`book_read.xml / @+id/menu_add_bookmark / 添加书签`。
  - `P3-seq69` 差异点清单（实施前）：
    - legado `ReadBookActivity.menu_add_bookmark -> addBookmark()` 固定走“创建书签草稿并弹出 `BookmarkDialog` 编辑”语义；当前 Flutter 入口实现为 `_toggleBookmark()`，会出现“有则删无则加”的额外分支。
    - legado `ReadView.click(action=7)` 也复用 `addBookmark()`；当前 Flutter 九宫格点击动作同样复用了 `_toggleBookmark()`，触发语义与 legado 不同。
    - legado 书签跳转依赖 `chapterPos` 恢复阅读位置；当前 Flutter 目录书签点击仅跳章，不使用 `chapterPos`。
  - `P3-seq69` 逐项对照清单（实施后）：
    - 入口：已同义（阅读操作菜单 `menu_add_bookmark` 与九宫格点击动作 `addBookmark` 均统一接入 `_openAddBookmarkDialog()`）。
    - 状态：已同义（弹窗标题固定“书签”，默认展示章节标题并提供“内容/备注”输入；取消不落库，确定才新增书签）。
    - 异常：已同义（新增失败保持可观测提示“书签操作失败：<error>”，不引入静默失败分支）。
    - 文案：已同义（“书签 / 内容 / 备注 / 取消 / 确定”）。
    - 排版：已同义（使用 `CupertinoAlertDialog` 承载章节标题 + 双输入框 + 操作按钮，平台样式差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（目录书签点击新增 `chapterPos -> targetChapterProgress` 恢复路径，按书签进度回跳章节内位置）。
    - 验证：手工路径 `阅读页 -> 阅读操作 -> 添加书签`、`阅读页 -> 九宫格点击动作(添加书签)`、`阅读页 -> 目录/书签 -> 选择书签`（校验弹窗展示、取消不落库、确定新增可见、书签跳转按进度恢复）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛书签交互与进度恢复语义，未改动书源解析与五段链路网络行为。
  - 已完成 `P3-seq70`：`book_read.xml / @+id/menu_edit_content / 编辑内容`。
  - `P3-seq70` 差异点清单（实施前）：
    - legado `ReadBookActivity.menu_edit_content -> showDialogFragment(ContentEditDialog())` 打开编辑页后由 `ContentEditViewModel.loadStateLiveData` 统一驱动加载态；当前 Flutter 虽已具备编辑正文入口，但“重置正文”仅在操作区显示小型 loading，未对整体编辑区域做一致的交互锁定。
    - legado `ContentEditViewModel.initContent` 通过 `execute` 包裹正文抓取异常，失败后不会中断编辑入口；当前 Flutter `_resolveCurrentChapterRawContentForMenu` 直接 await 抓取，异常会向上冒泡并打断“编辑正文/正文倒序”菜单链路。
  - `P3-seq70` 逐项对照清单（实施后）：
    - 入口：已同义（阅读操作菜单 `menu_edit_content` 继续走 `_openContentEditFromMenu()`，保持一级入口层级与 legado 一致）。
    - 状态：已同义（编辑页 `reset` 期间新增全屏遮罩 + `CupertinoActivityIndicator`，并通过 `IgnorePointer` 锁定整页交互，等价 legado dialog 的加载中不可编辑语义）。
    - 异常：已同义（正文抓取失败统一记录 `ExceptionLogService` 节点 `reader.menu.<action>.fetch_content_failed`，并回退当前显示内容继续流程；`edit_content/reverse_content` 场景补齐可观测提示“获取正文失败，已回退当前显示内容”）。
    - 文案：已同义（菜单文案“编辑正文”与编辑页动作文案“关闭/保存/重置/复制全文”保持不变，未引入扩展成功提示）。
    - 排版：已同义（继续使用 `CupertinoPageScaffold` 全屏编辑承载；新增遮罩仅用于加载态，属于 `Shadcn + Cupertino` 平台差异允许范围）。
    - 交互触发：已同义（返回/关闭仍自动回传正文并落库；重置流程保持“清理缓存 -> 重新抓取 -> 回写章节 -> 重载当前章节”主链路）。
    - 验证：手工路径 `阅读页 -> 阅读操作 -> 编辑正文 -> 重置`（校验重置期间全屏遮罩与不可交互）；`阅读页 -> 阅读操作 -> 编辑正文 -> 关闭`（校验关闭自动保存）；`阅读页 -> 阅读操作 -> 反转内容`（校验正文抓取异常时仍可回退当前内容并弹出提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛正文编辑菜单的异常兜底与加载态交互，不改动书源规则、Cookie 与五段链路数据模型。
  - 已完成 `P3-seq71`：`book_read.xml / @+id/menu_page_anim / 翻页动画（本书）`。
  - `P3-seq71` 差异点清单（实施前）：
    - legado `menu_page_anim` 点击后进入单选列表（默认/覆盖/滑动/仿真/滚动/无），写入书籍级 `pageAnim(i-1)`，随后立即执行 `upPageAnim + loadContent(false)`；当前 Flutter 该入口会跳转“界面设置”大面板，触发路径与入口层级不一致。
    - legado 该动作是“本书级覆盖”语义；当前 Flutter 无书籍级翻页动画持久化键，菜单动作只能改全局 `pageTurnMode`，会污染其它书籍会话。
    - legado 在样式面板修改全局翻页动画时会先执行 `book.setPageAnim(-1)` 清除本书覆盖；当前 Flutter 无该状态回收边界，容易出现本书覆盖与全局设置互相污染。
  - `P3-seq71` 逐项对照清单（实施后）：
    - 入口：已同义（阅读操作菜单 `menu_page_anim` 改为直接弹出单选列表，不再跳转界面设置面板）。
    - 状态：已同义（新增书籍级翻页动画持久化键 `book_page_anim_map`，支持默认/覆盖/滑动/仿真/滚动/无六档；阅读会话初始化与全局设置变更时均叠加本书覆盖）。
    - 异常：已同义（会话态与持久化态分离：本书菜单只改书籍覆盖并即时生效，不再误写全局阅读设置）。
    - 文案：已同义（菜单文案收敛为“翻页动画（本书）”，单选项文案为“默认/覆盖/滑动/仿真/滚动/无”）。
    - 排版：已同义（继续使用 `Cupertino` 选项底部面板承载单选动作，平台样式差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（菜单选择后立即刷新翻页模式与正文展示；样式面板改全局翻页动画时清除本书覆盖，对齐 legado `setPageAnim(-1)` 边界）。
    - 验证：`flutter test test/reader_legacy_menu_helper_test.dart test/simple_reader_view_compile_test.dart` 通过；手工路径 `阅读页 -> 阅读操作 -> 翻页动画（本书）`（校验单选项、即时生效、本书覆盖与全局设置边界）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_page_anim` 的入口语义与书籍级翻页动画状态边界，不改动书源规则解析与正文抓取链路。
  - 已完成 `P3-seq72`：`book_read.xml / @+id/menu_get_progress / 拉取云端进度`。
  - `P3-seq72` 差异点清单（实施前）：
    - legado `menu_get_progress` 触发 `syncBookProgress` 时，云端无进度/无配置/空目录均静默返回；当前 Flutter 会额外弹出“云端暂无该书进度”“当前目录为空，无法同步阅读进度”等扩展 toast，状态流转不一致。
    - legado 仅在 `progress.durChapterIndex < simulatedTotalChapterNum` 时才应用云端进度；当前 Flutter 对越界索引会 `clamp` 到末章后继续覆盖，存在越界回退覆盖风险。
    - legado 拉取失败仅写日志 `拉取阅读进度失败《书名》`，不弹失败 toast；当前 Flutter 会弹“获取进度失败：...”扩展提示，且缺少同义日志节点。
  - `P3-seq72` 逐项对照清单（实施后）：
    - 入口：已同义（阅读操作菜单保留 `获取进度` 入口，触发链路对齐 `menu_get_progress`）。
    - 状态：已同义（云端进度落后于本地时弹确认框；云端进度领先且章节索引合法时直接同步；索引越界时不覆盖本地进度；兼容 legado 原始 `durChapterPos` 位点场景时按章节内容长度估算章节进度）。
    - 异常：已同义（拉取失败仅记录 `reader.menu.get_progress.failed` 日志，不追加失败 toast；云端无进度保持静默返回）。
    - 文案：已同义（确认框标题“获取进度”，正文“当前进度超过云端，是否覆盖为云端进度？”）。
    - 排版：已同义（继续使用 `CupertinoAlertDialog`，平台样式差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（覆盖确认分支仅在本地进度领先时出现；确认后按目标章节与章节进度应用；取消不生效）。
    - 验证：手工路径 `阅读页(已配置 WebDav) -> 阅读操作 -> 获取进度`（校验无配置/无云端数据静默返回、落后分支弹确认框、领先分支直接同步、越界索引不覆盖本地进度、失败仅写日志）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_get_progress` 的状态流转与日志可观测边界，不改动书源规则、Cookie 与正文抓取链路。
  - 已完成 `P3-seq73`：`book_read.xml / @+id/menu_cover_progress / 覆盖云端进度`。
  - `P3-seq73` 差异点清单（实施前）：
    - legado `ReadBookActivity.menu_cover_progress` 调用 `ReadBook.uploadProgress(true)`，成功 toast 固定“上传成功”；当前 Flutter 成功提示为“上传进度成功”，文案存在偏差。
    - legado 失败链路是 `AppLog.put("上传进度失败\\n...", toast=true)`，具备日志可观测与失败提示双输出；当前 Flutter 仅弹失败 toast，缺少同义日志节点。
    - legado 在同步开关关闭/未配置 WebDav/无网络场景是静默返回；当前 Flutter 在守卫失败分支存在扩展提示，不符合 legado 静默守卫语义。
  - `P3-seq73` 逐项对照清单（实施后）：
    - 入口：已同义（阅读操作菜单保留 `覆盖云端进度` 一级入口，触发链路对齐 `menu_cover_progress`）。
    - 状态：已同义（同步开关关闭、未配置 WebDav、目录为空时静默返回；上传前先保存本地进度，再构建 payload 上传）。
    - 异常：已同义（上传失败补齐日志节点 `reader.menu.cover_progress.failed`，并保留失败提示）。
    - 文案：已同义（菜单文案由“覆盖进度”收敛为 legado 同义“覆盖云端进度”；成功提示收敛为“上传成功”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载阅读操作菜单与 toast 反馈，平台样式差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击后直接上传本地进度到云端，无确认框；失败提示与异常日志同时可观测）。
    - 验证：手工路径 `阅读页(已配置 WebDav) -> 阅读操作 -> 覆盖云端进度`（校验守卫分支静默返回、成功提示“上传成功”、失败提示“上传进度失败\\n<原因>”并在日志页看到 `reader.menu.cover_progress.failed`）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_cover_progress` 的提示/日志/文案语义，不改动书源规则、Cookie 与正文抓取链路。
  - 已完成 `P3-seq74`：`book_read.xml / @+id/menu_reverse_content / 反转内容`。
  - `P3-seq74` 差异点清单（实施前）：
    - legado `reverseContent` 通过 `content.toStringArray()` 逐字符倒序并回写缓存；当前 Flutter 采用“按行倒序”实现，正文反转粒度不一致。
    - legado 仅使用当前章节已缓存正文（`BookHelp.getContent`），正文缺失时静默返回；当前 Flutter 会兜底拉取正文并追加“当前章节暂无可倒序的正文”提示，状态流转偏离。
    - legado 菜单文案为 `reverse_content=反转内容`；当前 Flutter 文案为“正文倒序”，存在用户可见语义差异。
  - `P3-seq74` 逐项对照清单（实施后）：
    - 入口：已同义（阅读操作菜单仅在线书展示 `反转内容`，触发链路对齐 `menu_reverse_content`）。
    - 状态：已同义（正文反转算法收敛为字符级倒序，保持与 legado `toStringArray + insert(0, it)` 同义）。
    - 异常：已同义（无可用缓存正文时静默返回，不追加扩展提示与兜底抓取）。
    - 文案：已同义（菜单文案由“正文倒序”收敛为“反转内容”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载阅读操作菜单，平台样式差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击后回写当前章节缓存并立即重载当前章节，保持无成功 toast 的 legado 语义）。
    - 验证：手工路径 `阅读页(网络书且当前章节已缓存正文) -> 阅读操作 -> 反转内容`（校验入口显隐、字符级倒序结果、无缓存正文静默返回）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_reverse_content` 的反转算法与缺失正文边界，不改动书源规则、Cookie 与正文抓取链路。
  - 已完成 `P3-seq75`：`book_read.xml / @+id/menu_simulated_reading / 模拟追读`。
  - `P3-seq75` 差异点清单（实施前）：
    - legado `showSimulatedReading()` 为“配置弹窗 + 持久化 + 刷新正文”链路；当前 Flutter 该菜单仍是自动阅读占位动作，入口语义不一致。
    - legado `simulatedTotalChapterNum()` 使用 `Period.between(startDate, now).days + 1` 口径计算追读天数，并限制目录/翻页/朗读可读章节上限；当前 Flutter 未将该边界贯穿到章节导航与目录展示。
    - legado 在配置后会立即更新阅读会话边界；当前 Flutter 未对“可读章节=0”与“当前章节越界”提供同义收敛。
  - `P3-seq75` 逐项对照清单（实施后）：
    - 入口：已同义（阅读操作菜单 `模拟追读` 打开配置弹窗，包含启用、起始章节、每日章节、开始日期）。
    - 状态：已同义（落盘后立即重算可读章节上限，并统一影响底部章节导航、自动翻页、朗读切章、目录可见范围与进度分母）。
    - 异常：已同义（起始章节/每日章节非法输入阻断保存并提示；可读章节为 0 时清空正文展示且保持会话可继续配置）。
    - 文案：已同义（菜单文案与弹窗标题均为“模拟追读”，字段语义与 legado 对齐）。
    - 排版：已同义（保持 `CupertinoAlertDialog` 结构，平台样式差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（保存后立即重载当前章节或收敛到可读边界；取消不生效）。
    - 验证：`flutter test test/simple_reader_view_compile_test.dart`、`flutter test test/reader_legacy_menu_helper_test.dart`、`flutter test test/reader_catalog_sheet_test.dart`；手工路径 `阅读页 -> 阅读操作 -> 模拟追读`（校验配置保存后可读章节上限即时生效）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛阅读会话的可读章节边界与菜单交互语义，不改动书源解析与网络链路。
  - 已完成 `P3-seq76`：`book_read.xml / @+id/menu_enable_replace / 替换净化`。
  - `P3-seq76` 差异点清单（实施前）：
    - legado `menu_enable_replace` 标题语义为“替换净化（checkable）”；当前 Flutter 文案为“启用替换规则”，用户可见文案偏差。
    - legado `changeReplaceRuleState()` 是“切换书籍级开关 -> 保存 -> 刷新正文（不额外提示）”；当前 Flutter 在切换后追加“已开启/已关闭替换规则”toast，存在扩展反馈。
  - `P3-seq76` 逐项对照清单（实施后）：
    - 入口：已同义（阅读操作菜单保留 `替换净化`，勾选态映射书籍级 `useReplaceRule`）。
    - 状态：已同义（点击后切换书籍级开关并持久化，随后重载当前章节正文）。
    - 异常：已同义（空章节场景保持安全返回，不引入新异常分支）。
    - 文案：已同义（菜单标题收敛为“替换净化”，移除“已开启/已关闭替换规则”扩展提示）。
    - 排版：已同义（沿用阅读操作 `CupertinoActionSheet`，平台样式差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击即切换并刷新正文，保持无额外成功提示）。
    - 验证：`flutter test test/reader_legacy_menu_helper_test.dart`、`flutter test test/simple_reader_view_compile_test.dart`；手工路径 `阅读页 -> 阅读操作 -> 替换净化`（校验勾选态与正文刷新联动）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛菜单文案与交互反馈语义，不改动替换规则引擎与书源解析链路。
  - 已完成 `P3-seq77`：`book_read.xml / @+id/menu_same_title_removed / 移除重复标题`。
  - `P3-seq77` 差异点清单（实施前）：
    - legado `menu_same_title_removed` 文案为“移除重复标题”；当前 Flutter 文案为“同名标题去重”，用户可见语义偏差。
    - legado 菜单勾选态来自 `ReadBook.curTextChapter.sameTitleRemoved`（当前章节是否实际移除成功）；当前 Flutter 勾选态来自章节级持久化配置，状态语义不一致。
    - legado 点击动作为 `setRemoveSameTitle(book, chapter, !textChapter.sameTitleRemoved)`，且仅在“当前章节未移除且仍处于启用态”提示“未找到可移除的重复标题”；当前 Flutter 以“配置开关翻转 + 内容比较”判定提示，边界不一致。
    - legado 章节缺失场景静默返回；当前 Flutter 会提示“当前章节不存在”，存在扩展反馈。
  - `P3-seq77` 逐项对照清单（实施后）：
    - 入口：已同义（阅读操作菜单保留 `移除重复标题` 动作，不新增前置拦截入口）。
    - 状态：已同义（勾选态收敛为“当前章节实际发生重复标题移除”，不再使用章节配置态直接表达）。
    - 异常：已同义（章节缺失静默返回；仅在“未移除且已启用”边界提示“未找到可移除的重复标题”）。
    - 文案：已同义（菜单文案由“同名标题去重”收敛为“移除重复标题”）。
    - 排版：已同义（继续使用阅读操作 `CupertinoActionSheet` 承载 checkable 表达，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击后按 legado `!sameTitleRemoved` 语义翻转章节级开关并重载当前章节）。
    - 验证：`flutter test test/reader_legacy_menu_helper_test.dart`、`flutter test test/simple_reader_view_compile_test.dart`；手工路径 `阅读页 -> 阅读操作 -> 移除重复标题`（校验文案、勾选态、提示边界与章节重载）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_same_title_removed` 文案与状态语义，不改动书源规则与正文抓取链路。
  - 已完成 `P3-seq78`：`book_read.xml / @+id/menu_re_segment / 重新分段`。
  - `P3-seq78` 差异点清单（实施前）：
    - legado `menu_re_segment` 为固定文案 `checkable` 入口，勾选态来源于书籍级 `Book.getReSegment()`；当前 Flutter 虽保留同名入口，但重载前未先保存当前阅读进度，`restoreOffset` 在部分场景会读取旧进度导致位置漂移。
    - legado 点击链路为 `setReSegment(!getReSegment()) -> item.isChecked = getReSegment() -> ReadBook.loadContent(false)`，关键语义是“切换后立即重载当前正文且不追加提示”；当前 Flutter 存在额外的全量章节同步调用，语义颗粒度偏大。
    - legado `Book.ReadConfig.reSegment` 默认值为 `false`；Flutter 端需保持首次进入关闭态并按书籍维度持久化。
  - `P3-seq78` 逐项对照清单（实施后）：
    - 入口：已同义（阅读操作菜单保留 `重新分段`，不新增前置拦截与二级入口）。
    - 状态：已同义（勾选态映射书籍级 `reSegment` 开关；默认关闭，点击后立即翻转并持久化）。
    - 异常：已同义（章节列表为空时静默返回，不追加扩展提示）。
    - 文案：已同义（菜单文案保持固定“重新分段”，勾选态通过前缀勾选符表达）。
    - 排版：已同义（继续使用阅读操作 `CupertinoActionSheet`，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击后仅切换书籍级开关并重载当前章节；重载前先保存当前进度，再按 `restoreOffset` 恢复阅读位置，不追加成功 toast）。
    - 验证：手工路径 `阅读页 -> 阅读操作 -> 重新分段`（校验勾选态切换、正文即时重载、无扩展提示、重载后阅读位置保持）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_re_segment` 的重载触发与阅读位置恢复语义，不改动书源规则与正文抓取链路。
  - 已完成 `P3-seq79`：`book_read.xml / @+id/menu_enable_review / 段评`。
  - `P3-seq79` 差异点清单（实施前）：
    - legado 在 `book_read.xml` 保留 `menu_enable_review`，但默认 `visible=false`；同时 `ReadBookActivity` 中对应的显示与点击处理分支处于注释状态，运行时语义为“默认隐藏且不可触发”。
    - Flutter 端此前未显式保留该隐藏入口占位，虽结果同样不可触发，但缺少结构化表达，容易在后续菜单重排时误判为遗漏。
  - `P3-seq79` 逐项对照清单（实施后）：
    - 入口：已同义（阅读操作菜单默认不显示“段评”）。
    - 状态：已同义（保持默认隐藏，不引入可切换态）。
    - 异常：已同义（默认不可触发，无新增失败分支）。
    - 文案：已同义（保留 legacy 语义标签“段评”作为隐藏占位文案）。
    - 排版：已同义（不影响现有可见菜单布局与热区）。
    - 交互触发：已同义（菜单模型补齐 `enableReview` 占位，默认 `showReviewAction=false`；事件分发分支保持 no-op，不引入扩展流程）。
    - 验证：手工路径 `阅读页 -> 阅读操作`（校验菜单不出现“段评”且其后续项顺序不变）；代码对照 `legado book_read.xml(menu_enable_review visible=false)` 与 `legado ReadBookActivity` 注释分支确认默认不可触发。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐隐藏入口结构同义与触发边界，不改动正文渲染与书源链路。
  - 已完成 `P3-seq80`：`book_read.xml / @+id/menu_del_ruby_tag / 删除ruby标签`。
  - `P3-seq80` 差异点清单（实施前）：
    - legado `book_read.xml` 菜单文案为固定 `删除ruby标签`，当前 Flutter 菜单文案为“删除 ruby 标签”，存在用户可见语义差异。
    - legado 在 `EpubFile.getContent` 中仅移除 `rt/rp` 标签（`elements.select("rp, rt").remove()`），当前 Flutter 额外移除了 `ruby` 包裹标签，清理边界偏离 legacy。
    - legado 点击 `menu_del_ruby_tag` 后走 `refreshContentAll(it)`，语义为“全量清缓存并重载当前章节”；当前 Flutter 使用 `_clearBookCache` 会保留当前章内存正文，刷新边界偏弱。
  - `P3-seq80` 逐项对照清单（实施后）：
    - 入口：已同义（仅 EPUB 阅读场景显示“删除ruby标签”入口，非 EPUB 不显示）。
    - 状态：已同义（保持 checkable 语义，勾选态映射书籍级 `delRubyTag` 状态）。
    - 异常：已同义（入口显隐受 EPUB 边界控制，切换流程无新增静默失败分支）。
    - 文案：已同义（由“删除 ruby 标签”收敛为“删除ruby标签”）。
    - 排版：已同义（继续使用阅读操作 `CupertinoActionSheet` 承载，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击后切换书籍级开关、全量清缓存并重载当前章节；文本清理仅删除 `rt/rp` 标签，保留 `ruby` 包裹标签）。
    - 验证：手工路径 `阅读页(EPUB书籍) -> 阅读操作 -> 删除ruby标签`（校验入口显隐、勾选态切换、切换后当前章节重载且注音标签按 `rt/rp` 删除生效）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 EPUB 正文后处理与菜单文案/刷新语义，不改动书源解析与网络链路。
  - 已完成 `P3-seq81`：`book_read.xml / @+id/menu_del_h_tag / 删除h标签`。
  - `P3-seq81` 差异点清单（实施前）：
    - legado `book_read.xml` 菜单文案为固定 `删除h标签`，当前 Flutter 菜单文案为“删除 h 标签”，存在用户可见语义差异。
    - legado 在 `EpubFile.getBody` 中通过 `select("h1, h2, h3, h4, h5, h6").remove()` 删除整段标题节点；当前 Flutter `_removeHTagLikeLegado` 仅移除标签本身，保留标签内文本，清理边界偏离 legacy。
    - legado 点击 `menu_del_h_tag` 后沿用 `refreshContentAll(it)`，语义为“全量清缓存并重载当前章节”；当前 Flutter 已收敛全量清缓存链路，但需补齐 `h` 标签节点清理语义。
  - `P3-seq81` 逐项对照清单（实施后）：
    - 入口：已同义（仅 EPUB 阅读场景显示“删除h标签”入口，非 EPUB 不显示）。
    - 状态：已同义（保持 checkable 语义，勾选态映射书籍级 `delHTag` 状态）。
    - 异常：已同义（入口显隐受 EPUB 边界控制，切换流程无新增静默失败分支）。
    - 文案：已同义（由“删除 h 标签”收敛为“删除h标签”）。
    - 排版：已同义（继续使用阅读操作 `CupertinoActionSheet` 承载，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击后切换书籍级开关并走全量清缓存重载；`h` 标签处理收敛为删除 `h1~h6` 整段节点内容，包含标题文本）。
    - 验证：手工路径 `阅读页(EPUB书籍) -> 阅读操作 -> 删除h标签`（校验入口显隐、勾选态切换、切换后章节内 `h1~h6` 整段节点内容被移除、全量清缓存并重载当前章节）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 EPUB 正文 `h` 标签清理边界与菜单文案语义，不改动书源解析与网络链路。
  - 已完成 `P3-seq82`：`book_read.xml / @+id/menu_image_style / 图片样式`。
  - `P3-seq82` 差异点清单（实施前）：
    - legado `menu_image_style` 的 `SINGLE` 分支会调用 `book.setPageAnim(0)`，属于书籍级翻页动画覆盖；Flutter 端此前通过 `_updateSettings(...cover...)` 修改全局阅读设置，作用域偏大。
    - legado 选择图片样式后统一 `ReadBook.loadContent(false)` 刷新正文；Flutter 端已有章节重载链路，但需保证 `SINGLE` 联动后仍保持同次重载语义。
  - `P3-seq82` 逐项对照清单（实施后）：
    - 入口：已同义（阅读操作菜单保留“图片样式”一级入口）。
    - 状态：已同义（`DEFAULT/FULL/TEXT/SINGLE` 四档按书籍级持久化）。
    - 异常：已同义（取消选择不生效，保持当前样式）。
    - 文案：已同义（标题“图片样式”，选项保持 legacy 常量文案）。
    - 排版：已同义（切换样式后正文即时重载，图片渲染按所选样式更新）。
    - 交互触发：已同义（选择 `SINGLE` 时改为仅写入书籍级 `pageAnim=覆盖`，不再污染全局设置；随后重载当前章节）。
    - 验证：手工路径 `阅读页 -> 阅读操作 -> 图片样式 -> 选择 DEFAULT/FULL/TEXT/SINGLE`（校验样式即时生效；`SINGLE` 分支仅影响当前书籍翻页动画，切换其它书籍不受影响）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_image_style` 的 `SINGLE` 联动作用域，不改动书源解析与正文抓取链路。
  - 已完成 `P3-seq84`：`book_read.xml / @+id/menu_effective_replaces / 起效的替换`。
  - `P3-seq84` 差异点清单（实施前）：
    - legado `menu_effective_replaces` 点击后打开 `EffectiveReplacesDialog`，列表来源是 `ReadBook.curTextChapter.effectiveReplaceRules`（仅当前章节正文实际命中规则）；当前 Flutter 该入口直接跳转 `ReplaceRuleListView`，入口层级与语义不一致。
    - legado 在简繁转换开启（`chineseConverterType > 0`）时会在列表尾部追加固定项“繁简转换”；当前 Flutter 未暴露该同层级入口。
    - legado 对话框内发生编辑（规则编辑或简繁模式变更）后在 `onDismiss` 统一触发 `viewModel.replaceRuleChanged()` 刷新正文；当前 Flutter 缺少该“编辑后统一重载”闭环。
  - `P3-seq84` 逐项对照清单（实施后）：
    - 入口：已同义（阅读操作菜单“起效的替换”改为弹层展示当前章节起效规则，不再跳转规则总列表页）。
    - 状态：已同义（列表仅展示当前章节正文实际命中替换规则；简繁转换开启时追加“繁简转换”项）。
    - 异常：已同义（无命中规则时仅保留关闭动作，不新增扩展失败提示）。
    - 文案：已同义（菜单文案与弹层标题统一为“起效的替换”；简繁入口文案为“繁简转换”）。
    - 排版：已同义（采用 `CupertinoActionSheet` 承载弹层与条目，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击命中规则进入规则编辑；点击“繁简转换”进入模式选择；发生编辑后统一清理替换阶段缓存并重载当前章节，等价 `replaceRuleChanged`）。
    - 验证：手工路径 `阅读页 -> 阅读操作 -> 起效的替换`、`起效的替换 -> 选择规则 -> 保存`、`起效的替换 -> 繁简转换 -> 切换模式`（校验命中列表、简繁入口、编辑后即时重载）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_effective_replaces` 入口与规则可见性，不改动书源解析、网络请求与正文抓取链路。
  - 已完成 `P2-seq348`：`search_view.xml / @+id/menu_search / 搜索`。
  - `P2-seq348` 差异点清单（实施前）：
    - legado `search_view.xml` 仅提供 `menu_search` 单一 `SearchView actionView` 提交入口；当前 Flutter 搜索页存在“输入框 + 独立搜索按钮”双入口，属于扩展入口偏差。
    - legado 搜索输入提示语义来自 `search_book_key`（“搜索书名、作者”）；当前 Flutter 占位文案为“请输入书名或作者名”，存在文案口径差异。
  - `P2-seq348` 逐项对照清单（实施后）：
    - 入口：已同义（顶部收敛为单一 `ShadInput` 搜索控件，提交动作内聚在控件内搜索图标与键盘 `search`）。
    - 状态：已同义（搜索进行中控件内图标切换为 loading；输入变化时保持 legado 同义“停止搜索并隐藏继续加载入口”状态流转）。
    - 异常：已同义（未新增扩展失败提示，继续复用既有搜索异常汇总与日志可观测链路）。
    - 文案：已同义（搜索占位文案收敛为“搜索书名、作者”）。
    - 排版：已同义（搜索控件保持页面顶部一级入口承载；平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击控件内搜索图标或键盘提交均触发 `_search()`，不再保留外置独立“搜索”按钮入口）。
    - 验证：手工路径 `搜索页 -> 输入关键字 -> 点击输入框内搜索图标`、`搜索页 -> 输入关键字 -> 键盘搜索`（校验两条路径均可触发搜索；输入变化时会停止搜索并隐藏“继续加载”入口）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_search` 的入口形态与文案语义，不改动搜索规则解析、缓存键与书源请求链路。
  - 已完成 `P3-seq5`：`audio_play.xml / @+id/menu_change_source / 换源`。
  - `P3-seq5` 差异点清单（实施前）：
    - legado `AudioPlayActivity` 顶栏固定存在 `menu_change_source` 一级 action，点击后直接进入 `ChangeBookSourceDialog(name, author)`；当前 Flutter 端“朗读”长按入口仍是占位提示“朗读设置暂未实现”，缺少 `audio_play` 维度的换源触发入口。
    - Flutter 端虽已在阅读页顶栏实现 `book_read/menu_change_source`，但该入口不属于音频播放菜单语义，无法覆盖 `audio_play.xml` 的独立入口要求。
  - `P3-seq5` 逐项对照清单（实施后）：
    - 入口：已同义（底部菜单“朗读”长按改为打开“播放”菜单，补齐 `audio_play` 维度换源入口）。
    - 状态：已同义（菜单仅承载当前序号 `menu_change_source` 单项动作；取消仅关闭菜单，不改变阅读状态）。
    - 异常：已同义（换源点击后复用现有整书换源链路与异常边界：书名为空/无可用书源/无候选源时保持可观测提示）。
    - 文案：已同义（菜单标题“播放”，动作文案“换源”与 legado 语义一致）。
    - 排版：已同义（使用 `CupertinoActionSheet` 承载播放菜单，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“换源”后直接进入整书换源候选弹层，等价 legado `menu_change_source -> ChangeBookSourceDialog` 的主触发语义）。
    - 验证：手工路径 `阅读页 -> 底部菜单长按朗读 -> 播放 -> 换源`（校验播放菜单出现“换源”入口，点击后进入换源候选弹层）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `audio_play/menu_change_source` 入口与触发语义，不改动书源搜索规则、目录匹配与正文抓取链路。
  - 已完成 `P3-seq6`：`audio_play.xml / @+id/menu_login / 登录`。
  - `P3-seq6` 差异点清单（实施前）：
    - legado `AudioPlayActivity.onMenuOpened` 会按 `AudioPlay.bookSource?.loginUrl` 控制 `menu_login` 显隐；当前 Flutter “播放”菜单仅包含“换源”，缺少登录入口与显隐边界。
    - legado `menu_login` 点击后以 `bookSourceUrl` 触发 `SourceLoginActivity(type=bookSource, key=bookSourceUrl)`；当前 Flutter 缺少 `audio_play` 维度登录触发路径。
  - `P3-seq6` 逐项对照清单（实施后）：
    - 入口：已同义（“播放”菜单补齐“登录”动作，与 `audio_play/menu_login` 同层级）。
    - 状态：已同义（仅在当前书源 `loginUrl` 非空时展示“登录”；`loginUrl` 为空时隐藏）。
    - 异常：已同义（无可用登录入口时不展示动作，不新增扩展失败分支）。
    - 文案：已同义（动作文案固定为“登录”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载菜单，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“登录”后按 `bookSourceUrl` 复用现有书源登录链路：优先 `loginUi` 表单登录，回退网页登录）。
    - 验证：手工路径 `阅读页(网络书且书源配置 loginUrl) -> 底部菜单长按朗读 -> 播放 -> 登录`（校验 `loginUrl` 非空时展示并可进入登录流程；`loginUrl` 为空时不展示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `audio_play/menu_login` 的显隐与触发语义，不改动书源解析、目录匹配与正文抓取链路。
  - 已完成 `P3-seq8`：`audio_play.xml / @+id/menu_edit_source / 编辑书源`。
  - `P3-seq8` 差异点清单（实施前）：
    - legado `AudioPlayActivity.onCompatOptionsItemSelected` 中 `menu_edit_source` 为播放菜单常驻入口，点击后按当前 `AudioPlay.bookSource.bookSourceUrl` 打开 `BookSourceEditActivity`；当前 Flutter “播放”菜单仅有“登录/换源”，缺少 `audio_play` 维度编辑书源入口。
    - legado 仅在编辑页返回 `RESULT_OK` 时执行 `viewModel.upSource()` 刷新书源显示；当前 Flutter 播放菜单缺少该入口，无法覆盖“取消不刷新、保存返回刷新”的回调边界。
  - `P3-seq8` 逐项对照清单（实施后）：
    - 入口：已同义（“播放”菜单补齐“编辑书源”动作，与 `audio_play/menu_edit_source` 同层级）。
    - 状态：已同义（入口常驻展示；当前书源为空时点击保持 no-op，不新增扩展提示）。
    - 异常：已同义（缺失书源场景不触发编辑页，不新增额外失败分支）。
    - 文案：已同义（动作文案固定为“编辑书源”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载菜单，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击后复用 `_openSourceEditorFromReader(sourceUrl)` 打开书源编辑页；仅在保存返回时刷新当前书源展示，取消返回不刷新）。
    - 验证：手工路径 `阅读页(网络书) -> 底部菜单长按朗读 -> 播放 -> 编辑书源`（校验可进入编辑页、取消返回不刷新、保存返回后刷新当前书源展示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `audio_play/menu_edit_source` 入口与回调边界，不改动书源解析、目录匹配与正文抓取链路。
  - 已完成 `P3-seq87`：`book_read_change_source.xml / @+id/menu_chapter_change_source / 单章换源`。
  - `P3-seq87` 差异点清单（实施前）：
    - legado `menu_chapter_change_source` 会打开 `ChangeChapterSourceDialog`，并在选中候选书源后由用户手动选择目标章节，再执行 `replaceContent` 替换当前章节正文；当前 Flutter 端是“选源后自动匹配章节并立即替换”，缺少手动选章步骤。
    - legado 单章换源成功后仅关闭弹层并刷新当前章节，不弹成功 toast；当前 Flutter 端会弹“已完成章节换源：xxx”，属于扩展反馈。
  - `P3-seq87` 逐项对照清单（实施后）：
    - 入口：已同义（阅读页“换源”按钮长按分支保留“单章换源”入口，仍在 `book_read_change_source` 分支菜单层级触发）。
    - 状态：已同义（单章换源改为“先选候选书源，再选目标章节”两段流程，章节选择默认定位到 legado 同义匹配章节）。
    - 异常：已同义（目录为空/候选章节为空仍给出可观测失败提示；获取正文异常统一走 `章节换源失败：<原因>`）。
    - 文案：已同义（分支菜单文案收敛为“单章换源”；章节选择面板标题同步收敛为“单章换源”）。
    - 排版：已同义（章节选择使用 `OptionPickerSheet` 呈现目标章节列表；平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（选择目标章节后仅替换当前阅读章节正文并重载当前章节，不迁移整书来源，不追加成功 toast）。
    - 验证：手工路径 `阅读页(网络书) -> 顶部换源按钮长按 -> 单章换源 -> 选择候选书源 -> 选择目标章节`（校验当前章节正文被替换且章节索引保持不变）；手工路径 `同链路 -> 章节选择面板点取消`（校验取消不落库、不改正文）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_chapter_change_source` 的交互与正文替换边界，不改动整书换源、书源落库与目录持久化。
  - 已完成 `P3-seq88`：`book_read_change_source.xml / @+id/menu_book_change_source / 整书换源`。
  - `P3-seq88` 差异点清单（实施前）：
    - legado `book_read_change_source.xml` 中 `menu_book_change_source` 文案是“整书换源”；当前 Flutter 长按“换源”分支菜单该项文案为“书籍换源”，存在用户可见文案语义偏差。
    - legado `menu_change_source/menu_book_change_source` 成功后仅关闭换源弹层并刷新阅读会话，不弹成功 toast；当前 Flutter 整书换源成功后会弹“已切换到：<书源名>”，属于扩展反馈。
  - `P3-seq88` 逐项对照清单（实施后）：
    - 入口：已同义（阅读页“换源”按钮长按分支保留 `menu_book_change_source` 入口，层级不变）。
    - 状态：已同义（长按分支“整书换源”与顶栏点击“换源”均复用同一整书换源候选链路，切源后目录与正文同步刷新）。
    - 异常：已同义（保留整书换源既有可观测失败分支：书名为空/无可用书源/无候选源/目录为空/新源章节为空）。
    - 文案：已同义（分支菜单文案由“书籍换源”收敛为 legado 同义“整书换源”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载长按分支菜单，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（整书换源成功后保持静默，不再弹“已切换到：...”扩展提示，贴齐 legado `ChangeBookSourceDialog` 成功反馈边界）。
    - 验证：手工路径 `阅读页(网络书) -> 顶部换源按钮长按 -> 整书换源 -> 选择候选书源`（校验文案“整书换源”、切源后目录/正文刷新且无成功 toast）；手工路径 `阅读页(网络书) -> 顶部换源按钮点击`（校验默认点击与长按“整书换源”触发链路一致）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_book_change_source` 文案与成功反馈语义，不改动整书换源候选匹配、目录落库与正文抓取链路。
  - 已完成 `P3-seq210`：`content_select_action.xml / @+id/menu_search_content / 全文搜索`。
  - `P3-seq210` 差异点清单（实施前）：
    - legado `TextActionMenu.menu_search_content` 会把选中文本作为 `searchWord` 传给 `SearchContentActivity`，搜索范围是“当前书籍的跨章节正文”；当前 Flutter “搜索正文”仅在当前章节内命中，无法跨章节导航，语义缺口明显。
    - legado `SearchContentActivity` 的核心边界是“空关键词不触发搜索；在线书仅检索已缓存章节；本地书可检索全部章节内容”；当前 Flutter 实现没有这组跨章节与缓存边界。
    - legado 搜索结果导航会展示章节维度信息并支持跨章节跳转；当前 Flutter 结果面板只显示当前章节位置，无法表达“命中章节”。
  - `P3-seq210` 逐项对照清单（实施后）：
    - 入口：已同义（阅读页“搜索正文”继续作为一级动作，提交后直接进入全文结果面板）。
    - 状态：已同义（搜索状态新增“进行中”指示；重复发起搜索会取消旧任务并以新关键词结果覆盖）。
    - 异常：已同义（空关键词静默返回；无命中时保持结果面板空态文案“全文未找到匹配内容”，不追加扩展错误弹窗）。
    - 文案：已同义（保留“搜索正文”语义；结果栏改为“结果 x/y · 章节名”，对齐章节维度反馈）。
    - 排版：已同义（继续使用 `Cupertino` 搜索面板与底部结果条；新增 loading 指示仅用于状态可观测，属于 `Shadcn + Cupertino` 平台差异允许范围）。
    - 交互触发：已同义（命中列表支持上下条切换；命中不在当前章节时先切章再定位，形成跨章节跳转闭环）。
    - 验证：`flutter test test/reader_search_navigation_helper_test.dart`、`flutter test test/reader_top_menu_test.dart`；手工路径 `阅读页 -> 搜索正文 -> 输入当前章节关键词` 与 `阅读页 -> 搜索正文 -> 输入其它章节关键词 -> 上一个/下一个`（校验跨章节命中与定位）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_search_content` 的命中范围与跳转语义，不改动书源解析、目录刷新、换源与云端进度链路。
  - 已完成 `P3-seq239`：`font_select.xml / @+id/menu_other / 其它目录`。
  - `P3-seq239` 差异点清单（实施前）：
    - legado `FontSelectDialog` 顶栏菜单包含 `menu_other`，点击后始终触发 `openFolder()` 重选字体目录；当前 Flutter 字体弹层无“其它目录”入口。
    - legado 会持久化 `fontFolder` 并在后续重进弹层时继续以该目录加载字体；当前 Flutter 无字体目录路径持久化。
    - legado 目录重选后会刷新 `ttf/otf` 候选列表；当前 Flutter 仅固定展示预设字体，缺少目录字体刷新链路。
  - `P3-seq239` 逐项对照清单（实施后）：
    - 入口：已同义（阅读页“选择字体”弹层顶部补齐“其它目录”动作，触发层级与 legado `menu_other` 同义）。
    - 状态：已同义（新增字体目录路径持久化与回读；重进阅读后可继续使用已选目录与已选自定义字体路径）。
    - 异常：已同义（目录选择取消/空目录/读取失败均可观测且不崩溃；空目录提示“未找到可用字体文件”）。
    - 文案：已同义（动作文案固定为“其它目录”，不追加扩展入口文案）。
    - 排版：已同义（仅在既有字体弹层头部补齐动作按钮，列表层级与间距节奏保持不变；平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（点击“其它目录”后重选目录并刷新 `ttf/otf` 列表；点击目录字体后即时应用到正文）。
    - 验证：`flutter test test/reader_top_menu_test.dart`、`flutter test test/reader_search_navigation_helper_test.dart`、`flutter test test/simple_reader_view_compile_test.dart`；手工路径 `阅读页 -> 样式弹层 -> 字体 -> 其它目录 -> 选择目录` 与 `阅读页 -> 样式弹层 -> 字体 -> 选择目录字体`。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_other` 的目录重选与字体候选刷新语义，不改动书源解析、搜索/目录/正文抓取与换源链路。
  - 已完成 `P3-seq373`：`speak_engine.xml / @+id/menu_default / 导入默认规则`。
  - `P3-seq373` 差异点清单（实施前）：
    - legado `SpeakEngineDialog` 的 `menu_default` 会调用 `SpeakEngineViewModel.importDefault -> DefaultData.importDefaultHttpTTS`，语义是“删除默认规则（`id<0`）并导入内置 `defaultData/httpTTS.json`”；当前 Flutter 端“语音管理”入口为占位提示，缺少可执行导入动作。
    - legado 默认 HTTP 朗读规则资产来自 `app/src/main/assets/defaultData/httpTTS.json`；当前 Flutter 端缺少对应默认规则资产，无法保证导入内容同源。
  - `P3-seq373` 逐项对照清单（实施后）：
    - 入口：已同义（设置页与源管理页“语音管理”改为可进入“朗读引擎”管理页，并在右上角更多菜单提供“导入默认规则”动作）。
    - 状态：已同义（导入默认规则后列表即时刷新；重复执行时保持“仅重置默认规则”边界）。
    - 异常：已同义（资产读取/解析失败可观测：弹窗提示“导入失败：<原因>”）。
    - 文案：已同义（菜单文案固定“导入默认规则”，与 legado `@string/import_default_rule` 一致）。
    - 排版：已同义（使用 `AppCupertinoPageScaffold + CupertinoActionSheet + CupertinoListSection` 承载，属于 `Shadcn + Cupertino` 允许差异范围）。
    - 交互触发：已同义（动作执行语义收敛为“仅删除默认规则 `id<0>` 并导入 `assets/source/httpTTS.json`；保留用户自定义规则”）。
    - 验证：手工路径 `设置 -> 语音管理 -> 右上角更多 -> 导入默认规则`（校验导入后 `HTTP 朗读引擎` 列表出现默认规则且重复导入不删除用户规则）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐默认 HTTP 朗读规则导入语义与入口，不改动现有朗读执行链路。
  - 已完成 `P3-seq374`：`speak_engine.xml / @+id/menu_import_local / 本地导入`。
  - `P3-seq374` 差异点清单（实施前）：
    - legado `SpeakEngineDialog` 在 `menu_import_local` 分支固定触发 `HandleFileContract.FILE + allowExtensions(txt/json)`；当前 Flutter 朗读引擎页“更多”菜单仅有“导入默认规则”，缺少本地导入入口。
    - legado 本地导入不会直接落库，而是进入 `ImportHttpTtsDialog` 先展示候选项并按 `id + lastUpdateTime` 标记“新增/更新/已有”，默认仅勾选“新增/更新”；当前 Flutter 缺少候选对比与选择流程。
    - legado 确认导入时使用等待态并仅写入勾选项，取消则不落库；当前 Flutter 端缺少该状态流转与交互边界。
  - `P3-seq374` 逐项对照清单（实施后）：
    - 入口：已同义（“朗读引擎”页右上角更多菜单补齐“本地导入”一级入口，对齐 legado `menu_import_local` 层级）。
    - 状态：已同义（选择 `txt/json` 后先进入“导入朗读引擎”候选弹层；候选按 `id + lastUpdateTime` 标记“新增/更新/已有”，默认勾选“新增/更新”，支持全选/取消全选）。
    - 异常：已同义（格式错误时提示“格式不对”；导入异常可观测：日志输出 `ImportError:*` 且弹窗提示“导入失败：<原因>”）。
    - 文案：已同义（菜单文案固定“本地导入”，候选状态文案固定“新增/更新/已有”，不追加扩展成功文案）。
    - 排版：已同义（继续使用 `CupertinoActionSheet + CupertinoPopupSurface` 承载本地导入与候选选择，信息层级保持“入口 -> 候选列表 -> 导入确认”）。
    - 交互触发：已同义（确认导入仅落库勾选项并即时刷新 HTTP 朗读引擎列表；取消文件选择或取消弹层均不落库）。
    - 验证：`flutter test test/widget_test.dart`、`flutter test test/search_view_source_manage_action_test.dart`；手工路径 `设置 -> 语音管理 -> 右上角更多 -> 本地导入 -> 选择 txt/json`（校验候选状态、默认勾选与导入后刷新）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_import_local` 本地导入与候选选择语义，不改动阅读朗读执行链路与书源规则结构。
  - 已完成 `P3-seq375`：`speak_engine.xml / @+id/menu_import_onLine / 网络导入`。
  - `P3-seq375` 差异点清单（实施前）：
    - legado `SpeakEngineDialog` 在 `menu_import_onLine` 分支固定触发 `importAlert()`，先弹出 URL 输入框，再进入 `ImportHttpTtsDialog(url)`；当前 Flutter 朗读引擎页“更多”菜单缺少“网络导入”入口。
    - legado `importAlert` 会缓存导入 URL（键 `ttsUrlKey`）并支持删除历史项；当前 Flutter 端缺少网络导入历史管理能力。
    - legado 网络导入与本地导入共用同一候选预览导入语义（新增/更新/已有 + 默认勾选新增/更新 + 仅导入勾选项）；当前 Flutter 端仅覆盖了本地导入链路。
  - `P3-seq375` 逐项对照清单（实施后）：
    - 入口：已同义（“朗读引擎”页右上角更多菜单补齐“网络导入”一级入口，对齐 legado `menu_import_onLine` 层级）。
    - 状态：已同义（点击后进入“网络导入”输入弹层，支持历史记录点选回填与删除；确认后进入“导入朗读引擎”候选弹层，默认勾选新增/更新）。
    - 异常：已同义（输入格式不合法时提示“格式不对”；导入异常可观测：日志输出 `ImportError:*` 且弹窗提示“导入失败：<原因>”）。
    - 文案：已同义（菜单文案固定“网络导入”；输入占位固定 `url`；历史区域文案固定“历史记录”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet + CupertinoPopupSurface` 承载“入口 -> URL 输入/历史 -> 候选列表 -> 导入确认”层级，平台视觉差异属于允许范围）。
    - 交互触发：已同义（HTTP/HTTPS 输入会写入并前置历史；点选历史可回填输入框；确认导入仅落库勾选项并即时刷新列表；取消输入弹层/候选弹层均不落库）。
    - 验证：手工路径 `设置 -> 语音管理 -> 右上角更多 -> 网络导入 -> 输入 URL -> 导入`（校验网络导入弹层、历史记录回填与删除、候选状态与默认勾选、确认后列表刷新、取消不落库）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_import_onLine` 网络导入入口与历史记录语义，不改动朗读执行链路与书源规则结构。
  - 已完成 `P3-seq376`：`speak_engine.xml / @+id/menu_export / 导出`。
  - `P3-seq376` 差异点清单（实施前）：
    - legado `SpeakEngineDialog` 在 `menu_export` 分支固定触发 `HandleFileContract.EXPORT`，输出 `fileName=httpTts.json`、`mimeType=application/json`，内容为 `GSON.toJson(adapter.getItems())`；当前 Flutter 朗读引擎页“更多”菜单缺少“导出”入口。
    - legado 导出成功后会弹“导出成功”对话框并展示导出路径，支持复制路径；当前 Flutter 端缺少导出成功后的路径可观测与复制动作。
    - tracker 缺少 `seq376` 行，无法闭环“差异->实现->验证”证据链。
  - `P3-seq376` 逐项对照清单（实施后）：
    - 入口：已同义（“朗读引擎”页右上角更多菜单补齐“导出”一级入口，对齐 legado `menu_export` 层级）。
    - 状态：已同义（点击后进入系统导出流程，默认文件名 `httpTts.json`，导出内容为当前 HTTP 朗读引擎 JSON 数组；取消导出不落盘）。
    - 异常：已同义（导出失败弹窗可观测提示“导出失败：<原因>”，不吞错）。
    - 文案：已同义（菜单文案固定“导出”，成功弹窗标题固定“导出成功”，路径区域文案固定“导出路径：”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet + CupertinoAlertDialog` 承载“入口 -> 系统导出 -> 成功路径确认”层级，平台视觉差异属于允许范围）。
    - 交互触发：已同义（成功弹窗提供“复制路径”动作；复制后给出“已复制导出路径”轻提示）。
    - 验证：手工路径 `设置 -> 语音管理 -> 右上角更多 -> 导出`（校验默认文件名 `httpTts.json`、文件内容为当前 HTTP 朗读引擎 JSON 数组、成功弹窗展示路径且可复制）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_export` 导出入口与成功反馈语义，不改动朗读执行链路与书源规则结构。
  - 已完成 `P3-seq378`：`speak_engine_edit.xml / @+id/menu_login / 登录`。
  - `P3-seq378` 差异点清单（实施前）：
    - legado `HttpTtsEditDialog` 在 `menu_login` 分支固定执行“从编辑表单取值 -> `viewModel.save(httpTts)` -> `SourceLoginActivity(type=httpTts,key=id)`”；当前 Flutter 仅有朗读引擎列表承载，缺少 `speak_engine_edit` 编辑页与 `menu_login` 入口。
    - legado 在 `menu_login` 点击时只拦截 `loginUrl` 为空并提示“登录url不能为空”，不依赖列表页已保存态；当前 Flutter 缺少“登录前先按当前编辑输入回写规则”的状态流转。
    - tracker 缺少 `seq378` 行，无法闭环“差异->实现->验证”证据链。
  - `P3-seq378` 逐项对照清单（实施后）：
    - 入口：已同义（HTTP 朗读引擎条目支持进入编辑页，编辑页右上角更多菜单补齐“登录”动作，对齐 legado `speak_engine_edit/menu_login` 层级）。
    - 状态：已同义（点击“登录”时先按当前编辑表单回写规则，再按登录配置分流到登录页）。
    - 异常：已同义（`loginUrl` 为空时提示“登录url不能为空”并终止登录；登录流程失败弹窗可观测“登录失败：<原因>”）。
    - 文案：已同义（菜单文案固定“登录”，空登录地址提示固定“登录url不能为空”）。
    - 排版：已同义（编辑页使用 `AppCupertinoPageScaffold + CupertinoListSection` 承载字段编辑与更多菜单，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（存在 `loginUi` 时进入表单登录；无 `loginUi` 时进入网页登录；两条分支均先执行规则回写）。
    - 验证：手工路径 `设置 -> 语音管理 -> 点击 HTTP 朗读引擎条目 -> 编辑页右上角更多 -> 登录`（校验 `loginUrl` 为空提示“登录url不能为空”；非空时先保存编辑输入再进入登录流程）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_login` 触发链路与保存时序，不改动朗读执行链路与导入导出规则结构。
  - 已完成 `P3-seq380`：`speak_engine_edit.xml / @+id/menu_del_login_header / 删除登录头`。
  - `P3-seq380` 差异点清单（实施前）：
    - legado `HttpTtsEditDialog` 在 `menu_del_login_header` 分支固定执行 `dataFromView().removeLoginHeader()`；当前 Flutter 编辑页“更多”菜单仅有“登录/查看登录头”，缺少“删除登录头”入口。
    - legado 删除动作仅清理登录头缓存与关联 Cookie，不触发保存和提示；当前 Flutter 缺少该删除链路，无法从编辑页直接回收登录头状态。
  - `P3-seq380` 逐项对照清单（实施后）：
    - 入口：已同义（HTTP 朗读引擎编辑页“更多”菜单补齐“删除登录头”一级入口，对齐 legado `speak_engine_edit/menu_del_login_header` 层级）。
    - 状态：已同义（点击后按当前规则 `id` 映射 `httpTts:<id>` 键删除登录头缓存，不触发规则保存与登录跳转）。
    - 异常：已同义（缺失缓存时删除动作静默返回，不新增扩展错误提示）。
    - 文案：已同义（菜单文案固定“删除登录头”）。
    - 排版：已同义（继续使用 `CupertinoActionSheet` 承载“更多”菜单，平台视觉差异属于 `Shadcn + Cupertino` 允许范围）。
    - 交互触发：已同义（删除后立即生效；再进入“查看登录头”仅显示标题且无缓存文本）。
    - 验证：手工路径 `设置 -> 语音管理 -> 点击 HTTP 朗读引擎条目 -> 编辑页右上角更多 -> 删除登录头 -> 查看登录头`（校验删除后仅显示标题且删除动作无额外提示）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅补齐 `menu_del_login_header` 删除入口与缓存清理语义，不改动朗读执行链路与导入导出规则结构。
  - 已完成 `P3-seq201`：`content_edit.xml / @+id/menu_save / 保存`。
  - `P3-seq201` 差异点清单（实施前）：
    - legado `ContentEditDialog.menu_save -> save()` 调用 `BookHelp.saveText`，当正文为空字符串时直接返回，不覆盖现有正文缓存；当前 Flutter 编辑正文返回后会无条件用编辑框内容覆盖章节 `content`，空正文会把已缓存正文写成空串。
    - legado `menu_save` 仅负责保存正文并关闭弹层；当前 Flutter 保存链路还会无差别改写 `isDownloaded` 状态，即使正文未有效落库也会被置为已缓存。
  - `P3-seq201` 逐项对照清单（实施后）：
    - 入口：已同义（阅读页“阅读操作 -> 编辑正文”中保留“保存”动作，触发保存后返回阅读页）。
    - 状态：已同义（保存时仅在正文非空时覆盖章节 `content` 并置 `isDownloaded=true`；正文为空时保持原缓存与下载状态不变）。
    - 异常：已同义（本序号不新增网络/解析分支；空正文场景保持静默返回，不追加扩展提示）。
    - 文案：已同义（保持“保存”文案，不新增扩展提示）。
    - 排版：已同义（沿用现有 Cupertino 编辑页承载，平台视觉差异属于允许范围）。
    - 交互触发：已同义（点击“保存”或“关闭”均沿用自动保存链路；空正文不会覆盖当前章节正文缓存）。
    - 验证：手工路径 `阅读页 -> 阅读操作 -> 编辑正文 -> 清空正文后点保存/关闭`（校验返回后当前章节正文不被空串覆盖）；手工路径 `阅读页 -> 阅读操作 -> 编辑正文 -> 修改正文后保存`（校验正文更新并即时生效）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_save` 的空内容保存边界，不改动书源解析、目录加载与正文抓取链路。
  - 已完成 `P3-seq202`：`content_edit.xml / @+id/menu_reset / 重置`。
  - `P3-seq202` 差异点清单（实施前）：
    - legado `menu_reset` 失败分支无错误弹窗，执行失败时保持当前编辑内容；当前 Flutter 重置失败会弹出“重置失败”对话框，用户可见语义不一致。
    - legado `initContent(true)` 在重置时先清章节缓存，再按书籍类型回源获取正文（本地书走本地文件读取）；当前 Flutter 在重置链路中会回退到 `_currentContent`，本地书清缓存后也无法从本地文件回读章节正文。
    - legado 重置后触发 `ReadBook.loadContent(..., resetPageOffset=false)` 刷新当前阅读章节；当前 Flutter 失败分支可能中断刷新闭环，缺少同义日志落点。
  - `P3-seq202` 逐项对照清单（实施后）：
    - 入口：已同义（阅读页“阅读操作 -> 编辑正文”保留“重置”动作）。
    - 状态：已同义（重置前先清章节缓存与 `isDownloaded`；网络书按书源重拉正文，本地书按本地文件重读正文后回填编辑框并刷新当前章节）。
    - 异常：已同义（重置失败时保持当前编辑内容并静默返回，不弹扩展失败弹窗；同时记录 `reader.menu.edit_content_reset.failed` 与 `reader.menu.edit_content_reset.reload_failed` 日志）。
    - 文案：已同义（动作文案保持“重置”，未新增扩展提示文案）。
    - 排版：已同义（沿用 Cupertino 全屏编辑页与重置 loading 遮罩，平台视觉差异属于允许范围）。
    - 交互触发：已同义（点击“重置”后执行“清缓存 -> 回源读取 -> 回填编辑框 -> 刷新当前章节”，失败时保持编辑态可继续操作）。
    - 验证：手工路径 `阅读页(网络书) -> 阅读操作 -> 编辑正文 -> 重置`（校验重置后正文回填并刷新当前章节；重拉失败时无“重置失败”弹窗）；手工路径 `阅读页(本地 TXT/EPUB) -> 阅读操作 -> 编辑正文 -> 重置`（校验重置后从本地文件回读章节正文）。
  - 兼容影响：无旧书源兼容性破坏；本序号仅收敛 `menu_reset` 的重置来源与失败边界，不改动书源解析、目录加载与正文抓取主链路。
  - 下一项：`seq204`（`content_search.xml / @+id/menu_enable_replace / 替换`）。

## Surprises & Discoveries

- `2026-02-25`：推进 `P6-seq29` 时发现台账存在状态漂移：优先级队列中 `seq29(book_group_manage/menu_add)` 仍为 `pending`，但 `feature-item-tracker` 已记录为 `done`。进一步对照 legado `GroupManageDialog.menu_add -> GroupEditDialog` 后确认当前 Flutter 仅覆盖“分组名称”输入，`cover/bookSort/enableRefresh` 字段语义缺口仍在。已在本次实现中补齐结构化编辑态，并同步修正队列状态，避免“证据完成但语义未闭环”的伪一致。
- `2026-02-23`：分页渲染链路里标题使用 `TextPainter.layout(maxWidth: width)` 时，单行标题会退化为“按文本本身宽度布局”，导致 `TextAlign.center` 在画布路径视觉上接近左对齐；且标题命中计算若不复用同一段宽，会出现点击坐标与字符位置偏移。已收敛为统一固定段宽 painter，避免“设置值已切换但视觉无变化”的伪一致。
- `2026-02-23`：推进 `P6-seq171` 时确认差异不止“缺少导出动作”，而是“缺少 `bookmark.xml` 对应承载页入口”。Flutter 侧已有 `book_toc/menu_export_bookmark`（单书导出），若直接复用会把 `AllBookmarkActivity`（全量书签）与 `BookTocActivity`（单书目录）语义混淆，形成伪一致。本次先补“设置 -> 书签 -> 所有书签”承载与全量排序，再落 `menu_export` 单项导出，`menu_export_md` 保持下一序号推进。
- `2026-02-23`：对照 legado `AudioPlayActivity.menu_copy_audio_url -> sendToClip(AudioPlayService.url)` 时确认该入口关键语义是“常驻入口 + 直接复制 + 可空也可复制”。Flutter 当前阅读朗读链路未引入独立 `AudioPlayService.url` 状态，本序号将“当前播放 URL”映射为阅读会话实时章节链接（缺失时回落空字符串复制），并保持用户可见提示口径“已拷贝”同义。
- `2026-02-23`：推进 `P8-seq349` 时确认差异核心不止“缺少 `menu_save` 顶栏按钮”，还包括“提交时序与反馈边界”：legado 是“字段先改草稿，统一保存后关闭”，而 Flutter 旧实现是“字段弹窗即时落盘 + 每次提示已保存”。若仅补一个保存按钮但仍保留即时落盘，会出现“保存按钮形同虚设”的伪一致。本次已收敛为统一提交状态机并补齐失败口径 `保存出错\n<原因>`。
- `2026-02-23`：推进 `P8-seq248` 时确认 legado `deleteDoc -> finally(removeSelection)` 的关键并不是“删除成功后再移除 UI”，而是“删除动作完成后即从当前候选移除所选项”，即使个别文件删除失败也不阻塞列表移除时序。Flutter 侧若按“仅删除成功项才移除”实现，会与 legado 产生状态边界偏差；本序号已按同义时序收敛，并将失败可观测性下沉到异常日志。
- `2026-02-23`：推进 `P8-seq246` 时确认差异不止“菜单缺少 `智能扫描` 入口”，还包括“扫描完成后必须有候选勾选承载，否则会退化成自动全量导入”。若仅补递归扫描并直接写库，会破坏 legado `扫描 -> 选择 -> 添加书架` 状态边界。本次同步收敛为“扫描候选弹层 + 默认全选 + 可取消 + 仅导入勾选项”闭环，并补齐失败明细可观测输出。
- `2026-02-23`：推进 `P8-seq241` 时确认差异不止“菜单缺少 `选择文件夹` 入口”，还包括“目录选择结果需被后续文件选择链路消费”。若只补入口并持久化目录，而不把 `importBookPath` 接入 `pickFiles(initialDirectory)`，用户不会感知到目录记忆，属于伪一致。本次同步收敛为“入口 + 持久化 + 文件选择默认目录复用”闭环，并补齐取消静默/异常可观测边界。
- `2026-02-23`：推进 `P6-seq16` 时确认缺口不止“更多菜单少一个替换净化入口”，还包括“导出链路缺少 `exportUseReplace && bookUseReplaceRule` 组合闸门”。若只补 checkable 入口不联动导出正文，会出现“勾选态可切换但导出内容不变化”的伪一致。本次同步将替换规则应用接入 TXT 与 EPUB 导出正文，避免状态机空转。
- `2026-02-23`：推进 `P6-seq14` 时确认 legado `menu_book_group` 不只是“新增一个分组按钮”，还要求“分组切换后下载/导出范围跟随当前列表”。Flutter 侧若仅做视觉入口而不把过滤结果下沉到当前列表，会出现“分组显示变化但下载/导出仍跑全量”的伪一致。本次将分组过滤前置到页面数据集，确保后续动作默认消费当前分组集合。
- `2026-02-23`：推进 `P6-seq28` 时确认 `menu_download_all` 的差异不止是“多一个长按入口”，还包含“下载起点固定为首章（索引 0）”的执行语义。若仅复用“下载之后章节”入口会导致起点仍落在当前章节，形成伪一致。本次同步把下载任务服务抽象为可配置起点，确保 `menu_download_after` 与 `menu_download_all` 共用状态机但起点分离。
- `2026-02-23`：推进 `P6-seq22` 时确认 legado 的 `menu_export_folder` 是“纯目录配置入口”，不会触发导出任务；若在 Flutter 侧把该动作与“导出所有”绑定，会造成“点击导出文件夹即开始导出”的语义偏差。本次按同义边界收敛为“仅目录选择 + 持久化 + 取消静默返回”，导出仍由 `menu_export_all` 单独触发。
- `2026-02-23`：推进 `P6-seq21` 时发现 Flutter 侧 `menu_parallel_export` 的缺口不仅是“菜单入口缺失”，还包括“导出任务并发度固定单线程”。若只补 checkable 入口而不联动导出并发，会出现“开关可勾选但导出行为不变”的伪一致。本次已同步将导出链路并发度接入 `parallelExportBook`（关闭 `1`、开启 `9`），并保持失败单项不阻断整书导出。
- `2026-02-23`：推进 `P6-seq20` 时发现 Flutter 章节缓存模型只有 `content` 文本字段，没有 legado `BookHelp.getImage` 可直接复用的本地图片缓存路径；若仅补菜单开关会出现“可勾选但无图片产物”的伪一致。为保持用户可见语义，本次在导出链路补齐 `<img src>` 解析与图片写盘，并优先复用书源感知加载器（含 Cookie/请求头）抓取图片，失败按单文件日志记录且不阻断整书 TXT 导出。
- `2026-02-23`：推进 `P6-seq19` 时发现该序号不只是“菜单勾选态持久化”。legado `ExportBookService.getExportData` 会直接使用 `includeTitle = !AppConfig.exportNoChapterName` 控制 TXT 导出正文是否写章节标题；若仅补入口而不联动导出构建，会产生“开关可切但导出内容不变”的语义偏差。本次已同步将 Flutter TXT 导出构建接入同义开关，避免出现伪完成。
- `2026-02-23`：推进 `P6-seq15` 时发现 Flutter 侧缺少 legado `ExportBookService/AppConfig.exportType` 对应导出管线，若在本序号同时补齐 `Epub` 与导出格式设置会跨越 `seq17/24/25` 边界。本次按“一项一处理”先落 `menu_export_all` 基线能力（目录记忆 + 批量 TXT 导出 + 失败日志），并将 `自定义Epub导出章节/导出格式/导出编码` 保留在后续队列单项收敛，避免跨序号并项。
- `2026-02-23`：推进 `P6-seq13` 时发现现有 `widget_test` 仍锚定 `CacheExportPlaceholderView + “缓存/导出（迁移中）”` 文案断言。若直接移除 placeholder 会导致无关序号回归断裂；本次采用“兼容壳 + 新承载页”双层结构（`CacheExportPlaceholderView -> CacheExportView`），在不改测试用例的前提下完成 `menu_download` 迁移并保持验证稳定。
- `2026-02-23`：推进 `P5-seq400` 时再次发现 `feature-item-tracker.csv` 存在序号缺口：优先级队列包含 `seq400(txt_toc_rule_sel/menu_disable_selection)` 且状态为 `pending`，但跟踪台账中缺失对应行，导致“队列顺序”和“逐项证据”无法一一映射。本次已在完成实现后补齐 `seq400` 跟踪行并同步状态，避免后续按序执行断链。
- `2026-02-23`：推进 `P5-seq399` 时再次发现 `feature-item-tracker.csv` 存在序号缺口：优先级队列包含 `seq399(txt_toc_rule_sel/menu_enable_selection)` 且状态为 `pending`，但跟踪台账中缺失对应行，导致“队列顺序”和“逐项证据”无法一一映射。本次已在完成实现后补齐 `seq399` 跟踪行并同步状态，避免后续按序执行断链。
- `2026-02-23`：推进 `P5-seq393` 时发现 `TxtTocRule.copyWith` 与编辑页保存参数组合存在语义偏差：当用户清空“示例”后保存，Flutter 侧会把空输入转为 `null` 并被 `copyWith` 回落为旧值，导致“清空示例”不生效；而 legado `getRuleFromView` 使用 `toString()` 会写回空串。本次已改为按输入框原值（含空串）回写 `example`，消除保存边界偏差。
- `2026-02-23`：推进 `P5-seq387` 时再次发现 `feature-item-tracker.csv` 存在序号缺口：优先级队列包含 `seq387(txt_toc_rule/menu_add)` 且状态为 `pending`，但跟踪台账中缺失对应行，导致“队列顺序”和“逐项证据”无法一一映射。本次已在完成实现后补齐 `seq387` 跟踪行并同步状态，避免后续按序执行断链。
- `2026-02-23`：推进 `P5-seq297` 时再次发现 `feature-item-tracker.csv` 存在序号缺口：优先级队列包含 `seq297(replace_rule_sel/menu_top_sel)` 且状态为 `pending`，但跟踪台账中缺失对应行，导致“队列顺序”和“逐项证据”无法一一映射。本次已在完成实现后补齐 `seq297` 跟踪行并同步状态，避免后续按序执行断链。
- `2026-02-23`：推进 `P5-seq286` 时再次发现 `feature-item-tracker.csv` 存在序号缺口：优先级队列包含 `seq286(replace_rule/menu_group_null)` 且状态为 `pending`，但跟踪台账中缺失对应行，导致“队列顺序”和“逐项证据”无法一一映射。本次已在完成实现后补齐 `seq286` 跟踪行并同步状态，避免后续按序执行断链。
- `2026-02-23`：推进 `P5-seq285` 时发现 `feature-item-tracker.csv` 存在序号缺口：优先级队列包含 `seq285(replace_rule/menu_group_manage)` 且状态为 `pending`，但跟踪台账中缺失对应行，导致“队列顺序”和“逐项证据”无法一一映射。本次已在完成实现后补齐 `seq285` 跟踪行并同步状态，避免后续按序执行断链。
- `2026-02-23`：推进 `P5-seq281` 时发现 `feature-item-tracker.csv` 存在序号缺口：优先级队列包含 `seq281(replace_edit/menu_save)` 且状态为 `pending`，但跟踪台账中缺失对应行，导致“队列顺序”和“逐项证据”无法一一映射。本次已在完成实现后补齐 `seq281` 跟踪行并同步状态，避免后续按序执行断链。
- `2026-02-23`：推进 `P5-seq225` 时发现台账存在记录缺口：优先级队列已包含 `seq225(dict_rule_sel/menu_disable_selection)` 且状态为 `pending`，但 `feature-item-tracker.csv` 中缺失对应行，导致“按序执行”与“逐项证据”无法一一映射。本次已在完成实现后补齐 `seq225` 跟踪行并同步更新优先级状态，消除证据断链风险。
- `2026-02-23`：对照 legado `dict_rule.xml/menu_add + DictRuleActivity.onCompatOptionsItemSelected` 时确认 `seq215` 的关键阻塞点不是“字典规则编辑能力缺失”，而是“管理页顶栏缺少一级新建入口导致空白编辑态不可达”。Flutter 侧此前只能从规则条目进入编辑页（已有规则），无法触发 legado 同义“新建空白规则”路径；本序号据此仅补入口可达性并保持 `menu_save/menu_copy_rule`（`seq221/222`）后置，不跨序号并项。
- `2026-02-23`：对照 legado `TxtTocRuleActivity.initBottomActionBar + txt_toc_rule_sel/menu_export_selection` 时确认 `seq401` 的关键阻塞点不是“生成 JSON 文件能力”，而是“TXT 目录规则页缺少多选承载层导致入口不可达”。Flutter 侧此前已有导入链路但无 `menu_export_selection` 触发路径；本序号据此先补“多选状态 + 批量更多菜单”可达性，再落导出动作本身，并显式保持 `seq399/400`（启用/禁用所选）后置。
- `2026-02-23`：对照 legado `DefaultData.importDefaultTocRules + TxtTocRuleDao.deleteDefault` 时确认 `menu_import_default` 的关键不是“把默认规则追加回列表”，而是“先清理默认规则（`id<0`）再回灌默认资产，并保留用户自定义规则（`id>=0`）”。若直接全量覆盖会误删自定义规则，若直接 merge 全量又会保留已被 legado 设计为应重置的默认项修改；本序号据此收敛为“仅重置默认规则集合”。
- `2026-02-22`：对照 legado `ReplaceRuleActivity.initSelectActionView + replace_rule_sel/menu_export_selection` 时确认该序号的关键阻塞点不是“导出 JSON 能力”，而是“替换规则页缺少多选承载层导致入口不可达”。Flutter 侧已有全量导出能力，但若不先补“多选状态 + 批量更多菜单”，`menu_export_selection` 无法按 legado 路径触发；本序号据此先补可达性，再落导出动作本身，并显式保留 `seq295~298` 后置。
- `2026-02-22`：对照 legado `ReplaceRuleActivity.menu_import_qr -> qrCodeResult.launch -> ImportReplaceRuleDialog(it)` 时确认该项关键不是“新增扫码能力”，而是“扫码入口与既有候选导入状态机复用”：扫码结果必须直达与本地/网络同一候选弹层，且不得污染 `replaceRuleRecordKey` 网络历史。本序号已按该边界收敛为“扫码直达候选 + 取消静默返回 + 不写历史”。
- `2026-02-22`：对照 legado `ReplaceRuleActivity.showImportDialog + ImportReplaceRuleDialog` 时确认 `menu_import_onLine` 的核心并非“可从 URL 拉取 JSON”本身，而是“输入层历史闭环 + 候选导入复用”：仅 `http/https` 输入写入 `replaceRuleRecordKey` 历史，且历史需支持点选回填与删除回写；确认后必须进入与本地导入同一候选状态机（新增/更新/已有，默认仅新增）。若直接“输入后写库”会破坏同义状态流。本序号已按同名键与候选复用完成收敛。
- `2026-02-22`：对照 legado `ReplaceEditActivity.menu_paste_rule -> ReplaceEditViewModel.pasteRule` 时确认该序号的核心不是“具备剪贴板导入能力”，而是“入口层级与状态边界同义”：动作必须位于编辑页“更多”菜单，且成功后仅回填表单、不自动保存。Flutter 侧此前仅在规则列表页提供“从剪贴板导入”并直接写库，虽可导入但语义与 legado 不同；本序号已收敛为编辑页回填链路。
- `2026-02-22`：对照 legado `DictRuleActivity.initSelectActionView + menu_export_selection` 时确认该序号的关键阻塞点不是“文件导出能力”，而是“字典规则页缺少多选承载层导致入口不可达”。Flutter 侧已有文件保存能力，但若不先补“多选状态 + 批量更多菜单”，`menu_export_selection` 无法按 legado 路径触发；本序号据此先补可达性，再落导出动作本身。
- `2026-02-22`：对照 legado `DictRuleEditDialog.menu_paste_rule` 时确认该序号的阻塞点不是“剪贴板解析能力”，而是“编辑承载层缺失导致动作不可达”。Flutter 侧字典规则页此前仅有导入列表，没有 `dict_rule_edit` 对应入口；本序号先补最小编辑承载页，再在该承载页补齐“更多 -> 粘贴规则”回填链路，避免出现“已实现解析但无法触发”的偏航。
- `2026-02-22`：对照 legado `DictRuleActivity.menu_import_qr` 时确认二维码导入的核心是“扫码入口与导入候选复用”，而不是复用网络导入输入层。若把二维码结果走网络导入链路会误写 `dictRuleUrls` 历史，产生跨入口状态污染；本序号已收敛为“扫码结果直达候选弹层且不写历史”。
- `2026-02-22`：对照 legado `DictRuleActivity.showImportDialog` 时确认 `menu_import_onLine` 的核心不是“可从 URL 拉取 JSON”本身，而是“输入层历史状态闭环”：仅 `http/https` 输入写入 `dictRuleUrls`，且历史可点选回填、删除后立即持久化。若只做 URL 输入不补历史回写/删除，会丢失 legado 同义状态流。本序号已按同名键补齐历史闭环。
- `2026-02-22`：对照 legado `DictRuleActivity.menu_import_local` 时确认本序号阻塞点并非“导入解析能力”，而是“字典规则管理入口缺失导致动作不可达”。Flutter 侧虽已有 `DictRuleStore` 查询链路，但无对应管理页与导入菜单；本序号先补齐“替换净化 -> 字典规则 -> 更多 -> 本地导入”入口，再落候选导入闭环，避免出现“实现了导入逻辑但无法触发”的偏航。
- `2026-02-22`：对照 legado `BookSourceEditActivity.menu_paste_source -> BookSourceEditViewModel.pasteSource/importSource` 时确认该项关键并非“能从剪贴板导入”，而是“成功后仅回填表单且不更新保存基线”。Flutter 端此前在粘贴成功后同步更新 `_savedSource/_savedSnapshot`，会让“粘贴后未保存退出确认”失效；本序号据此收敛为“静默回填、基线不前移”。
- `2026-02-22`：对照 legado `BookSourceEditActivity.menu_clear_cookie -> BookSourceEditViewModel.clearCookie -> CookieStore.removeCookie` 时确认该项关键并非“尽量给出清理反馈”，而是“入口文案同义 + 点击后静默清理 + 不触发保存/跳转”。Flutter 端此前“清 Cookie”入口与多分支提示属于扩展语义，本序号据此收敛为“清除 Cookie + 按域作用域静默清理”。
- `2026-02-22`：对照 legado `BookSourceEditActivity.menu_debug_source -> viewModel.save -> BookSourceDebugActivity(key=bookSourceUrl)` 时确认该项关键不是“能打开调试页”本身，而是“先保存再调试 + 失败不跳转 + 入口文案同义”。Flutter 端主链路已具备，缺口集中在顶栏文案与迁移证据回填，本序号据此收敛为“仅调整入口文案为调试源并补齐台账”。
- `2026-02-22`：对照 legado `ChangeBookSourceDialog.editSourceResult` 与 `ChangeChapterSourceDialog.editSourceResult` 时确认 `menu_edit_source` 的返回刷新边界并不一致：整书换源仅重搜编辑源（`startSearch(origin)`），单章换源重搜全量候选（`startSearch()`）。若统一为单一刷新策略，会偏离其中一条链路的状态流。本序号据此在 Flutter 侧按入口分流刷新语义。
- `2026-02-22`：对照 legado `change_source_item.xml + ChangeBookSourceAdapter/ChangeChapterSourceAdapter.showMenu` 时确认 `menu_top_source` 的迁移关键是“候选条目长按菜单承载”而非顶栏入口；若仅在弹层顶栏补“置顶”按钮会偏离 legacy 的条目级触发热区。本序号据此在候选条目层补齐长按动作并保持静默执行。
- `2026-02-22`：对照 legado `change_source.xml/menu_close + ChangeBookSourceDialog.onMenuItemClick` 时确认该项的迁移关键是“固定文案‘关闭’ + 纯 dismiss 动作”，而不是新增任何关闭副作用；Flutter 侧功能链路已具备关闭能力，本序号主要补齐用户可见文案同义证据。
- `2026-02-22`：对照 legado `ChangeBookSourceViewModel.search/loadBookInfo` 时确认 `menu_load_info` 的真实边界不是“单独展示一个开关”，而是“候选补水总闸门”的一部分：当 `loadInfo/loadToc/loadWordCount` 任一开启时都需进入详情补水链路；若仅在 `loadToc/loadWordCount` 打开时补水，会导致“仅加载详情页”场景失效。本序号据此将候选抓取条件收敛为三开关并集。
- `2026-02-22`：执行 `P4-seq190` 定向回归时发现 `test/source_switch_candidate_sheet_test.dart` 仍沿用“筛选输入框默认展开”的旧断言（直接 `enterText`），而当前 `menu_screen` 语义已是“顶栏动作位触发展开”；该失败属于既有测试口径未跟随 `seq185` 收敛更新，不影响本序号功能链路判定。本次验证改以 `simple_reader_view_compile_test + reader_source_switch_helper_test + 手工路径` 作为可复现证据。
- `2026-02-22`：对照 legado `ChangeBookSourceDialog/ChangeChapterSourceDialog.menu_start_stop` 时确认该项的关键不是“把按钮文案改成停止”，而是“同入口 start/stop 状态机 + 可取消请求链路”的组合语义：运行中点击同入口必须能中断正在进行的搜索任务，并在任务回收后回落到刷新态；若只切换 UI 文案而请求层不可取消，会产生明显行为偏差。
- `2026-02-22`：对照 legado `ChangeBookSourceDialog/ChangeChapterSourceDialog.menu_screen` 时确认该项的关键不是“是否存在筛选算法”，而是“筛选入口承载层级 + 展开/收起状态机”：筛选必须由顶栏动作位触发，展开后标题区让位，关闭后恢复标题区；若仅保留内容区常驻输入框，即使过滤字段一致也会缺失 `menu_screen` 迁移证据。
- `2026-02-22`：对照 legado `BookSourceActivity.menu_check_selected_interval -> BookSourceAdapter.checkSelectedInterval` 时确认本序号核心是“当前列表区间补选”而非数据写入动作：仅依据已选项在当前列表中的最小/最大索引扩展选中区间并刷新计数，不涉及数据库更新与提示反馈。Flutter 端对应行为已具备，缺口在于该序号尚未完成台账与 ExecPlan 验收证据回填。
- `2026-02-22`：对照 legado `BookSourceActivity.menu_remove_group -> selectionRemoveFromGroups -> BookSourceViewModel.selectionRemoveFromGroups` 时确认该项是“固定文案 + 静默批量移除”语义：菜单文案与弹窗标题均为“移除分组”，确认后仅按选中集合执行 `removeGroup(groups)` 并批量写库，不追加“未选择/移除成功”提示。Flutter 端此前两条提示分支已在 `P4-seq153` 收敛。
- `2026-02-22`：对照 legado `BookSourceActivity.menu_add_group -> selectionAddToGroups` 时确认该项是“固定文案 + 静默批量写入”语义：菜单文案与弹窗标题均为“添加分组”，确认后仅调用 `selectionAddToGroups(adapter.selection, group)` 批量写库，不追加“未选择/成功”提示。Flutter 端此前多出的提示分支已在 `P4-seq152` 收敛。
- `2026-02-22`：对照 legado `BookSourceActivity.menu_enable_selection -> BookSourceViewModel.enableSelection` 时确认该项是“静默批量状态写入”语义：动作仅批量写 `enabled=true`，不追加“已启用 N 条/已全部启用”提示。Flutter 端此前复用通用批量开关方法会追加结果提示，本序号已收敛为静默链路。
- `2026-02-22`：对照 legado `SourcePickerDialog.menu_change_source_delay` 与 `BookshelfManageViewModel.changeSource` 时确认该项并非“仅展示配置入口”，而是“全局秒级整数配置 + 后续换源循环按该值串行延迟”的组合语义。SoupReader 当前尚未迁移书架批量换源流程，本序号将该全局键先接入现有换源候选搜索循环（阅读页与详情页）以保持“配置即生效”的核心边界，同时不提前扩展到未迁移的批量管理流程。
- `2026-02-22`：对照 legado `SourceLoginDialog.menu_show_login_header` 与 `HttpTtsEditDialog.menu_show_login_header` 时确认两者边界不同：前者在有登录头缓存时提供“复制文本”按钮，后者仅只读展示无复制动作。`P4-seq365` 已按前者补齐复制语义，避免错误复用 `P3-seq379` 的只读边界。
- `2026-02-22`：对照 legado `ChangeBookSourceDialog/ChangeChapterSourceDialog.menu_load_toc` 时确认该项是“只切换全局开关 + 勾选态”的纯状态动作，不触发刷新；但该开关会影响后续候选刷新链路是否预加载目录。Flutter 端此前无此入口且候选刷新固定不预加载目录，本序号已补齐入口并将刷新链路改为按开关分支。
- `2026-02-22`：对照 legado `ChangeBookSourceDialog.menu_refresh_list -> ChangeBookSourceViewModel.startRefreshList` 时确认“刷新列表”并非“重新对全部启用书源发起新搜索”，而是“基于当前候选集合逐项刷新并回写列表”；同时 `ChangeChapterSourceDialog` 未处理 `menu_refresh_list`。本序号据此将刷新动作仅接入整书换源候选弹层，避免在单章链路提前引入无效扩展动作。
- `2026-02-22`：对照 legado `HttpTtsEditDialog.menu_paste_source + HttpTtsEditViewModel.importFromClip/importSource` 时确认该动作的关键边界不是“从剪贴板导入并保存”，而是“仅把剪贴板 JSON 回填到编辑表单”：剪贴板为空提示“剪贴板为空”，仅接受 JSON 对象/数组，数组仅取首项，成功后不自动保存也不跳转。本序号已按该边界收敛。
- `2026-02-22`：对照 legado `HttpTtsEditDialog.menu_save` 时确认该动作是“显式保存入口”而非“由其它动作顺带保存”：点击后必须即时持久化并提示“保存成功”，且编辑页保持打开；若仅保留“登录前保存”会丢失独立 `menu_save` 交互语义。本序号已补齐顶栏一级“保存”并保持保存后不退出页面。
- `2026-02-22`：对照 legado `SpeakEngineDialog.menu_add -> HttpTtsEditDialog` 时确认“添加”动作本身不承担保存语义，只负责打开空白编辑承载页；若在入口点击阶段直接写库会偏离 legado 的“由 `menu_save` 提交”状态分层。本序号已先收敛一级入口与“未保存不落库”边界，保存动作留在后续 `seq377` 单项推进。
- `2026-02-22`：对照 legado `FontSelectDialog.menu_default + ChapterProvider.getTypeface` 时确认“默认字体”动作不是“回到预设字体列表首项”，而是“写入系统字体类型（默认/衬线/等宽）并强制清空 `textFont` 自定义路径”；若仅改当前字体索引而不清空自定义路径，会被自定义字体覆盖导致默认字体不生效。本序号已补齐“清空自定义字体 -> 应用系统字体 -> 关闭弹层”闭环。
- `2026-02-22`：推进 `P3-seq209(menu_dict)` 时确认 legado 默认词典规则的 `showRule` 包含 `org.jsoup.Jsoup.parse(result)` 脚本（例如 `select(...).remove().html()`）；Flutter 现有 JS 运行时无法直接执行 Java 互操作脚本。为保持主链路同义，本序号在词典查询层补齐了 jsoup 子集解释（`select/remove/html/text`）并继续复用规则提取链路，保证默认规则可用且不阻断迁移队列。
- `2026-02-22`：对照 legado `content_select_action.xml + TextActionMenu + ReadBookActivity.menu_replace` 时确认 `menu_replace` 的关键前提是“可获得选中文本 `selectedText` 并带入替换编辑页”；当前 Flutter 阅读正文为 `RichText` 分页渲染，缺少选区能力与选区回调，导致该序号无法在不引入基础设施改造的前提下等价复刻。本项已按迁移例外流程标记 `blocked`，等待需求方确认。
- `2026-02-22`：对照 legado `ContentEditDialog.menu_reset -> ContentEditViewModel.initContent(true)` 后确认重置失败边界是“静默保留当前编辑内容”，不弹失败提示；同时本地书重置并非回退当前显示内容，而是回源到本地文件正文。Flutter 端此前“回退当前显示内容 + 重置失败弹窗”会引入语义偏差，本序号已收敛。
- `2026-02-22`：对照 legado `ContentEditDialog.save -> BookHelp.saveText` 时确认 `menu_save` 存在“空正文不落库”的硬边界：`content.isEmpty()` 直接返回且不会覆盖缓存正文。Flutter 端此前无条件覆盖章节内容会把空正文写回缓存并污染阅读结果；本序号已收敛为“仅正文非空才覆盖”。
- `2026-02-22`：对照 legado `ReadRecordActivity` 与 `ReadBook.upReadTime` 后确认 `menu_enable_record` 的核心语义是“全局开关控制阅读记录累计”，而不是“禁用阅读进度保存”。Flutter 端为保持主阅读链路稳定，本序号采用“继续保存章节进度，仅在开关关闭时不刷新 `lastReadTime`”的收敛策略，兼顾开关语义与现有数据模型边界。
- `2026-02-22`：对照 legado `AudioPlayService` 时确认 `audioPlayUseWakeLock` 在服务创建阶段读取一次；因此 `menu_wake_lock` 的同义关键是“全局键落盘 + 菜单勾选反映当前键值”，而不是“即时影响正在播放的会话状态”。Flutter 端本序号已先收敛入口与持久化语义。
- `2026-02-22`：对照 legado `HttpTtsEditDialog.menu_del_login_header` 时确认该动作不是“清空表单中的请求头字段”，而是“按 `id` 映射键 `httpTts:<id>` 删除登录头缓存”；且删除动作本身不触发保存、不弹成功提示。Flutter 端本序号已补齐该独立状态清理语义，避免误把登录头缓存与规则配置字段耦合。
- `2026-02-22`：对照 legado `HttpTtsEditDialog.menu_login` 时确认该动作依赖“编辑表单未保存输入”语义，点击登录必须先按当前输入回写规则再启动登录流程；若直接从列表条目登录会丢失 legado 的“编辑态优先保存”边界。本序号先补齐 `speak_engine_edit` 承载页并把“保存后登录”收敛到同一动作链路。
- `2026-02-22`：对照 legado `SpeakEngineDialog.menu_export` 时确认导出动作不是“生成文本后仅提示成功”，而是“调用系统导出器写出 `httpTts.json` + 成功后展示可复制路径”的完整链路；若缺少路径展示与复制入口，会丢失 legado 的导出可观测反馈。本序号已补齐导出成功路径弹窗与复制路径动作。
- `2026-02-22`：对照 legado `SpeakEngineDialog.menu_import_onLine -> importAlert -> ImportHttpTtsDialog` 时确认“网络导入”不是“仅输入 URL 后直接入库”，而是“URL 输入/历史管理 + 候选预览勾选导入”完整链路；若跳过候选层会破坏与本地导入一致的“新增/更新默认勾选”语义。本序号已补齐输入历史、候选预览与仅导入勾选项闭环。
- `2026-02-22`：对照 legado `SpeakEngineDialog.menu_import_local + ImportHttpTtsDialog` 时确认“本地导入”不是“选文件后直接覆盖导入”，而是“先候选对比（新增/更新/已有）再按勾选项提交”；若跳过候选层会丢失 legado 默认仅勾选新增/更新的状态语义。本序号已补齐候选预览与选择提交闭环。
- `2026-02-22`：对照 legado `DefaultData.importDefaultHttpTTS` 与 `HttpTTSDao.deleteDefault` 时确认 `menu_default` 的真实边界是“仅删除默认规则（`id<0`）并回灌默认资产”，不能清空全量规则；否则会误删用户自定义 HTTP 朗读引擎。
- `2026-02-22`：对照 legado `FontSelectDialog` 时确认 `menu_other` 不是“新增字体入口”，而是“始终可重选字体目录并刷新候选列表”的目录重选动作；Flutter 端此前只有预设字体清单，本序号已补齐目录重选与 `ttf/otf` 列表刷新闭环。
- `2026-02-22`：对照 legado `SearchContentActivity` 时确认 `menu_search_content` 的核心并非“当前章节内查找”，而是“跨章节检索 + 在线仅缓存正文边界 + 跨章节跳转”。Flutter 端此前仅当前章节命中，本序号已收敛。
- `2026-02-22`：对照 legado `book_read_change_source.xml` 时确认 `menu_book_change_source` 的用户可见文案应固定为“整书换源”，不能写成“书籍换源”；同时 `ReadBookActivity` 触发整书换源成功后不提供成功 toast。Flutter 端已将分支文案与成功反馈边界同步收敛。
- `2026-02-22`：对照 legado `ChangeChapterSourceDialog` 时确认 `menu_chapter_change_source` 的核心语义是“手动选章后替换当前章节正文”，不是“按标题自动匹配后立即覆盖”；Flutter 端此前自动匹配会缺失选章交互且附带扩展成功提示，本序号已收敛为“选源 -> 选章 -> 替换当前章正文（成功静默）”。
- `2026-02-22`：对照 legado `AudioPlayActivity` 时确认 `menu_edit_source` 在 `audio_play` 菜单是常驻入口，且刷新边界是“仅编辑保存返回时刷新书源显示（`RESULT_OK`）”；Flutter 端此前播放菜单缺少该入口，本序号已补齐并复用既有“保存返回刷新、取消不刷新”回调语义。
- `2026-02-22`：对照 legado `AudioPlayActivity` 时确认 `menu_login` 的核心边界是“按书源 `loginUrl` 显隐”，而不是“固定展示登录后再提示不可用”；Flutter 端此前“播放”菜单仅有“换源”，本序号已补齐“登录”并收敛到 `loginUrl` 非空才展示。
- `2026-02-22`：对照 legado `AudioPlayActivity` 时确认 `audio_play/menu_change_source` 不是阅读菜单动作，而是音频播放菜单独立入口；Flutter 端此前仅在“朗读长按”保留占位提示，已收敛为“播放菜单 -> 换源”并复用整书换源链路。
- `2026-02-22`：对照 legado `search_view.xml` 时确认 `menu_search` 的核心是“搜索控件自身提交动作”，而非“输入框外再挂一个独立搜索按钮”；Flutter 端此前“输入框 + 独立按钮”会形成扩展入口，本序号已收敛为单一搜索控件内提交。
- `2026-02-22`：对照 legado `EffectiveReplacesDialog` 时确认 `menu_effective_replaces` 的核心不是“进入规则管理”，而是“展示当前章节真实命中的替换规则清单”；并且简繁转换开启时该弹层必须追加“繁简转换”同层级入口。Flutter 端此前直接跳规则总列表会丢失该状态语义，本序号已收敛。
- `2026-02-22`：对照 legado `ReadBookActivity.menu_image_style` 时确认 `SINGLE` 联动只应写入书籍级 `pageAnim=0`，不应修改全局翻页动画设置；Flutter 端此前走全局 `_updateSettings` 会产生跨书籍污染，本序号已收敛为书籍级覆盖。
- `2026-02-22`：对照 legado `EpubFile.getBody` 时确认 `menu_del_h_tag` 的核心不是“把 `h1~h6` 标签删掉”，而是“删除整个 `h1~h6` 节点内容（含标题文本）”；Flutter 端此前仅做去标签会保留标题文字并造成正文重复，本序号已收敛为整段节点移除。
- `2026-02-22`：对照 legado `EpubFile.getContent` 与 `ReadBookActivity.menu_del_ruby_tag` 时确认该功能的同义关键包含两层边界：一是仅移除 `rt/rp` 不移除 `ruby` 包裹标签，二是切换后需走 `refreshContentAll` 的全量清缓存语义。Flutter 端此前分别存在“多删 `ruby` 标签”和“保留当前章内存正文”的偏差，本序号已收敛。
- `2026-02-22`：对照 legado `menu_enable_review` 时确认该项在当前上游代码中属于“结构保留但运行时关闭”状态：`book_read.xml` 默认 `visible=false` 且 `ReadBookActivity` 对应分支已注释。迁移时应避免把该项误当作可见功能实现，正确语义是“保留占位并默认隐藏”。
- `2026-02-22`：对照 legado `menu_re_segment -> ReadBook.loadContent(false)` 时确认该项的关键不仅是开关持久化，还包含“重载后阅读位置保持”语义；Flutter 端若直接 `restoreOffset` 但未先保存当前进度，会在部分场景回到旧位点。本序号已调整为“先保存进度再重载”闭环。
- `2026-02-22`：对照 legado `menu_same_title_removed` 时确认该项勾选态并非“章节配置是否启用”，而是 `curTextChapter.sameTitleRemoved` 的“本章实际移除结果”；且点击动作是按 `!sameTitleRemoved` 翻转章节级开关。Flutter 端已改为同义边界并保留“未移除且已启用”时的提示语义。
- `2026-02-22`：对照 legado `Book.simulatedTotalChapterNum` 时确认追读天数口径并非“起始日到当前日的总天数”，而是 `Period.between(startDate, now).days + 1`（`days` 仅取日期差中的“日”分量）。Flutter 端已按该口径实现 `_legacyPeriodDays`，避免以总天数替代导致可读章节上限漂移。
- `2026-02-22`：对照 legado `menu_enable_replace` 时确认该动作是“checkable 文案 + 即时刷新正文”而非“切换后提示反馈”；Flutter 端已将菜单文案收敛为“替换净化”并移除切换 toast，避免扩展反馈干扰迁移一致性。
- `2026-02-22`：对照 legado `ReadBookViewModel.reverseContent` 时确认该动作是“字符级倒序 + 仅缓存正文 + 缺失静默返回”语义，不包含正文拉取兜底或失败提示；Flutter 端此前“按行倒序 + 提示/兜底拉取”属于扩展行为，本序号已收敛。
- `2026-02-22`：对照 legado `menu_cover_progress -> uploadBookProgress(toast=true)` 时确认该功能是“静默守卫 + 成功固定提示 + 失败日志与提示并存”组合语义：守卫失败（开关关闭/无配置/无网络）不弹提示，上传成功统一“上传成功”，上传异常同时写日志并提示失败。Flutter 端此前存在扩展提示与文案漂移，本序号已收敛。
- `2026-02-22`：对照 legado `menu_get_progress -> syncBookProgress` 时确认该功能的关键是“静默同步 + 条件确认 + 越界不覆盖”：无云端进度与失败场景不弹扩展提示，仅写日志；且仅 `durChapterIndex` 合法时才应用。Flutter 端此前存在扩展 toast 与越界 `clamp` 覆盖，本序号已收敛为同义边界。
- `2026-02-22`：对照 legado `menu_page_anim + ReadStyleDialog` 时确认“翻页动画（本书）”与“样式面板翻页动画”是两层状态机：前者写书籍级覆盖、后者改全局并清书籍覆盖。Flutter 端若只做全局 `pageTurnMode` 会互相污染，本序号已拆分为“本书覆盖键 + 样式面板改全局时清覆盖”双路径。
- `2026-02-22`：对照 legado `ContentEditDialog + ContentEditViewModel` 时确认 `menu_edit_content` 的风险点不在入口缺失，而在“正文抓取异常不能中断编辑链路”；Flutter 端已将 `_resolveCurrentChapterRawContentForMenu` 收敛为“异常记录 + 回退当前内容 + 可观测提示”。
- `2026-02-22`：`P3-seq69` 对照 legado 时确认“添加书签”在阅读菜单和九宫格点击动作都必须走同一“弹窗确认后新增”路径；Flutter 端原“有则删无则加”会把 legado 中不存在的删除分支暴露到一级入口，已统一收敛并补齐按 `chapterPos` 恢复书签跳转进度。
- `2026-02-22`：对照 legado `TocActivity + ChapterListAdapter` 时确认 `menu_load_word_count` 的核心不在“新增字数计算”，而在“全局 checkable 开关 + 目录适配器刷新”；Flutter 端先收敛开关语义与持久化默认值，再在已缓存章节上补齐字数显隐，保证在现有章节模型下尽量等价。
- `2026-02-22`：对照 legado `TocActivity` 时确认 `menu_use_replace` 不是“阅读替换规则开关”的别名，而是“目录展示层开关 + 全局持久化”的独立语义；本序号已将目录标题展示收敛为 `tocUiUseReplace && 书籍启用替换规则` 组合判断，并在目录页点击后即时重算标题。
- `2026-02-22`：对照 legado `TocActivity` 时确认 `menu_split_long_chapter` 的关键不是“可改设置”，而是“目录页 checkable 入口 + 切换后立即重建目录”的组合语义；若只保留详情页入口会造成目录页状态流转缺口。本序号已补齐目录页入口并复用本地 TXT 即时重建链路。
- `2026-02-22`：`P3-seq100` 对照 legado 时确认“禁用书源”核心风险不在开关写库，而在 Flutter `updateSource` 的 upsert 行为会放大弹层快照副作用：若弹层期间书源已被删除，直接用快照写库可能把记录重建；本序号已收敛为按 `bookSourceUrl` 实时回查后再禁用。
- `2026-02-22`：`P3-seq99` 对照 legado 时确认“编辑书源”与“登录/购买”属于同类时序边界：若弹层打开后书源被删除，继续使用弹层快照会偏离 legado 的实时回查语义；本序号已统一改为按 `bookSourceUrl` 回查后再触发编辑。
- `2026-02-22`：`P3-seq98` 对照 legado `String?.isTrue()` 时确认购买动作的“成功判定”不是仅 `true/1/ok`，而是“非空且不属于 `false|no|not|0`”即视为真；Flutter 端已按该口径收敛，避免 `payAction` 返回自定义 truthy 字符串时被误判为失败。
- `2026-02-22`：`P3-seq97` 对照 legado 时确认阅读页“登录”动作与书源管理条目登录存在同类边界风险：若弹层打开后书源状态变化，直接使用快照对象会偏离“按当前书源状态触发”的语义；本序号已统一为按 `bookSourceUrl` 回查后再触发登录链路。
- `2026-02-22`：`P3-seq96` 对照 legado 时确认“刷新全部章节”的高风险点不是运行逻辑缺失，而是缺少 `startIndex=0 + clearFollowing=true` 的独立回归证据；本序号补齐 `ReaderRefreshScopeHelper` 的 `menu_refresh_all` 映射与全量清缓存测试后，已可稳定证明全量刷新边界。
- `2026-02-22`：`P3-seq95` 补证据时发现“刷新之后章节”的核心风险不是实现缺失，而是范围计算与验证证据分散在页面状态类中，难以稳定回归；本序号将范围计算抽离为 `ReaderRefreshScopeHelper` 后，已能稳定证明“从当前章节开始清理后续缓存、前序不受影响”的 legado 边界。
- `2026-02-22`：`P3-seq94` 对照 legado 时确认 `menu_refresh` 与 `menu_refresh_dur` 不是“主动作 + 子菜单”两套独立逻辑，而是同一刷新分支；Flutter 端已将默认刷新动作集中到 `defaultRefreshAction/current`，避免后续序号改动导致触发语义漂移。
- `2026-02-22`：`P2-seq83` 对照 legado 时确认 `menu_update_toc` 在本地书籍并不会被拦截，而是走“本地重载目录”链路；Flutter 端此前将本地书拦截为“不支持检查更新”，本序号已收敛为本地/在线统一可触发目录刷新。
- `2026-02-22`：`P2-seq68` 对照 legado 时确认“设置编码”不是固定选项选择器，而是允许自由输入的 `charset` 文本框；若限制为枚举会丢失 legado 的开放输入语义。本序号已改为输入式对话框并保留建议值展示。
- `2026-02-22`：`P2-seq67` 对照 legado `TxtTocRuleDialog` 时确认 `menu_toc_regex` 的关键边界是“取消不生效、确定统一提交”，不是“点选即生效”；Flutter 端已将阅读页规则选择收敛为确认式弹窗并移除扩展成功提示。
- `2026-02-22`：`P2-seq66` 对照 legado 时确认 `menu_download` 不是“更多菜单中的下载动作”，而是在线阅读顶栏一级 action（`showAsAction=always`）；Flutter 端若保留二级入口会形成层级偏差，因此本序号同步将离线缓存从“阅读操作”菜单移出并收敛到顶栏。
- `2026-02-22`：`P2-seq64` 对照 legado 时确认“换源分支菜单（章节/整书）”在 Android 端挂在 `menu_change_source` 图标长按手势，而不是点击后的二级弹窗；Flutter 端已将默认点击收敛为整书换源，并在顶栏按钮补齐长按分支入口。
- `2026-02-22`：`P2-seq163` 对照 legado `TextFile.getChapterList` 时确认“指定 `tocRegex`”与“自动识别”是两条不同语义：指定规则不应再回退自动分章；Flutter 端已在 `TxtParser` 增加 `tocRuleRegex` 透传，并将“指定规则无匹配”收敛为可观测空目录结果。
- `2026-02-22`：`P2-seq163` 的目录页 widget 回归在 Drift 写库链路上复现了既有阻塞问题（测试环境中目录重建任务无法稳定收敛）；本序号保留“入口与手工路径”证据，并将自动化验证下沉到 parser/refresh/settings 定向测试闭环，运行时逻辑不受影响。
- `2026-02-22`：对照 legado `TocActivity` 时确认 `menu_search` 关键边界不是“有搜索能力即可”，而是“默认折叠 actionView + 失焦自动 iconify”；Flutter 端已按该边界从常驻内联输入收敛为顶栏可折叠搜索入口并补齐定向回归。
- `2026-02-22`：`P2-seq165` 对照 legado 时确认 `menu_reverse_toc` 属于“固定文案的一次性菜单动作”语义，不是页面内常驻按钮或 checkable 子项；Flutter 端已将页面内“倒序”按钮收敛为“更多 -> 反转目录”并补齐菜单触发回归。
- `2026-02-22`：`P2-seq168` 的目录导出回归中，默认 `ReaderBookmarkExportService` 会触发系统文件选择器，widget 环境下不可稳定复现；为保证单项证据可复现，`SearchBookInfoView` 增加了仅测试可选的 `bookmarkExportService` 注入点，默认运行时行为保持不变。
- `2026-02-22`：`P2-seq169` 对照 legado `TocActivity` 时确认 `menu_export_md` 与 `menu_export_bookmark` 属于同一书签菜单组的并列入口，不应复用同一文案或参数；Flutter 端已在目录“更多”菜单补齐独立“导出(MD)”入口，并通过定向回归固化 `.md` 扩展名与 Markdown 导出触发链路。
- `2026-02-21`：历史计划文档体量较大且聚焦阅读器，不适合作为“全量逐项迁移”主执行文档，已改为统一 tracker 驱动。
- `2026-02-21`：对照 legado `TextDialog` 构造逻辑确认 `content` 为空时会按空字符串直接展示，不会追加“暂无源码”提示；`P2-seq137` 已据此移除空源码拦截分支并保持入口可达。
- `2026-02-21`：`P2-seq138` 对照 legado 时确认 `menu_book_src` 与 `menu_search_src` 一样采用 `TextDialog("html", bookSrc)` 直出语义；Flutter 端原“详情源码 + 空内容拦截”属于扩展路径，已在本序号收敛。
- `2026-02-21`：`P2-seq139` 对照 legado 时确认 `menu_toc_src` 同样采用 `TextDialog("html", tocSrc)` 直出语义；Flutter 端原“目录源码 + 空内容拦截”属于扩展路径，已在本序号收敛。
- `2026-02-21`：`P2-seq140` 对照 legado 时确认 `menu_content_src` 与 `menu_search_src/menu_book_src/menu_toc_src` 共享同一 `TextDialog("html", raw)` 直出语义；Flutter 端原“正文源码 + 空内容拦截”属于扩展路径，已在本序号收敛。
- `2026-02-21`：`P2-seq141` 的 `widget test` 若直接依赖组件内部 `SourceExploreKindsService`，无法稳定构造“首次加载失败、刷新后成功”的对照场景；为保证迁移证据可复现，调试页补充了“发现分类加载/清缓存”可注入回调，默认运行路径保持不变。
- `2026-02-21`：`P2-seq142` 对照 legado 时确认调试页帮助并非内置提示，而是 `showHelp("debugHelp")` 文档链路；Flutter 资产目录此前缺少 `debugHelp.md`，已补齐同源文档并切换到统一帮助弹层展示。
- `2026-02-22`：`P2-seq143` 的条目“置顶”链路在 `widget test` 环境中会因 Drift 批量写库出现阻塞，导致“入口触发已命中但持久化断言不稳定”；本序号为 `SourceListView` 增加可选 `moveSourcesHandler` 注入点，仅用于稳定验证 `menu_top` 触发与分流语义，默认运行时行为保持不变。
- `2026-02-22`：`P2-seq144` 对照 legado 时确认“置底”并非简单固定写底序；在反序场景必须走 `topSource` 分流。Flutter 运行链路已同义，当前序号主要补齐“升序/反序分流”的可复现回归证据。
- `2026-02-22`：`P2-seq145` 的边界回归里，若在 action sheet 已打开后立刻删除书源再点击“登录”，会出现列表重绘与弹层生命周期竞争，导致 UI 断言偶发不稳定；本序号保留稳定可复现的两条核心证据（入口显隐 + 登录跳转），并在实现层补齐“按 URL 回查书源”的缺失边界。
- `2026-02-22`：`P2-seq146` 的 widget 回归中，`CupertinoActionSheetAction` 在部分场景会出现命中区域漂移，`tap` 触发不稳定；测试侧改为直接调用 action `onPressed` 以稳定复现菜单触发语义，不影响运行时交互实现。
- `2026-02-22`：`P2-seq147` 对照 legado 时确认 `menu_debug_source` 的关键约束是“菜单点击后直达调试页，不在入口做二次查库拦截”；Flutter 端原 `_openEditor(initialTab:3)` 会因入口前回查导致调试页不可达，已改为按条目快照直达并补齐定向回归。
- `2026-02-22`：`P2-seq148` 对照 legado 字符串时确认删除确认弹窗标题应为 `draw=提醒`，不是“提示”；Flutter 端已将标题收敛为“提醒”并补齐“先移除选中态、取消不恢复、确认后删除”回归证据。
- `2026-02-22`：`P2-seq148` 的删除回归里，`SourceRepository.getSourceByUrl` 会受静态缓存时序影响出现短暂旧值；本序号将确认删除断言改为直接查询 Drift `source_records` 行存在性，以保证验证证据稳定可复现。
- `2026-02-22`：`P2-seq149` 对照 legado 时发现单项“启用发现”若直接调用 `updateSource(copyWith)` 会在 action sheet 打开期间被删除的场景下把书源重新 upsert 回库；本序号改为“先按 URL 回查现存记录再更新”，将边界行为收敛为 legado 的“仅更新已存在记录”语义并补齐删除后不重建回归。
- `2026-02-21`：在 `widget test` 场景下直接调用 `RssSourceRepository.addSource/addSources` 进行写库会出现阻塞；`P1-seq276` 改为内存 `FakeRssSourceRepository` 提供可控分组数据，保证分组菜单回归用例稳定可复现。
- `2026-02-21`：`P2-seq30` 页面级测试中，`testWidgets` 直接执行 Drift 写库会阻塞；改为 `tester.runAsync` 包裹 `BookRepository.addBook` 后恢复稳定，可复用到后续涉及 DB 预置数据的详情页测试。
- `2026-02-21`：`P2-seq31` 对照 legado 时发现当前分享入口存在“二维码预览中间页 + 文本回退分享”扩展语义，需在当前序号内收敛为直接系统分享二维码并对齐失败提示。
- `2026-02-21`：`P2-seq32` 对照 legado 字符串时发现当前详情页上传入口仍保留“上传到远程”扩展文案，且确认弹窗附加远程 URL；需在当前序号内收敛为固定提醒文案与确认路径。
- `2026-02-21`：`P2-seq33` 新增本地刷新测试时，详情页 widget 用例在 `pumpAndSettle` 下会被页面持续动画阻塞；改为 service 层定向单测可稳定复现本地刷新行为并避免假阻塞。
- `2026-02-21`：`P2-seq34` 页面级回归确认了 legado 的边界语义：即使书源配置了 `loginUi`，只要 `loginUrl` 为空，“登录”入口仍应隐藏；该规则已在 Flutter 端固化为可复现测试。
- `2026-02-21`：`P2-seq35` 页面级回归中发现 `BookRepository` 缓存快照存在时序抖动；置顶验证改为直接校验 Drift `book_records` 行字段，确保“写库结果”可稳定复现。
- `2026-02-21`：对照 legado `BaseSource.setVariable/getVariable` 时确认源变量边界语义是“仅 `null` 删除，空字符串保留并可回读”；Flutter 端原先将空串视为删除，已在 `P2-seq36` 收敛。
- `2026-02-21`：对照 legado `Book.putCustomVariable -> RuleDataInterface.putVariable` 时确认书籍变量边界语义与源变量一致：仅 `null` 删除，空字符串保留并可回读；Flutter 端原先将空白字符串视为删除，已在 `P2-seq37` 收敛。
- `2026-02-21`：`P2-seq38` 页面级回归中，若直接用 `MethodChannel('flutter/platform')` 伪造剪贴板会触发 `Message corrupted`；改为 `SystemChannels.platform` 同编解码通道后，剪贴板写入断言恢复稳定。
- `2026-02-21`：`P2-seq39` 对照 legado 时发现目录链接复制仍保留“空值拦截 + 已复制目录链接”扩展语义；已收敛为与 `sendToClip` 同义的“始终复制并统一提示复制完成”。
- `2026-02-21`：`P2-seq40` 对照 legado 时确认“允许更新”必须以 checkable 状态表达，不应把开关状态写进标题文本；Flutter 端已改为固定标题 + 勾选图标，并移除切换成功提示。
- `2026-02-21`：`P2-seq41` 对照 legado 时发现本地 TXT 重解析链路未读取 `splitLongChapter` 设置，导致开关只改 UI 不改解析策略；已在 `TxtParser.reparseFromFile` 与详情/阅读两侧调用链补齐参数透传，并将详情页切换动作改为“保存设置后立即重解析”。
- `2026-02-21`：`P2-seq42` 对照 legado 时确认“删除提醒”属于 checkable 静默开关语义：状态应由勾选态表达，切换不追加成功提示；Flutter 端已收敛为固定标题 + 勾选图标并移除开关提示文案。
- `2026-02-21`：`P2-seq43` 在 widget 场景中触发 `CupertinoActionSheetAction` 的异步清理链路时，需要通过 `tester.runAsync` 驱动数据库异步任务，否则会出现“动作已触发但清理结果未落盘”的假阴性；已固化到定向回归用例。
- `2026-02-21`：`P2-seq44` 对照 legado 时发现详情页“日志”虽已存在入口，但仍沿用“异常日志”页面跳转语义；需收敛为 `menu_log -> AppLogDialog` 弹层，并将空态文案统一到“暂无日志”。
- `2026-02-21`：`P2-seq45` 对照 legado 时发现编辑保存链路存在两处语义漂移：作者空白输入被回退为旧值，以及保存后追加“书籍信息已保存”扩展提示；已在本序号内收敛。
- `2026-02-21`：`P2-seq101` 的页面级测试发现 `RemoteBooksPlaceholderView` 依赖 `ShadTheme` 上下文；定向测试需以 `ShadApp.custom + ShadAppBuilder` 包裹后方可稳定复现刷新行为。
- `2026-02-21`：`P2-seq102` 对照 tracker 后确认 `menu_sort_name/menu_sort_time` 在台账中是独立序号（`seq103/104`）；当前序号仅收敛父级 `menu_sort` 入口与子菜单承载，避免跨序号并项实现。
- `2026-02-21`：`P2-seq103` 对照 legado `AlphanumComparator` 时发现普通字符串排序会把 `b10` 排在 `b2` 前；已按 chunk 比较规则实现 Dart 等价比较，确保名称排序语义一致。
- `2026-02-21`：`P2-seq104` 对照 legado `sortCheck(RemoteBookSort.Default)` 时确认“更新时间排序”并非固定单向排序，而是可重复点击切换升/降序；Flutter 端已补齐该状态机并追加页面级回归用例。
- `2026-02-21`：`P2-seq105` 页面级回归中，配置页返回后需显式触发目录重载才能对齐 legado `onDialogDismiss -> upPath`；已在远程页收敛为“配置页关闭即刷新当前目录”并通过测试固化。
- `2026-02-21`：`P2-seq106` 对照 legado `showHelp("webDavBookHelp")` 时发现 Flutter 资产仅包含 `appHelp.md`；需补齐同源 `webDavBookHelp.md` 后才能完成远程页帮助入口同义迁移。
- `2026-02-21`：`P2-seq107` 的页面级回归需要先清空 `ExceptionLogService` 才能稳定断言“暂无日志”空态；已在远程页定向测试中固化该前置动作。
- `2026-02-21`：`P2-seq108` 对照 legado 时确认“精准搜索”属于 `checkable` 菜单语义，不应以“开启/关闭”值文本承载；Flutter 端已改为勾选态并补齐定向回归。
- `2026-02-21`：`P2-seq109` 定向回归暴露 `SourceListView` 在 Linux/测试环境对 QuickJS 动态库的强依赖；已将 `js_runtime_native` 收敛为惰性初始化并在缺库时降级为空运行时，恢复书源管理入口可测可用。
- `2026-02-21`：`P2-seq110` 对照 legado 时确认当前“搜索范围 quick sheet”属于扩展流程，且将 `menu_search_scope` 变成二级入口；已移除该扩展并恢复“多分组/书源”一级直达语义。
- `2026-02-21`：`P2-seq111` 对照 legado 时确认搜索页“日志”必须是 `AppLogDialog` 弹层语义；Flutter 原实现仍跳转 `ExceptionLogsView` 页面，已收敛为弹层并补齐定向回归。
- `2026-02-21`：`P2-seq112` 对照 legado 时确认 `menu_screen` 的关键不只是“有筛选框”，还包括“入口位于工具栏 action 位且仅书源模式可见”；Flutter 端已将筛选输入迁移到导航栏 trailing 并补齐显隐回归。
- `2026-02-21`：`P2-seq113` 对照 legado 时确认当前排序入口的唯一偏差在父级标题文案（“排序选项” vs “排序”）；本序号仅收敛父级语义与回归证据，排序子项行为继续按 `seq114~121` 串行推进。
- `2026-02-21`：`P2-seq114` 对照 legado 时确认 `menu_sort_desc` 是固定“反序”checkable 项，不是“切换为降序/升序”的动态文案；Flutter 端已收敛为固定文案 + 勾选态并补齐定向回归。
- `2026-02-21`：`P2-seq115` 对照 legado 时确认当前偏差属于“迁移证据缺口”而非实现缺口；已新增“先切换到其它排序再切回手动排序”的定向回归，用例固化 `menu_sort_manual` 单选勾选态语义。
- `2026-02-21`：`P2-seq116` 对照 legado 时确认当前偏差集中在菜单文案（“权重” vs “智能排序”）与证据缺口；已收敛文案并新增“智能排序勾选态保持”定向回归，确保 `menu_sort_auto` 语义可复现。
- `2026-02-21`：`P2-seq117` 对照 legado 时确认偏差集中在菜单文案（“名称” vs “名称排序”）与证据缺口；已收敛文案并新增“名称排序勾选态保持”定向回归，确保 `menu_sort_name` 语义可复现。
- `2026-02-21`：`P2-seq118` 对照 legado 时确认偏差集中在菜单文案（“地址” vs “地址排序”）与证据缺口；已收敛文案并新增“地址排序勾选态保持”定向回归，确保 `menu_sort_url` 语义可复现。
- `2026-02-21`：`P2-seq119` 对照 legado 时确认当前偏差集中在菜单文案（“更新时间” vs “更新时间排序”）与证据缺口；已收敛文案并新增“更新时间排序勾选态 + 反序联动勾选态”定向回归，确保 `menu_sort_time` 语义可复现。
- `2026-02-21`：`P2-seq120` 对照 legado 时确认当前偏差集中在菜单文案（“响应时间” vs “响应时间排序”）与证据缺口；已收敛文案并新增“响应时间排序勾选态保持”定向回归，确保 `menu_sort_respondTime` 语义可复现。
- `2026-02-21`：`P2-seq121` 对照 legado 时确认 `menu_sort_enable` 有两处偏差：菜单文案（“启用状态” vs “是否启用”）与反序边界（Flutter 误将同组名称也反序）；已收敛文案并补齐“是否启用 + 反序同组名称正序”回归，确保 `menu_sort_enable` 语义可复现。
- `2026-02-21`：`P2-seq122` 对照 legado 时确认当前实现缺口主要是入口图标语义（`folder` vs `ic_groups`）和证据缺口（缺少分组入口触发/动态分组筛选用例）；已收敛图标并补齐页面级回归。
- `2026-02-21`：`P2-seq123` 在 widget test 中涉及 `CupertinoActionSheet -> CupertinoPopupSurface -> CupertinoAlertDialog` 三层叠加，点击目标易受底层同名按钮干扰；回归用例改为“分组管理入口/新增弹窗/分组行编辑删除入口可见性”定向断言，保持证据稳定可复现。
- `2026-02-21`：`P2-seq124` 对照 legado 时确认分组菜单筛选项存在“文案与过滤关键字绑定”隐式约束：若文案从“启用”收敛为“已启用”，过滤分支也必须同步识别“已启用”，否则会出现入口文案同义但筛选结果不生效的断层；已同步收敛并补齐定向回归。
- `2026-02-21`：`P2-seq125` 与 `seq124` 共享同一隐式约束：`menu_disabled_group` 文案改为“已禁用”后，过滤分支必须同步识别“已禁用”；否则只改文案会导致筛选语义漂移。已同步收敛并补齐定向回归。
- `2026-02-21`：`P2-seq126` 对照 legado 时确认 `menu_group_login` 同样存在“文案与过滤关键字绑定”隐式约束：若筛选项文案从“需登录”收敛为“需要登录”，过滤分支也必须同步识别“需要登录”，否则会出现入口文案同义但筛选结果不生效。已同步收敛并补齐定向回归。
- `2026-02-21`：`P2-seq127` 与 `seq124~126` 共享同一隐式约束：`menu_group_null` 文案改为“未分组”后，过滤分支必须同步识别“未分组”；否则只改文案会导致筛选语义漂移。已同步收敛并补齐定向回归。
- `2026-02-21`：`P2-seq128` 与 `seq124~127` 共享同一隐式约束：`menu_enabled_explore_group` 文案改为“已启用发现”后，过滤分支必须同步识别“已启用发现”；否则只改文案会导致筛选语义漂移。已同步收敛并补齐定向回归。
- `2026-02-21`：`P2-seq129` 延续 `seq124~128` 的同一隐式约束：`menu_disabled_explore_group` 文案改为“已禁用发现”后，过滤分支必须同步识别“已禁用发现”；否则只改文案会导致筛选语义漂移。已同步收敛并补齐定向回归。
- `2026-02-21`：执行 `flutter test test/source_list_view_sort_action_test.dart` 全量回归时，既有用例“书源管理是否启用反序时同启用状态内名称保持正序”在连续场景偶发找不到 `B-enabled`；同用例以 `--plain-name` 单独重跑可稳定通过。本序号保留定向验证证据，测试稳定性问题待后续独立处理。
- `2026-02-21`：`P2-seq130` 的 widget 回归中，`CupertinoIcons.ellipsis_circle` 存在多实例匹配（导航栏与其它图标节点）；定向用例需限定在 `CupertinoNavigationBar` 作用域内点击，才能稳定触发“更多”菜单。
- `2026-02-21`：`P2-seq131` 对照 legado 时确认“本地导入”语义不仅体现在 `menu_import_local` 菜单项，还体现在异常分支提示口径；若仅修改入口文案而不更新 CORS 降级提示，会出现同一功能域内文案口径不一致。
- `2026-02-21`：`P2-seq132` 对照 legado 时确认“网络导入”语义同时覆盖三个用户可见位置（菜单入口、导入弹层标题、错误提示建议）；只改入口不改弹层/提示会形成同链路文案割裂。
- `2026-02-21`：`P2-seq133` 对照 legado 时确认“二维码导入”链路只要求“扫码结果直接进入导入处理”；Flutter 端原有“扫码 URL 同步写入网络导入历史”属于扩展行为，已移除以避免跨入口状态耦合。
- `2026-02-21`：`P2-seq134` 对照 legado 时确认 `menu_group_sources_by_domain` 的关键约束是“固定标题 + checkable 勾选态”，不是“根据状态切换开/关文案”；Flutter 端已收敛为固定“按域名分组显示”并补齐勾选态回归。
- `2026-02-21`：`P2-seq136` 的 widget 回归如果直接走真实扫码页面，会受到 `mobile_scanner` 插件平台通道影响导致测试不稳定；本序号通过在调试页引入可注入扫码启动器，仅对 `menu_scan` 触发语义做定向断言，保证迁移证据稳定可复现。
- `2026-02-23`：推进 `P6-seq24` 时发现仅补 `menu_export_type` 入口会形成“可切换但导出仍固定 TXT”的伪一致；同时 `epubx.EpubWriter` 对 `EpubPackage.Guide` 存在非空约束（缺失会触发空指针）。本次已同步补齐 `exportType -> 导出分支` 联动，并在 EPUB 构建中显式初始化 `Guide` 以稳定写出。

## Decision Log

- `2026-02-25` 决策 249：`P6-seq29` 采用“入口不变 + 新增态结构化编辑补齐”策略：保留书架“分组管理”弹层右上角 `+` 一级入口，不新增中间跳转；将新增分组从“单输入框”收敛为 legado 同义结构化编辑态，补齐 `groupName/cover/bookSort/enableRefresh` 字段采集。存储层 `BookshelfBookGroupStore.addGroup` 改为承接上述字段并维持 `getUnusedId + maxOrder+1` 规则写入，保证 `menu_add` 入口语义与状态边界同义；编辑/删除与拖拽排序保持后续序号独立推进，不跨序号并项。
- `2026-02-23` 决策 248：正文标题居中问题采用“分页标题统一 painter 固定段宽”策略：不改动 `titleMode` 配置值与菜单结构，仅在 `PagedReaderWidget` 增加 `_buildPageTitlePainter`，统一给标题 `TextPainter` 使用固定 `minWidth/maxWidth` 布局，并复用于画布绘制、标题高度测量、长按命中坐标换算三条路径。该策略与 legado “按可视宽度计算标题居中”的语义一致，且变更面最小、不会影响滚动模式与书源主链路。
- `2026-02-23` 决策 247：`P6-seq171` 采用“先补承载入口可达性 + 单项导出收敛”策略：先在 `SettingsView` 补齐 `书签 -> 所有书签` 入口并新增 `AllBookmarkView` 承载 `bookmark.xml` 语义，再仅实现 `menu_export` 单项 JSON 导出，不提前并入 `menu_export_md`（`seq172`）。为对齐 legado `BookmarkDao.all` 顺序，`BookmarkRepository` 新增 `getAllBookmarksByLegacyOrder`（`bookName/bookAuthor/chapterIndex/chapterPos`）；导出服务新增 `exportAllJson` 并固定文件名 `bookmark-yyMMddHHmmss.json`，失败记 `ExceptionLogService(node=all_bookmark.menu_export)`，取消分支保持静默返回。
- `2026-02-23` 决策 246：`P3-seq7` 采用“入口单项补齐 + 播放 URL 章节链接映射 + 复制可空同义”策略：在 `SimpleReaderView` 的“播放”菜单仅新增 `menu_copy_audio_url` 同义入口，点击后直接执行剪贴板写入并提示“已拷贝”；为对齐 legado `sendToClip(AudioPlayService.url)` 的“可空也可复制”边界，复制值统一取当前阅读会话可解出的章节链接，链接缺失时复制空字符串并保持成功提示。异常分支仅记录 `reader.menu.audio_play.copy_audio_url.failed` 日志，不新增扩展提示；`menu_log`（`seq10`）保持下一序号独立推进。
- `2026-02-23` 决策 245：`P8-seq349` 采用“草稿态编辑 + 顶栏一级保存统一提交”策略：在 `RemoteBooksServerConfigView` 补齐 `menu_save` 同义入口，地址/账号/密码/同步目录改为先写草稿，点击右上角“保存”后统一调用 `SettingsService.saveAppSettings` 持久化并关闭页面；移除逐字段“已保存”提示，失败统一提示 `保存出错\n<原因>` 并停留当前页。`servers/menu_add`（`seq350`）保持下一序号独立推进，不跨序号并项。
- `2026-02-23` 决策 244：`P8-seq248` 采用“候选弹层单项补齐 + 删除后移除所选”策略：在 `BookshelfView._showScanImportSelectionDialog` 的动作区仅新增 `menu_del_selection` 同义“删除”入口；点击后调用 `ImportService.deleteLocalBooksByPaths` 按当前勾选集合执行文件删除，并在动作结束后从当前候选列表移除所选项，不追加成功提示。删除失败仅记录 `bookshelf.import.scan_folder.delete_file.failed` 日志，保持 legacy `deleteDoc -> finally(removeSelection)` 的时序语义；不跨序号并入 `server_config/menu_save`（`seq349`）后续能力。
- `2026-02-23` 决策 243：`P8-seq246` 采用“入口单项补齐 + 候选勾选承载 + 批量导入汇总”策略：在 `BookshelfView` 书架“更多”菜单仅新增 `menu_scan_folder` 同义入口，点击后调用 `ImportService.scanImportDirectory` 基于 `importBookPath` 递归扫描 `txt/epub` 文件；扫描完成弹出候选勾选弹层（默认全选，支持全选/取消全选），确认后仅导入勾选项并回显成功/失败汇总。该策略保持 legado“扫描后再选择导入”状态边界，同时不跨序号并入 `import_book_sel/menu_del_selection`（`seq248`）后续删除动作。
- `2026-02-23` 决策 242：`P8-seq241` 采用“入口单项补齐 + 目录记忆最小闭环”策略：在 `BookshelfView` 书架“更多”菜单仅新增 `menu_select_folder` 同义动作，点击后调用 `ImportService.selectImportDirectory`；成功仅持久化 legacy 同名键 `importBookPath`，取消静默返回，失败提示并记录 `ExceptionLogService`。为避免“仅保存不生效”的伪一致，`importLocalBook/importTxtFile/importEpubFile` 同步接入 `initialDirectory=getSavedImportDirectory()`，实现“先选目录、后选文件”的同义状态流。`menu_scan_folder`（`seq246`）保持下一序号独立推进，不跨序号并项。
- `2026-02-23` 决策 241：`P6-seq16` 采用“入口单项补齐 + 导出链路同源联动”策略：`CacheExportView` 顶栏“更多”菜单仅新增 checkable `menu_enable_replace`，菜单打开回显 `exportUseReplace`，点击只做翻转持久化；导出服务侧新增同名键读取并引入组合闸门 `exportUseReplace && bookUseReplaceRule`，仅在两者同时开启时应用替换净化规则。该策略避免跨序号改动导出格式/编码/目录能力，同时消除“开关可切换但导出无变化”的伪一致。
- `2026-02-23` 决策 240：`P6-seq14` 采用“顶栏入口单项补齐 + 固定组先收敛 + 过滤作用域下沉”策略：`CacheExportView` 顶栏新增 `menu_book_group` 同义动作，菜单固定提供 legado 组序 `全部/本地/音频/网络未分组/本地未分组/更新失败`，并在选择后仅更新当前分组与列表过滤。为避免“仅视觉切组”的伪一致，下载与导出流程继续直接消费当前列表数据，使动作作用域天然随分组切换。考虑到当前 `Book` 模型尚未迁移 `audio/updateError` 类型位，本序号保留这两组入口但回落空列表，并在后续书架类型位迁移序号回补。
- `2026-02-23` 决策 239：`P8-seq229` 采用“更多菜单单项补齐 + 默认规则选择器回填”策略：在 `DirectLinkUploadConfigView` 的“更多”菜单仅新增 `menu_import_default` 同义入口，点击后读取 `DirectLinkUploadConfigService.loadDefaultRules` 并弹出规则选择层；选中规则后仅执行表单回填（`uploadUrl/downloadUrlRule/summary/compress`），不触发保存与关闭。保持 `menu_copy_rule`（`seq227`）后置不并项，确保序号边界清晰。
- `2026-02-23` 决策 238：`P8-seq228` 采用“先补可达承载页 + 粘贴动作单项收敛”策略：在 `OtherSettingsView` 补齐“源设置 -> 直链上传规则”入口并新增 `DirectLinkUploadConfigView` 承载页后，仅实现 `menu_paste_rule`。粘贴逻辑严格对齐 legado：读取剪贴板文本后按单个 `Rule` JSON 对象解析，成功仅回填表单，失败统一提示“剪贴板为空或格式不对”，不自动保存、不跳转页面；`menu_import_default/menu_copy_rule` 保持后续序号独立推进。
- `2026-02-23` 决策 237：`P6-seq28` 采用“长按子菜单单项补齐 + 下载起点参数化复用”策略：在 `CacheExportView` 长按下载弹层仅新增 `menu_download_all` 入口，点击后复用既有下载状态机并走“空闲态确认 -> 从首章到末章缓存 / 运行中即停止”边界；在 `CacheDownloadTaskService` 抽象 `_startDownload` 并新增 `startDownloadAllChapters`（起点固定 `0`），`startDownloadFromCurrentChapter` 保持原始起点逻辑。该策略避免复制下载主链路，同时确保 `menu_download_after` 与 `menu_download_all` 仅在起点语义上差异化，不跨序号并入 `menu_log`（`seq26`）。
- `2026-02-23` 决策 236：`P6-seq27` 采用“长按下载入口单项补齐 + 同源状态机复用”策略：在 `CacheExportView` 顶栏下载按钮仅补齐 `menu_download_after` 长按弹层入口，点击后复用既有 `menu_download` 链路（未运行时确认后按当前章节到末章缓存，运行中点击即停止），不新增并行下载策略与额外提示分支。`menu_download_all`（`seq28`）保持下一序号独立推进，不跨序号并项。
- `2026-02-23` 决策 235：`P6-seq25` 采用“入口单项补齐 + 导出写盘编码联动”策略：在 `CacheExportView` 顶栏“更多”菜单仅新增 `menu_export_charset` 同义入口，菜单标题回显 `导出编码(当前值)`；点击后弹输入式编码对话框（placeholder `charset name`，保留 legacy 编码候选提示）并持久化到同名键 `exportCharset`。为避免“入口可配但导出不生效”的伪一致，`CacheExportTaskService` 的 TXT 写盘链路同步改为按 `exportCharset` 编码输出（`UTF-8/GB2312/GB18030/GBK/Unicode/UTF-16/UTF-16LE/ASCII`），并保持未知编码按失败分支进入既有异常可观测链路。`menu_log`（`seq26`）继续遵循 `detail_later` 后置，不跨序号并项。
- `2026-02-23` 决策 234：`P6-seq24` 采用“入口单项补齐 + 导出主链路同步联动”策略：在 `CacheExportView` 顶栏“更多”菜单仅新增 `menu_export_type` 同义入口，菜单标题回显 `导出格式(当前值)`，点击后提供 `txt/epub` 单选并持久化 `exportType`（索引）。为避免“开关可切但行为不变”的伪一致，`CacheExportTaskService.exportAllToDirectory` 同步按 `exportType` 分支导出：`txt` 维持原链路，`epub` 使用 `epubx.EpubWriter` 生成真实文件。保持导出编码与日志入口不变，不提前并入 `seq25~26`，继续一项一处理。
- `2026-02-23` 决策 233：`P6-seq23` 采用“入口单项补齐 + 命名链路同源回收”策略：在 `CacheExportView` 顶栏“更多”菜单仅新增 `menu_export_file_name` 同义入口，点击后弹输入框并持久化 `bookExportFileName`；导出链路仅补齐 TXT 命名规则解析（变量 `name/author`，兼容 `epubIndex` 占位），规则为空或解析失败统一回退默认名并记录日志。保持导出目录、导出格式、导出编码与日志入口能力不变，不提前并入 `seq24~26`，维持一项一处理。
- `2026-02-23` 决策 232：`P6-seq22` 采用“独立目录配置入口 + 静默边界保持”策略：在 `CacheExportView` 顶栏“更多”菜单仅新增 `menu_export_folder` 同义入口，点击后只打开目录选择并持久化目录，不触发导出任务；取消选择保持静默返回。为补齐失败可观测性，目录持久化异常写入 `ExceptionLogService`。不提前并入 `menu_export_file_name/menu_export_type/menu_export_charset/menu_log`（`seq23~26`）后续能力，保持一项一处理。
- `2026-02-23` 决策 231：`P6-seq21` 采用“顶栏更多单项入口 + checkable 回显 + 导出并发度联动”策略：在 `CacheExportView` 顶栏“更多”菜单仅新增 `menu_parallel_export` 同义入口，菜单打开时读取并回显 `parallelExportBook`，点击后即时翻转并持久化；在 `CacheExportTaskService` 导出链路按开关切换并发度（关闭 `1`、开启 `9`，对齐 legado `AppConst.MAX_THREAD`），用于章节文本组装与章节图片导出任务。保持导出主链路不变，不提前并入 `menu_export_folder/menu_export_file_name/menu_export_type/menu_export_charset`（`seq22~seq25`）后续能力，保持一项一处理。
- `2026-02-23` 决策 230：`P6-seq20` 采用“顶栏更多单项入口 + checkable 回显 + 导出链路联动”策略：在 `CacheExportView` 顶栏“更多”菜单仅新增 `menu_export_pics_file` 同义入口，菜单打开时读取并回显 `exportPictureFile`，点击后即时翻转并持久化；在 `CacheExportTaskService` 的 TXT 导出链路中按开关解析章节 `<img src>` 并导出到 `{书名_作者}/images/{章节}`。图片抓取优先复用书源感知加载器（对齐书源请求头/Cookie 语义），抓取失败按单文件日志记录且不阻断整书 TXT 导出。保持导出主链路不变，不提前并入 `menu_parallel_export/menu_export_folder/menu_export_file_name/menu_export_type/menu_export_charset`（`seq21~seq25`）后续能力，保持一项一处理。
- `2026-02-23` 决策 229：`P6-seq19` 采用“顶栏更多单项入口 + checkable 回显 + 导出正文联动”策略：在 `CacheExportView` 顶栏“更多”菜单仅新增 `menu_export_no_chapter_name` 同义入口，菜单打开时读取并回显 `exportNoChapterName` 当前值，点击后即时翻转并持久化；同时在 `CacheExportTaskService` 的 TXT 导出构建接入同义联动（开启时不写章节标题，关闭时恢复写入）。保持导出主链路不变，不提前并入 `menu_export_pics_file/menu_parallel_export/menu_export_folder/menu_export_file_name/menu_export_type/menu_export_charset`（`seq20~seq25`）后续能力，保持一项一处理。
- `2026-02-23` 决策 228：`P6-seq18` 采用“顶栏更多单项入口 + checkable 回显 + legado 键名持久化”策略：在 `CacheExportView` 顶栏“更多”菜单仅新增 `menu_export_web_dav` 同义入口，菜单打开时读取并回显 `webDavCacheBackup` 当前值，点击后即时翻转并持久化；保持导出主链路不变，不提前并入 `menu_export_no_chapter_name/menu_export_pics_file/menu_parallel_export/menu_export_folder/menu_export_file_name/menu_export_type/menu_export_charset`（`seq19~seq25`）后续能力，保持一项一处理。
- `2026-02-23` 决策 227：`P6-seq17` 采用“顶栏更多单项入口 + checkable 回显 + 同名键持久化”策略：在 `CacheExportView` 顶栏“更多”菜单仅新增 `menu_enable_custom_export` 同义入口，菜单打开时读取并回显 `enableCustomExport` 当前值，点击后即时翻转并持久化；保持导出主链路不变，不提前并入 `menu_export_web_dav/menu_export_no_chapter_name/menu_export_pics_file/menu_parallel_export/menu_export_folder/menu_export_file_name/menu_export_type/menu_export_charset`（`seq18~seq25`）后续能力，保持一项一处理。
- `2026-02-23` 决策 226：`P6-seq15` 采用“顶栏更多单项入口 + 导出目录记忆 + 批量 TXT 导出”策略：在 `CacheExportView` 顶栏仅新增 `更多 -> 导出所有` 入口，对齐 legado `menu_export_all` 层级；触发后优先复用已保存目录，不可写时走目录重选，取消分支静默返回。导出执行按当前列表逐本写出已缓存章节 TXT，并将单书失败写入 `ExceptionLogService` 汇总回显；不提前并入 `menu_enable_custom_export/menu_export_type/menu_export_charset`（`seq17/24/25`）后续能力，保持一项一处理。
- `2026-02-23` 决策 225：`P6-seq13` 采用“真实承载页优先 + 兼容壳保留”策略：新增 `CacheExportView` 承载 `menu_download` 全流程（确认式提交、下载/停止状态机、批量缓存与中断），同时保留 `CacheExportPlaceholderView` 作为路由兼容壳并透传到新页面，避免触发既有回归用例断裂。实现上复用 `BookshelfCatalogUpdateService` 补齐“目录缺失时先拉目录再缓存”的 legado 语义，新增 `CacheDownloadTaskService` 聚合下载任务与取消控制；不提前并入 `menu_export_all/menu_book_group/menu_log`（`seq15+`）后续能力，保持一项一处理。
- `2026-02-23` 决策 224：`P5-seq400` 采用“多选入口单项补齐 + 批量禁用静默写库”策略：在 `TxtTocRuleManageView` 多选“更多”菜单仅新增 `menu_disable_selection`，点击后按当前选中集合调用 `TxtTocRuleStore.disableRulesByIds` 批量写入 `enabled=false` 并刷新列表；全流程不追加成功提示、不跳转页面。为避免重复触发，补充 `_disablingSelection` 忙碌闸门并并入 `_selectionUpdating`，同时保持“启用所选/禁用所选/导出所选”共享同一批量动作忙碌指示；不提前并入 `menu_export_selection`（`seq401`）后续能力，保持一项一处理。
- `2026-02-23` 决策 223：`P5-seq399` 采用“多选入口单项补齐 + 批量启用静默写库”策略：在 `TxtTocRuleManageView` 多选“更多”菜单仅新增 `menu_enable_selection`，点击后按当前选中集合调用 `TxtTocRuleStore.enableRulesByIds` 批量写入 `enabled=true` 并刷新列表；全流程不追加成功提示、不跳转页面。为避免重复触发，新增 `_enablingSelection` 忙碌闸门并并入 `_menuBusy`；不提前并入 `menu_disable_selection`（`seq400`）后续能力，保持一项一处理。
- `2026-02-23` 决策 222：`P5-seq398` 采用“条目删除单项收敛 + legado 时序对齐”策略：在 `TxtTocRuleManageView` 条目更多菜单仅新增 `menu_del` 同义“删除”入口，触发顺序严格对齐 legado `menu_del -> selected.remove(item) -> del(item)`，先移除选中态再弹确认框；确认框文案收敛为“提醒 / 是否确认删除？\n<规则名>”，仅确认后调用 `TxtTocRuleStore.deleteRule` 删库并静默刷新列表，失败只记录 `DeleteTxtTocRuleError` 日志；不提前并入 `menu_enable_selection/menu_disable_selection`（`seq399~400`）后续能力，保持一项一处理。
- `2026-02-23` 决策 221：`P5-seq396` 采用“条目级更多入口最小补齐 + 单项置顶静默写库”策略：在 `TxtTocRuleManageView` 非多选态条目补齐右侧“更多”热区，但动作列表仅新增 `menu_top` 同义“置顶”入口；点击后调用 `TxtTocRuleStore.moveRuleToTop`，按 legado `minOrder - 1` 规则仅重写目标规则 `serialNumber` 并静默刷新列表，不追加成功提示。为避免并发重复触发，新增 `_toppingRule` 忙碌闸门并并入 `_menuBusy`；不提前并入 `menu_bottom/menu_del/menu_enable_selection/menu_disable_selection`（`seq397~400`）后续能力，保持一项一处理。
- `2026-02-23` 决策 220：`P5-seq393` 采用“保存边界同义优先 + 最小修正”策略：保留 `TxtTocRuleEditView` 现有顶栏“保存”入口与校验状态机，仅修正 `example` 写回逻辑为“按输入框原值提交（含空串）”，确保“清空示例后保存”与 legado `toString()` 语义一致；不扩展 `menu_copy_rule`（`seq394`）与条目菜单（`seq396+`）能力，保持一项一处理。
- `2026-02-23` 决策 219：`P5-seq387` 采用“顶栏一级入口补齐 + 编辑保存链路打通 + 校验前置”策略：`TxtTocRuleManageView` 顶栏仅新增 `menu_add` 同义“添加”动作，点击后创建草稿规则并进入编辑页；`TxtTocRuleEditView` 补齐一级“保存”动作，保存前执行 legado 同义校验（名称不能为空、正则可编译），仅校验通过才回传规则。持久化层新增 `TxtTocRuleStore.upsertRule/createDraftRule`，保证“新增/编辑同链路回写 + 列表刷新”收敛；不提前并入 `txt_toc_rule_edit.xml` 其它菜单能力（`seq393+`），保持一项一处理。
- `2026-02-23` 决策 218：`P5-seq298` 采用“多选入口单项补齐 + 静默批量置底 + 顺序保持”策略：`ReplaceRuleListView` 的多选“更多”菜单仅新增 `menu_bottom_sel`，点击后按当前列表中的选中顺序计算置底序列并批量写回 `order`（`maxOrder` 起步，逐项 `maxOrder++`），确保置底后相对顺序不变；全流程不追加成功提示、不跳转页面。为避免重复触发，补充 `_bottomingSelection` 菜单忙碌闸门并并入 `_selectionUpdating`，不提前并入 `txt_toc_rule.xml` 后续序号能力，保持一项一处理。
- `2026-02-23` 决策 217：`P5-seq297` 采用“多选入口单项补齐 + 静默批量置顶 + 顺序保持”策略：`ReplaceRuleListView` 的多选“更多”菜单仅新增 `menu_top_sel`，点击后按当前列表中的选中顺序计算 `minOrder - selectionSize` 起始序列并批量写回 `order`，确保置顶后相对顺序不变；全流程不追加成功提示、不跳转页面。为避免重复触发，补充 `_toppingSelection` 菜单忙碌闸门并并入 `_selectionUpdating`，但不提前并入 `menu_bottom_sel`（`seq298`）后续能力，保持一项一处理。
- `2026-02-23` 决策 216：`P5-seq296` 采用“多选入口单项补齐 + 批量禁用静默写库”策略：`ReplaceRuleListView` 的多选“更多”菜单仅新增 `menu_disable_selection`，点击后按当前选中集合批量写入 `isEnabled=false` 并由流式列表刷新回显；全流程不追加成功提示、不跳转页面。为避免重复触发，补充 `_disablingSelection` 菜单忙碌闸门，并将 `_menuBusy` 统一收敛为 `_selectionUpdating`，但不提前并入 `menu_top_sel/menu_bottom_sel`（`seq297~298`）后续能力，保持一项一处理。
- `2026-02-23` 决策 215：`P5-seq295` 采用“多选入口单项补齐 + 批量启用静默写库”策略：`ReplaceRuleListView` 的多选“更多”菜单仅新增 `menu_enable_selection`，点击后按当前选中集合批量写入 `isEnabled=true` 并由流式列表刷新回显；全流程不追加成功提示、不跳转页面。为避免重复触发，补充 `_enablingSelection` 菜单忙碌闸门，但不提前并入 `menu_disable_selection/menu_top_sel/menu_bottom_sel`（`seq296~298`）后续能力，保持一项一处理。
- `2026-02-23` 决策 214：`P5-seq294` 采用“条目删除单项补齐 + 选中态先清理 + 确认后删库”策略：在替换规则条目“更多”菜单仅新增 `menu_del`，点击后先移除当前条目选中态，再弹出 legado 同义确认框（“提醒 / 是否确认删除？\n<规则名>”）；确认后执行删库并由列表流刷新，取消保持静默不删库；不提前并入 `replace_rule_sel` 批量动作（`seq295~298`），保持一项一处理。
- `2026-02-23` 决策 213：`P5-seq286` 采用“单项语义证据补齐 + no-group 判定口径集中”策略：保留 `ReplaceRuleListView` 既有“分组弹层 -> 未分组”入口，不扩展新交互；将 no-group 关键词抽成统一常量并集中到 `_isNoGroupRule` 判定，明确对齐 legado `flowNoGroup` 的三段边界（`group` 为空/空白/包含“未分组”）。本序号只处理 `menu_group_null`，`menu_add_replace_rule`（`seq287`）继续后续单项推进，不跨序号并项。
- `2026-02-23` 决策 212：`P5-seq285` 采用“分组入口层级补齐优先 + 管理弹层静默变更”策略：`ReplaceRuleListView` 的“分组”动作弹层新增 `menu_group_manage` 同义入口并打开“分组管理”弹层；弹层内仅实现 `添加分组/编辑分组/删除分组` 三个动作。写库语义对齐 legado：`添加分组` 仅作用于 `group` 为空规则；`编辑/删除分组` 按逗号分组集合移除旧组并静默落库，不追加成功提示。`menu_group_null/menu_add_replace_rule`（`seq286/287`）保持后续序号单独处理，不跨序号并项。
- `2026-02-23` 决策 211：`P5-seq284` 采用“入口层级收敛优先 + 分组语义按 legado 拆分/命中”策略：`ReplaceRuleListView` 移除页面内胶囊分组条，补齐顶栏一级 `menu_group` 入口并以下拉动作承载“全部/未分组/动态分组”；动态分组由 `group` 按 `[,;，；]` 拆分去重后按 `cnCompareLikeLegado` 排序。“未分组”筛选按 `group` 为空或包含“未分组”命中，动态分组按 `group.contains` 命中，保持与 legado `flowNoGroup/flowGroupSearch` 同义边界；`menu_group_manage`（`seq285`）保持下一序号单独处理，不跨序号并项。
- `2026-02-23` 决策 210：`P5-seq281` 采用“编辑页内部异步保存 + 失败不退出 + 排序边界补齐”策略：`ReplaceRuleEditView` 的 `menu_save` 改为先构建草稿并执行有效性校验，失败统一提示 `save error, <原因>` 且停留当前页；成功才关闭编辑页。调用方回调改为异步落库，并在 `order == Int.MIN_VALUE` 时按当前最大排序号补 `maxOrder+1`，对齐 legado `ReplaceEditViewModel.save` 语义，不提前并入 `menu_group/menu_group_manage`（`seq284/285`）后续能力。
- `2026-02-23` 决策 209：`P5-seq225` 采用“单项入口独立收敛 + 静默批量禁用”策略：在 `DictRuleManageView` 多选“更多”菜单单独新增 `menu_disable_selection`，点击后仅对当前选中集合批量写入 `enabled=false` 并刷新列表；不追加成功提示、不跳转页面。实现上复用 `DictRuleStore.setEnabledForRuleNames(..., enabled: false)`，不提前并入 `replace_edit/menu_save`（`seq281`）后续能力，保持一项一处理。
- `2026-02-23` 决策 208：`P5-seq221` 采用“编辑页一级保存入口 + 旧名删除后新名写入”策略：在 `DictRuleEditView` 顶栏补齐 `menu_save` 同义动作，点击后仅回传 `name/urlRule/showRule` 表单值；`DictRuleManageView` 接收后调用 `DictRuleStore.saveRule(originalName, newRule)` 执行“删除旧名称规则 -> 插入新规则”，确保改名场景不残留旧规则，并保持 `enabled/sortNumber` 透传，不提前并入 `menu_copy_rule`（`seq222`）与多选启停（`seq224/225`）后续能力。
- `2026-02-23` 决策 207：`P5-seq215` 采用“一级入口先收敛 + 空白编辑态直达”策略：在 `DictRuleManageView` 顶栏补齐 `menu_add` 同义加号动作，点击后仅打开空白 `DictRuleEditView`（`name/urlRule/showRule` 为空），不触发保存、不触发导入，不提前并入 `menu_save/menu_copy_rule`（`seq221/222`）后续能力，保持一项一处理。
- `2026-02-23` 决策 206：`P5-seq401` 采用“先补多选承载可达性 + 导出动作单项收敛”策略：在 `TxtTocRuleManageView` 先补顶栏“多选/完成”和底部“全选/反选/更多”多选承载层，仅落 `menu_export_selection` 单项；导出目标固定为当前选中规则集合，默认文件名 `exportTxtTocRule.json`，取消导出静默返回，成功后弹路径并支持复制。`menu_enable_selection/menu_disable_selection`（`seq399/400`）继续后置，不跨序号并项。
- `2026-02-23` 决策 205：`P5-seq391` 采用“入口单项补齐 + 默认规则集合重置”策略：`TxtTocRuleManageView` 的“更多”菜单仅新增 `menu_import_default` 单项，点击后直接执行默认规则导入，不引入候选弹层与成功提示。`TxtTocRuleStore.importDefaultRules` 写库语义对齐 legado `deleteDefault(id<0) + insert(default)`：先剔除本地默认规则，再导入资产 `assets/source/txtTocRule.json`，保留 `id>=0` 用户自定义规则；`menu_add/menu_help`（`seq395/392`）保持后续序号单独处理，不跨序号并项。
- `2026-02-23` 决策 204：`P5-seq390` 采用“扫码入口单项补齐 + 候选导入链路复用 + 历史隔离”策略：`TxtTocRuleManageView` 的“更多”菜单仅新增 `menu_import_qr` 单项，点击后调用统一扫码服务并将扫码文本直接交给既有“导入 TXT 目录规则”候选弹层；候选状态保持“新增/更新/已有”，默认勾选新增+更新。二维码分支不写 `tocRuleUrl` 历史，避免与 `menu_import_onLine` 输入历史耦合。`menu_import_default`（`seq391`）保持后续序号单独处理，不跨序号并项。
- `2026-02-23` 决策 203：`P5-seq389` 采用“URL 输入层同义优先 + `tocRuleUrl` 历史键复用 + 候选导入链路复用”策略：`TxtTocRuleManageView` 的“更多”菜单仅新增 `menu_import_onLine` 单项，点击后先弹“网络导入”输入层（占位 `url`），历史记录支持点选回填与删除，并按 legado 语义默认注入 `myTxtChapterRule.json` 地址；确认后复用既有“导入 TXT 目录规则”候选弹层完成勾选导入（默认勾选新增+更新）。`menu_import_qr/menu_import_default`（`seq390/391`）保持后续序号单独处理，不跨序号并项。
- `2026-02-22` 决策 202：`P5-seq299` 采用“先补多选承载可达性 + 单项导出收敛”策略：在 `ReplaceRuleListView` 先补顶栏“多选/完成”与底部多选动作栏，仅落 `menu_export_selection` 单项；导出目标固定为当前选中集合，默认文件名 `exportReplaceRule.json`，取消导出静默返回，成功后弹路径并支持复制。`menu_enable_selection/menu_disable_selection/menu_top_sel/menu_bottom_sel`（`seq295~298`）继续后置，不跨序号并项。
- `2026-02-22` 决策 201：`P5-seq290` 采用“扫码入口单项补齐 + 候选导入链路复用”策略：在 `ReplaceRuleListView` 的“更多”菜单仅新增 `menu_import_qr` 动作，点击后拉起扫码并将结果文本直接交给既有“导入替换规则”候选弹层；候选状态继续保持“新增/更新/已有”，默认仅选中新增。二维码导入链路不写入 `replaceRuleRecordKey` 历史，避免与 `menu_import_onLine` 输入历史耦合；`menu_group/menu_group_manage` 保持后续序号单独处理，不跨序号并项。
- `2026-02-22` 决策 200：`P5-seq289` 采用“输入层历史同义优先 + 候选导入链路复用”策略：在 `ReplaceRuleListView` 的“更多”菜单仅收敛 `menu_import_onLine` 单项，点击后先弹“网络导入”输入层并使用 legado 同名历史键 `replaceRuleRecordKey`（支持点选回填与删除）；确认后复用既有“导入替换规则”候选弹层完成勾选导入，候选状态保持“新增/更新/已有”，默认仅选中新增。`menu_import_qr/menu_group` 保持后续序号单独处理，不跨序号并项。
- `2026-02-22` 决策 199：`P5-seq288` 采用“入口文案收敛 + 候选导入闭环”策略：`ReplaceRuleListView` 的本地导入入口由“从文件导入”收敛为“本地导入”，并将导入行为从“解析成功即写库”改为“选档 -> 候选预览 -> 勾选导入”。候选状态严格按 legado `id` 比对规则输出“新增/更新/已有”，默认仅勾选新增；失败口径收敛为 `readTextError:*` / `ImportError:*`，成功后保持静默返回且不追加提示，不提前并入 `menu_import_onLine/menu_import_qr` 后续序号能力。
- `2026-02-22` 决策 198：`P5-seq283` 采用“编辑承载页入口收敛 + 粘贴动作单项闭环”策略：在 `ReplaceRuleEditView` 顶栏补齐“保存 + 更多”双动作，并在“更多”中仅实现 `menu_paste_rule`，不提前并入 `menu_copy_rule` 等后续动作。粘贴解析严格按单个 `ReplaceRule` JSON 对象处理；成功仅回填编辑表单字段并停留当前页，不自动保存、不跳转；失败口径固定“剪贴板为空/格式不对”，保持与 legado `upReplaceView` 边界同义。
- `2026-02-22` 决策 197：`P5-seq226` 采用“多选承载先补可达性 + 导出动作单项收敛”策略：在 `DictRuleManageView` 先补 `多选` 状态栏与批量“更多”菜单，仅落 `menu_export_selection` 单项，默认导出名固定 `exportDictRule.json`，取消导出静默返回，成功后弹路径并提供复制；不提前并入 `menu_enable_selection/menu_disable_selection`（`seq224/225`）后续能力，保持一项一处理。
- `2026-02-22` 决策 196：`P5-seq223` 采用“最小编辑承载页先补可达性 + 粘贴动作单项收敛”策略：新增字典规则编辑承载页但仅实现 `menu_paste_rule`，不提前并入 `menu_save/menu_copy_rule`（`seq221/seq222`）后续能力。粘贴解析严格按单个 `DictRule` JSON 对象处理（非数组）；成功仅回填 `name/urlRule/showRule`，空剪贴板提示“剪贴板没有内容”，其它解析失败统一“格式不对”，全程不保存不跳转，保持与 legado `upRuleView` 同义边界。
- `2026-02-22` 决策 195：`P5-seq218` 采用“扫码入口独立收敛 + 候选导入链路复用”策略：在 `DictRuleManageView` 的“更多”菜单仅新增 `menu_import_qr` 单项，点击后调用统一扫码服务并将结果文本直接交给既有“导入字典规则”候选弹层；候选状态与默认勾选继续沿用“新增/已有 + 默认仅新增”。二维码导入链路不写入 `dictRuleUrls` 历史，避免与 `menu_import_onLine` 的输入历史状态耦合。`menu_import_default/menu_add` 保持后续序号单独处理，不跨序号并项。
- `2026-02-22` 决策 194：`P5-seq217` 采用“输入层历史同义优先 + 候选导入链路复用”策略：在 `DictRuleManageView` 的“更多”菜单仅新增 `menu_import_onLine` 单项，点击后先弹“网络导入”输入层并使用 legado 同名历史键 `dictRuleUrls`（支持回填与删除）；确认后复用既有“导入字典规则”候选弹层完成勾选导入，默认仅选中新增项。`menu_import_qr/menu_import_default/menu_add` 保持后续序号单独处理，不跨序号并项。
- `2026-02-22` 决策 193：`P5-seq216` 采用“入口可达优先 + 候选导入同义闭环”策略：先在 `TextRulesSettingsView` 补齐“字典规则”入口并新增 `DictRuleManageView` 承载页，再在该页“更多”菜单仅实现 `menu_import_local`；本地导入固定 `txt/json` 选档，导入前展示候选并按同名规则标记“新增/已有”，默认仅勾选新增，确认后按 `name` 覆盖写入。`menu_add/menu_import_onLine/menu_import_qr/menu_import_default` 维持后续序号单独推进，不跨序号并项。
- `2026-02-22` 决策 192：`P4-seq371` 采用“专用网页登录页 + 顶栏确认状态机 + 自动 Cookie 回写”策略：新增 `SourceLoginWebViewView` 承载无 `loginUi` 登录分支，顶栏一级动作固定“确认”；点击后设置 checking 并提示“正在打开首页，成功自动返回主界面”，重载首页并在加载完成后自动关闭页面。Cookie 同步改为页面加载开始/结束双时机自动回写，平台桥接补齐 `WebViewCookieBridge.getCookiesForUrl`（iOS+Android）；非 `http/https` 跳转统一走“跳转其它应用”确认外跳。`seq357/seq367` 继续按 `detail_later` 后置，不跨序号并项。
- `2026-02-22` 决策 191：`P4-seq370` 采用“顶栏一级添加 + 草稿弹窗编辑后落库”策略：在 `RuleSubscriptionView` 顶栏补齐 `menu_add` 同义入口，点击后先按当前列表计算 `customOrder=max+1` 生成草稿，再进入“规则订阅”编辑弹窗收集 `type/name/url`。确认时执行 URL 重复校验（命中重复且非同 id 则提示“此 URL 已订阅(名称)”并中断），未重复才写入存储；不提前并入条目点击导入与编辑图标等非本序号能力，保持一项一处理。
- `2026-02-22` 决策 190：`P4-seq364` 采用“登录表单确认链路同义优先”策略：`SourceLoginFormView` 的 `menu_ok` 提交从“过滤空值 + 展示脚本回执文案”收敛为“按 `text/password` 全量键值提交（含空字符串）-> 先写 `userInfo_<sourceKey>` -> 执行登录脚本 -> 成功固定提示‘成功’并关闭”；失败统一口径“登录出错\n<原因>”并写入异常日志。`menu_log`（`seq367`）保持后续序号单独处理，避免跨序号并项。
- `2026-02-22` 决策 189：`P4-seq362` 采用“入口文案收敛 + 文本分享静默化”策略：`SourceEditLegacyView.menu_share_str` 由“分享文本 + 成功提示 + 动态 subject”收敛为“字符串分享 + 固定 `subject=分享` + 全程静默”；点击后仅执行当前编辑态 `getSource()` JSON 的系统文本分享，不触发保存/跳转；分享异常显式吞并不提示。`menu_ok`（`seq364`）保持待下一序号单独处理，避免跨序号并项。
- `2026-02-22` 决策 188：`P4-seq361` 采用“入口文案收敛 + 直出二维码图片分享 + 无 fallback”策略：`SourceEditLegacyView.menu_share_qr` 由“进入中间承载页二次分享”收敛为“直接对当前编辑态 `getSource()` JSON 生成二维码并拉起系统分享”，标题固定“分享书源”，二维码纠错级别显式对齐 `L`；二维码生成失败统一提示“文字太多，生成二维码失败”，分享异常仅透传错误摘要并回退 `ERROR`，不追加文本分享降级。`menu_share_str`（`seq362`）保持待下一序号单独处理，避免跨序号并项。
- `2026-02-22` 决策 187：`P4-seq359` 采用“保留先保存再弹层主链路，仅收敛扩展提示分支”策略：`SourceEditLegacyView.menu_set_source_variable` 继续复用 `_saveInternal(showSuccessMessage: false)` 成功后打开变量弹层的既有流程；删除非 legado 的“请先填写 bookSourceUrl”分支与“源变量已保存”提示，变量保存后仅写入 `sourceVariable_<bookSourceUrl>` 并保持静默。`menu_share_qr`（`seq361`）保持待下一序号单独处理，避免跨序号并项。
- `2026-02-22` 决策 186：`P4-seq358` 采用“入口文案收敛 + 成功静默回填 + 保存基线不前移”策略：`SourceEditLegacyView` 将 `menu_paste_source` 文案收敛为“粘贴源”；点击后读取剪贴板并导入首个书源，成功时仅执行 `_loadSourceToFields` 回填，不更新 `_savedSource/_currentOriginalUrl/_savedSnapshot`，确保回填后仍保持“未保存修改”确认边界；错误文案按 legado 收敛为“剪贴板为空/格式不对”主口径。`menu_set_source_variable`（`seq359`）保持待下一序号单独处理，避免跨序号并项。
- `2026-02-22` 决策 185：`P4-seq355` 采用“入口文案收敛 + 清理分支静默化”策略：`SourceEditLegacyView` 的 `menu_clear_cookie` 文案统一为 legado 同义“清除 Cookie”，点击后按当前编辑态 `bookSourceUrl` 执行域作用域 Cookie 清理并吞并异常，不追加“URL 无效/清理成功/失败”提示，不触发保存与跳转；不提前并入 `menu_auto_complete`（`seq356`）后续能力，保持一项一处理。
- `2026-02-22` 决策 184：`P4-seq352` 采用“保留先保存再调试主链路，仅收敛入口文案与迁移证据”策略：继续复用现有 `_saveInternal -> SourceDebugLegacyView(source: saved)` 语义（保存成功进入调试，失败停留编辑页），仅将顶栏动作文案从“调试”收敛为 legado 同义“调试源”，并回填 queue/tracker/ExecPlan；不提前并入 `menu_clear_cookie/menu_auto_complete`（`seq355/356`）后续能力，保持一项一处理。
- `2026-02-22` 决策 183：`P4-seq351` 采用“保留既有保存成功即退出主链路，仅收敛失败提示与必填校验文案”策略：`menu_save` 成功路径继续保持“保存成功后关闭编辑页并回传 `sourceUrl`”，不新增成功提示；失败路径改为直接透传错误摘要，不追加“保存失败：”前缀；`name/url` 必填校验文案收敛为 legado 同义“名称和 URL 不能为空”。本序号不提前并入 `menu_debug_source`（`seq352`）后续能力，保持一项一处理。
- `2026-02-22` 决策 182：`P4-seq199` 采用“共享候选弹层补齐删除入口 + 按入口分流确认边界”策略：在 `SourceSwitchCandidateSheet` 长按候选菜单新增“删除源”动作，由阅读页回调执行同义删除链路；整书换源入口开启删除前确认弹窗，单章换源入口保持直接删除。删除实现统一复用“删除书源记录 + 清理 sourceVariable 缓存”规则并保持静默状态流，不提前并入 `source_edit.xml`（`seq351+`）后续能力，保持一项一处理。
- `2026-02-22` 决策 181：`P4-seq198` 采用“条目长按单项补齐 + 静默禁用并移除当前候选”策略：在 `SourceSwitchCandidateSheet` 长按候选菜单新增“禁用源”动作，点击后由阅读页按 `sourceUrl` 回查目标书源并写库 `enabled=false`，随后仅移除当前点击候选；书源缺失场景保持 legado 同义静默边界（仅移除候选，不追加提示）。本序号不提前并入 `menu_delete_source`（`seq199`）能力，保持一项一处理。
- `2026-02-22` 决策 180：`P4-seq197` 采用“条目长按入口补齐 + 编辑返回按入口分流刷新”策略：在 `SourceSwitchCandidateSheet` 长按候选菜单新增“编辑源”动作，点击后复用现有书源编辑承载页并透传 `sourceUrl`。编辑保存返回后，整书换源链路按 legado `startSearch(origin)` 仅回刷目标书源候选，单章换源链路按 legado `startSearch()` 回刷全量候选；取消返回保持列表不变，不追加扩展提示，不提前并入 `menu_disable_source/menu_delete_source`（`seq198/199`）后续能力。
- `2026-02-22` 决策 179：`P4-seq196` 采用“条目长按入口对称补齐 + 单项置底静默写库”策略：在 `SourceSwitchCandidateSheet` 长按候选菜单新增“置底”动作，点击后由阅读页执行 `customOrder=maxOrder+1` 写库并按新序重排当前候选列表；不追加成功提示，不提前并入 `menu_edit_source/menu_disable_source/menu_delete_source`（`seq197~199`）后续能力，保持一项一处理。
- `2026-02-22` 决策 178：`P4-seq195` 采用“条目长按入口优先 + 单项置顶静默写库”策略：在 `SourceSwitchCandidateSheet` 仅新增候选条目长按菜单动作“置顶”，点击后由阅读页执行 `customOrder=minOrder-1` 写库并按新序重排当前候选列表；不追加成功提示，不提前并入 `menu_bottom_source/menu_edit_source/menu_disable_source/menu_delete_source`（`seq196~199`）后续能力，保持一项一处理。
- `2026-02-22` 决策 177：`P4-seq194` 采用“单项文案收敛 + 纯关闭动作保持”策略：将换源候选弹层顶栏关闭动作文案由“取消”收敛为 legado 同义“关闭”，点击继续仅执行 `Navigator.pop/dismiss`；不追加状态写入、提示反馈或搜索副作用，不提前并入 `change_source_item.xml`（`seq195+`）后续条目能力，保持一项一处理。
- `2026-02-22` 决策 176：`P4-seq193` 采用“候选弹层顶栏分组入口 + 全局键同名持久化 + 空结果确认回退”策略：在 `SourceSwitchCandidateSheet` 新增独立“分组”动作，不并入“更多”菜单；分组选项按启用书源动态生成并补齐“全部书源”单选项，选中后写入 legado 同名键 `searchGroup` 并执行“停止当前搜索 -> 按分组重拉候选”。当所选分组无结果时，补齐 legado 同义确认回退弹窗，允许一键切回全部书源；不提前并入 `menu_close`（`seq194`）后续能力，保持一项一处理。
- `2026-02-22` 决策 175：`P4-seq191` 采用“共享候选弹层补齐 checkable 入口 + 候选补水并集闸门”策略：在 `SourceSwitchCandidateSheet` 新增“更多 -> 加载详情页”动作，点击仅翻转并持久化 `changeSourceLoadInfo`；不自动刷新当前候选。候选抓取阶段将补水条件收敛为 `loadInfo || loadToc || loadWordCount`，开启 `menu_load_info` 时仅补齐 `getBookInfo` 并回填最新章节，不提前并入 `menu_group/menu_close`（`seq193/194`）后续能力。
- `2026-02-22` 决策 174：`P4-seq190` 采用“开关持久化优先 + 候选抓取链路按需补水”策略：在共享候选弹层新增 `menu_load_word_count` checkable 入口并持久化到 legado 同名键 `changeSourceLoadWordCount`；当开关关闭时保持现有候选抓取链路不额外请求正文；当开关开启时仅在候选抓取/刷新阶段补齐“详情->目录->当前章正文长度”采集，并按 legado 规则执行“字数加载优先 + 章节号降序 + 字数降序 + 原顺序”排序；不提前并入 `menu_load_info/menu_group/menu_close`（`seq191/193/194`）后续能力。
- `2026-02-22` 决策 173：`P4-seq189` 采用“全候选采集 + 弹层侧作者校验过滤”策略：候选搜索阶段统一按书名采集并保留全部候选，`menu_check_author` 仅控制候选弹层展示过滤（`author.contains(currentAuthor)`），并将状态持久化到 `changeSourceCheckAuthor`；切换动作保持静默，不追加扩展提示，也不并入 `menu_load_word_count/menu_load_info/menu_group/menu_close`（`seq190/191/193/194`）后续能力。
- `2026-02-22` 决策 172：`P4-seq186` 采用“同入口状态机优先 + 取消链路下沉”策略：候选弹层新增独立 `menu_start_stop` 同义动作，空闲态执行“刷新候选搜索”，运行态执行“停止当前搜索”；为保证停止语义可落地，将 `cancelToken` 从阅读页换源流程透传至 `RuleParserEngine.search/getBookInfo/getToc/getContent/_fetch` 请求链路。`menu_refresh_list`（`seq188`）保持“刷新当前候选集合”独立动作，不与 `menu_start_stop` 并项。
- `2026-02-22` 决策 171：`P4-seq185` 采用“入口层级收敛优先”策略：候选弹层仅补齐 `menu_screen` 顶栏动作位与展开/收起状态机（展开隐藏标题区、收起恢复并清空筛选词），筛选算法继续复用既有“书源名/最新章节”实时过滤实现；不提前并入 `menu_start_stop/menu_check_author/menu_load_word_count/menu_load_info/menu_group/menu_close`（`seq186/189/190/191/193/194`）后续能力，保持一项一处理。
- `2026-02-22` 决策 170：`P4-seq161` 采用“行为保持 + 证据补齐”策略：`book_source_sel/menu_check_selected_interval` 运行时代码保持现状，不引入额外写库或提示分支；以 legado `adapter.checkSelectedInterval()` 为准补齐差异清单、逐项对照与手工回归证据，并将队列推进到 `seq185(menu_screen)`，避免跨序号并项。
- `2026-02-22` 决策 169：`P4-seq160` 采用“关键词弹窗同层配置 + 启动静默 + 运行中统一提示”策略：`menu_check_source` 保持多选菜单入口不变，仅收敛三处用户可见语义：1）关键词弹窗标题改为“搜索关键词”，且“校验设置”按钮改为同层打开配置弹窗并保留关键词弹窗；2）开始校验后不再追加“已开始校验（N 条）”扩展提示，进度统一由任务条与列表状态呈现；3）任务运行中重复触发统一提示“已有书源在校验,等完成后再试”。`menu_check_selected_interval`（`seq161`）保持待下一序号单独处理，避免跨序号并项。
- `2026-02-22` 决策 168：`P4-seq159` 采用“入口文案收敛 + 文件分享静默化”策略：仅收敛 `book_source_sel/menu_share_source` 的菜单文案与分享状态流，动作改为“按导出集合规则生成分享文件后直接调用系统分享”；移除“已打开系统分享”提示、失败复制 JSON 兜底与额外 `text/subject` 扩展参数。`menu_check_source`（`seq160`）保持待下一序号单独处理，避免跨序号并项。
- `2026-02-22` 决策 167：`P4-seq157` 采用“单项入口独立收敛 + 静默批量置底”策略：仅将 `book_source_sel/menu_bottom_sel` 从通用 `_batchMoveToTopBottom` 分离为独立 `_batchMoveSelectionToBottom` 动作；点击后按当前选中集合直接执行批量置底写库，不追加成功或兜底提示。`menu_share_source`（`seq159`）保持原实现待下一序号单独处理，避免跨序号并项。
- `2026-02-22` 决策 166：`P4-seq156` 采用“单项入口独立收敛 + 静默批量置顶”策略：仅将 `book_source_sel/menu_top_sel` 从通用 `_batchMoveToTopBottom` 分离为独立 `_batchMoveSelectionToTop` 动作；点击后按当前选中集合直接执行批量置顶写库，不追加成功或兜底提示。`menu_bottom_sel`（`seq157`）保持原实现待下一序号单独处理，避免跨序号并项。
- `2026-02-22` 决策 165：`P4-seq155` 采用“单项入口独立收敛 + 静默批量禁用发现”策略：仅将 `book_source_sel/menu_disable_explore` 从通用 `_batchSetExplore` 分离为独立 `_batchDisableExplore` 动作；点击后按当前选中集合直接写入 `enabledExplore=false`，不筛选已禁用项，不追加成功或兜底提示。`menu_top_sel`（`seq156`）保持待下一序号单独处理，避免跨序号并项。
- `2026-02-22` 决策 164：`P4-seq154` 采用“单项入口独立收敛 + 静默批量启用发现”策略：仅将 `book_source_sel/menu_enable_explore` 从通用 `_batchSetExplore` 分离为独立 `_batchEnableExplore` 动作；点击后按当前选中集合直接写入 `enabledExplore=true`，不筛选已启用项，不追加成功或兜底提示。`menu_disable_explore`（`seq155`）保持原实现待下一序号单独处理，避免跨序号并项。
- `2026-02-22` 决策 163：`P4-seq153` 采用“单项入口收敛 + 静默批量移除分组”策略：仅收敛 `book_source_sel/menu_remove_group` 的动作边界，菜单文案与弹窗标题统一为“移除分组”；确认非空输入后仅按当前选中集合批量移除对应分组并写库，移除“无选中/成功移除”扩展提示。`menu_enable_explore`（`seq154`）保持待下一序号单独处理，避免跨序号并项。
- `2026-02-22` 决策 162：`P4-seq152` 采用“单项入口收敛 + 静默批量追加分组”策略：仅收敛 `book_source_sel/menu_add_group` 的入口文案与动作边界，菜单文案/弹窗标题统一为“添加分组”；确认非空输入后仅按当前选中集合批量追加分组并写库，移除“无选中/成功写入”扩展提示。`menu_remove_group`（`seq153`）保持待下一序号单独处理，避免跨序号并项。
- `2026-02-22` 决策 161：`P4-seq150` 采用“单项入口独立收敛 + 静默批量启用”策略：仅将 `book_source_sel/menu_enable_selection` 从通用 `_batchSetEnabled` 分离为独立 `_batchEnableSelection` 动作，点击后按当前选中集合直接写入 `enabled=true`，不追加成功或兜底提示；`menu_disable_selection`（`seq151`）保持原实现待下一序号单独处理，避免跨序号并项。
- `2026-02-22` 决策 160：`P4-seq368` 采用“共享候选弹层补齐单项入口 + 全局键持久化 + 搜索链路延迟生效”策略：在 `SourceSwitchCandidateSheet` 的“更多”菜单新增 `menu_change_source_delay` 同义入口，使用 `0~9999` 秒滚轮选择并落盘到 `batchChangeSourceDelay`；菜单动作仅更新配置不触发候选刷新。阅读页与详情页换源搜索循环统一读取该键并按秒级串行延迟，保持 legado 的“配置影响后续换源节奏”语义，不提前并入 `seq150~157` 批量多选菜单能力。
- `2026-02-22` 决策 159：`P4-seq366` 采用“登录页单项补齐 + 静默清理”策略：在 `SourceLoginFormView` 的“更多”菜单仅新增 `menu_del_login_header`，点击后执行“删除 `loginHeader_<sourceKey>` + 按书源 URL 作用域清理 Cookie”；清理失败不提示，保持 legado `removeLoginHeader()` 的静默边界。该序号不提前并入 `menu_log`（`seq367`）后续能力，保持一项一处理。
- `2026-02-22` 决策 158：`P4-seq365` 采用“登录承载页单项补齐 + 复制语义按源类型分流”策略：在 `SourceLoginFormView` 顶栏新增“更多”入口，仅补齐 `menu_show_login_header`；点击后按当前书源键读取 `loginHeader_<sourceKey>` 缓存并弹出“登录头”对话框，有缓存时展示原始文本并提供“复制文本”动作，无缓存仅标题。该序号不提前并入 `menu_del_login_header/menu_log` 后续能力，保持一项一处理。
- `2026-02-22` 决策 157：`P4-seq360` 采用“入口文案收敛 + 导入仅回填表单”策略：`SourceEditLegacyView.menu_qr_code_camera` 文案收敛为“二维码导入”，扫码承载标题收敛为“扫描二维码”；扫码成功后仅执行 `upSourceView` 等价回填，不更新 `_savedSource/_savedSnapshot`，不追加成功提示，保持“导入后仍需用户手动保存”的 legado 边界，不提前并入 `menu_show_login_header/menu_del_login_header` 后续序号能力。
- `2026-02-22` 决策 156：`P4-seq354` 采用“入口显式写入 scope 再跳转”策略：`SourceEditLegacyView.menu_search` 保持“先保存再跳转”主链路不变，但将搜索范围写入从 `SearchView.scoped(sourceUrls)` 的页面内隐式推导收敛为入口侧显式 `searchScope=SearchScope.fromSource(saved)`；随后打开常规搜索页。该策略与 legado `BookSourceEditActivity.menu_search -> putExtra(searchScope, SearchScope(source))` 触发语义同义，不提前并入 `menu_qr_code_camera/menu_show_login_header/menu_del_login_header` 后续序号能力。
- `2026-02-22` 决策 155：`P4-seq353` 采用“入口显隐沿用 `loginUrl`，分流判定收敛为 `loginUi` 原始非空”策略：`SourceEditLegacyView.menu_login` 点击后继续复用“先保存再跳转”主链路；登录承载分流从“可解析 loginUi 行”改为“`loginUi` 字符串非空即表单承载”，与 legado `SourceLoginActivity(loginUi.isNullOrEmpty())` 语义同义，不提前并入 `menu_search/menu_clear_cookie` 后续序号能力。
- `2026-02-22` 决策 154：`P4-seq192` 采用“共享候选弹层补齐 checkable 入口 + 刷新链路按开关分支”策略：在 `SourceSwitchCandidateSheet` 新增“更多 -> 加载目录”动作，点击仅翻转并持久化 `changeSourceLoadToc`；不自动刷新当前候选。候选重拉时按开关决定是否执行“搜索后预加载目录并回填最新章节”，目录预加载失败按单源隔离，保持 legado 状态边界。
- `2026-02-22` 决策 153：`P4-seq188` 采用“候选弹层内热刷新 + 当前候选来源范围约束”策略：在 `SourceSwitchCandidateSheet` 新增可选“刷新列表”回调，由阅读页传入“按当前候选来源集合重拉结果”的实现；刷新中禁用“刷新列表/书源管理”动作，刷新失败静默保留当前列表，不提前并入 `menu_load_toc/menu_load_word_count`（后续序号）能力。
- `2026-02-22` 决策 152：`P4-seq187` 采用“共享候选弹层单点补齐 + 路由回调复用”策略：在 `SourceSwitchCandidateSheet` 仅新增可选“书源管理”回调入口，由阅读页传入 `SourceListView` 打开逻辑，同时复用于“整书换源/单章换源”两条路径；保持“点击仅跳转管理页，不提前并入 `menu_refresh_list/menu_load_toc` 后续序号能力”。
- `2026-02-22` 决策 149：`P3-seq377` 采用“顶栏一级保存 + 非阻塞成功反馈”策略：在 `speak_engine_edit` 顶栏新增独立“保存”动作并与“更多”并列；点击仅执行“表单回写持久化 -> 成功提示‘保存成功’”，不触发登录、不关闭页面。登录链路继续保留“先保存再登录”的既有语义，两条路径互不替代。
- `2026-02-22` 决策 148：`P3-seq372` 采用“一级添加入口先收敛 + 保存动作后置”策略：在语音管理页顶栏补齐 `menu_add` 同义入口，点击仅创建空白 HTTP 朗读引擎草稿并打开编辑承载页，不在当前序号执行写库、副作用导入或导出流程；保存闭环严格留在下一序号 `seq377(menu_save)` 单独实现，保持一项一处理。
- `2026-02-22` 决策 146：`P3-seq238` 采用“系统字体动作独立入口 + 清空自定义字体优先”策略：在字体弹层顶部单独补齐 `menu_default` 同义入口，点击后弹出“系统内置字体样式”三选项并映射到当前阅读字体预设；确认后强制执行 `clear custom font path` 再应用系统字体并关闭字体弹层，不提前并入字体目录加载与其它扩展行为，保持按队列串行推进。
- `2026-02-22` 决策 141：`P3-seq207` 采用“选中文本复用既有书签编辑闭环”策略：不新增独立书签存储流程，而是在文本操作菜单补齐 `menu_bookmark` 并复用 `_showBookmarkEditorDialog` 的确认落库语义；`bookText` 预填选中文本，取消不写库，确定后写库并刷新书签状态。当前 `chapterPos` 继续沿用现有阅读器进度编码模型，避免在本序号跨入书签存储结构改造。
- `2026-02-22` 决策 140：`P3-seq205` 采用“词级选区起点 + 文本动作菜单先闭环”策略：在 `PagedReaderWidget` 补齐长按文本提取回调，并在阅读页接入 `menu_replace` 动作；当前先收敛到“长按提取词级 selectedText -> 替换规则编辑”闭环，不提前并入 `menu_bookmark/menu_aloud/menu_dict/menu_browser/menu_share_str` 后续序号逻辑，确保按队列串行推进。
- `2026-02-22` 决策 139：`P3-seq205` 采用“先阻塞、后确认”策略：由于当前 Flutter 阅读器缺失“选中文本菜单”基础设施，无法等价复刻 legado `menu_replace(selectedText -> ReplaceEditActivity)` 语义，先将 ExecPlan 状态标记为 `blocked`；待需求方确认后在两种路径中二选一推进：A 先补选区基础设施再迁移（推荐），B 明确批准临时降级方案并登记例外回补计划。
- `2026-02-22` 决策 127：`P3-seq373` 采用“入口承载补齐 + 默认规则边界同义”策略：先将设置页/源管理页“语音管理”从占位提示收敛为“朗读引擎”管理页，再仅实现 `menu_default` 动作；导入逻辑严格按 `id<0` 删除默认项并从 `assets/source/httpTTS.json` 回灌默认规则，不提前并入 `menu_import_local/menu_import_onLine/menu_export` 后续序号能力。
- `2026-02-22` 决策 126：`P3-seq210` 采用“跨章节检索优先 + 缓存边界同义”策略：全文搜索收敛为跨章节命中列表，命中跳转支持自动切章后定位；在线书仅检索已有缓存正文，本地书检索全章节已加载正文；搜索并发采用任务令牌取消旧请求，避免结果乱序覆盖。
- `2026-02-22` 决策 125：`P3-seq88` 采用“文案同义 + 成功静默”策略：长按“换源”分支菜单 `menu_book_change_source` 文案收敛为“整书换源”，并移除整书换源成功 toast；换源候选匹配、目录落库与正文刷新流程继续复用既有主链路，不跨序号并入 `seq210` 的全文搜索动作。
- `2026-02-22` 决策 124：`P3-seq87` 采用“手动选章同义优先”策略：单章换源从“选源后自动匹配章节”收敛为“选源后手动选择目标章节再替换当前章节正文”，并移除成功 toast 以对齐 legado `ChangeChapterSourceDialog -> replaceContent` 的静默成功边界；整书换源行为保持原链路，留待 `seq88` 单独闭环。
- `2026-02-22` 决策 123：`P3-seq8` 采用“入口补齐 + 回调边界复用”策略：在播放菜单仅新增 `menu_edit_source` 动作，点击后复用现有 `_openSourceEditorFromReader(sourceUrl)` 链路；刷新语义保持“仅保存返回刷新、取消不刷新”，不提前并入 `menu_copy_audio_url/menu_wake_lock/menu_log` 后续序号逻辑，确保按队列串行推进。
- `2026-02-22` 决策：`P3-seq69` 以 legado `ReadBookActivity.addBookmark()` 为准，统一采用“打开书签编辑弹窗并确认后新增”语义，不在该入口保留“已存在即删除”扩展分支；同时在目录书签跳转链路接入 `chapterPos` 进度恢复，确保添加与回跳语义闭环。
- `2026-02-21` 决策 1：执行粒度下沉到单项（seq），避免模块级“完成但漏项”。
- `2026-02-21` 决策 2：执行方式固定串行（不并行），优先稳定推进与可追溯。
- `2026-02-21` 决策 3：基于需求“挨个处理所有功能”，全功能域纳入计划，不再仅限核心链路。
- `2026-02-21` 决策 4：主入口底栏项按 `seq` 串行收敛，`P1-seq257/258` 分别对齐 legado 的 `300ms` 双击触发阈值语义，不跨越到未到序号的业务菜单实现。
- `2026-02-21` 决策 5：主入口底栏文案以 legado 中文业务语义为准，`P1-seq259` 将 `RSS` 明确收敛为“订阅”。
- `2026-02-21` 决策 6：`P1-seq261` 保持书架搜索入口为顶栏一级动作（非折叠菜单项），并以“点击即进搜索页”作为与 legado 的同义标准。
- `2026-02-21` 决策 7：`P1-seq262` 保持“更新目录”在书架更多菜单层级，空数据场景优先提供可观测提示而非静默返回。
- `2026-02-21` 决策 8：`P1-seq263` 菜单文案以 legado 字符串语义为准，将“本机导入”统一为“添加本地”，并保持本地导入触发链路不变。
- `2026-02-21` 决策 9：`P1-seq264` 先收敛入口语义（文案 + 页面导航），远程书籍页内菜单与数据行为保留到后续对应序号逐项迁移，避免跨序号并项。
- `2026-02-21` 决策 10：`P1-seq265` 网址加书链路按 legado 口径优先复刻“`baseUrl` 精确匹配 + `bookUrlPattern` 回退匹配”，并复用现有 `BookAddService` 完成详情与目录入库，避免重复实现数据写入逻辑。
- `2026-02-21` 决策 11：`P1-seq266` 先收敛“入口可达”语义，书架管理页内批量操作（删除/允许更新/批量换源等）保持后续序号分步迁移，不与当前序号并项实现。
- `2026-02-21` 决策 12：`P1-seq267` 按同一策略先收敛“缓存/导出”入口语义（文案 + 页面导航），`CacheActivity` 页内下载/导出/分组/日志菜单保留到 P6 对应序号迁移，避免跨序号并项实现。
- `2026-02-21` 决策 13：`P1-seq268` 对齐 legado 的弹窗层级语义，先将“分组管理”从提示文案收敛为对话框承载入口；分组新增/编辑/排序等复杂行为保留到后续对应序号逐项迁移，避免跨序号并项实现。
- `2026-02-21` 决策 14：`P1-seq269` 采用“入口先完整收敛 + 配置字段同步落盘”的策略：以 `bookshelfLayoutIndex/bookshelfSortIndex` 作为 legado 索引语义主字段，同时回写 `bookshelfViewMode/bookshelfSortMode` 兼容现有页面，避免一次性改动冲击已迁移链路。
- `2026-02-21` 决策 15：`P1-seq270` 维持现有文件保存实现（`FilePicker.saveFile`）不引入中间临时文件，但补齐 legado 同义的成功弹窗路径复制语义与错误文案口径，避免跨序号扩展导出基础设施。
- `2026-02-21` 决策 16：`P1-seq271` 复用现有书单导入执行器（按书名/作者搜索入库）但将入口交互与输入解析严格收敛到 legado 语义（`url/json` 输入 + 选择文件 + `http/https 或 JSON 数组`），避免在同一序号跨入后续批量导入策略重构。
- `2026-02-21` 决策 17：`P1-seq272` 采用“日志入口弹层先收敛”的实现策略，复用既有日志数据服务但将入口触发层级与文案统一到 legado `AppLogDialog` 语义，避免在当前序号引入额外日志管线重构。
- `2026-02-21` 决策 18：`P1-seq273` 将发现页分组入口从通用选单收敛为“动态分组动作列表直达筛选”的 legado 同义语义，并同步收敛分组排序（`cnCompare`）与 `group:` 逗号边界匹配规则，避免出现“入口同义但筛选语义偏差”。
- `2026-02-21` 决策 19：`P1-seq274` 采用“同源资产直读 + 弹层承载”策略，直接引入 legado `appHelp.md` 到 Flutter 资产并由“我的”页顶栏触发，优先保证帮助文档内容与入口语义同义，不在当前序号扩展 Markdown 渲染器替换链路。
- `2026-02-21` 决策 20：`P1-seq275` 先收敛 RSS 顶栏“收藏”入口触发与页面标题语义，并将收藏页内部菜单（分组/删除）保留到 `P7-seq307~309`，避免跨序号并项实现。
- `2026-02-21` 决策 21：`P1-seq276` 将订阅页“分组”入口从通用选项面板收敛为 legado 同义“动态分组菜单”，并移除“全部”扩展项；为保证回归稳定性，新增基于内存仓库的页面级测试用例，不在该序号引入数据库写入链路重构。
- `2026-02-21` 决策 22：`P1-seq277` 不新增业务实现，仅通过补充“设置入口直达订阅源管理页”的定向回归用例闭环证据，以保持 `menu_rss_config -> RssSourceActivity` 入口语义与现有 Flutter 路由实现同义。
- `2026-02-21` 决策 23：`P2-seq30` 在保持现有实现不变的前提下，以“页面级测试 + 手工路径”补齐迁移证据，优先闭环 `menu_edit` 同义性验证，不在该序号提前并入 `menu_share_it/menu_refresh` 等后续动作。
- `2026-02-21` 决策 24：`P2-seq31` 采用“直接系统分享 + 载荷纯对齐”策略：移除详情页分享中间预览页，分享文本固定为 `bookUrl#bookJson` 并仅输出二维码图片；二维码生成失败统一提示“文字太多，生成二维码失败”。
- `2026-02-21` 决策 25：`P2-seq32` 采用“菜单语义先收敛 + 远程标记延续既有映射”的策略：入口文案与 `sure_upload` 弹窗文案严格对齐 legado，同时保留现有 `book_remote_upload_url_map` 作为“已存在远程链接”判定来源，避免在该序号提前重构本地书籍数据模型。
- `2026-02-21` 决策 26：`P2-seq33` 采用“刷新分流同义化”策略：`_triggerRefresh` 在书架内按本地/网络类型分流；本地链路新增 `SearchBookInfoRefreshHelper` 复用 TXT/EPUB 解析能力并回写章节与书籍元数据，网络链路保留既有目录刷新逻辑，避免跨序号改动登录/置顶等后续菜单动作。
- `2026-02-21` 决策 27：`P2-seq34` 采用“实现不扩展、证据先闭环”策略：保持现有登录入口实现不引入额外扩展逻辑，仅补齐 `menu_login` 的可见性与触发分支页面级回归用例，并回填 tracker/计划文档。
- `2026-02-21` 决策 28：`P2-seq35` 采用“触发语义先收敛”策略：移除详情页置顶的前置拦截提示，收敛为 legado 同义“点击即写库”，并新增 helper + 页面级回归用例闭环置顶证据。
- `2026-02-21` 决策 29：`P2-seq36` 采用“边界语义优先收敛”策略：源变量存储对齐 legado `setVariable/getVariable`（空串保留、仅 `null` 删除），并移除保存后的扩展成功提示，确保 `menu_set_source_variable` 仅保留 legado 定义的状态流转与文案语义。
- `2026-02-21` 决策 30：`P2-seq37` 延续变量边界收敛策略：书籍变量存储对齐 legado `putCustomVariable`（空串保留、仅 `null` 删除），并将错误提示与保存后反馈收敛为 legado 同义最小文案，不新增扩展提示链路。
- `2026-02-21` 决策 31：`P2-seq38` 采用“入口语义 + 边界触发同义化”策略：菜单文案收敛为“拷贝书籍 URL”，复制反馈统一为“复制完成”，并按 legado 保留空字符串也执行复制；`menu_copy_toc_url` 保持待下一序号（`P2-seq39`）处理，避免跨序号并项。
- `2026-02-21` 决策 32：`P2-seq39` 采用与 `menu_copy_book_url` 对称的复制策略：菜单文案收敛为“拷贝目录 URL”，复制动作统一走“写入剪贴板 + 复制完成提示”，并移除空值拦截以对齐 legado `sendToClip` 语义。
- `2026-02-21` 决策 33：`P2-seq40` 采用“标题语义固定 + 勾选态表达状态”策略：将 `menu_can_update` 文案收敛为固定“允许更新”，以勾选图标表达开关状态并移除切换成功提示，同时保留“仅书架内持久化”的 legado 边界行为。
- `2026-02-21` 决策 34：`P2-seq41` 采用“解析层参数化 + 详情页即时重解析”策略：为 `TxtParser.reparseFromFile` 增加 `splitLongChapter` 参数并贯穿到 `SearchBookInfoRefreshHelper` 与 `SimpleReaderView`，详情页切换开关后强制触发本地刷新（禁用刷新成功 toast）再统一输出开关提示，确保与 legado “切换即生效”语义同义。
- `2026-02-21` 决策 35：`P2-seq42` 采用与 legado 一致的 checkable 菜单语义：删除提醒标题固定为“删除提醒”并通过勾选态表达状态，切换后不追加“已开启/已关闭”扩展提示；保留现有删除提醒持久化键以避免跨序号改动设置结构。
- `2026-02-21` 决策 36：`P2-seq43` 采用“触发语义统一 + 缓存实体补丁”策略：`menu_clear_cache` 移除书架态前置拦截并统一成功提示为“成功清理缓存”；同时修复 `Chapter.copyWith` 的 `content` 显式置空能力，保证清理缓存后内存态与持久化态同义。
- `2026-02-21` 决策 37：`P2-seq44` 采用“入口不变、触发层级收敛”策略：保留详情页“日志”菜单位置与排序，仅将动作从页面跳转改为 `showAppLogDialog` 弹层，并将日志空态文案统一为“暂无日志”，对齐 legado `menu_log -> AppLogDialog` 语义。
- `2026-02-21` 决策 38：`P2-seq45` 采用“保存语义去扩展”策略：保留编辑页保存入口层级，仅收敛字段提交与反馈口径（作者空白按输入落库、移除成功提示、失败可观测），不在本序号提前扩展 `BookType`/封面文件迁移等非 `menu_save` 核心逻辑。
- `2026-02-21` 决策 39：`P2-seq101` 采用“最小必要链路”策略：先实现 `menu_refresh` 所需的目录重载能力（路径栈、PROPFIND 拉取、失败可观测），排序/服务器配置/帮助/日志菜单严格留待后续 `seq102~107`，避免跨序号并项。
- `2026-02-21` 决策 40：`P2-seq102` 采用“入口先同义、行为后续拆分”策略：本序号仅补齐顶栏排序入口与 `名称排序/更新时间排序` 子菜单承载，具体排序执行逻辑严格留待 `seq103/104` 逐项实现。
- `2026-02-21` 决策 41：`P2-seq103` 采用“名称排序单序号收敛”策略：仅实现 `menu_sort_name` 的状态切换与目录重载，并在 Flutter 端补齐 legado `AlphanumComparator` 等价比较；`menu_sort_time` 保留到 `seq104`，不跨序号并项。
- `2026-02-21` 决策 42：`P2-seq104` 采用“时间排序独立收敛”策略：在不改动 `seq103` 名称排序链路的前提下，仅补齐 `menu_sort_time` 的 `sortCheck(Default)` 状态切换与重载触发，并新增页面级回归验证“首次切换升序 + 再次点击降序”。
- `2026-02-21` 决策 43：`P2-seq105` 采用“入口同层级 + 配置关闭即刷新”策略：在远程书籍页补齐 `menu_server_config` 更多菜单入口，配置承载页复用现有 WebDav 设置字段（地址/账号/密码/目录），并在返回远程页时强制触发目录重载，对齐 legado `onDialogDismiss -> initData -> upPath` 语义。
- `2026-02-21` 决策 44：`P2-seq106` 采用“同源资产直读 + 入口单项收敛”策略：在不提前实现 `menu_log` 的前提下，仅补齐“帮助”动作并直接加载 legado `webDavBookHelp.md` 文档，同时保留加载失败可观测提示，确保序号边界与迁移语义同时满足。
- `2026-02-21` 决策 45：`P2-seq107` 采用“复用通用日志弹层”策略：在远程书籍页仅补齐 `menu_log` 入口并复用现有 `showAppLogDialog`，确保与 legado `AppLogDialog` 触发语义同义，同时避免跨序号改动日志存储管线。
- `2026-02-21` 决策 46：`P2-seq108` 采用“展示层 checkable 收敛 + 触发链统一重提交流程”策略：将“精准搜索”改为勾选态表达，并在切换后统一调用 `_search()` 对齐 legado `setQuery(..., true)` 语义，避免空输入分支与非空分支行为漂移。
- `2026-02-21` 决策 47：`P2-seq109` 采用“入口语义保持 + 运行时惰性降级”策略：`menu_source_manage` 继续直接跳转书源管理页，不引入额外确认流程；针对 Linux/测试环境 QuickJS 缺库场景，将 `createJsRuntime()` 收敛为首次 evaluate 时初始化，失败则降级为空运行时以保证入口稳定可用。
- `2026-02-21` 决策 48：`P2-seq110` 采用“去扩展流程、直达 legacy 入口”策略：搜索设置中的该项固定为“多分组/书源”，点击后直接进入范围选择页；移除 quick sheet 二级跳转与“无书源阻断”扩展分支，保持范围变更后自动重搜边界不变。
- `2026-02-21` 决策 49：`P2-seq111` 采用“统一日志入口承载”策略：搜索设置“日志”动作与书架/详情/远程页保持同一 `showAppLogDialog` 弹层链路，不再跳转 `ExceptionLogsView`，以确保 `menu_log` 在各入口层级语义一致并避免扩展文案偏差。
- `2026-02-21` 决策 50：`P2-seq112` 采用“菜单位同义优先”策略：保留现有筛选算法不变，仅收敛筛选入口承载到导航栏 trailing 并维持“分组隐藏/书源显示”的状态机，以最小改动达成 `menu_screen` 交互层级同义。
- `2026-02-21` 决策 51：`P2-seq113` 采用“父级入口单项收敛”策略：仅修正 `action_sort` 父级标题文案并补齐入口触发回归，不提前并入 `menu_sort_desc/menu_sort_manual/...` 子项行为改动，确保严格按 tracker 序号串行推进。
- `2026-02-21` 决策 52：`P2-seq114` 采用“反序子项单项收敛”策略：仅将排序菜单动态切换文案收敛为固定“反序”checkable 语义并补齐勾选态回归，不提前并入 `menu_sort_manual/menu_sort_auto/...` 排序模式改造，确保严格按 tracker 序号串行推进。
- `2026-02-21` 决策 53：`P2-seq115` 采用“证据闭环优先”策略：保持现有 `menu_sort_manual` 业务实现不扩展，仅新增定向回归固化“从其它排序切回手动排序后手动项独占勾选”的 legado 语义，确保序号边界清晰且可复现。
- `2026-02-21` 决策 54：`P2-seq116` 采用“文案同义先收敛 + 行为不扩展”策略：仅将排序子项展示由“权重”改为“智能排序”并补齐勾选态定向回归，排序比较逻辑继续复用既有 `_SourceSortMode.weight`，避免跨入后续 `seq117+` 子项实现。
- `2026-02-21` 决策 55：`P2-seq117` 采用“文案同义先收敛 + 行为不扩展”策略：仅将排序子项展示由“名称”改为“名称排序”并补齐勾选态定向回归，排序比较逻辑继续复用既有 `_SourceSortMode.name` 与 `cnCompare` 等价比较，避免跨入后续 `seq118+` 子项实现。
- `2026-02-21` 决策 56：`P2-seq118` 采用“文案同义先收敛 + 行为不扩展”策略：仅将排序子项展示由“地址”改为“地址排序”并补齐勾选态定向回归，排序比较逻辑继续复用既有 `_SourceSortMode.url`，避免跨入后续 `seq119+` 子项实现。
- `2026-02-21` 决策 57：`P2-seq119` 采用“文案同义先收敛 + 行为不扩展”策略：仅将排序子项展示由“更新时间”改为“更新时间排序”并补齐勾选态与反序联动定向回归，排序比较逻辑继续复用既有 `_SourceSortMode.update` 与 `_sortAscending` 状态机，避免跨入后续 `seq120+` 子项实现。
- `2026-02-21` 决策 58：`P2-seq120` 采用“文案同义先收敛 + 行为不扩展”策略：仅将排序子项展示由“响应时间”改为“响应时间排序”并补齐勾选态定向回归，排序比较逻辑继续复用既有 `_SourceSortMode.respond`，避免跨入后续 `seq121+` 子项实现。
- `2026-02-21` 决策 59：`P2-seq121` 采用“文案同义 + 边界语义修正”策略：将 `menu_sort_enable` 展示文案收敛为“是否启用”，并单独处理 `enabled` 排序反序逻辑（仅反转启用分组，不反转同组名称），以精确复刻 legado `BookSourceSort.Enable` 的升降序语义。
- `2026-02-21` 决策 60：`P2-seq122` 采用“入口语义最小收敛 + 证据闭环”策略：本序号仅收敛 `menu_group` 顶栏入口图标为分组语义并补齐“入口触发 + 动态 `group:` 筛选”回归，不提前并入 `seq123~129` 的分组子菜单文案/行为改造，保持严格串行。
- `2026-02-21` 决策 61：`P2-seq123` 采用“入口语义 + 弹层层级同义优先”策略：本序号聚焦 `menu_group_manage` 的一级触发路径、弹层文案与操作入口层级收敛；分组筛选子项（`seq124~129`）继续按序列单独推进，不跨序号并项。
- `2026-02-21` 决策 62：`P2-seq124` 采用“单项语义收敛 + 旧词兼容”策略：本序号仅收敛 `menu_enabled_group` 的展示文案与查询词为“已启用”，并在过滤逻辑保留“启用”兼容分支，确保 legacy 同义链路生效且不破坏既有用户输入。
- `2026-02-21` 决策 63：`P2-seq125` 延续“单项语义收敛 + 旧词兼容”策略：本序号仅收敛 `menu_disabled_group` 的展示文案与查询词为“已禁用”，并在过滤逻辑保留“禁用”兼容分支，确保 legacy 同义链路生效且不破坏既有用户输入。
- `2026-02-21` 决策 64：`P2-seq126` 延续“单项语义收敛 + 旧词兼容”策略：本序号仅收敛 `menu_group_login` 的展示文案与查询词为“需要登录”，并在过滤逻辑保留“需登录”兼容分支，确保 legacy 同义链路生效且不破坏既有用户输入。
- `2026-02-21` 决策 65：`P2-seq127` 延续“单项语义收敛 + 旧词兼容”策略：本序号仅收敛 `menu_group_null` 的展示文案与查询词为“未分组”，并在过滤逻辑保留“无分组”兼容分支，确保 legacy 同义链路生效且不破坏既有用户输入。
- `2026-02-21` 决策 66：`P2-seq128` 延续“单项语义收敛 + 旧词兼容”策略：本序号仅收敛 `menu_enabled_explore_group` 的展示文案与查询词为“已启用发现”，并在过滤逻辑保留“启用发现”兼容分支，确保 legacy 同义链路生效且不破坏既有用户输入。
- `2026-02-21` 决策 67：`P2-seq129` 延续“单项语义收敛 + 旧词兼容”策略：本序号仅收敛 `menu_disabled_explore_group` 的展示文案与查询词为“已禁用发现”，并在过滤逻辑保留“禁用发现”兼容分支，确保 legacy 同义链路生效且不破坏既有用户输入。
- `2026-02-21` 决策 68：`P2-seq130` 采用“实现保持 + 证据闭环”策略：保持现有“更多 -> 新建书源 -> 书源编辑页”链路不扩展，仅新增定向回归验证入口触发与默认状态（自动保存Cookie 开启），并回填 tracker/计划文档确保单项可追溯完成。
- `2026-02-21` 决策 69：`P2-seq131` 采用“入口文案同义 + 异常提示口径同源”策略：本序号仅收敛 `menu_import_local` 的菜单文案为“本地导入”并同步修正文案相关提示，不提前并入 `menu_import_onLine/menu_import_qr` 的入口与流程改造，保持严格按序推进。
- `2026-02-21` 决策 70：`P2-seq132` 采用“入口文案 + 弹层文案 + 提示口径”同步收敛策略：本序号仅聚焦 `menu_import_onLine` 的用户可见语义统一，不提前并入 `menu_import_qr` 扫码链路和导入算法重构，保持严格按序推进。
- `2026-02-21` 决策 71：`P2-seq133` 采用“入口文案同义 + 触发链路去扩展”策略：将 `menu_import_qr` 文案收敛为“二维码导入”，并统一扫码结果进入 `importFromText` 解析链路，移除扫码 URL 写入网络导入历史的扩展行为，确保与 legado“扫码结果直达导入处理”语义同义。
- `2026-02-21` 决策 72：`P2-seq134` 采用“固定文案 + 勾选态表达状态”策略：将“按域名分组/关闭按域名分组”动态文案收敛为固定“按域名分组显示”，并以勾选态表达开关状态；保留既有按域名排序与分组头展示逻辑，不扩展持久化配置。
- `2026-02-21` 决策 73：`P2-seq136` 采用“文案同义收敛 + 可测触发注入”策略：扫码入口标题固定收敛为“扫描二维码”，并在 `SourceDebugLegacyView` 增加可注入扫码启动器，仅用于稳定验证 `menu_scan` 触发语义，不改动真实扫码与调试解析主链路。
- `2026-02-21` 决策 74：`P2-seq137` 采用“触发路径同义优先”策略：`menu_search_src` 点击后直接进入源码承载页并将标题收敛为 `html`，源码为空时不追加“暂无搜索源码”扩展提示，以对齐 legado `TextDialog("html", searchSrc)` 的状态流转边界。
- `2026-02-21` 决策 75：`P2-seq138` 采用“同链路对称收敛”策略：`menu_book_src` 点击后与 `menu_search_src` 保持一致，直接打开 `html` 标题源码承载页并移除空源码拦截；仅收敛当前子项，不提前并入 `menu_toc_src/menu_content_src`，确保严格按序推进。
- `2026-02-21` 决策 76：`P2-seq139` 采用“同链路对称收敛”策略：`menu_toc_src` 点击后与 `menu_search_src/menu_book_src` 保持一致，直接打开 `html` 标题源码承载页并移除空源码拦截；仅收敛当前子项，不提前并入 `menu_content_src`，确保严格按序推进。
- `2026-02-21` 决策 77：`P2-seq140` 延续“同链路对称收敛”策略：`menu_content_src` 点击后与 `menu_search_src/menu_book_src/menu_toc_src` 保持一致，直接打开 `html` 标题源码承载页并移除空源码拦截；仅收敛当前子项，不提前并入 `menu_refresh_explore`，确保严格按序推进。
- `2026-02-21` 决策 78：`P2-seq141` 采用“行为不变 + 可测注入最小化”策略：保留 `menu_refresh_explore` 现有用户链路，只新增 `exploreKindsLoader/clearExploreKindsCache` 可选注入回调用于测试；默认仍走 `SourceExploreKindsService`，避免把测试设施扩散到运行时语义。
- `2026-02-21` 决策 79：`P2-seq142` 采用“同源文档优先 + 统一帮助承载”策略：移除调试页内置 `SourceHelpTexts.debug` 提示弹窗，改为读取 `assets/web/help/md/debugHelp.md` 并复用 `showAppHelpDialog` 展示，失败分支保留“帮助文档加载失败”可观测提示，确保与 legado `showHelp("debugHelp")` 语义同义。
- `2026-02-22` 决策 80：`P2-seq143` 采用“行为不变 + 触发证据可注入”策略：运行时继续使用 `_moveSourcesToTopBottom` 的既有写库链路，仅新增可选 `moveSourcesHandler` 注入点用于稳定验证 `menu_top` 触发来源与 `toTop` 分流语义；同时将条目更多按钮补充稳定 key 以消除测试中导航栏同图标歧义，不改变用户可见交互。
- `2026-02-22` 决策 81：`P2-seq144` 采用“实现保持 + 证据闭环”策略：不改动 `_toBottom` 与 `_moveSourcesToTopBottom` 运行时写库实现，仅补齐 `menu_bottom` 的升序/反序分流回归（`toTop=false/true`）与台账证据，确保严格按序号完成 legado 同义验证。
- `2026-02-22` 决策 82：`P2-seq145` 采用“入口语义 + URL 回查边界”策略：菜单项继续按 `loginUrl` 非空控制可见性；点击“登录”时按 `bookSourceUrl` 回查最新书源后再触发登录链路，缺失时统一提示“未找到书源”；回归仅保留稳定的“入口显隐 + 登录跳转”断言，避免引入不稳定时序用例。
- `2026-02-22` 决策 83：`P2-seq146` 采用“快照 scope 先写入 + 页面无阻塞跳转”策略：菜单点击“搜索”后先按当前条目构造并写入 `SearchScope.fromSource(source)`（异步落盘不阻塞导航），再打开搜索页；避免继续依赖 `SearchView.scoped` 的二次查库生成 scope，确保与 legado `SearchScope(bookSource)` 快照语义同义。
- `2026-02-22` 决策 84：`P2-seq147` 采用“快照直达调试页”策略：`menu_debug_source` 点击后直接按当前条目快照打开 `SourceDebugLegacyView`，不再复用 `_openEditor(initialTab:3)` 的入口前二次查库拦截；仅收敛当前子项触发语义，不提前并入 `menu_del/menu_enable_explore` 后续序号。
- `2026-02-22` 决策 85：`P2-seq148` 采用“确认文案收敛 + 删除触发内聚”策略：将删除确认标题收敛为 legado `draw` 同义“提醒”，并将删除执行绑定到确认按钮回调（确认即删、取消不删）；测试侧保留“取消路径 + 确认删除”两条页面级证据，并用 Drift 直查落库结果规避仓库静态缓存时序抖动。
- `2026-02-22` 决策 86：`P2-seq163` 采用“入口同义 + 规则透传最小闭环”策略：目录页仅在本地 TXT 展示 `menu_toc_regex`，规则选择结果落到书籍级 `SettingsService` 映射并透传至 `TxtParser/SearchBookInfoRefreshHelper/阅读器重解析`；自动化证据优先使用 parser/refresh/settings 定向测试，页面级触发通过手工路径补齐，避免引入 Drift 阻塞型假阴性。
- `2026-02-22` 决策 87：`P2-seq165` 采用“菜单层级同义优先”策略：保留既有 `_reversed` 的“过滤后倒序”实现与数据结构不变，仅将入口从页面内按钮迁移到目录“更多”菜单并固定文案“反转目录”；非本地 TXT 场景同样保留该入口，本地 TXT 场景与 `menu_toc_regex` 并列展示。
- `2026-02-22` 决策 88：`P2-seq168` 采用“菜单单项收敛 + 可观测导出链路”策略：目录页“更多”菜单仅补齐 `menu_export_bookmark` 的固定文案“导出”与 JSON 导出触发，不提前并入 `menu_export_md`；导出成功统一提示“导出成功”，取消不提示，失败记录 `ExceptionLogService` 并给出可观测反馈。为稳定回归证据，新增可选 `bookmarkExportService` 注入点，仅用于测试替换导出服务，默认运行时行为保持不变。
- `2026-02-22` 决策 89：`P2-seq169` 采用“同组菜单并列收敛”策略：在保持 `menu_export_bookmark` 已收敛行为不变的前提下，单独补齐 `menu_export_md` 的固定文案“导出(MD)”与 Markdown 导出触发链路，不复用 JSON 参数；导出成功统一提示“导出成功”，取消不提示，失败继续记录 `ExceptionLogService`，并新增定向回归验证 `.md` 扩展名与动作入口。
- `2026-02-22` 决策 90：`P2-seq64` 采用“入口层级同义优先 + 默认触发对齐”策略：将阅读页换源从“更多菜单二级入口”收敛为顶栏一级动作，并将点击默认行为改为整书换源；章节/整书分支菜单保留在换源按钮长按手势，避免新增扩展入口导致与 legado 触发语义漂移。
- `2026-02-22` 决策 91：`P2-seq65` 采用“顶栏一级入口 + 点击默认当前章节刷新”策略：将刷新动作从“阅读操作”二级菜单收敛为顶栏一级按钮，默认点击执行当前章节刷新，并将长按分支对齐 legado `book_read_refresh` 三分支菜单；同时从更多菜单移除刷新项，避免同一动作双入口导致层级偏差。
- `2026-02-22` 决策 92：`P2-seq66` 采用“顶栏一级入口 + 范围缓存主链路”策略：将离线缓存动作从“阅读操作”二级菜单收敛为顶栏一级按钮，点击后弹出章节范围输入并按范围执行正文缓存；保留在线/本地显隐边界并将章节抓取失败写入异常日志，确保 `menu_download` 触发链路、状态流转与可观测语义对齐 legado。
- `2026-02-22` 决策 93：`P2-seq67` 采用“确认式提交优先”策略：阅读页 `menu_toc_regex` 保持顶栏一级入口不变，将规则选择从“点选即提交”收敛为“取消不生效、确定统一提交”，并移除扩展成功提示；确定后继续沿用既有 TXT 重解析链路，确保 `menu_toc_regex -> onTocRegexDialogResult -> loadChapterList` 状态流转同义。
- `2026-02-22` 决策 94：`P2-seq68` 采用“顶栏一级入口 + 输入式提交 + 本地统一重载”策略：`menu_set_charset` 从“阅读操作”菜单移至本地书籍顶栏一级动作，交互由固定枚举改为自由输入 `charset` 对话框；确认后先持久化编码再统一触发本地目录重载（TXT/非 TXT），取消不生效且不追加扩展成功提示。
- `2026-02-22` 决策 95：`P2-seq83` 采用“本地/在线同义刷新 + 失败口径收敛”策略：阅读页 `menu_update_toc` 不再拦截本地书籍，统一进入目录重载链路；本地失败收敛为 `LoadTocError:*`、在线失败收敛为“加载目录失败”，并移除成功扩展提示，仅保留加载态与日志可观测输出。对 EPUB 场景在刷新前清理章节缓存，等价 legado 的“先清缓存再更新目录”语义。
- `2026-02-22` 决策 96：`P3-seq94` 采用“默认动作单点收敛”策略：通过 `ReaderLegacyMenuHelper.defaultRefreshAction()` 固化 `menu_refresh=menu_refresh_dur(current)` 语义，并让顶栏刷新点击与阅读菜单刷新共用同一默认执行链路；长按分支菜单保持仅承担“选择当前/之后/全部刷新”入口职责，不再承载默认动作判定。
- `2026-02-22` 决策 97：`P3-seq95` 采用“范围计算抽离 + 行为保持”策略：将“刷新之后章节”的范围计算与缓存清理提炼为 `ReaderRefreshScopeHelper`，由 `selectionFromLegacyAction(after)` 固化 `startIndex=current, clearFollowing=true`，并新增独立单测覆盖“前序章节不清理”边界；页面触发链路保持不变，避免跨序号改动 `menu_refresh_all` 分支。
- `2026-02-22` 决策 98：`P3-seq96` 采用“行为保持 + 证据独立闭环”策略：运行时继续复用既有 `selectionFromLegacyAction(all) -> clearCachedRange(start=0, clearFollowing=true)` 链路，不新增分支实现；仅补齐 `menu_refresh_all` 的动作映射与全量清缓存单测，并回填台账证据，确保后续序号改动不破坏全量刷新边界。
- `2026-02-22` 决策 99：`P3-seq97` 采用“URL 回查优先”策略：阅读页 `menu_login` 点击后不再直接使用 action sheet 打开时的书源快照，而是按 `bookSourceUrl` 回查当前书源后再触发登录；缺失时提示“未找到书源”，以对齐 legado `SourceLoginActivity(key=bookSourceUrl)` 的实时状态边界并避免过期快照误触发。
- `2026-02-22` 决策 100：`P3-seq98` 采用“显隐边界收敛 + 日志优先可观测”策略：`menu_chapter_pay` 显隐严格收敛为 `loginUrl && isVip && !isPay`，确认后按 `bookSourceUrl` 回查当前书源执行 `payAction`；结果分流对齐 legado `isAbsUrl / isTrue` 语义，异常统一写日志 `执行购买操作出错`，不追加扩展 toast。
- `2026-02-22` 决策 101：`P3-seq99` 采用“实时回查 + 保存后刷新”策略：`menu_edit_source` 点击后不再使用弹层快照直接打开编辑页，而是按 `bookSourceUrl` 回查当前书源后再触发；仅在编辑页保存返回时刷新阅读页书源显示，取消返回不刷新，以对齐 legado `RESULT_OK -> upBookSource/upMenuView` 回调边界。
- `2026-02-22` 决策 102：`P3-seq100` 采用“直接执行同义化 + 回查防重建”策略：移除禁用确认弹窗与成功 toast，动作收敛为点击即按 `bookSourceUrl` 回查当前书源并写库 `enabled=false`；回查缺失时仅提示“未找到书源”，避免使用弹层快照触发 upsert 重建已删除书源。
- `2026-02-22` 决策 103：`P2-seq164` 采用“目录页 checkable 入口补齐 + 即时重建复用”策略：在目录页“更多”菜单补齐 `menu_split_long_chapter`，标题固定“拆分超长章节”并以勾选态表达状态；点击后复用本地 TXT 重建目录链路，保持“切换即生效”而不新增并行刷新实现。
- `2026-02-22` 决策 104：`P2-seq166` 采用“全局目录开关持久化 + 展示层即时重算”策略：目录页“更多”菜单补齐 `menu_use_replace` 固定文案与勾选态，点击后仅切换全局 `tocUiUseReplace` 并立即重算目录展示标题，不追加成功提示；标题处理链路收敛为 `tocUiUseReplace && 书籍启用替换规则`，以对齐 legado 的目录展示边界。
- `2026-02-22` 决策 105：`P2-seq167` 采用“开关语义优先 + 现有数据渐进承载”策略：先补齐 `menu_load_word_count` 的 checkable 入口、全局持久化默认值（`true`）与目录即时刷新，再基于现有章节缓存内容补齐字数展示（`xx字/xx万字`）；不引入章节表结构变更，避免在当前序号扩大到跨层数据迁移。
- `2026-02-22` 决策 106：`P3-seq70` 采用“异常兜底优先 + 加载态交互锁定”策略：保持 `menu_edit_content` 入口与保存链路不变，仅将正文抓取异常收敛为“记录日志并回退当前显示内容”以避免中断菜单流程；同时在编辑页 `reset` 期间增加全屏遮罩与整页禁用，贴齐 legado `loadState` 的不可交互语义。
- `2026-02-22` 决策 107：`P3-seq71` 采用“双层状态拆分”策略：`menu_page_anim` 收敛为书籍级单选覆盖（默认/覆盖/滑动/仿真/滚动/无）且不写全局；样式面板改翻页动画继续走全局设置并同步清理书籍覆盖，以对齐 legado `book.pageAnim` 与 `ReadBookConfig.pageAnim` 的职责边界。
- `2026-02-22` 决策 108：`P3-seq72` 采用“静默同步优先 + 越界保护”策略：`menu_get_progress` 在无配置/空目录/云端无数据时保持静默返回，不追加扩展 toast；仅在云端章节索引合法时应用同步，云端进度落后本地时保留 legado 同义确认框，拉取失败统一写 `reader.menu.get_progress.failed` 日志。
- `2026-02-22` 决策 109：`P3-seq73` 采用“静默守卫 + 文案收敛 + 失败可观测”策略：`menu_cover_progress` 在开关关闭/无配置/空目录时静默返回；成功提示收敛为 legado 同义“上传成功”；失败链路统一记录 `reader.menu.cover_progress.failed` 日志并保留失败提示，避免只提示不落日志的可观测缺口。
- `2026-02-22` 决策 110：`P3-seq74` 采用“算法同义优先 + 扩展行为回收”策略：`menu_reverse_content` 从“按行倒序 + 正文兜底拉取 + 缺失提示”收敛为 legado `reverseContent` 同义“按字符倒序 + 仅处理当前缓存正文 + 缺失静默返回”；同时将菜单文案统一为“反转内容”。
- `2026-02-22` 决策 111：`P3-seq75` 采用“边界先行收敛”策略：先对齐 legado `simulatedTotalChapterNum` 计算口径（含 `Period.days + 1` 语义），再把可读章节上限贯穿到目录、底部章节导航、自动翻页、朗读切章、进度分母与越界保护，避免仅修菜单入口导致会话边界漂移。
- `2026-02-22` 决策 112：`P3-seq76` 采用“文案与反馈同义化”策略：`menu_enable_replace` 菜单文案收敛为“替换净化”，并移除切换后的扩展 toast；保留“点击即切换书籍级开关并刷新正文”的主链路，不扩大到替换规则引擎实现层改动。
- `2026-02-22` 决策 113：`P3-seq77` 采用“实际结果驱动状态 + Legacy 翻转语义”策略：`menu_same_title_removed` 勾选态按当前章节实际移除结果表达，不再直接映射章节配置；点击动作按 `!sameTitleRemoved` 写回章节级开关并重载当前章节，且仅在“未移除且已启用”时提示“未找到可移除的重复标题”，其余边界保持静默。
- `2026-02-22` 决策 114：`P3-seq78` 采用“开关持久化后同章重载 + 位点先保存”策略：`menu_re_segment` 点击后仅切换书籍级 `reSegment` 并重载当前章节，不新增扩展提示；为对齐 legado `loadContent(false)` 的位置保持语义，重载前先执行进度保存，再以 `restoreOffset` 恢复当前阅读位点。
- `2026-02-22` 决策 115：`P3-seq79` 采用“隐藏入口结构化保留”策略：菜单模型补齐 `menu_enable_review` 占位与 legacy 文案，但默认 `showReviewAction=false` 且事件分发 no-op，严格对齐 legado 当前“默认隐藏且不可触发”的运行时语义，不提前扩展段评主流程。
- `2026-02-22` 决策 116：`P3-seq80` 采用“清理边界同义 + 全量刷新回归”策略：菜单文案固定收敛为“删除ruby标签”；正文清理规则收敛为仅删除 `rt/rp`，不移除 `ruby` 包裹标签；切换后刷新链路改为全量清缓存并重载当前章节，贴齐 legado `refreshContentAll` 语义。
- `2026-02-22` 决策 117：`P3-seq81` 采用“节点级清理同义 + 文案收敛”策略：`menu_del_h_tag` 菜单文案固定收敛为“删除h标签”；正文清理规则由“仅移除 `h1~h6` 标签”收敛为“移除 `h1~h6` 整段节点内容（含标题文本）”，并继续复用全量清缓存重载链路，贴齐 legado `select("h1, h2, h3, h4, h5, h6").remove()` 语义。
- `2026-02-22` 决策 118：`P3-seq82` 采用“书籍级联动优先”策略：`menu_image_style` 选择 `SINGLE` 时不再改全局 `ReadingSettings.pageTurnMode`，统一复用本书翻页动画覆盖链路写入 `book_page_anim_map(0=覆盖)`；保持“样式切换后立即重载当前章节”语义不变，确保与 legado `book.setPageAnim(0) + ReadBook.loadContent(false)` 同义。
- `2026-02-22` 决策 119：`P3-seq84` 采用“命中规则可见性优先 + 编辑后统一重载”策略：`menu_effective_replaces` 从规则总列表跳转收敛为“当前章节起效规则弹层”；规则项来源改为正文实际命中列表，并在简繁转换开启时追加“繁简转换”项；发生规则编辑或简繁切换后统一清理替换阶段缓存并重载当前章节，以对齐 legado `onDismiss -> replaceRuleChanged` 闭环。
- `2026-02-22` 决策 120：`P2-seq348` 采用“单控件提交优先”策略：搜索入口收敛为单一输入控件内提交（控件内搜索图标 + 键盘 `search`），移除外置独立搜索按钮；同时占位文案收敛为 legado `search_book_key` 同义“搜索书名、作者”，不改动搜索算法、缓存键与范围状态机。
- `2026-02-22` 决策 121：`P3-seq5` 采用“先补入口语义、复用既有换源主链路”策略：将“朗读长按”占位提示收敛为 `audio_play` 播放菜单并补齐“换源”动作；点击后直接复用现有整书换源候选流程，不提前并入 `menu_login/menu_edit_source/menu_wake_lock/menu_log` 后续序号逻辑，确保严格按序推进。
- `2026-02-22` 决策 122：`P3-seq6` 采用“显隐边界先行 + 触发链路复用”策略：在播放菜单仅新增 `menu_login` 单项，显隐严格收敛到 `loginUrl` 非空；点击后复用现有 `_openSourceLoginFromReader(bookSourceUrl)` 登录链路，不提前并入 `menu_copy_audio_url/menu_edit_source/menu_wake_lock/menu_log` 后续序号逻辑，确保按队列串行推进。
- `2026-02-22` 决策 123：`P3-seq239` 采用“目录重选动作优先”策略：先补齐 `menu_other` 的“重选字体目录 -> 刷新候选列表”主语义与路径持久化，再在现有字体弹层中承载目录字体选择；不提前并入 `menu_default`（`seq238`）的系统字体菜单改造，避免跨序号并项。
- `2026-02-22` 决策 128：`P3-seq374` 采用“候选预览优先 + 默认选择新增/更新”策略：`menu_import_local` 点击后先执行 `txt/json` 本地选档，再进入“导入朗读引擎”候选弹层；候选状态按 `id + lastUpdateTime` 收敛为“新增/更新/已有”，默认仅勾选新增/更新并支持全选切换；确认后仅提交勾选项并即时刷新列表，不提前并入 `menu_import_onLine/menu_export` 后续序号能力。
- `2026-02-22` 决策 129：`P3-seq375` 采用“URL 输入与历史同义优先 + 候选导入复用”策略：`menu_import_onLine` 点击后先弹“网络导入”输入层并持久化 `ttsUrlKey` 历史（支持点选回填与删除），确认后复用既有“导入朗读引擎”候选弹层完成勾选导入；不提前并入 `menu_export`（`seq376`）后续序号能力，保持按序推进。
- `2026-02-22` 决策 130：`P3-seq376` 采用“导出器同义优先 + 路径可观测闭环”策略：在“朗读引擎”更多菜单补齐 `menu_export` 并固定导出文件名 `httpTts.json`、内容为当前 HTTP 朗读引擎 JSON 数组；导出成功后提供路径展示与复制路径动作，不提前并入 `speak_engine_edit.xml`（`seq377+`）后续序号能力，保持按序推进。
- `2026-02-22` 决策 131：`P3-seq378` 采用“编辑态保存优先 + 登录分流复用”策略：先补齐 `speak_engine_edit` 承载页，再在“更多”菜单新增 `menu_login`；点击后先按当前编辑表单回写 HTTP 朗读规则，再按 `loginUi` 分流到表单登录或网页登录，并保留 legado 同义空值拦截“登录url不能为空”；不提前并入 `menu_save/menu_show_login_header/menu_del_login_header` 后续序号能力，保持按序推进。
- `2026-02-22` 决策 132：`P3-seq379` 采用“只读展示优先”策略：在 `speak_engine_edit` 仅新增 `menu_show_login_header` 单项并复用登录态缓存键 `httpTts:<id>` 读取当前规则登录头；展示层严格收敛为“标题为登录头的只读弹窗”，无缓存时不追加占位文案，不提前并入 `menu_del_login_header`（`seq380`）删除链路，保持按序推进。
- `2026-02-22` 决策 133：`P3-seq380` 采用“缓存键直删优先”策略：在 `speak_engine_edit` 仅新增 `menu_del_login_header` 单项并按 `httpTts:<id>` 删除登录头缓存；删除动作保持 legado 同义静默语义（无保存、无成功提示），不提前并入 `menu_save/menu_paste_source`（`seq377/382`）后续序号能力，保持按序推进。
- `2026-02-22` 决策 134：`P3-seq9` 采用“checkable 入口先收敛 + 全局键同名持久化”策略：在播放菜单仅新增 `menu_wake_lock` 单项并用勾选态表达开关状态；点击后仅翻转并落盘 legado 同名键 `audioPlayWakeLock`，不提前并入 `menu_copy_audio_url/menu_log` 后续序号能力，确保按优先级队列串行推进。
- `2026-02-22` 决策 135：`P3-seq93` 采用“入口同义优先 + 进度链路不破坏”策略：先补齐“阅读记录页更多菜单 -> 开启记录”checkable 入口与 `enableReadRecord` 同名持久化；为避免破坏主阅读链路，阅读进度仍按原路径保存，仅在开关关闭时停止刷新 `lastReadTime`，用现有数据结构承接 legado 阅读记录开关语义。
- `2026-02-22` 决策 136：`P3-seq201` 采用“空正文边界优先”策略：编辑正文保存链路对齐 legado `BookHelp.saveText(content.isEmpty -> return)`，仅在正文非空时覆盖章节缓存并标记已下载；空正文场景保持静默且不改写现有正文，避免把缓存正文污染为空串。
- `2026-02-22` 决策 137：`P3-seq202` 采用“重置来源同义 + 失败静默回收”策略：重置链路统一收敛为“清缓存 -> 回源读取 -> 回填编辑框 -> 刷新当前章节”；网络书禁用 `_currentContent` 回退并改为失败抛错记录日志，本地书改为按本地文件回读章节正文；编辑页失败分支移除“重置失败”弹窗，保持 legado 同义静默边界。
- `2026-02-22` 决策 138：`P3-seq204` 采用“搜索态开关独立优先”策略：在全文搜索面板仅新增 `content_search/menu_enable_replace` 单项并以勾选态表达状态；点击动作仅翻转搜索态开关，不自动重跑搜索；执行搜索时按“搜索替换开关 && 书籍替换净化开关”共同决定是否应用替换规则，以对齐 legado `replaceEnabled` 与 `book.getUseReplaceRule()` 组合边界。
- `2026-02-22` 决策 142：`P3-seq208` 采用“双模式分流优先 + 同名键持久化”策略：文本操作菜单补齐 `menu_aloud` 后，点击动作按 `contentSelectSpeakMod` 分流为“朗读选中文本（mode=0）/从选择处开始持续朗读（mode=1）”；长按文本操作菜单项统一切换模式并持久化到同名键，不提前并入 `menu_dict/menu_browser/menu_share_str` 后续序号能力，保持按序推进。
- `2026-02-22` 决策 143：`P3-seq209` 采用“词典弹层闭环优先 + 默认规则同源”策略：文本操作菜单补齐 `menu_dict` 后，点击动作统一进入词典弹层，按 `enabled + sortNumber` 加载并排序规则，默认首项自动查询；规则默认资产对齐 legado `defaultData/dictRules.json`，并在弹层内支持规则切换重查，不提前并入 `menu_browser/menu_share_str` 后续序号能力，保持按序推进。
- `2026-02-22` 决策 144：`P3-seq211` 采用“绝对网址直开优先 + 非网址搜索回退”策略：文本操作菜单补齐 `menu_browser` 后，点击动作按 `isAbsUrl` 语义分流为“外部浏览器打开 / 网页搜索关键词”；失败口径收敛为“异常优先显示错误消息，空消息回退 `ERROR`”，不提前并入 `menu_share_str`（`seq212`）后续序号能力，保持按序推进。
- `2026-02-22` 决策 145：`P3-seq212` 采用“系统分享直连 + 异常静默吞错”策略：文本操作菜单补齐 `menu_share_str` 后，点击动作直接调用系统文本分享并透传 `selectedText`；失败边界按 legado `Context.share` 保持静默，不追加成功或失败提示；不提前并入 `menu_default`（`seq238`）后续序号能力，保持按序推进。
- `2026-02-22` 决策 147：`P3-seq256` 采用“编辑工具承载优先 + serialNo 同义持久化”策略：在 Flutter 端先将“辅助按键配置”挂到 `SourceEditLegacyView` 的“编辑工具”动作面板，进入配置弹层后补齐顶部“添加”入口；新增动作严格按 legado `editKey(null)` 语义使用 `key/value` 双输入框，并以 `serialNo=max+1` 追加持久化，保证新增项可立即回流到编辑工具用于插入 `value`。
- `2026-02-22` 决策 150：`P3-seq382` 采用“剪贴板解析优先 + 仅回填不落库”策略：编辑页“更多”菜单仅新增 `menu_paste_source` 单项，点击后按 legado 同义规则读取剪贴板文本并只接受 JSON 对象/数组（数组取首项）回填表单；成功后不自动保存、不跳转、不追加成功提示，不提前并入 `menu_copy_source/menu_log/menu_help` 后续序号能力，保持按序推进。
- `2026-02-22` 决策 151：`P4-seq158` 采用“仅收敛导出文件名与取消边界”策略：保持现有“导出所选”入口层级与导出集合计算规则不变，仅将文件导出默认名调整为 legado 同义 `bookSource.json`，并将取消分支改为静默返回；不提前并入 `menu_enable_selection/menu_disable_selection/menu_share_source/menu_check_source`（`seq150~151/159~160`）后续序号能力，确保一项一处理。

## Outcomes & Retrospective

- `2026-02-25`：完成 `P6-seq29`（`book_group_manage/menu_add`）迁移闭环，已补齐“分组管理弹层右上角一级添加入口 + 添加分组结构化编辑弹窗（名称/封面/排序/允许下拉刷新）+ 空名称与上限边界提示 + 封面选择失败可观测日志 + 新增字段入库存储”同义证据；优先级队列 `seq29` 已同步置为 `done`，队列推进到下一项 `seq181(bookshelf_menage_sel/menu_change_source)`。
- `2026-02-23`：完成阅读页“正文标题居中无效”修复闭环，已补齐“分页画布标题固定段宽布局 + 居中渲染生效 + 标题命中坐标对齐”证据；滚动模式与书源五段链路未受影响。
- `2026-02-23`：完成 `P6-seq171`（`menu_export`）迁移闭环，已补齐“设置页书签入口 + 所有书签承载页 + 顶栏更多单项‘导出’ + 全量书签按 legado 顺序导出 JSON + 文件名 `bookmark-yyMMddHHmmss.json` + 失败日志可观测 + 取消导出静默返回”的同义证据；`menu_export_md(seq172)` 保持下一序号独立推进。
- `2026-02-23`：完成 `P3-seq7`（`menu_copy_audio_url`）迁移闭环，已补齐“阅读页播放菜单拷贝播放 URL 入口 + 复制值映射当前章节链接 + 缺失链接复制空值 + 成功提示‘已拷贝’ + 复制失败仅日志可观测”的同义证据；队列推进到下一项 `seq10(audio_play/menu_log)`。
- `2026-02-23`：完成 `P8-seq349`（`menu_save`）迁移闭环，已补齐“服务器配置页顶栏一级保存入口 + 字段草稿态编辑 + 点击保存统一落盘并关闭 + 失败提示 `保存出错\n<原因>` + 移除逐字段‘已保存’提示”的同义证据；`menu_copy_rule(seq227)` 继续 `detail_later` 后置；队列推进到下一项 `seq350(servers/menu_add)`。
- `2026-02-23`：完成 `P8-seq248`（`menu_del_selection`）迁移闭环，已补齐“智能扫描候选弹层删除入口 + 按选中集合执行文件删除 + 删除动作结束后移除所选候选项 + 失败日志可观测 + 全流程静默无成功提示”的同义证据；`menu_copy_rule(seq227)` 继续 `detail_later` 后置；队列推进到下一项 `seq349(server_config/menu_save)`。
- `2026-02-23`：完成 `P8-seq246`（`menu_scan_folder`）迁移闭环，已补齐“书架更多菜单智能扫描入口 + `importBookPath` 目录递归扫描 + 扫描候选勾选弹层（默认全选/全选切换）+ 仅导入勾选项 + 导入成功/失败汇总明细”的同义证据；`menu_copy_rule(seq227)` 继续 `detail_later` 后置；队列推进到下一项 `seq248(import_book_sel/menu_del_selection)`。
- `2026-02-23`：完成 `P8-seq241`（`menu_select_folder`）迁移闭环，已补齐“书架更多菜单选择文件夹入口 + 目录选择成功仅保存 `importBookPath` + 取消静默不覆盖 + 异常可观测日志 + 本地导入默认目录复用”的同义证据；`menu_copy_rule(seq227)` 继续 `detail_later` 后置；队列推进到下一项 `seq246(import_book/menu_scan_folder)`。
- `2026-02-23`：完成 `P6-seq16`（`menu_enable_replace`）迁移闭环，已补齐“缓存/导出页顶栏更多菜单替换净化入口 + `exportUseReplace` 勾选态回显与持久化 + 导出链路按 `exportUseReplace && bookUseReplaceRule` 应用替换规则（TXT 与 EPUB）”的同义证据；`menu_copy_rule(seq227)` 继续 `detail_later` 后置；队列推进到下一项 `seq241(import_book/menu_select_folder)`。
- `2026-02-23`：完成 `P8-seq229`（`menu_import_default`）迁移闭环，已补齐“直链上传配置更多菜单导入默认规则入口 + 默认规则选择层 + 选择后仅回填上传URL/下载URL规则/注释/是否压缩 + 不自动保存不关闭页面”的同义证据；`menu_copy_rule(seq227)` 继续 `detail_later` 后置；队列推进到下一项 `seq247(import_book/menu_import_file_name)`。
- `2026-02-23`：完成 `P8-seq228`（`menu_paste_rule`）迁移闭环，已补齐“直链上传配置更多菜单粘贴规则入口 + 剪贴板 Rule JSON 解析 + 成功仅回填表单 + 失败统一提示‘剪贴板为空或格式不对’ + 不自动保存不跳转”的同义证据；队列推进到下一项 `seq229(direct_link_upload_config/menu_import_default)`。
- `2026-02-23`：完成 `P6-seq28`（`menu_download_all`）迁移闭环，已补齐“缓存/导出页长按下载子菜单 `下载全部章节` 入口 + 空闲态确认后首章到末章缓存 + 运行中同入口停止任务 + 下载进度回显复用既有链路”的同义证据；`menu_log(seq26)` 继续 `detail_later` 后置；队列推进到下一项 `seq228(direct_link_upload_config/menu_paste_rule)`。
- `2026-02-23`：完成 `P6-seq25`（`menu_export_charset`）迁移闭环，已补齐“缓存/导出页顶栏更多菜单导出编码入口 + 当前编码标题回显 + `exportCharset` 持久化 + TXT 导出写盘按所选编码生效（空值回落 UTF-8）”的同义证据；`menu_log(seq26)` 维持 `detail_later` 后置；队列推进到下一项 `seq27(book_cache_download/menu_download_after)`。
- `2026-02-23`：完成 `P6-seq24`（`menu_export_type`）迁移闭环，已补齐“缓存/导出页顶栏更多菜单导出格式入口 + 当前格式标题回显 + `exportType` 持久化 + 导出链路按 `txt/epub` 分支执行（`epub` 真实文件写出）”的同义证据；导出编码与日志入口能力保留后续序号收敛；队列推进到下一项 `seq25(book_cache/menu_export_charset)`。
- `2026-02-23`：完成 `P6-seq23`（`menu_export_file_name`）迁移闭环，已补齐“缓存/导出页顶栏更多菜单导出文件名入口 + 弹窗回显与保存 `bookExportFileName` + 导出命名按 JS 规则解析（`name/author`）+ 规则异常回退默认命名并记录日志”的同义证据；导出格式/导出编码与日志能力保留后续序号收敛；队列推进到下一项 `seq24(book_cache/menu_export_type)`。
- `2026-02-23`：完成 `P6-seq22`（`menu_export_folder`）迁移闭环，已补齐“缓存/导出页顶栏更多菜单导出文件夹入口 + 目录选择后持久化默认导出目录 + 取消选择静默返回 + 不触发导出任务”的同义证据；导出文件名/格式/编码与日志能力保留后续序号收敛；队列推进到下一项 `seq23(book_cache/menu_export_file_name)`。
- `2026-02-23`：完成 `P6-seq21`（`menu_parallel_export`）迁移闭环，已补齐“缓存/导出页顶栏更多菜单多线程导出入口 + 菜单勾选态读取与回显 + legado 同名键 `parallelExportBook` 持久化切换 + 导出并发度开关（关闭 `1`、开启 `9`）”的同义证据；导出文件夹/文件名/格式/编码能力保留后续序号收敛；队列推进到下一项 `seq22(book_cache/menu_export_folder)`。
- `2026-02-23`：完成 `P6-seq20`（`menu_export_pics_file`）迁移闭环，已补齐“缓存/导出页顶栏更多菜单 TXT 导出图片入口 + 菜单勾选态读取与回显 + legado 同名键 `exportPictureFile` 持久化切换 + TXT 导出图片写盘链路（按书籍/章节目录结构）”的同义证据；并行导出与导出目录/文件名/格式/编码能力保留后续序号收敛；队列推进到下一项 `seq21(book_cache/menu_parallel_export)`。
- `2026-02-23`：完成 `P6-seq19`（`menu_export_no_chapter_name`）迁移闭环，已补齐“缓存/导出页顶栏更多菜单 TXT 不导出章节名入口 + 菜单勾选态读取与回显 + legado 同名键 `exportNoChapterName` 持久化切换 + TXT 导出正文章节标题开关联动”的同义证据；TXT 图片导出/并行导出/导出目录与格式配置能力保留后续序号收敛；队列推进到下一项 `seq20(book_cache/menu_export_pics_file)`。
- `2026-02-23`：完成 `P6-seq18`（`menu_export_web_dav`）迁移闭环，已补齐“缓存/导出页顶栏更多菜单导出到 WebDav 入口 + 菜单勾选态读取与回显 + legado 同名键 `webDavCacheBackup` 持久化切换”的同义证据；TXT 导出细项/导出格式/导出编码能力保留后续序号收敛；队列推进到下一项 `seq19(book_cache/menu_export_no_chapter_name)`。
- `2026-02-23`：完成 `P6-seq17`（`menu_enable_custom_export`）迁移闭环，已补齐“缓存/导出页顶栏更多菜单自定义Epub导出章节入口 + 菜单勾选态读取与回显 + 同名键 `enableCustomExport` 持久化切换”的同义证据；导出到 WebDav/TXT 导出细项/导出格式/导出编码能力保留后续序号收敛；队列推进到下一项 `seq18(book_cache/menu_export_web_dav)`。
- `2026-02-23`：完成 `P6-seq15`（`menu_export_all`）迁移闭环，已补齐“缓存/导出页顶栏更多菜单导出所有入口 + 导出目录复用与重选 + 当前列表批量导出已缓存章节 TXT + 失败写异常日志 + 导出汇总回显”的同义证据；`自定义Epub导出章节/导出格式/导出编码` 保留后续序号收敛；队列推进到下一项 `seq17(book_cache/menu_enable_custom_export)`。
- `2026-02-23`：完成 `P6-seq13`（`menu_download`）迁移闭环，已补齐“缓存/导出页顶栏下载入口 + 下载前确认弹窗 + 运行态下载/停止切换 + 从当前章节到末章批量缓存 + 运行中可中断 + 失败写异常日志”的同义证据；队列推进到下一项 `seq15(book_cache/menu_export_all)`。
- `2026-02-23`：完成 `P5-seq400`（`menu_disable_selection`）迁移闭环，已补齐“TXT 目录规则多选更多菜单禁用所选入口 + 仅对选中集合批量写入 `enabled=false` + 刷新后保持页面停留 + 全流程静默无成功提示”的同义证据；队列推进到下一项 `seq401(txt_toc_rule_sel/menu_export_selection)`。
- `2026-02-23`：完成 `P5-seq399`（`menu_enable_selection`）迁移闭环，已补齐“TXT 目录规则多选更多菜单启用所选入口 + 仅对选中集合批量写入 `enabled=true` + 刷新后保持页面停留 + 全流程静默无成功提示”的同义证据；队列推进到下一项 `seq400(txt_toc_rule_sel/menu_disable_selection)`。
- `2026-02-23`：完成 `P5-seq398`（`menu_del`）迁移闭环，已补齐“TXT 目录规则条目更多菜单删除入口 + 删除前先移除选中态 + ‘提醒/是否确认删除？\n规则名’确认框 + 仅确认后删库刷新 + 失败仅调试日志 + 全流程静默无成功提示”的同义证据；队列推进到下一项 `seq399(txt_toc_rule_sel/menu_enable_selection)`。
- `2026-02-23`：完成 `P5-seq396`（`menu_top`）迁移闭环，已补齐“TXT 目录规则条目右侧更多入口 + 单项置顶动作 + 置顶按 `serialNumber=minOrder-1` 写回 + 失败仅调试日志 + 全流程静默无成功提示”的同义证据；队列推进到下一项 `seq397(txt_toc_rule_item/menu_bottom)`。
- `2026-02-23`：完成 `P5-seq393`（`menu_save`）迁移闭环，已补齐“TXT 目录规则编辑页顶栏一级保存动作 + 校验通过后静默回传并关闭 + 保存仅提交 `name/rule/example` + `example` 空串清空边界同义”的证据；队列推进到下一项 `seq396(txt_toc_rule_item/menu_top)`。
- `2026-02-23`：完成 `P5-seq387`（`menu_add`）迁移闭环，已补齐“TXT 目录规则管理页顶栏添加入口 + 新建草稿进入编辑页 + 编辑页保存动作 + 名称/正则保存前校验 + 保存成功回传并落库刷新”的同义证据；队列推进到下一项 `seq393(txt_toc_rule_edit/menu_save)`。
- `2026-02-23`：完成 `P5-seq294`（`menu_del`）迁移闭环，已补齐“替换规则条目更多菜单删除入口 + 删除前移除条目选中态 + ‘提醒/是否确认删除？\n规则名’确认框 + 确认后删库刷新 + 全流程静默无成功提示”的同义证据；队列推进到下一项 `seq295(replace_rule_sel/menu_enable_selection)`。
- `2026-02-23`：完成 `P5-seq286`（`menu_group_null`）迁移闭环，已补齐“分组弹层未分组入口 + no-group 三段判定边界（`group` 为空/空白/包含‘未分组’）+ 切换筛选静默停留页面”的同义证据；队列推进到下一项 `seq287(replace_rule/menu_add_replace_rule)`。
- `2026-02-23`：完成 `P5-seq285`（`menu_group_manage`）迁移闭环，已补齐“分组弹层中的分组管理入口 + 分组管理承载弹层 + 添加分组仅赋值无分组规则 + 编辑/删除分组静默写库并即时刷新”的同义证据；队列推进到下一项 `seq286(replace_rule/menu_group_null)`。
- `2026-02-23`：完成 `P5-seq281`（`menu_save`）迁移闭环，已补齐“替换规则编辑页保存前有效性校验 + `save error` 失败口径 + 保存失败不退出 + `order==Int.MIN_VALUE` 自动分配 `maxOrder+1` + 保存成功关闭编辑页且无成功提示”的同义证据；队列推进到下一项 `seq284(replace_rule/menu_group)`。
- `2026-02-23`：完成 `P5-seq225`（`menu_disable_selection`）迁移闭环，已补齐“字典规则多选更多菜单禁用所选入口 + 仅对选中集合批量写入 `enabled=false` + 刷新后保持页面停留 + 全流程静默无成功提示”的同义证据；队列推进到下一项 `seq281(replace_edit/menu_save)`。
- `2026-02-23`：完成 `P5-seq215`（`menu_add`）迁移闭环，已补齐“字典规则管理页顶栏一级新建入口 + 点击直达空白编辑页 + 全程不自动保存/不触发导入”的同义证据；队列推进到下一项 `seq221(dict_rule_edit/menu_save)`。
- `2026-02-23`：完成 `P5-seq401`（`menu_export_selection`）迁移闭环，已补齐“TXT 目录规则多选承载入口 + 批量更多菜单导出所选 + 默认文件名 `exportTxtTocRule.json` + 取消导出静默返回 + 成功路径可复制”的同义证据；队列推进到下一项 `seq215(dict_rule/menu_add)`。
- `2026-02-23`：完成 `P5-seq391`（`menu_import_default`）迁移闭环，已补齐“TXT 目录规则更多菜单导入默认规则入口 + 点击后直接导入默认资产 + 默认规则集合重置（删除 `id<0` 后回灌）+ 保留 `id>=0` 自定义规则 + 导入成功静默刷新无提示”的同义证据；队列推进到下一项 `seq395(txt_toc_rule_edit/menu_paste_rule)`。
- `2026-02-23`：完成 `P5-seq390`（`menu_import_qr`）迁移闭环，已补齐“TXT 目录规则更多菜单二维码导入入口 + 扫码结果直达候选导入弹层 + 候选状态（新增/更新/已有）+ 默认勾选新增/更新 + 仅提交勾选项 + 二维码分支不写 `tocRuleUrl` 历史”的同义证据；队列推进到下一项 `seq391(txt_toc_rule/menu_import_default)`。
- `2026-02-23`：完成 `P5-seq389`（`menu_import_onLine`）迁移闭环，已补齐“TXT 目录规则更多菜单网络导入入口 + URL 输入层 + `tocRuleUrl` 历史回填/删除 + 默认历史注入 `myTxtChapterRule.json` + 候选状态（新增/更新/已有）+ 默认勾选新增/更新 + 仅提交勾选项”的同义证据；队列推进到下一项 `seq390(txt_toc_rule/menu_import_qr)`。
- `2026-02-22`：完成 `P5-seq299`（`menu_export_selection`）迁移闭环，已补齐“替换规则多选承载入口 + 批量更多菜单导出所选 + 默认文件名 `exportReplaceRule.json` + 取消导出静默返回 + 成功路径可复制”的同义证据；队列推进到下一项 `seq388(txt_toc_rule/menu_import_local)`。
- `2026-02-22`：完成 `P5-seq290`（`menu_import_qr`）迁移闭环，已补齐“替换规则更多菜单二维码导入入口 + 扫码结果直达候选导入弹层 + 候选状态（新增/更新/已有）+ 默认仅勾选新增 + 仅提交勾选项 + 二维码分支不写 `replaceRuleRecordKey` 历史”的同义证据；队列推进到下一项 `seq299(replace_rule_sel/menu_export_selection)`。
- `2026-02-22`：完成 `P5-seq289`（`menu_import_onLine`）迁移闭环，已补齐“替换规则更多菜单网络导入入口 + URL 输入层 + `replaceRuleRecordKey` 历史回填/删除 + 候选状态（新增/更新/已有）+ 默认仅勾选新增 + 仅提交勾选项 + 导入成功静默返回”的同义证据；队列推进到下一项 `seq290(replace_rule/menu_import_qr)`。
- `2026-02-22`：完成 `P5-seq288`（`menu_import_local`）迁移闭环，已补齐“替换规则更多菜单本地导入入口文案收敛 + `txt/json` 选档 + 候选状态（新增/更新/已有）+ 默认仅勾选新增 + 仅提交勾选项 + 导入成功静默返回”的同义证据；队列推进到下一项 `seq289(replace_rule/menu_import_onLine)`。
- `2026-02-22`：完成 `P5-seq283`（`menu_paste_rule`）迁移闭环，已补齐“替换规则编辑页顶栏更多入口 + 粘贴规则动作 + 空剪贴板/非法 JSON 固定错误口径 + 成功仅回填表单且不自动保存”的同义证据；队列推进到下一项 `seq288(replace_rule/menu_import_local)`。
- `2026-02-22`：完成 `P5-seq226`（`menu_export_selection`）迁移闭环，已补齐“字典规则多选入口 + 批量更多菜单导出所选 + 默认文件名 `exportDictRule.json` + 取消导出静默返回 + 成功路径可复制”的同义证据；队列推进到下一项 `seq283(replace_edit/menu_paste_rule)`。
- `2026-02-22`：完成 `P5-seq218`（`menu_import_qr`）迁移闭环，已补齐“字典规则更多菜单二维码导入入口 + 扫码结果直达候选导入弹层 + 候选状态（新增/已有）+ 默认仅勾选新增 + 仅提交勾选项 + 二维码分支不写 `dictRuleUrls` 历史”的同义证据；队列推进到下一项 `seq219(dict_rule/menu_import_default)`。
- `2026-02-22`：完成 `P5-seq217`（`menu_import_onLine`）迁移闭环，已补齐“字典规则更多菜单网络导入入口 + URL 输入层 + `dictRuleUrls` 历史回填/删除 + 候选状态（新增/已有）+ 默认仅勾选新增 + 仅提交勾选项”的同义证据；队列推进到下一项 `seq218(dict_rule/menu_import_qr)`。
- `2026-02-22`：完成 `P5-seq216`（`menu_import_local`）迁移闭环，已补齐“替换净化页字典规则入口 + 配置字典规则承载页 + 更多菜单本地导入入口 + `txt/json` 选档 + 候选状态（新增/已有）+ 默认仅勾选新增 + 按名称覆盖导入”的同义证据；队列推进到下一项 `seq217(dict_rule/menu_import_onLine)`。
- `2026-02-22`：完成 `P4-seq371`（`menu_ok`）迁移闭环，已补齐“无表单登录专用网页登录页 + 顶栏一级‘确认’动作 + checking 提示‘正在打开首页，成功自动返回主界面’ + 确认后重载首页并自动返回 + WebView Cookie 自动回写到 CookieJar + 非 http(s) 外跳确认”的同义证据；`P4` 非 `detail_later` 主功能项已清零，队列推进到 `P5-seq216(dict_rule/menu_import_local)`。
- `2026-02-22`：完成 `P4-seq362`（`menu_share_str`）迁移闭环，已补齐“更多菜单文案收敛为‘字符串分享’ + 点击后直接系统文本分享（无保存/无跳转）+ `subject` 固定‘分享’ + 成功无提示 + 分享异常静默吞并”的同义证据；队列推进到下一项 `seq364(source_login/menu_ok)`（`seq357/seq367` 后置）。
- `2026-02-22`：完成 `P4-seq361`（`menu_share_qr`）迁移闭环，已补齐“更多菜单文案收敛为‘二维码分享’ + 点击后直接二维码图片分享（无中间承载页）+ 分享标题固定‘分享书源’ + 二维码生成失败提示‘文字太多，生成二维码失败’ + 无文本分享 fallback”的同义证据；队列推进到下一项 `seq362(menu_share_str)`（`seq357/seq367` 后置）。
- `2026-02-22`：完成 `P4-seq358`（`menu_paste_source`）迁移闭环，已补齐“更多菜单入口文案收敛为‘粘贴源’ + 粘贴成功仅回填表单且不提示成功 + 不更新已保存快照与原始 URL 基线 + 粘贴后返回仍触发未保存确认”的同义证据；队列推进到下一项 `seq359(menu_set_source_variable)`（`seq357/seq367` 后置）。
- `2026-02-22`：完成 `P4-seq355`（`menu_clear_cookie`）迁移闭环，已补齐“书源编辑页更多菜单入口文案收敛为‘清除 Cookie’ + 点击后直接按当前 `bookSourceUrl` 清理 Cookie + 全流程静默无提示且不触发保存/跳转”的同义证据；队列推进到下一项 `seq356(menu_auto_complete)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq352`（`menu_debug_source`）迁移闭环，已补齐“编辑页顶栏入口文案收敛为‘调试源’ + 点击后先保存再进入调试页 + 保存失败停留编辑页且不进入调试页”的同义证据；队列推进到下一项 `seq355(menu_clear_cookie)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq351`（`menu_save`）迁移闭环，已补齐“编辑页保存失败提示直接透传错误摘要（无‘保存失败：’前缀）+ 必填校验文案收敛为‘名称和 URL 不能为空’ + 保存成功后关闭编辑页并回传 `sourceUrl` 且无成功提示”的同义证据；队列推进到下一项 `seq352(menu_debug_source)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq197`（`menu_edit_source`）迁移闭环，已补齐“换源候选条目长按编辑源入口 + 编辑承载页回跳 + 整书/单章换源按 legado 分流刷新（单源/全量）+ 取消返回保持列表”的同义证据；队列推进到下一项 `seq198(menu_disable_source)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq195`（`menu_top_source`）迁移闭环，已补齐“换源候选条目长按置顶入口 + `customOrder=minOrder-1` 写库 + 候选顺序即时前移 + 全流程静默无提示”的同义证据；队列推进到下一项 `seq196(menu_bottom_source)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq194`（`menu_close`）迁移闭环，已补齐“换源候选弹层关闭动作文案收敛为‘关闭’ + 点击仅关闭弹层无额外副作用”的同义证据；队列推进到下一项 `seq195(menu_top_source)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq193`（`menu_group`）迁移闭环，已补齐“换源候选弹层顶栏分组入口 + 动态分组选项（含全部书源）单选勾选态 + 全局键 `searchGroup` 持久化 + 切组后停止并重拉候选 + 分组空结果确认回退到全部书源”的同义证据；队列推进到下一项 `seq194(menu_close)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq191`（`menu_load_info`）迁移闭环，已补齐“换源候选弹层加载详情页 checkable 入口 + 同名键 `changeSourceLoadInfo` 持久化 + 开启后候选详情补水并回填最新章节 + 切换静默不自动刷新”的同义证据；队列推进到下一项 `seq193(menu_group)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq190`（`menu_load_word_count`）迁移闭环，已补齐“换源候选弹层加载字数 checkable 入口 + 同名键 `changeSourceLoadWordCount` 持久化 + 开启后候选字数/响应时间采集展示 + 按 legacy 字数优先规则排序”的同义证据；队列推进到下一项 `seq191(menu_load_info)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq185`（`menu_screen`）迁移闭环，已补齐“换源候选弹层顶栏筛选入口 + 筛选展开/收起标题区状态切换 + 输入实时过滤（书源名/最新章节）+ 收起后清空筛选词”的同义证据；队列推进到下一项 `seq186(menu_start_stop)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq161`（`menu_check_selected_interval`）迁移闭环，确认“多选区间补选”行为与 legado 同义：点击后按当前可见列表中已选项最小/最大索引补齐连续选区并更新计数，全程静默无提示；队列推进到下一项 `seq185(menu_screen)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq160`（`menu_check_source`）迁移闭环，已补齐“校验所选关键词弹窗同层校验设置入口 + 校验设置打开不关闭关键词弹窗 + 启动静默无‘已开始校验’提示 + 运行中重复触发统一提示 + 失效自动筛选提示文案收敛”的同义证据；队列推进到下一项 `seq161(menu_check_selected_interval)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq159`（`menu_share_source`）迁移闭环，已补齐“书源多选菜单分享选中源入口 + 导出集合规则复用 + 直接系统文件分享 + 全流程无扩展提示/无复制兜底”的同义证据；队列推进到下一项 `seq160(menu_check_source)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq157`（`menu_bottom_sel`）迁移闭环，已补齐“书源多选菜单置底所选入口 + 批量置底写库 + 全流程静默无提示”的同义证据；队列推进到下一项 `seq159(menu_share_source)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq156`（`menu_top_sel`）迁移闭环，已补齐“书源多选菜单置顶所选入口 + 批量置顶写库 + 全流程静默无提示”的同义证据；队列推进到下一项 `seq157(menu_bottom_sel)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq155`（`menu_disable_explore`）迁移闭环，已补齐“书源多选菜单禁用发现入口 + 批量写入 `enabledExplore=false` + 不筛选已禁用项 + 全流程静默无提示”的同义证据；队列推进到下一项 `seq156(menu_top_sel)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq154`（`menu_enable_explore`）迁移闭环，已补齐“书源多选菜单启用发现入口 + 批量写入 `enabledExplore=true` + 不筛选已启用项 + 全流程静默无提示”的同义证据；队列推进到下一项 `seq155(menu_disable_explore)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq153`（`menu_remove_group`）迁移闭环，已补齐“书源多选菜单移除分组入口 + 输入弹窗标题收敛 + 按选中集合批量移除分组 + 全流程静默无提示”的同义证据；队列推进到下一项 `seq154(menu_enable_explore)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq152`（`menu_add_group`）迁移闭环，已补齐“书源多选菜单添加分组入口 + 输入弹窗标题收敛 + 按选中集合批量追加分组 + 全流程静默无提示”的同义证据；队列推进到下一项 `seq153(menu_remove_group)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq150`（`menu_enable_selection`）迁移闭环，已补齐“书源多选菜单启用所选入口 + 批量启用状态写入 + 全流程静默无提示”同义证据；队列推进到下一项 `seq151(menu_disable_selection)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq368`（`menu_change_source_delay`）迁移闭环，已补齐“换源候选弹层更多菜单换源间隔入口 + `0~9999` 秒滚轮选择 + 全局键 `batchChangeSourceDelay` 持久化 + 后续逐源搜索按秒级间隔串行执行”同义证据；队列推进到下一项 `seq150(book_source_sel/menu_enable_selection)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq366`（`menu_del_login_header`）迁移闭环，已补齐“登录表单页更多菜单删除登录头入口 + 删除 `loginHeader_<sourceKey>` + 清理书源 URL 作用域 Cookie + 全流程静默无提示”的同义证据；队列推进到下一项 `seq368(source_picker/menu_change_source_delay)`（`seq367` 后置）。
- `2026-02-22`：完成 `P4-seq365`（`menu_show_login_header`）迁移闭环，已补齐“登录表单页更多菜单查看登录头入口 + 读取 `loginHeader_<sourceKey>` 缓存 + 弹窗标题‘登录头’ + 有缓存时可复制文本”的同义证据；队列推进到下一项 `seq366(source_login/menu_del_login_header)`。
- `2026-02-22`：完成 `P4-seq360`（`menu_qr_code_camera`）迁移闭环，已补齐“书源编辑页更多菜单‘二维码导入’文案 + 扫码页标题‘扫描二维码’ + 扫码成功仅回填表单且不重置已保存快照 + 无扩展成功提示”的同义证据；队列推进到下一项 `seq365(source_login/menu_show_login_header)`。
- `2026-02-22`：完成 `P4-seq354`（`menu_search`）迁移闭环，已补齐“书源编辑页更多菜单搜索入口 + 点击先保存 + 入口侧显式写入 `searchScope=SearchScope.fromSource(saved)` + 进入搜索页范围锁定当前书源”的同义证据；队列推进到下一项 `seq360(source_edit/menu_qr_code_camera)`。
- `2026-02-22`：完成 `P4-seq192`（`menu_load_toc`）迁移闭环，已补齐“换源候选弹层 checkable 加载目录入口 + 全局键 `changeSourceLoadToc` 持久化 + 点击仅切换不刷新 + 刷新候选按开关决定是否预加载目录”同义证据；队列推进到下一项 `seq353(source_edit/menu_login)`。
- `2026-02-22`：完成 `P4-seq188`（`menu_refresh_list`）迁移闭环，已补齐“整书换源候选弹层刷新列表入口 + 基于当前候选来源集合重拉结果 + 刷新中动作防并发 + 失败静默保留列表”同义证据；队列推进到下一项 `seq192(menu_load_toc)`。
- `2026-02-22`：完成 `P4-seq187`（`menu_source_manage`）迁移闭环，已补齐“换源候选弹层书源管理入口 + 点击后打开书源管理页 + 返回后候选弹层继续保留”的同义证据；队列推进到下一项 `seq188(menu_refresh_list)`。
- `2026-02-22`：完成 `P4-seq158`（`menu_export_selection`）迁移闭环，已补齐“导出所选默认文件名 `bookSource.json` + 取消导出静默返回 + 成功路径可复制”的同义证据；队列推进到下一项 `seq150(menu_enable_selection)`。
- `2026-02-22`：完成 `P3-seq382`（`menu_paste_source`）迁移闭环，已补齐“编辑页更多菜单粘贴源入口 + 剪贴板 JSON 对象/数组解析 + 数组取首项回填 + 成功不自动保存”的同义证据；队列推进到下一项 `seq158(menu_export_selection)`。
- `2026-02-22`：完成 `P3-seq377`（`menu_save`）迁移闭环，已补齐“朗读引擎编辑页顶栏一级保存入口 + 点击后按当前表单落库 + 成功提示‘保存成功’ + 保存后停留编辑页”同义证据；队列推进到下一项 `seq382(menu_paste_source)`。
- `2026-02-22`：完成 `P3-seq372`（`menu_add`）迁移闭环，已补齐“语音管理页顶栏一级添加入口 + 空白草稿编辑页跳转 + 未保存不落库”同义证据；队列推进到下一项 `seq377(menu_save)`。
- `2026-02-22`：完成 `P3-seq256`（`menu_add`）迁移闭环，已补齐“编辑工具 -> 辅助按键配置”入口、配置弹层顶部添加动作、`key/value` 双输入框与 `serialNo=max+1` 持久化链路，并回流到编辑工具支持直接插入新增项 `value`；队列推进到下一项 `seq372(menu_add)`。
- `2026-02-22`：完成 `P3-seq238`（`menu_default`）迁移闭环，已补齐“字体弹层默认字体入口 + 系统内置字体样式三选项 + 选择后清空自定义字体并即时生效 + 关闭弹层”同义证据；队列推进到下一项 `seq256(menu_add)`。
- `2026-02-22`：完成 `P3-seq212`（`menu_share_str`）迁移闭环，已补齐“翻页阅读长按文本操作菜单分享入口 + 选中文本系统分享 + 异常静默吞错”同义证据；队列推进到下一项 `seq238(menu_default)`。
- `2026-02-22`：完成 `P3-seq211`（`menu_browser`）迁移闭环，已补齐“翻页阅读长按文本操作菜单浏览器入口 + URL 文本外部浏览器直开 + 非 URL 文本网页搜索 + 失败提示口径”同义证据；队列推进到下一项 `seq212(menu_share_str)`。
- `2026-02-22`：完成 `P3-seq209`（`menu_dict`）迁移闭环，已补齐“翻页阅读长按文本操作菜单字典入口 + 点击后弹出词典面板 + 默认规则自动查询 + 规则切换重查”同义证据；队列推进到下一项 `seq211(menu_browser)`。
- `2026-02-22`：完成 `P3-seq208`（`menu_aloud`）迁移闭环，已补齐“翻页阅读长按文本操作菜单朗读入口 + 点击按 `contentSelectSpeakMod` 执行双模式分流 + 长按菜单项切换模式并持久化”的同义证据；队列推进到下一项 `seq209(menu_dict)`。
- `2026-02-22`：完成 `P3-seq207`（`menu_bookmark`）迁移闭环，已补齐“翻页阅读长按文本操作菜单书签入口 + 选中文本预填书签编辑弹窗 + 取消不落库 + 确定后新增书签并刷新状态”的同义证据；队列推进到下一项 `seq208(menu_aloud)`。
- `2026-02-22`：完成 `P3-seq205`（`menu_replace`）迁移闭环，已补齐“翻页阅读长按文本动作入口 + selectedText 逐行 trim 预填 pattern + scope 预填 bookName;bookSourceUrl + 保存后刷新当前章节”的同义证据；ExecPlan 从 `blocked` 恢复为 `active`，队列推进到下一项 `seq207(menu_bookmark)`。
- `2026-02-22`：推进 `P3-seq205`（`menu_replace`）时发现阅读页缺少选中文本基础设施，无法等价复刻 legado `selectedText` 触发链路；已按迁移例外流程将 ExecPlan 标记为 `blocked`，并回填“原因/影响范围/替代方案/回补计划”，等待需求方确认解除阻塞。
- `2026-02-22`：完成 `P3-seq204`（`menu_enable_replace`）迁移闭环，已补齐“全文搜索菜单 checkable 替换入口 + 开关仅影响搜索链路且不自动重跑 + 搜索替换开关与书籍替换净化总开关组合生效”的同义证据；队列推进到下一项 `seq205(menu_replace)`。
- `2026-02-22`：完成 `P3-seq202`（`menu_reset`）迁移闭环，已补齐“重置先清缓存、网络书按书源重拉、本地书按本地文件回读、失败静默保留编辑内容并记录日志”的同义证据；队列推进到下一项 `seq204(menu_enable_replace)`。
- `2026-02-22`：完成 `P3-seq201`（`menu_save`）迁移闭环，已补齐“编辑正文保存仅在正文非空时覆盖章节缓存、空正文不落库且不污染现有正文”同义证据；队列推进到下一项 `seq202(menu_reset)`。
- `2026-02-22`：完成 `P3-seq93`（`menu_enable_record`）迁移闭环，已补齐“阅读记录页更多菜单 checkable 入口 + `enableReadRecord` 同名键持久化 + 关闭开关后不刷新 `lastReadTime`”同义证据；队列推进到下一项 `seq201(menu_save)`。
- `2026-02-22`：完成 `P3-seq9`（`menu_wake_lock`）迁移闭环，已补齐“播放菜单 checkable 入口 + `audioPlayWakeLock` 同名键持久化 + 重进菜单勾选态保持”同义证据；队列推进到下一项 `seq93(menu_enable_record)`。
- `2026-02-22`：完成 `P3-seq380`（`menu_del_login_header`）迁移闭环，已补齐“编辑页更多菜单删除登录头入口 + 按 `httpTts:<id>` 删除登录头缓存 + 删除动作静默无提示”同义证据；队列推进到下一项 `seq9(menu_wake_lock)`。
- `2026-02-22`：完成 `P3-seq379`（`menu_show_login_header`）迁移闭环，已补齐“编辑页更多菜单查看登录头入口 + 按 `httpTts:<id>` 读取缓存 + 标题为登录头的只读弹窗（无缓存仅标题）”同义证据；队列推进到下一项 `seq380(menu_del_login_header)`。
- `2026-02-22`：完成 `P3-seq378`（`menu_login`）迁移闭环，已补齐“HTTP 朗读引擎编辑承载页 + 更多菜单登录入口 + 登录前保存编辑输入 + 空 `loginUrl` 提示”同义证据；队列推进到下一项 `seq379(menu_show_login_header)`。
- `2026-02-22`：完成 `P3-seq376`（`menu_export`）迁移闭环，已补齐“导出入口 + 默认文件名 `httpTts.json` + JSON 数组落盘 + 成功路径展示与复制路径”同义证据；队列推进到下一项 `seq378(menu_login)`。
- `2026-02-22`：完成 `P3-seq375`（`menu_import_onLine`）迁移闭环，已补齐“网络导入入口 + URL 输入与历史管理 + 候选状态对比（新增/更新/已有）+ 默认勾选新增/更新 + 仅提交勾选项”同义证据；队列推进到下一项 `seq376(menu_export)`。
- `2026-02-22`：完成 `P3-seq374`（`menu_import_local`）迁移闭环，已补齐“本地导入入口 + txt/json 选档 + 候选状态对比（新增/更新/已有）+ 默认勾选新增/更新 + 仅提交勾选项”同义证据；队列推进到下一项 `seq375(menu_import_onLine)`。
- `2026-02-22`：完成 `P3-seq373`（`menu_default`）迁移闭环，已补齐“语音管理入口承载 + 导入默认规则菜单动作 + 默认规则资产同源 + `id<0` 默认规则重置边界”同义证据；队列推进到下一项 `seq374(menu_import_local)`。
- `2026-02-22`：完成 `P3-seq239`（`menu_other`）迁移闭环，已补齐“字体弹层其它目录入口 + 目录路径持久化 + `ttf/otf` 候选刷新 + 目录字体即时应用”的同义证据；队列推进到下一项 `seq373(menu_default)`。
- `2026-02-22`：完成 `P3-seq210`（`menu_search_content`）迁移闭环，已补齐“跨章节全文命中列表 + 在线缓存边界 + 跨章节跳转定位 + 搜索任务并发收敛”同义证据；队列推进到下一项 `seq239(menu_other)`。
- `2026-02-22`：完成 `P3-seq88`（`menu_book_change_source`）迁移闭环，已补齐“分支菜单文案收敛为整书换源 + 成功静默无 toast + 与顶栏点击换源同链路触发”的同义证据；队列推进到下一项 `seq210(menu_search_content)`。
- `2026-02-22`：完成 `P3-seq87`（`menu_chapter_change_source`）迁移闭环，已补齐“候选书源选择后手动选章、仅替换当前章节正文、成功静默无 toast”的同义证据；队列推进到下一项 `seq88(menu_book_change_source)`。
- `2026-02-22`：完成 `P3-seq8`（`audio_play/menu_edit_source`）迁移闭环，已补齐“播放菜单编辑书源入口 + 打开编辑页 + 仅保存返回刷新”的同义证据；队列推进到下一项 `seq87(menu_chapter_change_source)`。
- `2026-02-22`：完成 `P3-seq6`（`audio_play/menu_login`）迁移闭环，已补齐“登录入口显隐（`loginUrl` 非空）+ 登录触发路径”同义证据；队列推进到下一项 `seq8(menu_edit_source)`。
- `2026-02-22`：完成 `P3-seq5`（`audio_play/menu_change_source`）迁移闭环，已补齐“朗读长按播放菜单 + 换源入口触发 + 整书换源链路复用”的同义证据；队列推进到下一项 `seq6(menu_login)`。
- `2026-02-22`：完成 `P2-seq348`（`menu_search`）迁移闭环，已补齐“单一搜索控件内提交动作 + 占位文案收敛 + 输入变更停止搜索边界”的同义证据；队列推进到下一项 `seq5(menu_change_source)`。
- `2026-02-22`：完成 `P3-seq84`（`menu_effective_replaces`）迁移闭环，已补齐“当前章节命中规则弹层 + 简繁转换同层级入口 + 编辑后统一重载当前章节”的同义证据；队列推进到下一项 `seq348(menu_search)`。
- `2026-02-22`：完成 `P3-seq82`（`menu_image_style`）迁移闭环，已补齐“图片样式四档书籍级持久化 + `SINGLE` 仅当前书籍强制覆盖翻页 + 切换后即时重载正文”的同义证据；队列推进到下一项 `seq84(menu_effective_replaces)`。
- `2026-02-22`：完成 `P3-seq81`（`menu_del_h_tag`）迁移闭环，已补齐“文案收敛、`h1~h6` 整段节点内容清理、全量清缓存后重载当前章节”的同义证据；队列推进到下一项 `seq82(menu_image_style)`。
- `2026-02-22`：完成 `P3-seq80`（`menu_del_ruby_tag`）迁移闭环，已补齐“文案收敛、`rt/rp` 清理边界、全量清缓存后重载当前章节”的同义证据；队列推进到下一项 `seq81(menu_del_h_tag)`。
- `2026-02-22`：完成 `P3-seq79`（`menu_enable_review`）迁移闭环，已补齐“隐藏入口结构保留 + 默认不展示 + 默认不可触发”的同义证据；队列推进到下一项 `seq80(menu_del_ruby_tag)`。
- `2026-02-22`：完成 `P3-seq78`（`menu_re_segment`）迁移闭环，已补齐“固定 checkable 文案 + 书籍级开关持久化 + 重载前保存进度避免位点漂移 + 无扩展提示”的同义证据；队列推进到下一项 `seq79(menu_enable_review)`。
- `2026-02-22`：完成 `P3-seq77`（`menu_same_title_removed`）迁移闭环，已补齐“文案收敛 + 勾选态按实际移除结果 + `!sameTitleRemoved` 翻转语义 + 提示边界收敛”的同义证据；队列推进到下一项 `seq78(menu_re_segment)`。
- `2026-02-22`：完成 `P3-seq76`（`menu_enable_replace`）迁移闭环，已补齐“替换净化文案收敛 + 去除扩展 toast + 点击即切换并刷新正文”的同义证据；队列推进到下一项 `seq77(menu_same_title_removed)`。
- `2026-02-22`：完成 `P3-seq75`（`menu_simulated_reading`）迁移闭环，已补齐“配置弹窗落盘 + 可读章节上限收敛 + `Period.days + 1` 口径对齐”的同义证据；队列推进到下一项 `seq76(menu_enable_replace)`。
- `2026-02-22`：完成 `P3-seq74`（`menu_reverse_content`）迁移闭环，已补齐“字符级倒序、仅缓存正文、缺失静默返回”的同义证据；队列推进到下一项 `seq75(menu_simulated_reading)`。
- `2026-02-22`：完成 `P3-seq73`（`menu_cover_progress`）迁移闭环，已补齐“静默守卫、成功文案收敛、失败日志+提示”的同义证据；队列推进到下一项 `seq74(menu_reverse_content)`。
- `2026-02-22`：完成 `P3-seq72`（`menu_get_progress`）迁移闭环，已补齐“静默同步、落后确认、越界不覆盖、失败仅日志”的同义证据；队列推进到下一项 `seq73(menu_cover_progress)`。
- `2026-02-22`：完成 `P3-seq71`（`menu_page_anim`）迁移闭环，已补齐“本书级翻页动画覆盖 + 样式面板改全局时清覆盖”的同义证据；队列推进到下一项 `seq72(menu_get_progress)`。
- `2026-02-22`：完成 `P3-seq70`（`menu_edit_content`）迁移闭环，已补齐正文抓取失败的可观测兜底（日志 + 回退 + 提示）以及编辑页重置期间全屏加载锁定；队列推进到下一项 `seq71(menu_page_anim)`。
- `2026-02-22`：完成 `P3-seq69`（`menu_add_bookmark`）迁移闭环，阅读菜单与九宫格动作均收敛为“弹窗确认后新增”同义语义，并补齐目录书签按 `chapterPos` 恢复进度；队列推进到下一项 `seq70(menu_edit_content)`。
- `2026-02-21`：完成 P1（主入口与导航）`21/21` 项逐项迁移与验收，全部为 `done`，无 `blocked` 项；阶段内所有入口均补齐了可复现验证证据。
- `2026-02-22`：完成 `P3-seq95`（`menu_refresh_after`）迁移闭环，已补齐差异清单、逐项对照与可复现验证证据；队列推进到下一项 `seq96(menu_refresh_all)`。
- `2026-02-22`：完成 `P3-seq96`（`menu_refresh_all`）迁移闭环，已补齐“首章起全量清缓存 + 无书源回落当前章节重载”的独立验证证据；队列推进到下一项 `seq97(menu_login)`。
- `2026-02-22`：完成 `P3-seq97`（`menu_login`）迁移闭环，已补齐“按 `bookSourceUrl` 回查当前书源后触发登录”的实时状态边界证据；队列推进到下一项 `seq98(menu_chapter_pay)`。
- `2026-02-22`：完成 `P3-seq98`（`menu_chapter_pay`）迁移闭环，已补齐“显隐条件、`isTrue` 判定与异常日志可观测”的同义证据；队列推进到下一项 `seq99(menu_edit_source)`。
- `2026-02-22`：完成 `P3-seq99`（`menu_edit_source`）迁移闭环，已补齐“按 `bookSourceUrl` 实时回查再编辑 + 仅保存返回刷新”的同义证据；队列推进到下一项 `seq100(menu_disable_source)`。
- `2026-02-22`：完成 `P3-seq100`（`menu_disable_source`）迁移闭环，已补齐“点击即禁用、无确认弹窗/无成功提示 + 按 `bookSourceUrl` 回查防止快照重建”的同义证据；队列推进到下一项 `seq164(menu_split_long_chapter)`。
- `2026-02-22`：完成 `P2-seq164`（`menu_split_long_chapter`）迁移闭环，已补齐目录页 `checkable` 入口、仅本地 TXT 显示与切换后即时重建目录的同义证据；队列推进到下一项 `seq166(menu_use_replace)`。
- `2026-02-22`：完成 `P2-seq166`（`menu_use_replace`）迁移闭环，已补齐目录页“使用替换”checkable 入口、全局持久化与目录标题即时重算的同义证据；队列推进到下一项 `seq167(menu_load_word_count)`。
- `2026-02-22`：完成 `P2-seq167`（`menu_load_word_count`）迁移闭环，已补齐目录页“加载字数”checkable 入口、全局持久化默认值与目录即时刷新链路，并在已缓存章节上补齐字数显隐（`xx字/xx万字`）证据；队列推进到下一项 `seq69(menu_add_bookmark)`。
