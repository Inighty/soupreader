{"done":false,"done_reason":"当前仓库 UI 仍有核心页未全面接入 iOS 大标题导航（`useSliverNavigationBar: true` 目前仅见于书架页），且现有 UI Cupertino 差异台账 `docs/plans/2026-02-27-ui-cupertino-diff.md` 的扫描结论与当前代码存在偏差，需要先完成差异清单冻结再推进迁移实现与回归收口。","goal_summary":"将“大目标：根据 AGENTS.md 修改 UI”拆解为下一批可执行任务（本批聚焦：差异清单冻结 + 发现/订阅/我的三核心页接入 Cupertino 大标题导航 + 回归收口记录），严格遵守迁移级流程与 Cupertino 规范。","tasks":[{"id":"UI-01","title":"刷新并冻结 Cupertino UI 差异台账（以当前代码为准）","priority":1,"prompt":"改动范围：仅更新文档 `docs/plans/2026-02-27-ui-cupertino-diff.md`（不改业务代码）。\n预期行为：\n1) 以当前仓库代码为准，重新执行台账中的定向扫描命令（`shadcn_ui`、`showGeneralDialog`、`useSliverNavigationBar`、`CupertinoSliverNavigationBar`、`ShadTheme|ShadButton|ShadCard`），把命中数量与命中文件列表更新到“1.2/1.3”。\n2) 若 `lib/` 内已无 `shadcn_ui` 命中，则同步修正 `EX-NAV-02`（将状态从 `blocked` 调整为 `tracked/done` 或按实际原因改写；不得保留与当前代码矛盾的结论）。\n3) 同步校准 `N-01~N-04` 当前状态：核对四个核心页是否已接入 `useSliverNavigationBar: true`，并更新表格状态（`pending/in_progress/done/blocked`）。\n验证方式：\n- 运行 verify_cmd 的 `rg` 扫描命令并对照文档中统计与文件清单一致；\n- 手工检查文档中“blocked”项是否仍有可复现的代码依据（如无依据必须移除或降级为非阻塞记录）。","verify_cmd":"rg -n \"shadcn_ui\" lib && rg -n \"showGeneralDialog\" lib && rg -n \"useSliverNavigationBar\" lib && rg -n \"useSliverNavigationBar:\\s*true\" lib && rg -n \"CupertinoSliverNavigationBar\" lib && rg -n \"ShadTheme|ShadButton|ShadCard\" lib","required_paths":["docs/plans/2026-02-27-ui-cupertino-diff.md"],"depends_on":[]},{"id":"UI-02","title":"N-02：发现页接入 Cupertino 大标题导航（Sliver 化）","priority":2,"prompt":"改动范围：`lib/features/discovery/views/discovery_view.dart`（必要时可小幅调整同目录内仅与该页滚动结构相关的私有构建函数；避免波及其他 feature）。\n预期行为：\n1) 将发现页外层 `AppCupertinoPageScaffold` 从默认 `CupertinoNavigationBar` 路径迁移到大标题导航：设置 `useSliverNavigationBar: true`，并使用 `sliverBodyBuilder` 输出 Sliver 结构。\n2) 将当前 `Column + Expanded + ListView` 的滚动结构改为单一 `CustomScrollView` sliver 结构，避免嵌套滚动；搜索框区块、计数/筛选提示、空态/无结果态/列表态需要在 sliver 下保持现有语义与布局层级（平台差异除外）。\n3) 保持现有交互语义不变：筛选菜单按钮（trailing）、搜索输入、滚动控制（若当前用 `_scrollController`，需保证控制器仍驱动主滚动容器）、空态文案与图标不变。\n4) 满足台账 `N-AC-01~03`：大标题折叠/展开随滚动稳定；Tab 根页不应因右滑触发 pop；进入二级页后仍保留 iOS 侧滑返回。\n验证方式：\n- 代码级：确认该页存在 `useSliverNavigationBar: true` 且 `sliverBodyBuilder` 已接入；\n- 手工回归：进入“发现”Tab，上下滚动触发大标题折叠/展开；搜索后列表/空态切换正常；从发现进入二级页（如书源详情/编辑等入口）并侧滑返回；在根页右滑不应退出/回退 Tab 根路由。","verify_cmd":"rg -n \"useSliverNavigationBar:\\s*true\" lib/features/discovery/views/discovery_view.dart","required_paths":["lib/features/discovery/views/discovery_view.dart","lib/app/widgets/app_cupertino_page_scaffold.dart","docs/plans/2026-02-27-ui-cupertino-diff.md"],"depends_on":["UI-01"]},{"id":"UI-03","title":"N-03：订阅页接入 Cupertino 大标题导航（Sliver 化）","priority":3,"prompt":"改动范围：`lib/features/rss/views/rss_subscription_view.dart`。\n预期行为：\n1) 将订阅页外层 `AppCupertinoPageScaffold` 接入大标题导航：`useSliverNavigationBar: true`，并以 `sliverBodyBuilder` 组织整个页面滚动。\n2) 将 `Column + Expanded + ListView.separated` 改为 sliver 单滚动：搜索框、计数行、规则订阅入口、列表/空态全部作为 sliver 组成；保持现有 padding/间距语义一致（iOS 视觉可允许细微差异，但信息层级、热区与动作路径必须同义）。\n3) 保持现有 trailing 三按钮语义不变（收藏/分组/设置），以及长按弹出操作、点击进入订阅源等逻辑不变。\n4) 满足台账 `N-AC-01~03`（大标题折叠、滚动稳定、返回手势约束）。\n验证方式：\n- 代码级：确认 `useSliverNavigationBar: true` 生效且页面不再嵌套主列表滚动；\n- 自动化（定向）：运行现有订阅页相关测试文件（不修改测试，仅运行）；\n- 手工回归：进入“订阅”Tab，滚动折叠/展开稳定；搜索筛选后计数与列表刷新；空态按钮行为正确。","verify_cmd":"flutter test test/rss_subscription_view_group_menu_test.dart","required_paths":["lib/features/rss/views/rss_subscription_view.dart","lib/app/widgets/app_cupertino_page_scaffold.dart","test/rss_subscription_view_group_menu_test.dart","docs/plans/2026-02-27-ui-cupertino-diff.md"],"depends_on":["UI-01"]},{"id":"UI-04","title":"N-04：我的页接入 Cupertino 大标题导航（Sliver 化）","priority":4,"prompt":"改动范围：`lib/features/settings/views/settings_view.dart`。\n预期行为：\n1) 将“我的”页外层 `AppCupertinoPageScaffold` 接入大标题导航：`useSliverNavigationBar: true`。\n2) 将当前 `ListView` 内容迁移到 `sliverBodyBuilder`（例如 `SliverPadding + SliverList/SliverToBoxAdapter` 组合），确保滚动行为与大标题折叠联动自然；原有分组（`CupertinoListSection.insetGrouped`）结构保持。\n3) 保持 trailing 帮助按钮 `_buildHelpAction()` 行为不变；各菜单项 key/文案/跳转不变；Web 服务“本轮不迁移”的弹窗/提示语义不变。\n4) 满足台账 `N-AC-01~03`。\n验证方式：\n- 代码级：确认 `useSliverNavigationBar: true` 接入且 `ListView` 不再作为页面根滚动；\n- 自动化（定向）：运行与“我的/设置导航一致性”相关的现有测试（不改测试）；\n- 手工回归：进入“我的”Tab，滚动折叠/展开稳定；进入二级页侧滑返回正常；根页右滑不回退根路由。","verify_cmd":"flutter test test/reading_settings_navigation_parity_test.dart","required_paths":["lib/features/settings/views/settings_view.dart","lib/app/widgets/app_cupertino_page_scaffold.dart","test/reading_settings_navigation_parity_test.dart","docs/plans/2026-02-27-ui-cupertino-diff.md"],"depends_on":["UI-01"]},{"id":"UI-05","title":"N-VAL-01：导航专项手工回归收口记录（含排版一致性）","priority":5,"prompt":"改动范围：文档（优先在 `docs/plans/2026-02-27-ui-cupertino-diff.md` 的 `N-VAL-01` 条目下补充回归证据；若篇幅过长可新增同目录补充文档并在台账中引用）。\n预期行为：\n1) 在 `N-01~N-04` 均完成接入后，按台账 `N-AC-01~03` 对四个核心页逐项回填手工回归结论，必须包含“排版布局一致性”结论（加载/空态/错误/列表状态的层级、间距、对齐、热区）。\n2) 对每个核心页给出可复现的回归路径（从 Tab 根页开始），并记录是否通过；如发现无法等价复现的点，按 AGENTS `1.1.2` 追加例外记录（原因/影响范围/替代方案/回补计划），不得直接宣称一致。\n验证方式：\n- 代码级：检查台账 `N-VAL-01` 从 `blocked` 转为可收口状态，并附有逐页证据；\n- 手工：按文档路径复走一遍，确保记录可复现。","verify_cmd":"rg -n \"N-VAL-01\" docs/plans/2026-02-27-ui-cupertino-diff.md","required_paths":["docs/plans/2026-02-27-ui-cupertino-diff.md"],"depends_on":["UI-02","UI-03","UI-04"]},{"id":"UI-06","title":"补齐核心页 useSliverNavigationBar 扫描回填与台账状态同步","priority":6,"prompt":"改动范围：`docs/plans/2026-02-27-ui-cupertino-diff.md`（仅文档回填），并要求实现已在 `UI-02~UI-04` 中落地。\n预期行为：\n1) 在完成 N-02/N-03/N-04 代码修改后，重新扫描 `useSliverNavigationBar` 与 `useSliverNavigationBar: true` 的命中数量与文件列表，并回填到台账 1.2/1.3。\n2) 将 `N-02~N-04` 状态从 `pending` 更新为 `in_progress/done`（按实际完成度），并在表格中补充对应的手工回归路径是否已执行。\n3) 确保台账对“核心页大标题导航接入”的结论与代码一致，不留历史矛盾描述。\n验证方式：\n- 运行 verify_cmd 的 `rg` 命令并对照文档统计一致；\n- 人工快速抽查四个文件的 `AppCupertinoPageScaffold` 参数，确保 `useSliverNavigationBar: true` 覆盖 N-01~N-04。","verify_cmd":"rg -n \"useSliverNavigationBar:\\s*true\" lib/features/bookshelf/views/bookshelf_view.dart lib/features/discovery/views/discovery_view.dart lib/features/rss/views/rss_subscription_view.dart lib/features/settings/views/settings_view.dart","required_paths":["docs/plans/2026-02-27-ui-cupertino-diff.md","lib/features/bookshelf/views/bookshelf_view.dart","lib/features/discovery/views/discovery_view.dart","lib/features/rss/views/rss_subscription_view.dart","lib/features/settings/views/settings_view.dart"],"depends_on":["UI-02","UI-03","UI-04"]}],"notes":["本批任务遵守迁移级前置：先完成差异清单冻结（UI-01）再推进实现（UI-02~UI-04）。","当前仓库 `pubspec.yaml` 仍声明 `shadcn_ui` 且 `test/` 内存在对 `shadcn_ui` 的依赖；按 AGENTS 约束，本批不触碰/改造测试用例。如需求方希望彻底清退依赖（含 `pubspec.yaml` 与 `test/`），需明确授权后另起任务批次处理。"]}