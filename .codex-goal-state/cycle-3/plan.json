{"done":false,"done_reason":"目标尚未完成：`N-VAL-01` 证据文件仍为“待验证/待回填”，`N-01~N-04` 与 `D-04` 在台账仍未收口；另外 `updateToVariant` 仍存在与 legado 三值口径不一致风险（含 `official_version`）。","goal_summary":"下一批任务应先完成 D-04 口径复核与代码收敛，再回填导航专项证据并同步台账状态，最后做一次定向守卫扫描形成可审计收口记录。","tasks":[{"id":"R3-T01-d04-diff-rescan","title":"复扫 D-04 差异并冻结基线（含 legado 对照）","priority":1,"prompt":"改动范围：`docs/plans/2026-02-27-ui-cupertino-diff.md`、`docs/plans/2026-02-26-my-menu-parity-checklist.md`。先完整读取 legado 对应实现（`../legado/app/src/main/java/io/legado/app/ui/setting/OtherConfigFragment.kt` 及其引用的更新版本配置逻辑），再对照当前 Flutter 代码，复扫并回填 D-04 当前真实差异：1) `updateToVariant` 可选值是否严格三值同义；2) Web 区是否仅只读回显且无可操作入口。预期行为：两份台账对 D-04 的“现状/剩余项/依赖”描述一致，且不再使用过期结论。验证方式：检索 D-04、updateToVariant、Web 只读关键词，确认台账无互相矛盾状态。","verify_cmd":"rg -n \"D-04|updateToVariant|default_version|beta_release_version|beta_releaseA_version|official_version|Web 服务（未启用）|不可操作|in_progress|done|blocked\" docs/plans/2026-02-27-ui-cupertino-diff.md docs/plans/2026-02-26-my-menu-parity-checklist.md","required_paths":["docs/plans/2026-02-27-ui-cupertino-diff.md","docs/plans/2026-02-26-my-menu-parity-checklist.md"],"depends_on":[]},{"id":"R3-T02-d04-variant-fix","title":"按 legado 三值口径收敛 updateToVariant（代码）","priority":2,"prompt":"改动范围：`lib/core/models/app_settings.dart`、`lib/core/services/settings_service.dart`、`lib/features/settings/views/other_settings_view.dart`。按 legado 语义仅保留 `default_version`、`beta_release_version`、`beta_releaseA_version` 三值：移除 UI 中 `official_version` 入口；`normalizeUpdateToVariant` 对历史脏值统一回退到默认值；设置页回显与保存链路保持稳定。预期行为：其它设置页“检查更新查找版本”只显示三项，保存后持久化正确，旧配置值不会导致异常或脏展示。验证方式：检索常量/选项/归一化逻辑，确认无 `official_version` 可选入口且三值链路闭环。","verify_cmd":"rg -n \"officialUpdateToVariant|official_version|default_version|beta_release_version|beta_releaseA_version|normalizeUpdateToVariant|检查更新查找版本\" lib/core/models/app_settings.dart lib/core/services/settings_service.dart lib/features/settings/views/other_settings_view.dart","required_paths":["lib/core/models/app_settings.dart","lib/core/services/settings_service.dart","lib/features/settings/views/other_settings_view.dart"],"depends_on":["R3-T01-d04-diff-rescan"]},{"id":"R3-T03-nav-evidence-refill","title":"回填 N-VAL-01 四页导航回归证据","priority":3,"prompt":"改动范围：`docs/plans/evidence/2026-02-27-ui-nav-final-regression/R-N01-bookshelf.md`、`R-N02-discovery.md`、`R-N03-rss.md`、`R-N04-settings.md`。基于当前实现执行手工回归并回填每页 `N-AC-01`/`N-AC-02`/`N-AC-03` 与“排版布局一致性”结论；将“结果/处理动作”从待回填改为可审计结论。`R-N03` 必须明确记录 `noEnabled` 空态按钮进入订阅源管理（`_openSourceSettings`）同义性。预期行为：四份证据文档不再出现“待验证/待回填”，且每页都有可追踪结论与动作。验证方式：关键词检索必须命中 `N-AC-01~03`、排版布局一致性、noEnabled（R-N03），且不命中“待验证/待回填”。","verify_cmd":"rg -n \"N-AC-01|N-AC-02|N-AC-03|排版布局一致性|noEnabled|订阅源管理|结果|处理动作|待验证|待回填\" docs/plans/evidence/2026-02-27-ui-nav-final-regression/R-N01-bookshelf.md docs/plans/evidence/2026-02-27-ui-nav-final-regression/R-N02-discovery.md docs/plans/evidence/2026-02-27-ui-nav-final-regression/R-N03-rss.md docs/plans/evidence/2026-02-27-ui-nav-final-regression/R-N04-settings.md","required_paths":["docs/plans/evidence/2026-02-27-ui-nav-final-regression/R-N01-bookshelf.md","docs/plans/evidence/2026-02-27-ui-nav-final-regression/R-N02-discovery.md","docs/plans/evidence/2026-02-27-ui-nav-final-regression/R-N03-rss.md","docs/plans/evidence/2026-02-27-ui-nav-final-regression/R-N04-settings.md"],"depends_on":["R3-T02-d04-variant-fix"]},{"id":"R3-T04-status-closeout-sync","title":"同步台账收口状态（N-01~N-04 / N-VAL-01 / D-04）","priority":4,"prompt":"改动范围：`docs/plans/2026-02-27-ui-cupertino-diff.md`、`docs/plans/2026-02-26-my-menu-parity-checklist.md`、`PLANS.md`。在证据回填后统一更新状态：`N-01~N-04` 与 `N-VAL-01` 的完成面、`D-04` 的剩余项/完成项、依赖链描述（保持 `D-03 -> D-04` 与 `N-01~N-04 -> N-VAL-01` 语义一致）。预期行为：三份台账对同一 ID 状态一致，不再存在“已完成但仍 pending/in_progress”的冲突文本。验证方式：同一关键词在三文档中的状态应一致，且“证据待回填”应被移除或转为明确 blocked 记录。","verify_cmd":"rg -n \"N-01|N-02|N-03|N-04|N-VAL-01|D-04|D-03 -> D-04|pending|in_progress|done|blocked|证据待回填\" docs/plans/2026-02-27-ui-cupertino-diff.md docs/plans/2026-02-26-my-menu-parity-checklist.md PLANS.md","required_paths":["docs/plans/2026-02-27-ui-cupertino-diff.md","docs/plans/2026-02-26-my-menu-parity-checklist.md","PLANS.md"],"depends_on":["R3-T03-nav-evidence-refill"]},{"id":"R3-T05-cupertino-guard-record","title":"补充 Cupertino 约束定向检查记录","priority":5,"prompt":"改动范围：`docs/plans/2026-02-27-ui-cupertino-diff.md`。新增或更新“定向检查结果”小节，记录本轮守卫扫描摘要：`shadcn_ui`、`showGeneralDialog`、`package:flutter/material.dart` 残留情况，以及四个核心页 `useSliverNavigationBar: true` 命中。预期行为：文档中有可复用的命令与结果摘要，满足 AGENTS 的 Cupertino 主实现约束可审计性。验证方式：运行给定 `rg` 命令，检查文档已回填命中摘要与日期。","verify_cmd":"rg -n \"shadcn_ui|showGeneralDialog|package:flutter/material\\.dart|useSliverNavigationBar:\\s*true\" lib && rg -n \"定向检查结果|shadcn_ui|showGeneralDialog|material\\.dart|useSliverNavigationBar\" docs/plans/2026-02-27-ui-cupertino-diff.md","required_paths":["docs/plans/2026-02-27-ui-cupertino-diff.md","lib/features/bookshelf/views/bookshelf_view.dart","lib/features/discovery/views/discovery_view.dart","lib/features/rss/views/rss_subscription_view.dart","lib/features/settings/views/settings_view.dart"],"depends_on":["R3-T04-status-closeout-sync"]}],"notes":["本批任务保持“先差异清单、再代码收敛、后证据回填与台账收口”的串行主链。","并行性建议：本批基本为串行收口；若需要并行，仅允许在 R3-T03 中四份证据文件分 owner 回填。","按 AGENTS 约束，本批验证不使用 `flutter analyze`，仅使用定向 `rg` 与已存在回归路径记录。"]}