{"done":false,"done_reason":"目标“根据AGENTS.md修改ui”尚未完成；当前仓库仍存在少量 Material 依赖与主页面未统一采用 iOS 大标题导航（CupertinoSliverNavigationBar）等与规范不完全一致点，需要先产出差异清单再逐项迁移。","goal_summary":"以迁移级口径对齐 AGENTS.md 的 Flutter Cupertino UI 规范：先输出差异点清单（含 legado 对照依据），再清理 UI 层 Material 依赖并将关键页面切换到 iOS 大标题导航与可侧滑返回的导航行为。","tasks":[{"id":"UI-DIFF-01","title":"产出 UI 差异点清单（对照 AGENTS + legado）","priority":1,"prompt":"改动范围：新增迁移文档（建议放在 `docs/migration/ui_parity_checklist.md`），不改业务代码。\n预期行为：\n- 按 AGENTS.md UI 强约束逐条核对当前 soupreader UI：是否使用 Flutter Cupertino 作为主实现、是否存在 Material 组件/路由/弹窗混用、导航是否支持侧滑返回、导航栏是否优先使用大标题（CupertinoSliverNavigationBar）、弹窗是否统一 CupertinoAlertDialog / CupertinoActionSheet、字体是否保持系统 SF 视觉一致（不额外引入自定义字体）。\n- 必须补充 legado 对照依据：对每个差异点标注“legado 对应页面/入口 + 相关文件路径/资源 key（在 `../legado` 中查）+ 当前 soupreader 对应文件路径”。无法确认 legado 对应实现时，按 1.1.2 标记 blocked，并写清原因/影响范围/替代方案/回补计划。\n验证方式：\n- 本地命令确认文档存在且包含差异列表与 blocked 记录。\n- 同时给出用于复查的 rg 命令片段（Material import、CupertinoSliverNavigationBar 使用情况等）。","verify_cmd":"test -f docs/migration/ui_parity_checklist.md && rg -n \"^#|^##|差异|blocked\" docs/migration/ui_parity_checklist.md","required_paths":["docs"],"depends_on":[]},{"id":"UI-IMPORT-01","title":"移除 SelectableText 的 Material 依赖（保持 UI 行为不变）","priority":2,"prompt":"改动范围：\n- `lib/features/settings/views/app_help_dialog.dart`\n- `lib/features/settings/views/about_settings_view.dart`\n- `lib/features/reader/views/reader_dict_lookup_sheet.dart`\n\n预期行为：\n- 不再通过 `package:flutter/material.dart` 引入 `SelectableText`（改用 `package:flutter/widgets.dart` 或其它非 Material 来源），页面展示与可选择复制文本行为保持不变。\n- 保持现有 Cupertino 弹窗/弹层交互语义不变（关闭按钮、滚动、SafeArea、颜色解析等不改）。\n- 若差异清单（UI-DIFF-01）对这些页面有 legado 交互差异标注，需同时按清单约束修正；否则仅做“移除 Material import”这一项，避免扩展。\n验证方式：\n- `rg` 确认上述文件不再包含 `package:flutter/material.dart`。\n- 跑最小集 Flutter 测试确保工程可编译（不运行 `flutter analyze`）。","verify_cmd":"rg -n \"package:flutter/material\\.dart\" lib/features/settings/views/app_help_dialog.dart lib/features/settings/views/about_settings_view.dart lib/features/reader/views/reader_dict_lookup_sheet.dart || true\nflutter test test/widget_test.dart","required_paths":["lib/features/settings/views/app_help_dialog.dart","lib/features/settings/views/about_settings_view.dart","lib/features/reader/views/reader_dict_lookup_sheet.dart"],"depends_on":["UI-DIFF-01"]},{"id":"UI-IMPORT-02","title":"移除书源管理页 Reorderable* 的 Material 依赖（保持拖拽排序语义）","priority":3,"prompt":"改动范围：`lib/features/source/views/source_list_view.dart`\n\n预期行为：\n- 不再从 `package:flutter/material.dart` 引入 `ReorderableListView` / `ReorderableDragStartListener`（改用 Widgets 库来源），交互与行为保持一致：拖拽手柄、列表可重排、排序模式为“手动”时可拖拽，其它排序模式下行为不被破坏。\n- 保持现有 Cupertino 页面容器、弹窗、菜单（showCupertinoModalPopup / CupertinoAlertDialog / CupertinoActionSheet 等）行为不变。\n- 若 legado 对照（来自 UI-DIFF-01）指出书源管理页的排序/分组/拖拽热区语义差异，本任务仅处理“Material import 清理 + 保持现有语义”，差异修复另开任务，避免混入。\n验证方式：\n- 运行该页面的 compile test（仓库已有）：`test/source_list_view_compile_test.dart`。\n- `rg` 确认该文件不再包含 `package:flutter/material.dart`。","verify_cmd":"flutter test test/source_list_view_compile_test.dart\nrg -n \"package:flutter/material\\.dart\" lib/features/source/views/source_list_view.dart || true","required_paths":["lib/features/source/views/source_list_view.dart","test/source_list_view_compile_test.dart"],"depends_on":["UI-DIFF-01"]},{"id":"UI-IMPORT-03","title":"移除阅读绘制组件 ScrollSegmentPaintView 的 Material 依赖（仅保留绘制能力）","priority":4,"prompt":"改动范围：`lib/features/reader/widgets/scroll_segment_paint_view.dart`\n\n预期行为：\n- 不再 `import 'package:flutter/material.dart';`；改为更基础的依赖（widgets/painting/rendering 或 cupertino + 需要的类），组件绘制逻辑、TextPainter 缓存策略与高亮渲染效果保持不变。\n- 不引入任何新的 UI 体系，不更改现有参数/调用方（如 `simple_reader_view.dart`）。\n验证方式：\n- 运行与阅读页相关的 compile test（仓库已有）：`test/simple_reader_view_compile_test.dart`。\n- `rg` 确认该文件不再包含 `package:flutter/material.dart`。","verify_cmd":"flutter test test/simple_reader_view_compile_test.dart\nrg -n \"package:flutter/material\\.dart\" lib/features/reader/widgets/scroll_segment_paint_view.dart || true","required_paths":["lib/features/reader/widgets/scroll_segment_paint_view.dart","test/simple_reader_view_compile_test.dart"],"depends_on":["UI-DIFF-01"]},{"id":"UI-NAV-SETTINGS-01","title":"SettingsView（我的页）切换到 iOS 大标题导航并消除嵌套滚动","priority":5,"prompt":"改动范围：\n- `lib/features/settings/views/settings_view.dart`\n- 可能联动：`lib/app/widgets/app_cupertino_page_scaffold.dart`（仅在确有必要时）\n\n预期行为：\n- 按 AGENTS.md：导航栏优先使用 iOS 大标题导航（`CupertinoSliverNavigationBar`）。参考 `BookshelfView` 的既有实现方式：`useSliverNavigationBar: true` + `sliverBodyBuilder`，避免在 Sliver 容器内再嵌套 `ListView` 导致双滚动。\n- 保持 legado 入口顺序语义不变（文件头注释已说明对标 `pref_main.xml`）：条目分组、点击行为、弹窗文案、开关态、异常分支处理不改。\n- 保持 iOS 侧滑返回可用（路由仍用 CupertinoPageRoute 等既有方式）。\n验证方式：\n- 运行仓库已有回归守护脚本（不含 flutter analyze）：`bash tool/my_menu_smoke.sh`。\n- 手工回归路径记录到 UI-DIFF-01 的文档里：进入“我的”tab，检查顶部大标题收起/展开、列表滚动、各入口可进入/可返回。","verify_cmd":"bash tool/my_menu_smoke.sh","required_paths":["lib/features/settings/views/settings_view.dart","tool/my_menu_smoke.sh"],"depends_on":["UI-DIFF-01"]},{"id":"UI-NAV-RSS-01","title":"RssSubscriptionView 切换到 iOS 大标题导航并改为 Sliver 结构","priority":6,"prompt":"改动范围：`lib/features/rss/views/rss_subscription_view.dart`\n\n预期行为：\n- 使用 `AppCupertinoPageScaffold(useSliverNavigationBar: true, child: const SizedBox.shrink(), sliverBodyBuilder: ...)` 结构，将现有顶部搜索框/计数行/列表改成 Sliver（例如 `SliverToBoxAdapter` + `SliverList` / `SliverFixedExtentList`），避免双滚动。\n- 页面交互语义不变：搜索过滤即时生效、右上角按钮（收藏/分组/设置）功能不变、空态/加载态布局语义不变（仅容器/滚动结构调整）。\n- 侧滑返回与现有 Cupertino 路由栈行为不变。\n验证方式：\n- 运行仓库已有 compile test：`flutter test test/rss_subscription_view_compile_test.dart`。\n- 手工回归：进入“订阅”tab，检查大标题收起/展开、搜索框吸顶/布局、列表滚动与按钮可用。","verify_cmd":"flutter test test/rss_subscription_view_compile_test.dart","required_paths":["lib/features/rss/views/rss_subscription_view.dart","test/rss_subscription_view_compile_test.dart"],"depends_on":["UI-DIFF-01"]}],"notes":["约束提醒：除需求方明确要求外，不新增/改造任何测试用例；本批验证优先使用现有 compile test 与脚本，不运行 `flutter analyze`（仅在最终提交推送前执行一次）。","legado 复刻前置：凡涉及交互/状态流转变更的 UI 任务，在动手前必须先在 `../legado` 中定位对应实现并完整阅读相关文件后再下结论；无法确认则按 AGENTS 1.1.2 标记 blocked。","并行说明：本批任务按依赖全部串行（2~6 依赖 UI-DIFF-01），避免在未完成差异清单前启动实现分支。"]}