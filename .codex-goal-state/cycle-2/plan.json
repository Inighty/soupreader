{"done":false,"done_reason":"目标未完成：台账仍存在 `D-04=in_progress` 与 `N-VAL-01=pending`，且 `updateToVariant` 取值与 legado 三值口径存在潜在偏差，需要继续收口。","goal_summary":"按 AGENTS.md 的迁移级要求，先复扫并固化差异清单，再完成 `D-04` 代码收口与 `N-VAL-01` 证据/台账闭环。","tasks":[{"id":"R2-T01-diff-rescan","title":"复扫 UI 差异并刷新基线台账","priority":1,"prompt":"改动范围：`docs/plans/2026-02-27-ui-cupertino-diff.md`、`docs/plans/2026-02-26-my-menu-id-diff.md`、`docs/plans/2026-02-26-my-menu-parity-checklist.md`。先执行迁移级任务必须的“差异点清单”复扫，逐项核对 `D-04`、`N-01~N-04`、`N-VAL-01` 与代码现状是否一致，清理过期描述（尤其是 `updateToVariant` 与 `NAV-DIFF-01` 的状态表述）。预期行为：三份台账状态一致、无互相矛盾文本，后续实现以该基线推进。验证方式：用 `rg` 定位关键状态词，确认不存在同一项同时出现冲突状态。","verify_cmd":"rg -n \"D-04=|N-VAL-01|NAV-DIFF-01|updateToVariant|pending|in_progress|done\" docs/plans/2026-02-27-ui-cupertino-diff.md docs/plans/2026-02-26-my-menu-id-diff.md docs/plans/2026-02-26-my-menu-parity-checklist.md","required_paths":["docs/plans/2026-02-27-ui-cupertino-diff.md","docs/plans/2026-02-26-my-menu-id-diff.md","docs/plans/2026-02-26-my-menu-parity-checklist.md"],"depends_on":[]},{"id":"R2-T02-d04-variant-parity","title":"收口 updateToVariant 取值到 legado 三值语义","priority":2,"prompt":"改动范围：`lib/core/models/app_settings.dart`、`lib/features/settings/views/other_settings_view.dart`（必要时同步 `lib/core/services/settings_service.dart` 的兜底逻辑）。将 `updateToVariant` 取值严格对齐 legado：仅保留 `default_version`、`beta_release_version`、`beta_releaseA_version` 三值；移除 UI 中非 legado 选项；对历史非三值数据做归一化回退。预期行为：设置页仅展示三种可选版本，保存后持久化与回显稳定，旧数据不会导致异常或显示脏值。验证方式：检索常量与选项渲染，确认不存在额外 variant；并检查归一化函数覆盖兜底。","verify_cmd":"rg -n \"officialUpdateToVariant|default_version|beta_release_version|beta_releaseA_version|updateToVariantLabel|检查更新查找版本\" lib/core/models/app_settings.dart lib/features/settings/views/other_settings_view.dart lib/core/services/settings_service.dart","required_paths":["lib/core/models/app_settings.dart","lib/features/settings/views/other_settings_view.dart","lib/core/services/settings_service.dart"],"depends_on":["R2-T01-diff-rescan"]},{"id":"R2-T03-d04-web-boundary-readonly","title":"完善 Other 设置页 Web 边界只读回显文案","priority":3,"prompt":"改动范围：`lib/features/settings/views/other_settings_view.dart`。在不触发 `EX-01`（不接入 WebService 运行态）的前提下，统一 Web 区只读项的文案与排版：明确“仅说明不可操作”，并稳定展示当前配置值（端口、唤醒锁）以满足“只读回显优化”。预期行为：用户可看到当前值与禁用语义，但无可操作入口、无运行态误导。验证方式：检索 `Web 服务（未启用）` 区块文案与条目，确认无 `onTap`/开关/编辑入口，仅保留只读展示。","verify_cmd":"rg -n \"Web 服务（未启用）|当前构建排除了 Web 服务|Web 端口|WebService 唤醒锁|onTap:|CupertinoSwitch\" lib/features/settings/views/other_settings_view.dart","required_paths":["lib/features/settings/views/other_settings_view.dart"],"depends_on":["R2-T02-d04-variant-parity"]},{"id":"R2-T04-nav-evidence-fill","title":"回填 N-VAL-01 四页导航回归证据","priority":4,"prompt":"改动范围：`docs/plans/evidence/2026-02-27-ui-nav-final-regression/R-N01-bookshelf.md`、`R-N02-discovery.md`、`R-N03-rss.md`、`R-N04-settings.md`。按既有模板回填 `N-AC-01~N-AC-03` 与“排版布局一致性”结果；`R-N03` 需明确记录 `noEnabled` 空态按钮进入订阅源管理的同义结论。预期行为：四份证据文件从待回填转为可审计结果，包含结果与处理动作。验证方式：`rg` 检查文件内不再出现“待回填/待验证”，并包含 `N-AC-01~03` 关键字段。","verify_cmd":"rg -n \"N-AC-01|N-AC-02|N-AC-03|排版布局一致性|结果|处理动作|待回填|待验证|noEnabled|订阅源管理\" docs/plans/evidence/2026-02-27-ui-nav-final-regression/R-N01-bookshelf.md docs/plans/evidence/2026-02-27-ui-nav-final-regression/R-N02-discovery.md docs/plans/evidence/2026-02-27-ui-nav-final-regression/R-N03-rss.md docs/plans/evidence/2026-02-27-ui-nav-final-regression/R-N04-settings.md","required_paths":["docs/plans/evidence/2026-02-27-ui-nav-final-regression/R-N01-bookshelf.md","docs/plans/evidence/2026-02-27-ui-nav-final-regression/R-N02-discovery.md","docs/plans/evidence/2026-02-27-ui-nav-final-regression/R-N03-rss.md","docs/plans/evidence/2026-02-27-ui-nav-final-regression/R-N04-settings.md"],"depends_on":["R2-T01-diff-rescan","R2-T03-d04-web-boundary-readonly"]},{"id":"R2-T05-closeout-status-sync","title":"同步 N-VAL-01 与 D-04 收口状态","priority":5,"prompt":"改动范围：`docs/plans/2026-02-27-ui-cupertino-diff.md`、`docs/plans/2026-02-26-my-menu-parity-checklist.md`、`PLANS.md`。在证据回填完成后，统一更新 `N-VAL-01`、`N-01~N-04` 与 `D-04` 状态描述、依赖链与收口结论，移除“证据待回填/待收口”过期表述。预期行为：总计划与两份台账状态一致，能够直接反映当前完成面。验证方式：检索关键状态词，确认同一 ID 在三处文档中的状态一致。","verify_cmd":"rg -n \"N-VAL-01|N-01|N-02|N-03|N-04|D-04|证据待回填|待收口|pending|in_progress|done\" docs/plans/2026-02-27-ui-cupertino-diff.md docs/plans/2026-02-26-my-menu-parity-checklist.md PLANS.md","required_paths":["docs/plans/2026-02-27-ui-cupertino-diff.md","docs/plans/2026-02-26-my-menu-parity-checklist.md","PLANS.md"],"depends_on":["R2-T04-nav-evidence-fill"]},{"id":"R2-T06-cupertino-guard-check","title":"执行 Cupertino 约束定向检查并回填结果","priority":6,"prompt":"改动范围：`docs/plans/2026-02-27-ui-cupertino-diff.md`（新增“定向检查结果”小节）。执行定向扫描，确认 `lib/` 下无 `shadcn_ui`、`showGeneralDialog`、`material.dart` 残留，且四个核心页仍保持 `useSliverNavigationBar: true`。预期行为：形成可复用的提交前检查记录，满足 AGENTS 的 Cupertino 主实现约束。验证方式：运行给定 `rg` 命令并将命中摘要回填文档。","verify_cmd":"rg -n \"shadcn_ui|showGeneralDialog|package:flutter/material.dart|useSliverNavigationBar:\\s*true\" lib","required_paths":["docs/plans/2026-02-27-ui-cupertino-diff.md","lib/features/bookshelf/views/bookshelf_view.dart","lib/features/discovery/views/discovery_view.dart","lib/features/rss/views/rss_subscription_view.dart","lib/features/settings/views/settings_view.dart"],"depends_on":["R2-T05-closeout-status-sync"]}],"notes":["按 AGENTS 要求，本批任务已保证“先差异清单、后实现、再收口”。","并行建议：`R2-T02` 与 `R2-T04` 可在 `R2-T01` 完成后并行；`R2-T05` 必须串行收口。"]}